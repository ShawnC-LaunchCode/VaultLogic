
> vault-logic@1.0.0 test
> vitest run --coverage tests/unit/ScriptEngine.test.ts tests/unit/LifecycleHookService.test.ts tests/unit/HelperLibrary.test.ts


[1m[46m RUN [49m[22m [36mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/HelperLibrary.test.ts [2m([22m[2m60 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 59[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return current date[32m 4[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should add days to date[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should subtract months from date[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should format dates[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should parse date strings[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should calculate date difference[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle invalid dates gracefully[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should convert to uppercase[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should convert to lowercase[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should trim whitespace[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should replace text[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should replace all occurrences[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should split strings[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should join arrays[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create slugs[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle empty strings[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should round numbers[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should ceil numbers[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should floor numbers[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should get absolute value[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should clamp numbers[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should format currency[32m 20[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should format percentages[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should get unique values[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should flatten arrays[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should chunk arrays[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should sort by property[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should filter arrays[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should map arrays[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle empty arrays[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should get object keys[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should get object values[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should pick properties[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should omit properties[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should merge objects[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deep merge objects[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle empty objects[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should generate random numbers[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should generate random integers[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should sum arrays[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should calculate average[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should find min[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should find max[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should capture console.log calls[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should capture console.warn calls[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should capture console.error calls[32m 0[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should capture mixed console calls in order[39m[32m 11[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle objects and arrays[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create independent console instances[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should export all helper categories[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have all expected date methods[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have all expected string methods[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have all expected number methods[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have all expected array methods[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have all expected object methods[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have all expected math methods[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle null/undefined inputs gracefully[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle non-numeric inputs to number helpers[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle invalid date formats[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle array operations on non-arrays[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/ScriptEngine.test.ts [2m([22m[2m26 tests[22m[2m | [22m[31m13 failed[39m[2m | [22m[33m4 skipped[39m[2m)[22m[32m 27[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should execute simple JavaScript code[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should whitelist input keys correctly[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should inject helpers into execution context[32m 0[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should inject context into execution[39m[32m 8[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should capture console logs when enabled[39m[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should handle errors gracefully[39m[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should enforce timeout[39m[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should handle missing emit() call[39m[32m 0[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should use custom helpers if provided[39m[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should measure execution duration[39m[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should execute simple Python code[39m[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should whitelist input keys in Python[39m[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should handle Python errors gracefully[39m[32m 1[2mms[22m[39m
         [2m[90mÎ“Ã¥Ã´[39m[22m should enforce timeout for Python
[31m         [31mâ”œÃ¹[31m should handle missing emit() in Python[39m[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate JavaScript syntax[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject invalid JavaScript syntax[39m[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject code exceeding size limit[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject empty code[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate Python requires emit()[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should accept Python code with emit()[32m 0[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should test execute with sample data
       [2m[90mÎ“Ã¥Ã´[39m[22m should capture console logs in test mode
       [2m[90mÎ“Ã¥Ã´[39m[22m should use test context
[31m       [31mâ”œÃ¹[31m should handle unexpected errors gracefully[39m[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle malformed output gracefully[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":40,"time":1765388913473,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1765388913479,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1765388913481,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1765388913485,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1765388913486,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 24[2mms[22m[39m

[2m Test Files [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m1 passed[39m[22m[90m (3)[39m
[2m      Tests [22m [1m[31m14 failed[39m[22m[2m | [22m[1m[32m85 passed[39m[22m[2m | [22m[33m4 skipped[39m[90m (103)[39m
[2m   Start at [22m 11:48:31
[2m   Duration [22m 5.84s[2m (transform 856ms, setup 2.13s, collect 1.13s, tests 111ms, environment 1ms, prepare 113ms)[22m

