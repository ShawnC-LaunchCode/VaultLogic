npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764866669763,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764866671548,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764866672853,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764866672853,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764866672858,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764866672858,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764866672858,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764866672858,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764866673883,"env":"test","module":"user-credentials-repository","userId":"o9wNMdG9nEBxq3FkeQ0J6","msg":"User credentials created"}
{"level":30,"time":1764866673885,"env":"test","module":"auth-routes","userId":"o9wNMdG9nEBxq3FkeQ0J6","email":"test-workflows-6SVuxkAz2yZknif0X3Ho8@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"87e855f7-f8f7-461c-9080-532ca18f524c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"o9wNMdG9nEBxq3FkeQ0J6","tenantId":"64b148c1-eb6f-4c4f-b657-465373069fa5","createdBy":"o9wNMdG9nEBxq3FkeQ0J6","ownerId":"o9wNMdG9nEBxq3FkeQ0J6","status":"active","archived":false,"createdAt":"2025-12-04T16:44:35.382Z","updatedAt":"2025-12-04T16:44:35.382Z"}

{"level":30,"time":1764866674636,"env":"test","module":"user-credentials-repository","userId":"dSUO3ZO64mv0KVkngsuLV","msg":"User credentials created"}
{"level":30,"time":1764866674636,"env":"test","module":"auth-routes","userId":"dSUO3ZO64mv0KVkngsuLV","email":"viewer-G1VBaE2nREJe_9TEUZmAp@example.com","msg":"User registered successfully"}
{"level":40,"time":1764866674738,"env":"test","module":"rbac-middleware","userId":"dSUO3ZO64mv0KVkngsuLV","userRole":"viewer","permission":"workflow:create","path":"/projects/87e855f7-f8f7-461c-9080-532ca18f524c/workflows","msg":"Permission denied"}
{"level":50,"time":1764866681502,"env":"test","error":{},"workflowId":"a6da4ca7-1ec4-4b9c-a6a4-69db18f6ccf9","userId":"o9wNMdG9nEBxq3FkeQ0J6","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764866681847,"env":"test","module":"auth-middleware","path":"/api/workflows/2ea643bb-6b91-4687-92e4-d8be60356462/move","msg":"No valid authentication found"}
{"level":30,"time":1764866682392,"env":"test","module":"user-credentials-repository","userId":"tQHYE57XF-gWgE_-3l__Z","msg":"User credentials created"}
{"level":30,"time":1764866682392,"env":"test","module":"auth-routes","userId":"tQHYE57XF-gWgE_-3l__Z","email":"test-workflows-ldRgKhIR7c9BmFFT8qgyB@example.com","msg":"User registered successfully"}
{"level":50,"time":1764866682451,"env":"test","error":{},"workflowId":"656e6f85-c21c-4331-a10c-bd672e017f80","userId":"tQHYE57XF-gWgE_-3l__Z","projectId":"5c314660-556a-4318-80bb-a6ec0b573281","msg":"Error moving workflow"}
{"level":50,"time":1764866682930,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"08dcd128-7d49-47b6-806e-c08e48751369","userId":"o9wNMdG9nEBxq3FkeQ0J6","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764866683321,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"5af7d980-a25f-47af-9b18-8c6cd82b382d","userId":"o9wNMdG9nEBxq3FkeQ0J6","msg":"Error moving workflow"}
{"level":30,"time":1764866683870,"env":"test","module":"user-credentials-repository","userId":"DtCBBD60mnzB8iTMsl3tl","msg":"User credentials created"}
{"level":30,"time":1764866683871,"env":"test","module":"auth-routes","userId":"DtCBBD60mnzB8iTMsl3tl","email":"test-workflows-q6q37h24OJmVolIU7eZ0Q@example.com","msg":"User registered successfully"}
{"level":30,"time":1764866684078,"env":"test","module":"auth-routes","userId":"DtCBBD60mnzB8iTMsl3tl","email":"test-workflows-q6q37h24OJmVolIU7eZ0Q@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764866684287,"env":"test","error":{},"workflowId":"56275b42-0742-4842-82f0-233d270b6ee1","userId":"o9wNMdG9nEBxq3FkeQ0J6","projectId":"62316413-3124-40b8-a4e4-ce6dbbf7ee41","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 12034[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 380[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 510[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 506[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 831[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 677[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 805[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 685[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 526[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 966[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:44:27
[2m   Duration [22m 17.53s[2m (transform 2.60s, setup 625ms, collect 4.35s, tests 12.03s, environment 0ms, prepare 19ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764866788387,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764866789708,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764866791155,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764866791156,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764866791165,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764866791165,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764866791166,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764866791166,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764866791628,"env":"test","module":"user-credentials-repository","userId":"KsKdc2Yd05K98FCuWXqdJ","msg":"User credentials created"}
{"level":30,"time":1764866791631,"env":"test","module":"auth-routes","userId":"KsKdc2Yd05K98FCuWXqdJ","email":"test-workflows-r8R9kHrh3DDv71uiD4VPZ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d2e55fdb-ae3f-4e77-ae44-81b7cbc1cff7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"KsKdc2Yd05K98FCuWXqdJ","tenantId":"d081fde0-dbc3-4a57-a81a-af6560383f20","createdBy":"KsKdc2Yd05K98FCuWXqdJ","ownerId":"KsKdc2Yd05K98FCuWXqdJ","status":"active","archived":false,"createdAt":"2025-12-04T16:46:33.124Z","updatedAt":"2025-12-04T16:46:33.124Z"}

{"level":30,"time":1764866792384,"env":"test","module":"user-credentials-repository","userId":"WQnp-jGT4giNm_FisSwdh","msg":"User credentials created"}
{"level":30,"time":1764866792384,"env":"test","module":"auth-routes","userId":"WQnp-jGT4giNm_FisSwdh","email":"viewer-ddxOsGgAJUK7etAF5_Gue@example.com","msg":"User registered successfully"}
{"level":40,"time":1764866792489,"env":"test","module":"rbac-middleware","userId":"WQnp-jGT4giNm_FisSwdh","userRole":"viewer","permission":"workflow:create","path":"/projects/d2e55fdb-ae3f-4e77-ae44-81b7cbc1cff7/workflows","msg":"Permission denied"}
{"level":50,"time":1764866799559,"env":"test","error":{},"workflowId":"f96b6201-0f0f-4879-98a0-697fb358f842","userId":"KsKdc2Yd05K98FCuWXqdJ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764866799921,"env":"test","module":"auth-middleware","path":"/api/workflows/e51bda4d-691d-46fd-a122-30070e6618e3/move","msg":"No valid authentication found"}
{"level":30,"time":1764866800496,"env":"test","module":"user-credentials-repository","userId":"vohyehziwsFLqcmjrLY76","msg":"User credentials created"}
{"level":30,"time":1764866800497,"env":"test","module":"auth-routes","userId":"vohyehziwsFLqcmjrLY76","email":"test-workflows-ScZhYHPPbUSYkomcl2nVW@example.com","msg":"User registered successfully"}
{"level":50,"time":1764866800553,"env":"test","error":{},"workflowId":"68f5eb94-f720-4233-9b80-5b2b0d8eb6f8","userId":"vohyehziwsFLqcmjrLY76","projectId":"0151adb0-06c9-41de-99db-7b6151ea09b9","msg":"Error moving workflow"}
{"level":50,"time":1764866800956,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"5bec43da-9046-4c08-8e77-a330369ae58b","userId":"KsKdc2Yd05K98FCuWXqdJ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764866801355,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0268ecfb-563e-4a51-8cb3-c44c517b2f0a","userId":"KsKdc2Yd05K98FCuWXqdJ","msg":"Error moving workflow"}
{"level":50,"time":1764866801942,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rMMa2nxUbSmjk1j1E-akP) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"rMMa2nxUbSmjk1j1E-akP","msg":"Failed to create user credentials"}
{"level":50,"time":1764866801943,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rMMa2nxUbSmjk1j1E-akP) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11221[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 386[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 512[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 509[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 941[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 687[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 785[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 534[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 403[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 399[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 588[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:46:26
[2m   Duration [22m 15.79s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764867267324,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867268782,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867270496,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867270496,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867270505,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867270505,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867270505,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867270505,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867270933,"env":"test","module":"user-credentials-repository","userId":"gNzgvFAi4pJmqvmVHkP8L","msg":"User credentials created"}
{"level":30,"time":1764867270936,"env":"test","module":"auth-routes","userId":"gNzgvFAi4pJmqvmVHkP8L","email":"test-workflows-dMVnd2Rs_W6JwL4XYmdhy@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f4a1ae0a-3aee-457d-a530-48d57451a011","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"gNzgvFAi4pJmqvmVHkP8L","tenantId":"4aa9cf76-cf12-4108-86e2-799664f0da63","createdBy":"gNzgvFAi4pJmqvmVHkP8L","ownerId":"gNzgvFAi4pJmqvmVHkP8L","status":"active","archived":false,"createdAt":"2025-12-04T16:54:32.430Z","updatedAt":"2025-12-04T16:54:32.430Z"}

{"level":30,"time":1764867271606,"env":"test","module":"user-credentials-repository","userId":"hIykZVvgd2AMIeR0n3Kj1","msg":"User credentials created"}
{"level":30,"time":1764867271607,"env":"test","module":"auth-routes","userId":"hIykZVvgd2AMIeR0n3Kj1","email":"viewer-q0GZmMgLVJs83zvnbWd1b@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867271693,"env":"test","module":"rbac-middleware","userId":"hIykZVvgd2AMIeR0n3Kj1","userRole":"viewer","permission":"workflow:create","path":"/projects/f4a1ae0a-3aee-457d-a530-48d57451a011/workflows","msg":"Permission denied"}
{"level":50,"time":1764867278316,"env":"test","error":{},"workflowId":"9a9ebe72-af9c-4061-b2e7-a6726f3c17a5","userId":"gNzgvFAi4pJmqvmVHkP8L","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867278651,"env":"test","module":"auth-middleware","path":"/api/workflows/81c3d940-edc8-4247-bf55-8f5b2dc6cc57/move","msg":"No valid authentication found"}
{"level":30,"time":1764867279165,"env":"test","module":"user-credentials-repository","userId":"A71PdKFSD2IaZ85J7e6nD","msg":"User credentials created"}
{"level":30,"time":1764867279165,"env":"test","module":"auth-routes","userId":"A71PdKFSD2IaZ85J7e6nD","email":"test-workflows-MrMBOixz7LxKQ9aiTQGfv@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867279211,"env":"test","error":{},"workflowId":"ffe39ca9-d7fa-46c6-8b43-c844225e328b","userId":"A71PdKFSD2IaZ85J7e6nD","projectId":"18dafbed-0f29-4248-b07c-763c60ebb87f","msg":"Error moving workflow"}
{"level":50,"time":1764867279599,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9da20ce3-998f-4f06-a7c8-938b3190a7b7","userId":"gNzgvFAi4pJmqvmVHkP8L","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867279974,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"12c5c480-847e-4945-a995-a2e77507a576","userId":"gNzgvFAi4pJmqvmVHkP8L","msg":"Error moving workflow"}
{"level":30,"time":1764867280494,"env":"test","module":"user-credentials-repository","userId":"owk4hoMyWDac1JYTvdLJH","msg":"User credentials created"}
{"level":30,"time":1764867280494,"env":"test","module":"auth-routes","userId":"owk4hoMyWDac1JYTvdLJH","email":"test-workflows-zKYTCi9ZCwZsfePoDhMXh@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867280708,"env":"test","module":"auth-routes","userId":"owk4hoMyWDac1JYTvdLJH","email":"test-workflows-zKYTCi9ZCwZsfePoDhMXh@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867280899,"env":"test","error":{},"workflowId":"dc024973-8552-407d-9219-b5bbe45c334d","userId":"gNzgvFAi4pJmqvmVHkP8L","projectId":"9c473930-2b67-4105-a33c-5a2342590932","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10676[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 816[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 681[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 626[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 861[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 926[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

[2m   Start at [22m 10:54:25
[2m   Duration [22m 15.74s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764867556238,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867558222,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867560460,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867560461,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867560474,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867560474,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867560474,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867560474,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867560962,"env":"test","module":"user-credentials-repository","userId":"ph5yPX8Kug6NeJAz1nNMV","msg":"User credentials created"}
{"level":30,"time":1764867560967,"env":"test","module":"auth-routes","userId":"ph5yPX8Kug6NeJAz1nNMV","email":"test-workflows-w3XqHBHNlu8pLK_0SdK6U@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c5c18353-8c98-4239-9f39-3067771cd2e2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ph5yPX8Kug6NeJAz1nNMV","tenantId":"dfe6712a-107b-4ae0-9587-9e99f2cdbf0e","createdBy":"ph5yPX8Kug6NeJAz1nNMV","ownerId":"ph5yPX8Kug6NeJAz1nNMV","status":"active","archived":false,"createdAt":"2025-12-04T16:59:22.471Z","updatedAt":"2025-12-04T16:59:22.471Z"}

{"level":30,"time":1764867561634,"env":"test","module":"user-credentials-repository","userId":"_vqnGeFOAEM5z8mAnBwn4","msg":"User credentials created"}
{"level":30,"time":1764867561635,"env":"test","module":"auth-routes","userId":"_vqnGeFOAEM5z8mAnBwn4","email":"viewer-tI6J6x1MM96Nc_aUzt1Rc@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867561725,"env":"test","module":"rbac-middleware","userId":"_vqnGeFOAEM5z8mAnBwn4","userRole":"viewer","permission":"workflow:create","path":"/projects/c5c18353-8c98-4239-9f39-3067771cd2e2/workflows","msg":"Permission denied"}
{"level":50,"time":1764867567869,"env":"test","error":{},"workflowId":"2baaada3-bfac-47a4-89dd-854c49c2c3cf","userId":"ph5yPX8Kug6NeJAz1nNMV","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867568178,"env":"test","module":"auth-middleware","path":"/api/workflows/2439f95c-facb-4edf-9e1c-16cc9c47b433/move","msg":"No valid authentication found"}
{"level":30,"time":1764867568662,"env":"test","module":"user-credentials-repository","userId":"lJqTrE5gd1vbX3Gq77RQI","msg":"User credentials created"}
{"level":30,"time":1764867568663,"env":"test","module":"auth-routes","userId":"lJqTrE5gd1vbX3Gq77RQI","email":"test-workflows-miE9bra_Lsmn6Zcd-DgOE@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867568711,"env":"test","error":{},"workflowId":"22bf9d7c-1586-4817-91db-3e3c2789bc7d","userId":"lJqTrE5gd1vbX3Gq77RQI","projectId":"2539da8b-3e22-4cd6-8388-4a86f9a84461","msg":"Error moving workflow"}
{"level":50,"time":1764867569073,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"cbf8e5e5-1868-4f1b-a666-27c82dca3827","userId":"ph5yPX8Kug6NeJAz1nNMV","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867569434,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9e72004a-254d-4ed4-a958-ebeb0e7e2f6c","userId":"ph5yPX8Kug6NeJAz1nNMV","msg":"Error moving workflow"}
{"level":30,"time":1764867569946,"env":"test","module":"user-credentials-repository","userId":"YCCqgjA0E2MaNwZZVA3Hc","msg":"User credentials created"}
{"level":30,"time":1764867569947,"env":"test","module":"auth-routes","userId":"YCCqgjA0E2MaNwZZVA3Hc","email":"test-workflows-d2VZA9EH08nrKkWyVKBFz@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867570187,"env":"test","module":"auth-routes","userId":"YCCqgjA0E2MaNwZZVA3Hc","email":"test-workflows-d2VZA9EH08nrKkWyVKBFz@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867570361,"env":"test","error":{},"workflowId":"e68dee56-6cb5-4bea-b552-39972ee10f2a","userId":"ph5yPX8Kug6NeJAz1nNMV","projectId":"e61ed4b4-6e9a-499f-a3fc-996228058399","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10162[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 320[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 429[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 778[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 643[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 617[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 534[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 361[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 927[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:59:13
[2m   Duration [22m 16.85s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764867688980,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867690722,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867692589,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867692589,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867692597,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867692597,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867692598,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867692598,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867693036,"env":"test","module":"user-credentials-repository","userId":"T6RI3NIyZO7ZjM5hbZhVf","msg":"User credentials created"}
{"level":30,"time":1764867693039,"env":"test","module":"auth-routes","userId":"T6RI3NIyZO7ZjM5hbZhVf","email":"test-workflows-QtJa_YAgijFh7CfBRQ7SA@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d0b62ff7-6e94-434a-a368-596236b7103a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"T6RI3NIyZO7ZjM5hbZhVf","tenantId":"22481cf7-901f-4caa-bfc8-cd4e200f86d2","createdBy":"T6RI3NIyZO7ZjM5hbZhVf","ownerId":"T6RI3NIyZO7ZjM5hbZhVf","status":"active","archived":false,"createdAt":"2025-12-04T17:01:34.549Z","updatedAt":"2025-12-04T17:01:34.549Z"}

{"level":30,"time":1764867693721,"env":"test","module":"user-credentials-repository","userId":"EnCgnhptIbdB6p6P8WOpu","msg":"User credentials created"}
{"level":30,"time":1764867693721,"env":"test","module":"auth-routes","userId":"EnCgnhptIbdB6p6P8WOpu","email":"viewer-EFqqlGPmSpyndx0OzXwU5@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867693812,"env":"test","module":"rbac-middleware","userId":"EnCgnhptIbdB6p6P8WOpu","userRole":"viewer","permission":"workflow:create","path":"/projects/d0b62ff7-6e94-434a-a368-596236b7103a/workflows","msg":"Permission denied"}
{"level":50,"time":1764867699927,"env":"test","error":{},"workflowId":"88508b63-d55e-4429-8af0-78595501a8ff","userId":"T6RI3NIyZO7ZjM5hbZhVf","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867700237,"env":"test","module":"auth-middleware","path":"/api/workflows/dcd68f3d-efb5-4449-9724-dd5b1e5568ec/move","msg":"No valid authentication found"}
{"level":30,"time":1764867700740,"env":"test","module":"user-credentials-repository","userId":"pby9XdLAIZGAGrsUVM68j","msg":"User credentials created"}
{"level":30,"time":1764867700741,"env":"test","module":"auth-routes","userId":"pby9XdLAIZGAGrsUVM68j","email":"test-workflows-IZb8ol_fJBiCQm007XK-E@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867700788,"env":"test","error":{},"workflowId":"8096f364-754f-4e92-986b-375169d266a2","userId":"pby9XdLAIZGAGrsUVM68j","projectId":"be5511ad-78f5-482c-99e1-a8e5d334a7b4","msg":"Error moving workflow"}
{"level":50,"time":1764867701158,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"fd16bcfc-f200-47f2-a59f-00649c495711","userId":"T6RI3NIyZO7ZjM5hbZhVf","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867701516,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"88aa72a8-af09-4076-b9a9-b1971b3493ae","userId":"T6RI3NIyZO7ZjM5hbZhVf","msg":"Error moving workflow"}
{"level":30,"time":1764867702019,"env":"test","module":"user-credentials-repository","userId":"DZ2wtHRg7nfPBF_KCfvvl","msg":"User credentials created"}
{"level":30,"time":1764867702019,"env":"test","module":"auth-routes","userId":"DZ2wtHRg7nfPBF_KCfvvl","email":"test-workflows-tLkp8llf9x_V5sJOiof5b@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867702161,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764867702213,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"577fb36d-6157-44c7-8499-42f899438564","userId":"T6RI3NIyZO7ZjM5hbZhVf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9884[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 618[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 582[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 441[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 552[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 357[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 698[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10

    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:01:26
[2m   Duration [22m 15.86s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764868031636,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868033469,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868035484,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868035484,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868035494,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868035494,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868035494,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868035494,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868036518,"env":"test","module":"user-credentials-repository","userId":"EFzrBXQ6uGvK8byz4eQtM","msg":"User credentials created"}
{"level":30,"time":1764868036521,"env":"test","module":"auth-routes","userId":"EFzrBXQ6uGvK8byz4eQtM","email":"test-workflows-yUqPDliKqkqnew2J8tSzN@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"22b36647-32a2-4ab4-84cb-3faf06aa80d5","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"EFzrBXQ6uGvK8byz4eQtM","tenantId":"f071812b-f71c-4948-bae2-2518afd0a6a3","createdBy":"EFzrBXQ6uGvK8byz4eQtM","ownerId":"EFzrBXQ6uGvK8byz4eQtM","status":"active","archived":false,"createdAt":"2025-12-04T17:07:18.043Z","updatedAt":"2025-12-04T17:07:18.043Z"}

{"level":30,"time":1764868037297,"env":"test","module":"user-credentials-repository","userId":"fdj2KJLlmhm5LHTmmorDu","msg":"User credentials created"}
{"level":30,"time":1764868037298,"env":"test","module":"auth-routes","userId":"fdj2KJLlmhm5LHTmmorDu","email":"viewer-jKOALfPjTJxPTLoFzyAOL@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868037394,"env":"test","module":"rbac-middleware","userId":"fdj2KJLlmhm5LHTmmorDu","userRole":"viewer","permission":"workflow:create","path":"/projects/22b36647-32a2-4ab4-84cb-3faf06aa80d5/workflows","msg":"Permission denied"}
{"level":50,"time":1764868043492,"env":"test","error":{},"workflowId":"3c5437ff-37f8-432b-b20a-814c45df540b","userId":"EFzrBXQ6uGvK8byz4eQtM","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868043849,"env":"test","module":"auth-middleware","path":"/api/workflows/52671ec1-24fe-4c41-94f8-df0184da0a85/move","msg":"No valid authentication found"}
{"level":30,"time":1764868044356,"env":"test","module":"user-credentials-repository","userId":"C8DLvlLOIumW5HSX44ed9","msg":"User credentials created"}
{"level":30,"time":1764868044357,"env":"test","module":"auth-routes","userId":"C8DLvlLOIumW5HSX44ed9","email":"test-workflows-k0gXHzAL9SkXPwGxG5Pf9@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868044399,"env":"test","error":{},"workflowId":"420d1629-e683-43fd-84cd-3b5053564aff","userId":"C8DLvlLOIumW5HSX44ed9","projectId":"daa800f1-4030-4513-9c90-efcda5d2fa38","msg":"Error moving workflow"}
{"level":50,"time":1764868044752,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"d6b70321-558f-416c-b0fc-a75c1eca24c8","userId":"EFzrBXQ6uGvK8byz4eQtM","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868045122,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"91086239-b00b-4512-81ff-62f3fc227a6e","userId":"EFzrBXQ6uGvK8byz4eQtM","msg":"Error moving workflow"}
{"level":30,"time":1764868045666,"env":"test","module":"user-credentials-repository","userId":"CjuAR1yEBPplQ2w9nImE5","msg":"User credentials created"}
{"level":30,"time":1764868045667,"env":"test","module":"auth-routes","userId":"CjuAR1yEBPplQ2w9nImE5","email":"test-workflows-nCreSPglRmuEzkDpUuYU8@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868045853,"env":"test","module":"auth-routes","userId":"CjuAR1yEBPplQ2w9nImE5","email":"test-workflows-nCreSPglRmuEzkDpUuYU8@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868046045,"env":"test","error":{},"workflowId":"af3fec6b-13c8-4e0d-b599-4fe7ecd0b395","userId":"EFzrBXQ6uGvK8byz4eQtM","projectId":"34eaaf4e-8f41-40eb-a877-f4b95f23cefd","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11105[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 301[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 582[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 702[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 589[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 357[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 550[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 924[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:07:08
[2m   Duration [22m 17.55s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764868270474,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868272287,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868274140,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868274141,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868274156,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868274156,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868274157,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868274157,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868274590,"env":"test","module":"user-credentials-repository","userId":"9REeMAnT-frPkDYFa4xp2","msg":"User credentials created"}
{"level":30,"time":1764868274593,"env":"test","module":"auth-routes","userId":"9REeMAnT-frPkDYFa4xp2","email":"test-workflows-Wgd1w1g9j2YhBHcSatXvi@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"6e0167c1-22d8-4aee-aee0-636030c718aa","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"9REeMAnT-frPkDYFa4xp2","tenantId":"4fd1884d-e1b0-416a-8eb3-5953e8baa40b","createdBy":"9REeMAnT-frPkDYFa4xp2","ownerId":"9REeMAnT-frPkDYFa4xp2","status":"active","archived":false,"createdAt":"2025-12-04T17:11:16.110Z","updatedAt":"2025-12-04T17:11:16.110Z"}

{"level":30,"time":1764868275284,"env":"test","module":"user-credentials-repository","userId":"Qkl3KJAK82na6Tx-bDKGl","msg":"User credentials created"}
{"level":30,"time":1764868275285,"env":"test","module":"auth-routes","userId":"Qkl3KJAK82na6Tx-bDKGl","email":"viewer-6-oNBLIjEOzcW6dQT2zNz@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868275376,"env":"test","module":"rbac-middleware","userId":"Qkl3KJAK82na6Tx-bDKGl","userRole":"viewer","permission":"workflow:create","path":"/projects/6e0167c1-22d8-4aee-aee0-636030c718aa/workflows","msg":"Permission denied"}
{"level":50,"time":1764868281624,"env":"test","error":{},"workflowId":"cead001d-7da9-456c-9a93-126818df9bc4","userId":"9REeMAnT-frPkDYFa4xp2","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868281957,"env":"test","module":"auth-middleware","path":"/api/workflows/58fd486a-8019-4a51-90d5-d90c955ef5f8/move","msg":"No valid authentication found"}
{"level":30,"time":1764868282461,"env":"test","module":"user-credentials-repository","userId":"pQSmcpjg_OtPGQfFu0Ff4","msg":"User credentials created"}
{"level":30,"time":1764868282461,"env":"test","module":"auth-routes","userId":"pQSmcpjg_OtPGQfFu0Ff4","email":"test-workflows-r2SD6Aqn7Iv8ImWURt9h2@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868282505,"env":"test","error":{},"workflowId":"fa6b9072-b846-4020-a8af-1df15a9220ef","userId":"pQSmcpjg_OtPGQfFu0Ff4","projectId":"62eee98b-ee33-4046-ad62-ac5d30129873","msg":"Error moving workflow"}
{"level":50,"time":1764868282860,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b087e414-cd06-4e70-a3e9-7ae4378d0cdc","userId":"9REeMAnT-frPkDYFa4xp2","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868283245,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"20bfe67f-35c5-4313-a2d1-91a345f8e0a5","userId":"9REeMAnT-frPkDYFa4xp2","msg":"Error moving workflow"}
{"level":30,"time":1764868283762,"env":"test","module":"user-credentials-repository","userId":"8_U2sdWNiKBSbQLXXTgqJ","msg":"User credentials created"}
{"level":30,"time":1764868283763,"env":"test","module":"auth-routes","userId":"8_U2sdWNiKBSbQLXXTgqJ","email":"test-workflows-Yv9qlxwXzPM1XldGwwrie@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868283959,"env":"test","module":"auth-routes","userId":"8_U2sdWNiKBSbQLXXTgqJ","email":"test-workflows-Yv9qlxwXzPM1XldGwwrie@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868284184,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a87b7bf1-60ee-4a0b-b075-b06c4f0f73b9","userId":"9REeMAnT-frPkDYFa4xp2","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 676[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 354[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 386[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 940[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:11:07
[2m   Duration [22m 16.16s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764868528876,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531072,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533368,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533368,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533379,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533379,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533379,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533379,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868533834,"env":"test","module":"user-credentials-repository","userId":"shZFwFw7xPcoGb7B2jBZk","msg":"User credentials created"}
{"level":30,"time":1764868533836,"env":"test","module":"auth-routes","userId":"shZFwFw7xPcoGb7B2jBZk","email":"test-workflows-_zozMv-veuXmTFysD5fSR@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"95626d74-fc7b-429f-a92b-abddba851e78","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"shZFwFw7xPcoGb7B2jBZk","tenantId":"a3129cb1-ab82-4589-b250-af881670801e","createdBy":"shZFwFw7xPcoGb7B2jBZk","ownerId":"shZFwFw7xPcoGb7B2jBZk","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.361Z","updatedAt":"2025-12-04T17:15:35.361Z"}

{"level":30,"time":1764868534542,"env":"test","module":"user-credentials-repository","userId":"hIBNMOd6DVBu_Jdr6tVB7","msg":"User credentials created"}
{"level":30,"time":1764868534543,"env":"test","module":"auth-routes","userId":"hIBNMOd6DVBu_Jdr6tVB7","email":"viewer-_kaMfLPiHH225jbojhu0U@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534634,"env":"test","module":"rbac-middleware","userId":"hIBNMOd6DVBu_Jdr6tVB7","userRole":"viewer","permission":"workflow:create","path":"/projects/95626d74-fc7b-429f-a92b-abddba851e78/workflows","msg":"Permission denied"}
{"level":50,"time":1764868540956,"env":"test","error":{},"workflowId":"b2ec064c-0280-40ff-8d04-347a270ba406","userId":"shZFwFw7xPcoGb7B2jBZk","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541279,"env":"test","module":"auth-middleware","path":"/api/workflows/1c97ad6a-7333-4afb-b10c-0e187c4b4b09/move","msg":"No valid authentication found"}
{"level":30,"time":1764868541791,"env":"test","module":"user-credentials-repository","userId":"zLuCSfDhhWHYJx-fiNHIQ","msg":"User credentials created"}
{"level":30,"time":1764868541792,"env":"test","module":"auth-routes","userId":"zLuCSfDhhWHYJx-fiNHIQ","email":"test-workflows-vNJ4lwkTm84Oo_CD_hvUZ@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868541839,"env":"test","error":{},"workflowId":"f9c0cfb0-4d4f-4e82-9381-be10d0252c4a","userId":"zLuCSfDhhWHYJx-fiNHIQ","projectId":"12d68394-b64d-4fdb-8c45-772dfe07e96f","msg":"Error moving workflow"}
{"level":50,"time":1764868542223,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"1b78b251-b820-486a-ae5d-5d8724a90483","userId":"shZFwFw7xPcoGb7B2jBZk","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868542703,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e409cb83-a76a-415e-992f-854a88440269","userId":"shZFwFw7xPcoGb7B2jBZk","msg":"Error moving workflow"}
{"level":30,"time":1764868543356,"env":"test","module":"user-credentials-repository","userId":"ckM-VMSvxeZp3EA5KDx9d","msg":"User credentials created"}
{"level":30,"time":1764868543357,"env":"test","module":"auth-routes","userId":"ckM-VMSvxeZp3EA5KDx9d","email":"test-workflows-9F_A26Ape1C2vVGkqmanM@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868543549,"env":"test","module":"auth-routes","userId":"ckM-VMSvxeZp3EA5KDx9d","email":"test-workflows-9F_A26Ape1C2vVGkqmanM@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868543792,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"019acc68-e0fc-4467-baf3-d81d5b6fbdc4","userId":"shZFwFw7xPcoGb7B2jBZk","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 589[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 479[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1090[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 17.97s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764868816063,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818335,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820452,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820452,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820463,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820464,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820464,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820464,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868820966,"env":"test","module":"user-credentials-repository","userId":"ol9ulgsBbv0YmIIRbiUoC","msg":"User credentials created"}
{"level":30,"time":1764868820970,"env":"test","module":"auth-routes","userId":"ol9ulgsBbv0YmIIRbiUoC","email":"test-workflows--Tl1GSYEr43X9zrOx1sno@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e9b7c7dd-9c5a-4494-a7c3-7210eefc730f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ol9ulgsBbv0YmIIRbiUoC","tenantId":"70dc8fcd-1d04-4c91-9fbf-5b848ae71d44","createdBy":"ol9ulgsBbv0YmIIRbiUoC","ownerId":"ol9ulgsBbv0YmIIRbiUoC","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.495Z","updatedAt":"2025-12-04T17:20:22.495Z"}

{"level":30,"time":1764868821643,"env":"test","module":"user-credentials-repository","userId":"r0TqMSRrfFjan3ITvf4jM","msg":"User credentials created"}
{"level":30,"time":1764868821644,"env":"test","module":"auth-routes","userId":"r0TqMSRrfFjan3ITvf4jM","email":"viewer-hZ-aOFCl7T6i4eqT2P4B5@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821742,"env":"test","module":"rbac-middleware","userId":"r0TqMSRrfFjan3ITvf4jM","userRole":"viewer","permission":"workflow:create","path":"/projects/e9b7c7dd-9c5a-4494-a7c3-7210eefc730f/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828161,"env":"test","error":{},"workflowId":"7fe4accc-b11b-469c-84da-d9812e0ddbda","userId":"ol9ulgsBbv0YmIIRbiUoC","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828497,"env":"test","module":"auth-middleware","path":"/api/workflows/094bc1dc-8e49-4b9e-9393-da4237f006d2/move","msg":"No valid authentication found"}
{"level":30,"time":1764868829023,"env":"test","module":"user-credentials-repository","userId":"K0d9yCuMyGKb5UOCN9SXd","msg":"User credentials created"}
{"level":30,"time":1764868829024,"env":"test","module":"auth-routes","userId":"K0d9yCuMyGKb5UOCN9SXd","email":"test-workflows-Rij_YojgwENJuUjTD8COm@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868829075,"env":"test","error":{},"workflowId":"2c9c3888-9902-4d9f-9b74-8404e6e0df5b","userId":"K0d9yCuMyGKb5UOCN9SXd","projectId":"f9957e8b-bffa-4ca2-b326-8cc8db059791","msg":"Error moving workflow"}
{"level":50,"time":1764868829448,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"5e5cc9cb-45ea-4477-82b5-ee05fbea74d1","userId":"ol9ulgsBbv0YmIIRbiUoC","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868829834,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"238eccd9-81e3-4f87-8b8f-42ea81df3328","userId":"ol9ulgsBbv0YmIIRbiUoC","msg":"Error moving workflow"}
{"level":30,"time":1764868830364,"env":"test","module":"user-credentials-repository","userId":"Bwjj3bWySFHUh33os47PB","msg":"User credentials created"}
{"level":30,"time":1764868830364,"env":"test","module":"auth-routes","userId":"Bwjj3bWySFHUh33os47PB","email":"test-workflows-Eht-zc-Jz4bhoHOeudCO-@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830568,"env":"test","module":"auth-routes","userId":"Bwjj3bWySFHUh33os47PB","email":"test-workflows-Eht-zc-Jz4bhoHOeudCO-@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868830747,"env":"test","error":{},"workflowId":"65b4b05d-059f-4c34-a437-9e6dc941d793","userId":"ol9ulgsBbv0YmIIRbiUoC","projectId":"ee3776e0-503c-4d84-93e1-cb63dfa130f0","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 330[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 742[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 755[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 387[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 915[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.40s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764871633192,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871636064,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871641518,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871641519,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871641534,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871641534,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871641534,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871641534,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871642051,"env":"test","module":"user-credentials-repository","userId":"D1GbKGhThTnxxU9TtbX7w","msg":"User credentials created"}
{"level":30,"time":1764871642055,"env":"test","module":"auth-routes","userId":"D1GbKGhThTnxxU9TtbX7w","email":"test-workflows-plU5CT7bco0GWHux0Fpxw@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a73c792b-62e3-4508-89e2-2ad2f7afd413","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"D1GbKGhThTnxxU9TtbX7w","tenantId":"98f4f8c9-0516-4dba-bcba-49adb0fc0563","createdBy":"D1GbKGhThTnxxU9TtbX7w","ownerId":"D1GbKGhThTnxxU9TtbX7w","status":"active","archived":false,"createdAt":"2025-12-04T18:07:23.637Z","updatedAt":"2025-12-04T18:07:23.637Z"}

{"level":30,"time":1764871642715,"env":"test","module":"user-credentials-repository","userId":"gPeAGhIyPdagzZnETBq36","msg":"User credentials created"}
{"level":30,"time":1764871642716,"env":"test","module":"auth-routes","userId":"gPeAGhIyPdagzZnETBq36","email":"viewer-ycvYv62gQjlLG6HLxeyBJ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871642806,"env":"test","module":"rbac-middleware","userId":"gPeAGhIyPdagzZnETBq36","userRole":"viewer","permission":"workflow:create","path":"/projects/a73c792b-62e3-4508-89e2-2ad2f7afd413/workflows","msg":"Permission denied"}
{"level":50,"time":1764871648758,"env":"test","error":{},"workflowId":"9b8e7706-ed31-4a1b-bb72-2c7885dad78d","userId":"D1GbKGhThTnxxU9TtbX7w","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871649080,"env":"test","module":"auth-middleware","path":"/api/workflows/603a361b-7a6c-4303-a82b-cf11c4531ed2/move","msg":"No valid authentication found"}
{"level":30,"time":1764871649579,"env":"test","module":"user-credentials-repository","userId":"8VnyLcaF8uvTXBtZ74Ur3","msg":"User credentials created"}
{"level":30,"time":1764871649580,"env":"test","module":"auth-routes","userId":"8VnyLcaF8uvTXBtZ74Ur3","email":"test-workflows-QaD5Vr-xEHlJjNyVKlE0N@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871649623,"env":"test","error":{},"workflowId":"5ed04df7-0925-4d22-a05b-d7f8993a837a","userId":"8VnyLcaF8uvTXBtZ74Ur3","projectId":"40525049-8821-4f82-a8e6-2a9f40c0d333","msg":"Error moving workflow"}
{"level":50,"time":1764871649980,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7f6a044c-c97f-4c68-a529-dd425fb291a2","userId":"D1GbKGhThTnxxU9TtbX7w","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871650337,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d604a361-067e-44b2-b304-23a41a107f0f","userId":"D1GbKGhThTnxxU9TtbX7w","msg":"Error moving workflow"}
{"level":30,"time":1764871650840,"env":"test","module":"user-credentials-repository","userId":"ml6syVUbb_Vrf81b7EEvU","msg":"User credentials created"}
{"level":30,"time":1764871650841,"env":"test","module":"auth-routes","userId":"ml6syVUbb_Vrf81b7EEvU","email":"test-workflows-hkE-ycViWMihCXIEMIcYp@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871651026,"env":"test","module":"auth-routes","userId":"ml6syVUbb_Vrf81b7EEvU","email":"test-workflows-hkE-ycViWMihCXIEMIcYp@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871651196,"env":"test","error":{},"workflowId":"35a88e38-a1cb-4764-b112-32848fe5dd86","userId":"D1GbKGhThTnxxU9TtbX7w","projectId":"463d5710-4a80-4a9e-b260-3aea3f53a649","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10120[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 684[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 357[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 860[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 21.55s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764871701997,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871706043,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871709732,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871709733,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871709744,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871709744,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871709744,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871709744,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710223,"env":"test","module":"user-credentials-repository","userId":"RbmcAN66O8Xw_Xhc9U--Q","msg":"User credentials created"}
{"level":30,"time":1764871710227,"env":"test","module":"auth-routes","userId":"RbmcAN66O8Xw_Xhc9U--Q","email":"test-workflows-6oVP9Xaw1xJmMW6WCqhUX@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2c168055-ad56-4171-9730-e7cc42f6066f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"RbmcAN66O8Xw_Xhc9U--Q","tenantId":"ed618685-5b57-4316-9485-22e231e28eaa","createdBy":"RbmcAN66O8Xw_Xhc9U--Q","ownerId":"RbmcAN66O8Xw_Xhc9U--Q","status":"active","archived":false,"createdAt":"2025-12-04T18:08:31.810Z","updatedAt":"2025-12-04T18:08:31.810Z"}

{"level":30,"time":1764871710928,"env":"test","module":"user-credentials-repository","userId":"wLfuyqC3-4Gt6nrW62bca","msg":"User credentials created"}
{"level":30,"time":1764871710929,"env":"test","module":"auth-routes","userId":"wLfuyqC3-4Gt6nrW62bca","email":"viewer-BpHQp0mL2fPCU86dn8r2z@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871711022,"env":"test","module":"rbac-middleware","userId":"wLfuyqC3-4Gt6nrW62bca","userRole":"viewer","permission":"workflow:create","path":"/projects/2c168055-ad56-4171-9730-e7cc42f6066f/workflows","msg":"Permission denied"}
{"level":50,"time":1764871717627,"env":"test","error":{},"workflowId":"6b80090f-8267-45be-be31-d17c0eafc65e","userId":"RbmcAN66O8Xw_Xhc9U--Q","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871717962,"env":"test","module":"auth-middleware","path":"/api/workflows/c3902faf-2572-4499-95f7-d462a26303af/move","msg":"No valid authentication found"}
{"level":30,"time":1764871718504,"env":"test","module":"user-credentials-repository","userId":"RY0Z7R5j5IGOC9a9rQZkY","msg":"User credentials created"}
{"level":30,"time":1764871718504,"env":"test","module":"auth-routes","userId":"RY0Z7R5j5IGOC9a9rQZkY","email":"test-workflows-sDyMRDEb5CZkJkgyOlA1r@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871718547,"env":"test","error":{},"workflowId":"1fc076d2-c6d3-4b84-b919-c842f98f5e8a","userId":"RY0Z7R5j5IGOC9a9rQZkY","projectId":"96e6bead-2044-4cad-af0e-203508241055","msg":"Error moving workflow"}
{"level":50,"time":1764871718930,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"a0fd93fb-ee1b-4d37-9c53-3d7b1ccac30d","userId":"RbmcAN66O8Xw_Xhc9U--Q","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871719298,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"acc15204-1006-4a13-88bd-01ab595ebf2a","userId":"RbmcAN66O8Xw_Xhc9U--Q","msg":"Error moving workflow"}
{"level":50,"time":1764871719953,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(pfUKoBYewK3t5qsdhTh2m) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"pfUKoBYewK3t5qsdhTh2m","msg":"Failed to create user credentials"}
{"level":50,"time":1764871719953,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(pfUKoBYewK3t5qsdhTh2m) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 802[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 909[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 659[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 21.65s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764871753286,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871756626,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871759766,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871759766,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871759777,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871759778,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871759778,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871759778,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871760284,"env":"test","module":"user-credentials-repository","userId":"49UWkhHR0N6R0fVaJk7KK","msg":"User credentials created"}
{"level":30,"time":1764871760288,"env":"test","module":"auth-routes","userId":"49UWkhHR0N6R0fVaJk7KK","email":"test-workflows-UPBYqa3viTmf0VxS8ucpw@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"5960c98a-b3bb-4e2c-bc93-e00e998b2c50","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"49UWkhHR0N6R0fVaJk7KK","tenantId":"fe6408a5-15e1-4e36-b2f1-1adfe518f276","createdBy":"49UWkhHR0N6R0fVaJk7KK","ownerId":"49UWkhHR0N6R0fVaJk7KK","status":"active","archived":false,"createdAt":"2025-12-04T18:09:21.859Z","updatedAt":"2025-12-04T18:09:21.859Z"}

{"level":30,"time":1764871760954,"env":"test","module":"user-credentials-repository","userId":"eWXwmNQzpeuRJEly7DNBy","msg":"User credentials created"}
{"level":30,"time":1764871760955,"env":"test","module":"auth-routes","userId":"eWXwmNQzpeuRJEly7DNBy","email":"viewer-U_vykIOn_NOfoVeY5Ai6P@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871761052,"env":"test","module":"rbac-middleware","userId":"eWXwmNQzpeuRJEly7DNBy","userRole":"viewer","permission":"workflow:create","path":"/projects/5960c98a-b3bb-4e2c-bc93-e00e998b2c50/workflows","msg":"Permission denied"}
{"level":50,"time":1764871767339,"env":"test","error":{},"workflowId":"a754a208-0869-4bb1-baaf-dc14e9221d6d","userId":"49UWkhHR0N6R0fVaJk7KK","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871767681,"env":"test","module":"auth-middleware","path":"/api/workflows/00cb2c1f-e71d-4016-b155-93e74e70b681/move","msg":"No valid authentication found"}
{"level":30,"time":1764871768192,"env":"test","module":"user-credentials-repository","userId":"jy5emRbFHVZ2Mld8je07D","msg":"User credentials created"}
{"level":30,"time":1764871768192,"env":"test","module":"auth-routes","userId":"jy5emRbFHVZ2Mld8je07D","email":"test-workflows-qZBvNrlqExYgmK1pIonaM@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871768242,"env":"test","error":{},"workflowId":"08cab1fa-b03b-4e1e-a652-cc14ca1c5f41","userId":"jy5emRbFHVZ2Mld8je07D","projectId":"bf5c721d-efeb-4a15-8001-a1a4da85da98","msg":"Error moving workflow"}
{"level":50,"time":1764871768620,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"dfd1988c-809c-4869-9da7-b2f6f2dceb93","userId":"49UWkhHR0N6R0fVaJk7KK","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871768982,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9ce0a7a5-1709-40e2-b745-407d5c88584a","userId":"49UWkhHR0N6R0fVaJk7KK","msg":"Error moving workflow"}
{"level":30,"time":1764871769515,"env":"test","module":"user-credentials-repository","userId":"GrsBYLXWCkcBI-Bng1OOI","msg":"User credentials created"}
{"level":30,"time":1764871769516,"env":"test","module":"auth-routes","userId":"GrsBYLXWCkcBI-Bng1OOI","email":"test-workflows-sxeslB5oqHJratsWDtJV5@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871769707,"env":"test","module":"auth-routes","userId":"GrsBYLXWCkcBI-Bng1OOI","email":"test-workflows-sxeslB5oqHJratsWDtJV5@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871769891,"env":"test","error":{},"workflowId":"ff70209c-66bb-4e82-9b6c-deccb50383de","userId":"49UWkhHR0N6R0fVaJk7KK","projectId":"fe962f17-ad9c-4451-b52a-ff536949ea95","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 838[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 769[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 363[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 913[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 20.50s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764873690165,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873693500,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873697321,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873697322,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873697339,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873697339,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873697339,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873697339,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873697810,"env":"test","module":"user-credentials-repository","userId":"lJKDMF3RgNXdTzoIkoQkK","msg":"User credentials created"}
{"level":30,"time":1764873697813,"env":"test","module":"auth-routes","userId":"lJKDMF3RgNXdTzoIkoQkK","email":"test-workflows-1XcBj2M6XPWULiezWSBOo@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"bc0467a5-22b5-440d-9b2e-74a875c28710","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"lJKDMF3RgNXdTzoIkoQkK","tenantId":"4aa98331-cd0a-4212-886d-c9634d49d32d","createdBy":"lJKDMF3RgNXdTzoIkoQkK","ownerId":"lJKDMF3RgNXdTzoIkoQkK","status":"active","archived":false,"createdAt":"2025-12-04T18:41:39.431Z","updatedAt":"2025-12-04T18:41:39.431Z"}

{"level":30,"time":1764873698490,"env":"test","module":"user-credentials-repository","userId":"KUEvruTWr9Gp4wWj3rhdv","msg":"User credentials created"}
{"level":30,"time":1764873698491,"env":"test","module":"auth-routes","userId":"KUEvruTWr9Gp4wWj3rhdv","email":"viewer-KU7hHuhjxVCAN5L_PJOfd@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873698582,"env":"test","module":"rbac-middleware","userId":"KUEvruTWr9Gp4wWj3rhdv","userRole":"viewer","permission":"workflow:create","path":"/projects/bc0467a5-22b5-440d-9b2e-74a875c28710/workflows","msg":"Permission denied"}
{"level":50,"time":1764873704568,"env":"test","error":{},"workflowId":"fbbae185-00d0-44a3-86b5-1fae01e3950a","userId":"lJKDMF3RgNXdTzoIkoQkK","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873704883,"env":"test","module":"auth-middleware","path":"/api/workflows/7bd17d6d-2697-43c3-9090-80f224927871/move","msg":"No valid authentication found"}
{"level":30,"time":1764873705374,"env":"test","module":"user-credentials-repository","userId":"bTmKfDrp_3yK6pTPqBt4m","msg":"User credentials created"}
{"level":30,"time":1764873705375,"env":"test","module":"auth-routes","userId":"bTmKfDrp_3yK6pTPqBt4m","email":"test-workflows-mECOjk3S3jb8X27lU7Mwk@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873705423,"env":"test","error":{},"workflowId":"27fe09f6-c8fb-41d6-8043-951924408580","userId":"bTmKfDrp_3yK6pTPqBt4m","projectId":"83be1dad-2886-4c10-af09-b31207e7c696","msg":"Error moving workflow"}
{"level":50,"time":1764873705784,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2f6fcfdb-d112-4aeb-8129-bcb67581e626","userId":"lJKDMF3RgNXdTzoIkoQkK","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873706127,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bed85f1b-9cfd-4203-875e-604323b0cd25","userId":"lJKDMF3RgNXdTzoIkoQkK","msg":"Error moving workflow"}
{"level":30,"time":1764873706653,"env":"test","module":"user-credentials-repository","userId":"Q5osA8FIZkYKDMfL3VXGp","msg":"User credentials created"}
{"level":30,"time":1764873706654,"env":"test","module":"auth-routes","userId":"Q5osA8FIZkYKDMfL3VXGp","email":"test-workflows-Bsp_1IUaKwiQEEUVn1Bi7@example.com","msg":"User registered successfully"}
{"level":30,"time":1764873706842,"env":"test","module":"auth-routes","userId":"Q5osA8FIZkYKDMfL3VXGp","email":"test-workflows-Bsp_1IUaKwiQEEUVn1Bi7@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764873707022,"env":"test","error":{},"workflowId":"21575a17-3cdb-4a09-bed7-76ef480cce15","userId":"lJKDMF3RgNXdTzoIkoQkK","projectId":"79151b5e-1b9c-4d31-a173-d41093643819","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 677[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 579[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 539[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 895[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 21.34s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764874578964,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874583925,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874590355,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874590356,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874590367,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874590367,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874590368,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874590368,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874591561,"env":"test","module":"user-credentials-repository","userId":"pTcn6v4upRYxHX5KU0LVc","msg":"User credentials created"}
{"level":30,"time":1764874591565,"env":"test","module":"auth-routes","userId":"pTcn6v4upRYxHX5KU0LVc","email":"test-workflows-FOs_Fk6lAphG_t1v8QKdk@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"552507ab-f415-46e4-a408-bf4a79e9571e","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"pTcn6v4upRYxHX5KU0LVc","tenantId":"0d830661-0d88-4654-86c7-48ee23f9a2fe","createdBy":"pTcn6v4upRYxHX5KU0LVc","ownerId":"pTcn6v4upRYxHX5KU0LVc","status":"active","archived":false,"createdAt":"2025-12-04T18:56:33.194Z","updatedAt":"2025-12-04T18:56:33.194Z"}

{"level":30,"time":1764874592382,"env":"test","module":"user-credentials-repository","userId":"Sc-DVxjp3d2lbiQmuQiqz","msg":"User credentials created"}
{"level":30,"time":1764874592383,"env":"test","module":"auth-routes","userId":"Sc-DVxjp3d2lbiQmuQiqz","email":"viewer-84sMN9mBk8beOWvzqYkQX@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874592480,"env":"test","module":"rbac-middleware","userId":"Sc-DVxjp3d2lbiQmuQiqz","userRole":"viewer","permission":"workflow:create","path":"/projects/552507ab-f415-46e4-a408-bf4a79e9571e/workflows","msg":"Permission denied"}
{"level":50,"time":1764874598762,"env":"test","error":{},"workflowId":"bd0256c8-424a-4894-8373-31dd3972608d","userId":"pTcn6v4upRYxHX5KU0LVc","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874599080,"env":"test","module":"auth-middleware","path":"/api/workflows/98cbf15e-8986-4ab8-a0cb-743d18ec1542/move","msg":"No valid authentication found"}
{"level":30,"time":1764874599599,"env":"test","module":"user-credentials-repository","userId":"LVX6bKCHRCt1Tes9rXbLx","msg":"User credentials created"}
{"level":30,"time":1764874599600,"env":"test","module":"auth-routes","userId":"LVX6bKCHRCt1Tes9rXbLx","email":"test-workflows-UhsflRSKGg-1HJFvJU5Dn@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874599647,"env":"test","error":{},"workflowId":"768b59fa-bba5-4a6f-a883-9a37050eaf4b","userId":"LVX6bKCHRCt1Tes9rXbLx","projectId":"afade24f-0a7a-49ec-b30e-f73767bc2e34","msg":"Error moving workflow"}
{"level":50,"time":1764874600017,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"fe57d551-d44b-4f84-83cb-eb85e9ee3acd","userId":"pTcn6v4upRYxHX5KU0LVc","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874600386,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"cd13bebf-91af-4c79-88a0-3cebddced7e1","userId":"pTcn6v4upRYxHX5KU0LVc","msg":"Error moving workflow"}
{"level":30,"time":1764874600921,"env":"test","module":"user-credentials-repository","userId":"KzA4-Nyiev70I_wmde44Z","msg":"User credentials created"}
{"level":30,"time":1764874600922,"env":"test","module":"auth-routes","userId":"KzA4-Nyiev70I_wmde44Z","email":"test-workflows-DPhQ6Z33jJE67ulZMbnsY@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874601143,"env":"test","module":"auth-routes","userId":"KzA4-Nyiev70I_wmde44Z","email":"test-workflows-DPhQ6Z33jJE67ulZMbnsY@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874601354,"env":"test","error":{},"workflowId":"c2c827e0-26cc-432b-b0d6-06c993a9c66e","userId":"pTcn6v4upRYxHX5KU0LVc","projectId":"07d730f7-a35d-459a-8a74-f0304439688a","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 11355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 785[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 720[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 666[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 965[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.15s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764874684458,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874689480,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874696248,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874696249,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874696259,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874696260,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874696260,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874696260,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874696983,"env":"test","module":"user-credentials-repository","userId":"iowDJtKOoUyvxojblI9p1","msg":"User credentials created"}
{"level":30,"time":1764874696987,"env":"test","module":"auth-routes","userId":"iowDJtKOoUyvxojblI9p1","email":"test-workflows-R9PIe2WklwoX89Vvss6uL@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3e6c3ded-307f-4508-a73e-435225c08528","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"iowDJtKOoUyvxojblI9p1","tenantId":"cb62121f-5dc6-4d41-baf5-5fac41e2b0c2","createdBy":"iowDJtKOoUyvxojblI9p1","ownerId":"iowDJtKOoUyvxojblI9p1","status":"active","archived":false,"createdAt":"2025-12-04T18:58:18.623Z","updatedAt":"2025-12-04T18:58:18.623Z"}

{"level":30,"time":1764874697710,"env":"test","module":"user-credentials-repository","userId":"KMHhfQWrfuvff6B7s-s4Q","msg":"User credentials created"}
{"level":30,"time":1764874697710,"env":"test","module":"auth-routes","userId":"KMHhfQWrfuvff6B7s-s4Q","email":"viewer-dD6WDJPbG1xzhqVCO5Q4r@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874697813,"env":"test","module":"rbac-middleware","userId":"KMHhfQWrfuvff6B7s-s4Q","userRole":"viewer","permission":"workflow:create","path":"/projects/3e6c3ded-307f-4508-a73e-435225c08528/workflows","msg":"Permission denied"}
{"level":50,"time":1764874704222,"env":"test","error":{},"workflowId":"450d393d-9679-4b82-9bb9-2138ea79a509","userId":"iowDJtKOoUyvxojblI9p1","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874704576,"env":"test","module":"auth-middleware","path":"/api/workflows/c64398a7-ad6d-4260-97a0-7e3b68d027bd/move","msg":"No valid authentication found"}
{"level":30,"time":1764874705103,"env":"test","module":"user-credentials-repository","userId":"984uhHRr8hySaKYrVEJ1s","msg":"User credentials created"}
{"level":30,"time":1764874705104,"env":"test","module":"auth-routes","userId":"984uhHRr8hySaKYrVEJ1s","email":"test-workflows-kG1flkx_UzzUyu3LUDsu6@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874705157,"env":"test","error":{},"workflowId":"8288a358-9ef6-44f4-85b3-38c92893e6c9","userId":"984uhHRr8hySaKYrVEJ1s","projectId":"26ec53f3-bcbb-4fd9-9804-ddf0caa0dc46","msg":"Error moving workflow"}
{"level":50,"time":1764874705542,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"86a46a85-056b-496f-a82a-030cb453ff3b","userId":"iowDJtKOoUyvxojblI9p1","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874705923,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d1c183bb-482a-41e0-9ac6-c7389a5dcfb1","userId":"iowDJtKOoUyvxojblI9p1","msg":"Error moving workflow"}
{"level":30,"time":1764874706457,"env":"test","module":"user-credentials-repository","userId":"qlIJvHS9vrLg5rrauv4AL","msg":"User credentials created"}
{"level":30,"time":1764874706458,"env":"test","module":"auth-routes","userId":"qlIJvHS9vrLg5rrauv4AL","email":"test-workflows-95EtwwF3hQhWp7LYdLhoP@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874706659,"env":"test","module":"auth-routes","userId":"qlIJvHS9vrLg5rrauv4AL","email":"test-workflows-95EtwwF3hQhWp7LYdLhoP@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874706851,"env":"test","error":{},"workflowId":"1908339b-a843-4a57-a313-5051d0e354d2","userId":"iowDJtKOoUyvxojblI9p1","projectId":"99bcc65f-a463-4355-a8d0-ebfc65422620","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10928[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 659[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 354[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 386[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 383[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 928[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 27.29s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764876566388,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876570233,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876575012,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876575013,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876575026,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876575026,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876575026,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876575026,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876575522,"env":"test","module":"user-credentials-repository","userId":"LC8ganHVa1VwItMZIAV0l","msg":"User credentials created"}
{"level":30,"time":1764876575526,"env":"test","module":"auth-routes","userId":"LC8ganHVa1VwItMZIAV0l","email":"test-workflows-upxn23kJ5JTTC1wEXHmlD@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e178882c-5a3e-4854-a539-e00b470c9130","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"LC8ganHVa1VwItMZIAV0l","tenantId":"33bd53a2-2feb-4f17-b36b-ce0ec94ae018","createdBy":"LC8ganHVa1VwItMZIAV0l","ownerId":"LC8ganHVa1VwItMZIAV0l","status":"active","archived":false,"createdAt":"2025-12-04T19:29:37.196Z","updatedAt":"2025-12-04T19:29:37.196Z"}

{"level":30,"time":1764876576212,"env":"test","module":"user-credentials-repository","userId":"CzozmjLOFeifA0kyQpaTL","msg":"User credentials created"}
{"level":30,"time":1764876576213,"env":"test","module":"auth-routes","userId":"CzozmjLOFeifA0kyQpaTL","email":"viewer-Eh9WWWVGeNcElsSc-9d1k@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876576310,"env":"test","module":"rbac-middleware","userId":"CzozmjLOFeifA0kyQpaTL","userRole":"viewer","permission":"workflow:create","path":"/projects/e178882c-5a3e-4854-a539-e00b470c9130/workflows","msg":"Permission denied"}
{"level":50,"time":1764876582583,"env":"test","error":{},"workflowId":"a5c63790-94bf-4236-acf8-6da0596bc812","userId":"LC8ganHVa1VwItMZIAV0l","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876582919,"env":"test","module":"auth-middleware","path":"/api/workflows/da31ae64-63cd-444b-9a3e-d604f5262142/move","msg":"No valid authentication found"}
{"level":30,"time":1764876583454,"env":"test","module":"user-credentials-repository","userId":"yj6eKNppyyTaN-_JpA2pV","msg":"User credentials created"}
{"level":30,"time":1764876583454,"env":"test","module":"auth-routes","userId":"yj6eKNppyyTaN-_JpA2pV","email":"test-workflows-FF6mPDnsDkWwiS_9ENw-a@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876583500,"env":"test","error":{},"workflowId":"12370d47-cfa8-472e-a1c7-c1e5887af2ac","userId":"yj6eKNppyyTaN-_JpA2pV","projectId":"f93971fa-b0d2-459b-b737-d38afb493316","msg":"Error moving workflow"}
{"level":50,"time":1764876583975,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6c36483f-6989-437e-8013-8fa38d48c8bc","userId":"LC8ganHVa1VwItMZIAV0l","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876585470,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"44e124c9-bd32-4ea0-b628-f099ce8e6e0b","userId":"LC8ganHVa1VwItMZIAV0l","msg":"Error moving workflow"}
{"level":50,"time":1764876585636,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(LC8ganHVa1VwItMZIAV0l) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"LC8ganHVa1VwItMZIAV0l","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10877[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 802[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 606[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 582[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 1495[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 167[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:29:20
[2m   Duration [22m 24.20s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764876646680,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876649469,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876653884,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876653885,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876653905,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876653905,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876653905,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876653906,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876654398,"env":"test","module":"user-credentials-repository","userId":"-aB8S_7PmQWwA85FCEMU0","msg":"User credentials created"}
{"level":30,"time":1764876654402,"env":"test","module":"auth-routes","userId":"-aB8S_7PmQWwA85FCEMU0","email":"test-workflows-sYcRKqluyS_tC7xdILC6P@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e9e7bdfa-d55a-4e44-9fd8-9b40743624be","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"-aB8S_7PmQWwA85FCEMU0","tenantId":"24d8ac7c-ce87-47b4-837a-aab585c00af2","createdBy":"-aB8S_7PmQWwA85FCEMU0","ownerId":"-aB8S_7PmQWwA85FCEMU0","status":"active","archived":false,"createdAt":"2025-12-04T19:30:56.075Z","updatedAt":"2025-12-04T19:30:56.075Z"}

{"level":30,"time":1764876655111,"env":"test","module":"user-credentials-repository","userId":"AbxVvn9uH9YFPERj0zaQp","msg":"User credentials created"}
{"level":30,"time":1764876655111,"env":"test","module":"auth-routes","userId":"AbxVvn9uH9YFPERj0zaQp","email":"viewer-laLEMBCc0Gxfh6zvmn_Yy@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876655215,"env":"test","module":"rbac-middleware","userId":"AbxVvn9uH9YFPERj0zaQp","userRole":"viewer","permission":"workflow:create","path":"/projects/e9e7bdfa-d55a-4e44-9fd8-9b40743624be/workflows","msg":"Permission denied"}
{"level":50,"time":1764876661615,"env":"test","error":{},"workflowId":"42ff5665-64bb-4a8d-94cf-add94e9316cd","userId":"-aB8S_7PmQWwA85FCEMU0","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876661971,"env":"test","module":"auth-middleware","path":"/api/workflows/59c54e35-f8af-4021-8b18-6caaf67a31b6/move","msg":"No valid authentication found"}
{"level":30,"time":1764876662486,"env":"test","module":"user-credentials-repository","userId":"QgS-kCvQpOnywPrzEnvKF","msg":"User credentials created"}
{"level":30,"time":1764876662487,"env":"test","module":"auth-routes","userId":"QgS-kCvQpOnywPrzEnvKF","email":"test-workflows-XUyt5hCVSuPT79kuAWZ-J@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876662539,"env":"test","error":{},"workflowId":"1c537914-c5aa-4242-8f96-a8d2c4040f0b","userId":"QgS-kCvQpOnywPrzEnvKF","projectId":"4d69f4c4-1c62-4ae5-a606-90d45d52796b","msg":"Error moving workflow"}
{"level":50,"time":1764876662915,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3574216b-8f43-4b76-9adf-132ffbe55c01","userId":"-aB8S_7PmQWwA85FCEMU0","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876663271,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"60c99045-2b8d-4c03-a817-44df7f83f871","userId":"-aB8S_7PmQWwA85FCEMU0","msg":"Error moving workflow"}
{"level":50,"time":1764876664805,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(MBRhopQFekSve6RAaRnYY) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"MBRhopQFekSve6RAaRnYY","msg":"Failed to create user credentials"}
{"level":50,"time":1764876664805,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(MBRhopQFekSve6RAaRnYY) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 726[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 658[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 820[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 355[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1536[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:30:40
[2m   Duration [22m 23.22s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764877226722,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877230828,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877235112,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877235113,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877235126,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877235126,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877235126,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877235126,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877235721,"env":"test","module":"user-credentials-repository","userId":"VQmngbFyz8AVmLUp1yWqP","msg":"User credentials created"}
{"level":30,"time":1764877235725,"env":"test","module":"auth-routes","userId":"VQmngbFyz8AVmLUp1yWqP","email":"test-workflows-IVLiBLrD10eisrFlO5qPc@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"da15dc6e-6c72-4c19-b92c-edca749b0003","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"VQmngbFyz8AVmLUp1yWqP","tenantId":"c3f1c062-2e35-4723-98cc-ae99e58546fc","createdBy":"VQmngbFyz8AVmLUp1yWqP","ownerId":"VQmngbFyz8AVmLUp1yWqP","status":"active","archived":false,"createdAt":"2025-12-04T19:40:37.402Z","updatedAt":"2025-12-04T19:40:37.402Z"}

{"level":30,"time":1764877236457,"env":"test","module":"user-credentials-repository","userId":"W_KSIpxB0A_PiqHZGgE1q","msg":"User credentials created"}
{"level":30,"time":1764877236458,"env":"test","module":"auth-routes","userId":"W_KSIpxB0A_PiqHZGgE1q","email":"viewer-0P5o2_8D7mZ_-DEYXY09K@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877236556,"env":"test","module":"rbac-middleware","userId":"W_KSIpxB0A_PiqHZGgE1q","userRole":"viewer","permission":"workflow:create","path":"/projects/da15dc6e-6c72-4c19-b92c-edca749b0003/workflows","msg":"Permission denied"}
{"level":50,"time":1764877243080,"env":"test","error":{},"workflowId":"38a49c53-04a3-41b7-b216-24a10902907f","userId":"VQmngbFyz8AVmLUp1yWqP","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877243422,"env":"test","module":"auth-middleware","path":"/api/workflows/620d2bd3-c74f-44c6-9502-a2ee07078e26/move","msg":"No valid authentication found"}
{"level":30,"time":1764877243959,"env":"test","module":"user-credentials-repository","userId":"ErPSK_AAigFRViei_dE_4","msg":"User credentials created"}
{"level":30,"time":1764877243960,"env":"test","module":"auth-routes","userId":"ErPSK_AAigFRViei_dE_4","email":"test-workflows-9nH4ah2jmwM3IcOp-LbTP@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877244017,"env":"test","error":{},"workflowId":"433de6b3-b724-489f-aa0d-bf531fbe8789","userId":"ErPSK_AAigFRViei_dE_4","projectId":"6e8a57b3-09f8-4c57-b3b2-993cedc9363b","msg":"Error moving workflow"}
{"level":50,"time":1764877244390,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b39f2079-db64-4065-b17a-660754007c32","userId":"VQmngbFyz8AVmLUp1yWqP","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877244783,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"5d69cec0-3901-402e-a888-bbf7935d6b03","userId":"VQmngbFyz8AVmLUp1yWqP","msg":"Error moving workflow"}
{"level":30,"time":1764877245306,"env":"test","module":"user-credentials-repository","userId":"3CMqgKuqLto_a2-EL3xm4","msg":"User credentials created"}
{"level":30,"time":1764877245306,"env":"test","module":"auth-routes","userId":"3CMqgKuqLto_a2-EL3xm4","email":"test-workflows-l9WjH0cBoSX9lcXFG4FQU@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877245496,"env":"test","module":"auth-routes","userId":"3CMqgKuqLto_a2-EL3xm4","email":"test-workflows-l9WjH0cBoSX9lcXFG4FQU@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877245690,"env":"test","error":{},"workflowId":"7e9d4e55-47e4-49de-8e90-f5a6e46cc7ae","userId":"VQmngbFyz8AVmLUp1yWqP","projectId":"79f5c9af-893d-4370-ae00-3d8b97d8137c","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10931[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 499[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 648[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 909[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:40:22
[2m   Duration [22m 22.71s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/googleAuth.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764877489179,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877492192,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877496546,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877496547,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877496558,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877496558,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877496558,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877496558,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877497164,"env":"test","module":"user-credentials-repository","userId":"Rp1DvHHeVB1UyVLuY1rnC","msg":"User credentials created"}
{"level":30,"time":1764877497168,"env":"test","module":"auth-routes","userId":"Rp1DvHHeVB1UyVLuY1rnC","email":"test-workflows-yVxl9CKJESQmE5H_KAmhm@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3153c398-8c01-4f07-b510-931a5d5a4ac4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Rp1DvHHeVB1UyVLuY1rnC","tenantId":"ef199e65-d1fb-4d25-b7d3-bd11cde6698e","createdBy":"Rp1DvHHeVB1UyVLuY1rnC","ownerId":"Rp1DvHHeVB1UyVLuY1rnC","status":"active","archived":false,"createdAt":"2025-12-04T19:44:58.851Z","updatedAt":"2025-12-04T19:44:58.851Z"}

{"level":30,"time":1764877497894,"env":"test","module":"user-credentials-repository","userId":"BrgLJG5IU_Yz5EO61__rB","msg":"User credentials created"}
{"level":30,"time":1764877497894,"env":"test","module":"auth-routes","userId":"BrgLJG5IU_Yz5EO61__rB","email":"viewer-glGOcrYO_O62UNdttd0pS@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877497993,"env":"test","module":"rbac-middleware","userId":"BrgLJG5IU_Yz5EO61__rB","userRole":"viewer","permission":"workflow:create","path":"/projects/3153c398-8c01-4f07-b510-931a5d5a4ac4/workflows","msg":"Permission denied"}
{"level":50,"time":1764877504591,"env":"test","error":{},"workflowId":"899cc848-9c6d-479c-9508-b2242a402846","userId":"Rp1DvHHeVB1UyVLuY1rnC","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877504931,"env":"test","module":"auth-middleware","path":"/api/workflows/57f7f534-1fc2-4d3a-902f-c8246f994b00/move","msg":"No valid authentication found"}
{"level":30,"time":1764877505453,"env":"test","module":"user-credentials-repository","userId":"euyrjHN8eaH2Uz1ZqI2jS","msg":"User credentials created"}
{"level":30,"time":1764877505454,"env":"test","module":"auth-routes","userId":"euyrjHN8eaH2Uz1ZqI2jS","email":"test-workflows-FX64DThFm4PGNtQXPloqG@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877505497,"env":"test","error":{},"workflowId":"9c54b167-0a2e-4f21-96b0-c1eee03044fa","userId":"euyrjHN8eaH2Uz1ZqI2jS","projectId":"eaac527e-0db6-4831-ad01-40783d9ea4bd","msg":"Error moving workflow"}
{"level":50,"time":1764877505881,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3917884c-5d2c-4a14-bf7e-0bb3ff7abb8a","userId":"Rp1DvHHeVB1UyVLuY1rnC","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877506265,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"83918e2c-1198-4f32-bf61-27dc47f95e38","userId":"Rp1DvHHeVB1UyVLuY1rnC","msg":"Error moving workflow"}
{"level":30,"time":1764877506802,"env":"test","module":"user-credentials-repository","userId":"FnQ3kAcmxCBVJ7S6qJuVf","msg":"User credentials created"}
{"level":30,"time":1764877506803,"env":"test","module":"auth-routes","userId":"FnQ3kAcmxCBVJ7S6qJuVf","email":"test-workflows-7W8touCE-mYcBeXov7tFp@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877506997,"env":"test","module":"auth-routes","userId":"FnQ3kAcmxCBVJ7S6qJuVf","email":"test-workflows-7W8touCE-mYcBeXov7tFp@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877507195,"env":"test","error":{},"workflowId":"4e1eff43-6d4e-4cab-9dec-92a815b4f73e","userId":"Rp1DvHHeVB1UyVLuY1rnC","projectId":"7a546187-ed42-41d2-92db-582de968fe62","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10934[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 844[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 930[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:44:44
[2m   Duration [22m 21.78s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764877821594,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877824842,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877828932,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877828932,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877828945,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877828945,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877828946,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877828946,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877829486,"env":"test","module":"user-credentials-repository","userId":"0N65Mbvy5HbeH32QFAGc3","msg":"User credentials created"}
{"level":30,"time":1764877829489,"env":"test","module":"auth-routes","userId":"0N65Mbvy5HbeH32QFAGc3","email":"test-workflows-qbSz-OyscsIId-cYK6aL9@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"bf64a31b-1c56-46cb-949c-3f01c523e925","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"0N65Mbvy5HbeH32QFAGc3","tenantId":"549582e3-fb06-490a-b368-a59824ec0fb9","createdBy":"0N65Mbvy5HbeH32QFAGc3","ownerId":"0N65Mbvy5HbeH32QFAGc3","status":"active","archived":false,"createdAt":"2025-12-04T19:50:31.174Z","updatedAt":"2025-12-04T19:50:31.174Z"}

{"level":30,"time":1764877830188,"env":"test","module":"user-credentials-repository","userId":"Am_3d3jZW4z2KdhDrpnvF","msg":"User credentials created"}
{"level":30,"time":1764877830189,"env":"test","module":"auth-routes","userId":"Am_3d3jZW4z2KdhDrpnvF","email":"viewer-ecEDp8lcWhEwNZzbvhqSx@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877830278,"env":"test","module":"rbac-middleware","userId":"Am_3d3jZW4z2KdhDrpnvF","userRole":"viewer","permission":"workflow:create","path":"/projects/bf64a31b-1c56-46cb-949c-3f01c523e925/workflows","msg":"Permission denied"}
{"level":50,"time":1764877836381,"env":"test","error":{},"workflowId":"e7323d32-6613-450f-82ee-f83a7edfd247","userId":"0N65Mbvy5HbeH32QFAGc3","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877836704,"env":"test","module":"auth-middleware","path":"/api/workflows/83ac7b7b-1ab6-4909-8b66-9026fb2afb98/move","msg":"No valid authentication found"}
{"level":30,"time":1764877837226,"env":"test","module":"user-credentials-repository","userId":"7hCXM0AtCXTY38szrF2k3","msg":"User credentials created"}
{"level":30,"time":1764877837226,"env":"test","module":"auth-routes","userId":"7hCXM0AtCXTY38szrF2k3","email":"test-workflows-arioEin5lHNlAeoR9bdhE@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877837275,"env":"test","error":{},"workflowId":"e48113f0-caad-4636-b9c4-0c67099fbec5","userId":"7hCXM0AtCXTY38szrF2k3","projectId":"2fbee678-72a1-46f8-b599-b7410e92d802","msg":"Error moving workflow"}
{"level":50,"time":1764877837644,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"e6827a8f-1ee7-4445-a80b-ebf4be16145e","userId":"0N65Mbvy5HbeH32QFAGc3","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877838024,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b1f5b51c-452c-4d6f-aa3d-a4ad26200c88","userId":"0N65Mbvy5HbeH32QFAGc3","msg":"Error moving workflow"}
{"level":30,"time":1764877838595,"env":"test","module":"user-credentials-repository","userId":"hfUBpBa0oOQt6TakVUVKM","msg":"User credentials created"}
{"level":30,"time":1764877838597,"env":"test","module":"auth-routes","userId":"hfUBpBa0oOQt6TakVUVKM","email":"test-workflows-MKu8hECQq9jnlX18N74KX@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877838800,"env":"test","module":"auth-routes","userId":"hfUBpBa0oOQt6TakVUVKM","email":"test-workflows-MKu8hECQq9jnlX18N74KX@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877838986,"env":"test","error":{},"workflowId":"caeb25a7-4fdb-4e97-93ea-4b6cd21cebda","userId":"0N65Mbvy5HbeH32QFAGc3","projectId":"39d81420-6d31-4b42-a88f-c650c7676d36","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 579[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 962[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:18
[2m   Duration [22m 20.49s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764877842925,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877846161,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877849388,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877849389,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877849402,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877849402,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877849403,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877849403,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877849894,"env":"test","module":"user-credentials-repository","userId":"C0DkXt29hCCdi4lE73VyN","msg":"User credentials created"}
{"level":30,"time":1764877849898,"env":"test","module":"auth-routes","userId":"C0DkXt29hCCdi4lE73VyN","email":"test-workflows-2uEj59pHm3y9tlVSgKwnY@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"dfb8cb0c-579c-4ed5-bbc7-cfc311a6e3f3","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"C0DkXt29hCCdi4lE73VyN","tenantId":"5bf4175a-a8d1-4fe4-959f-b804f559fd08","createdBy":"C0DkXt29hCCdi4lE73VyN","ownerId":"C0DkXt29hCCdi4lE73VyN","status":"active","archived":false,"createdAt":"2025-12-04T19:50:51.585Z","updatedAt":"2025-12-04T19:50:51.585Z"}

{"level":30,"time":1764877850616,"env":"test","module":"user-credentials-repository","userId":"yEDn-qholMOkonbxoqJ8G","msg":"User credentials created"}
{"level":30,"time":1764877850617,"env":"test","module":"auth-routes","userId":"yEDn-qholMOkonbxoqJ8G","email":"viewer-zyJk2JDhf9BMKVNs-R4p6@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877850714,"env":"test","module":"rbac-middleware","userId":"yEDn-qholMOkonbxoqJ8G","userRole":"viewer","permission":"workflow:create","path":"/projects/dfb8cb0c-579c-4ed5-bbc7-cfc311a6e3f3/workflows","msg":"Permission denied"}
{"level":50,"time":1764877857285,"env":"test","error":{},"workflowId":"336cc1a9-f03a-45ed-8200-fe3d155ff282","userId":"C0DkXt29hCCdi4lE73VyN","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877857618,"env":"test","module":"auth-middleware","path":"/api/workflows/8edd1c9b-2aa4-4b4c-89b2-4040652355e6/move","msg":"No valid authentication found"}
{"level":30,"time":1764877858164,"env":"test","module":"user-credentials-repository","userId":"zDkIn8x_gvDxjt5FVrBJb","msg":"User credentials created"}
{"level":30,"time":1764877858164,"env":"test","module":"auth-routes","userId":"zDkIn8x_gvDxjt5FVrBJb","email":"test-workflows-d34ZH2PCy5EM8qqMnciCg@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877858213,"env":"test","error":{},"workflowId":"bfd54ff6-096c-41d9-b065-0c840857b458","userId":"zDkIn8x_gvDxjt5FVrBJb","projectId":"5d76aa5b-f070-47fb-b239-8e66ab8f866c","msg":"Error moving workflow"}
{"level":50,"time":1764877858598,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"75b54308-3a57-49bf-93e3-9f10cfd118bd","userId":"C0DkXt29hCCdi4lE73VyN","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877859117,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"219907b7-2bdb-404e-99f4-b83fe102b232","userId":"C0DkXt29hCCdi4lE73VyN","msg":"Error moving workflow"}
{"level":30,"time":1764877859732,"env":"test","module":"user-credentials-repository","userId":"9bVMKgjv7JdDlclxomuls","msg":"User credentials created"}
{"level":30,"time":1764877859732,"env":"test","module":"auth-routes","userId":"9bVMKgjv7JdDlclxomuls","email":"test-workflows-1MwIwlHgJzFqXBE3s1fhU@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877859927,"env":"test","module":"auth-routes","userId":"9bVMKgjv7JdDlclxomuls","email":"test-workflows-1MwIwlHgJzFqXBE3s1fhU@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877860126,"env":"test","error":{},"workflowId":"4d1931bf-e64e-4432-8cca-62fd38995db6","userId":"C0DkXt29hCCdi4lE73VyN","projectId":"b31127ff-696c-47e4-a4a8-33742f582e24","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11169[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 755[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 385[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 519[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1010[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:39
[2m   Duration [22m 20.47s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764877864310,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877867676,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877871932,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877871932,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877871944,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877871944,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877871945,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877871945,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877872436,"env":"test","module":"user-credentials-repository","userId":"dYhRbR18qPGM4dwH6U6YB","msg":"User credentials created"}
{"level":30,"time":1764877872440,"env":"test","module":"auth-routes","userId":"dYhRbR18qPGM4dwH6U6YB","email":"test-workflows--3m42egDTxvQahUiOe6N8@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3de80a9c-4720-44f5-8a5b-8a479e0f12f2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"dYhRbR18qPGM4dwH6U6YB","tenantId":"8a7c2b64-6862-459b-8df8-86768f380818","createdBy":"dYhRbR18qPGM4dwH6U6YB","ownerId":"dYhRbR18qPGM4dwH6U6YB","status":"active","archived":false,"createdAt":"2025-12-04T19:51:14.120Z","updatedAt":"2025-12-04T19:51:14.120Z"}

{"level":30,"time":1764877873120,"env":"test","module":"user-credentials-repository","userId":"qBa9YLR0fYeGcWFYIEftA","msg":"User credentials created"}
{"level":30,"time":1764877873121,"env":"test","module":"auth-routes","userId":"qBa9YLR0fYeGcWFYIEftA","email":"viewer--Zbw4vexOZNLM0HhGWqnH@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877873221,"env":"test","module":"rbac-middleware","userId":"qBa9YLR0fYeGcWFYIEftA","userRole":"viewer","permission":"workflow:create","path":"/projects/3de80a9c-4720-44f5-8a5b-8a479e0f12f2/workflows","msg":"Permission denied"}
{"level":50,"time":1764877879335,"env":"test","error":{},"workflowId":"2a31f578-1102-4263-99c4-965e22407bab","userId":"dYhRbR18qPGM4dwH6U6YB","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877879662,"env":"test","module":"auth-middleware","path":"/api/workflows/2df5b6ab-f25f-4809-b4fc-8eb7ce840ae7/move","msg":"No valid authentication found"}
{"level":30,"time":1764877880158,"env":"test","module":"user-credentials-repository","userId":"xfVhcpuKb8-NKymMQbSdC","msg":"User credentials created"}
{"level":30,"time":1764877880158,"env":"test","module":"auth-routes","userId":"xfVhcpuKb8-NKymMQbSdC","email":"test-workflows-NjCwDNku90K9RmWj3_2Vx@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877880208,"env":"test","error":{},"workflowId":"7b8e2a5b-ee64-4ce2-bb95-2a779fcf35a3","userId":"xfVhcpuKb8-NKymMQbSdC","projectId":"6ad2a857-032c-4818-bddc-61fb5ad1b0bb","msg":"Error moving workflow"}
{"level":50,"time":1764877880559,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"11956caf-7cb4-4068-abc8-b7ab27ec63f3","userId":"dYhRbR18qPGM4dwH6U6YB","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877880929,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"3ff4c29f-5ab0-4342-842d-c65ec8a63ce2","userId":"dYhRbR18qPGM4dwH6U6YB","msg":"Error moving workflow"}
{"level":30,"time":1764877881437,"env":"test","module":"user-credentials-repository","userId":"D_MA6EmJ6hFXjP9b-TYbH","msg":"User credentials created"}
{"level":30,"time":1764877881438,"env":"test","module":"auth-routes","userId":"D_MA6EmJ6hFXjP9b-TYbH","email":"test-workflows-cUC-Mgm9PUX1lHDbtNi2d@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877881629,"env":"test","module":"auth-routes","userId":"D_MA6EmJ6hFXjP9b-TYbH","email":"test-workflows-cUC-Mgm9PUX1lHDbtNi2d@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877881815,"env":"test","error":{},"workflowId":"74a9274b-a27b-4d0b-be85-66bc8a20ac91","userId":"dYhRbR18qPGM4dwH6U6YB","projectId":"259f89ef-1a48-49b8-9497-8df0b50bb952","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10161[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 299[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 762[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 546[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 886[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:51:00
[2m   Duration [22m 20.89s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764879994051,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764879997125,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880000843,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880000844,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880000857,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880000857,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880000858,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880000858,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880001422,"env":"test","module":"user-credentials-repository","userId":"Cq_3REOPEyinhztEcnlC8","msg":"User credentials created"}
{"level":30,"time":1764880001426,"env":"test","module":"auth-routes","userId":"Cq_3REOPEyinhztEcnlC8","email":"test-workflows-xu3kHat5r27aPtZYsjaM5@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"13bd583c-530d-4f6a-97ff-347e8719cd20","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Cq_3REOPEyinhztEcnlC8","tenantId":"77c1a6ca-cded-4413-91fa-443eaa3dbd5d","createdBy":"Cq_3REOPEyinhztEcnlC8","ownerId":"Cq_3REOPEyinhztEcnlC8","status":"active","archived":false,"createdAt":"2025-12-04T20:26:43.145Z","updatedAt":"2025-12-04T20:26:43.145Z"}

{"level":30,"time":1764880002119,"env":"test","module":"user-credentials-repository","userId":"Tvd78Ef_QcK7YAeKULyHc","msg":"User credentials created"}
{"level":30,"time":1764880002120,"env":"test","module":"auth-routes","userId":"Tvd78Ef_QcK7YAeKULyHc","email":"viewer-fPWdCC84Vpt17I8fk3FK1@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880002219,"env":"test","module":"rbac-middleware","userId":"Tvd78Ef_QcK7YAeKULyHc","userRole":"viewer","permission":"workflow:create","path":"/projects/13bd583c-530d-4f6a-97ff-347e8719cd20/workflows","msg":"Permission denied"}
{"level":50,"time":1764880008908,"env":"test","error":{},"workflowId":"b61dca51-8c06-48b6-92cd-08a1913146cf","userId":"Cq_3REOPEyinhztEcnlC8","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880009249,"env":"test","module":"auth-middleware","path":"/api/workflows/08021d0d-dcaf-4b08-9dce-52163d807866/move","msg":"No valid authentication found"}
{"level":30,"time":1764880009811,"env":"test","module":"user-credentials-repository","userId":"9esutemV-lvg0Wu_Tcvb0","msg":"User credentials created"}
{"level":30,"time":1764880009813,"env":"test","module":"auth-routes","userId":"9esutemV-lvg0Wu_Tcvb0","email":"test-workflows-Rn0vvSHNMBPCbSOimHsQw@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880009863,"env":"test","error":{},"workflowId":"83feb023-bfa5-48ee-973c-71417c25afc2","userId":"9esutemV-lvg0Wu_Tcvb0","projectId":"1273d8ab-709e-4bb0-8af0-1570ada31d9a","msg":"Error moving workflow"}
{"level":50,"time":1764880010245,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ff932269-06c8-4a9d-96e1-19fe7923a56e","userId":"Cq_3REOPEyinhztEcnlC8","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880010631,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"36fa98e1-75a6-4a30-a4bd-2e5bb6caa421","userId":"Cq_3REOPEyinhztEcnlC8","msg":"Error moving workflow"}
{"level":30,"time":1764880011234,"env":"test","module":"user-credentials-repository","userId":"gRAB5oX-eFye3f4YK8lAU","msg":"User credentials created"}
{"level":30,"time":1764880011235,"env":"test","module":"auth-routes","userId":"gRAB5oX-eFye3f4YK8lAU","email":"test-workflows-KeJwjtQPoXziBNvHhzDQ4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880011443,"env":"test","module":"auth-routes","userId":"gRAB5oX-eFye3f4YK8lAU","email":"test-workflows-KeJwjtQPoXziBNvHhzDQ4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880011705,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ce02c52d-3c60-4944-aea1-a480a8b6561a","userId":"Cq_3REOPEyinhztEcnlC8","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11149[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 821[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 795[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 816[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 385[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1075[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:29
[2m   Duration [22m 21.54s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764880017595,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880020548,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880024007,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880024007,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880024018,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880024018,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880024018,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880024018,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880024518,"env":"test","module":"user-credentials-repository","userId":"em9-hWCxKBnmEayU3JfWV","msg":"User credentials created"}
{"level":30,"time":1764880024521,"env":"test","module":"auth-routes","userId":"em9-hWCxKBnmEayU3JfWV","email":"test-workflows-T6-HPKxscoaJPdY7rAQq5@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f0860c94-fe1c-4cfb-a410-995f5633f3a3","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"em9-hWCxKBnmEayU3JfWV","tenantId":"02d93d9a-158d-4b55-979b-e5bd14c18fa1","createdBy":"em9-hWCxKBnmEayU3JfWV","ownerId":"em9-hWCxKBnmEayU3JfWV","status":"active","archived":false,"createdAt":"2025-12-04T20:27:06.252Z","updatedAt":"2025-12-04T20:27:06.252Z"}

{"level":30,"time":1764880025205,"env":"test","module":"user-credentials-repository","userId":"wuizQ1CmjaYXlUdfNAyqk","msg":"User credentials created"}
{"level":30,"time":1764880025206,"env":"test","module":"auth-routes","userId":"wuizQ1CmjaYXlUdfNAyqk","email":"viewer-ZOVZeCOe3jA9bVKF8T85d@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880025299,"env":"test","module":"rbac-middleware","userId":"wuizQ1CmjaYXlUdfNAyqk","userRole":"viewer","permission":"workflow:create","path":"/projects/f0860c94-fe1c-4cfb-a410-995f5633f3a3/workflows","msg":"Permission denied"}
{"level":50,"time":1764880031487,"env":"test","error":{},"workflowId":"607afd4d-843c-46a4-94a8-f1c3b1e25ce4","userId":"em9-hWCxKBnmEayU3JfWV","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880031820,"env":"test","module":"auth-middleware","path":"/api/workflows/cf402134-4ddb-40fd-80aa-141812576e21/move","msg":"No valid authentication found"}
{"level":30,"time":1764880032331,"env":"test","module":"user-credentials-repository","userId":"4913fY0jDdT4ht4aY7zBc","msg":"User credentials created"}
{"level":30,"time":1764880032332,"env":"test","module":"auth-routes","userId":"4913fY0jDdT4ht4aY7zBc","email":"test-workflows-mvpfbj2jA1ACGfA7LbTnp@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880032438,"env":"test","error":{},"workflowId":"373319c9-266c-4e85-9fc1-2331a99c5169","userId":"4913fY0jDdT4ht4aY7zBc","projectId":"8a5b5ddf-754d-4faa-b187-267a5da9eb97","msg":"Error moving workflow"}
{"level":50,"time":1764880032798,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"49fdfbed-a1bb-4593-91a0-f1b7f30f2db3","userId":"em9-hWCxKBnmEayU3JfWV","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880033156,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"41b8fb31-e326-411e-bdf3-696002780e0a","userId":"em9-hWCxKBnmEayU3JfWV","msg":"Error moving workflow"}
{"level":30,"time":1764880033695,"env":"test","module":"user-credentials-repository","userId":"L_QyscB8bHwtxtwmUHXt1","msg":"User credentials created"}
{"level":30,"time":1764880033696,"env":"test","module":"auth-routes","userId":"L_QyscB8bHwtxtwmUHXt1","email":"test-workflows-Y1_c8Jdnf_Dp9je-VQJKH@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880033887,"env":"test","module":"auth-routes","userId":"L_QyscB8bHwtxtwmUHXt1","email":"test-workflows-Y1_c8Jdnf_Dp9je-VQJKH@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880034062,"env":"test","error":{},"workflowId":"0c4c9efa-aa3d-4f67-b5c7-2dfd7cc449fc","userId":"em9-hWCxKBnmEayU3JfWV","projectId":"7b42ab2d-9af7-41a5-8179-b0d26650565e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10281[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 288[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 906[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:52
[2m   Duration [22m 21.11s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764880067824,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880071169,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880074571,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880074572,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880074585,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880074585,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880074585,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880074585,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880075136,"env":"test","module":"user-credentials-repository","userId":"ELhrC0JXeTb0yNtumhaUX","msg":"User credentials created"}
{"level":30,"time":1764880075139,"env":"test","module":"auth-routes","userId":"ELhrC0JXeTb0yNtumhaUX","email":"test-workflows-mjmbPmCajQJxBwqLY3w6b@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f8cfc68d-906a-46c2-8ef9-acb3a8a928c7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ELhrC0JXeTb0yNtumhaUX","tenantId":"c88c4739-7806-4ed3-9953-bce691f9c3be","createdBy":"ELhrC0JXeTb0yNtumhaUX","ownerId":"ELhrC0JXeTb0yNtumhaUX","status":"active","archived":false,"createdAt":"2025-12-04T20:27:56.859Z","updatedAt":"2025-12-04T20:27:56.859Z"}

{"level":30,"time":1764880075839,"env":"test","module":"user-credentials-repository","userId":"qJAOyEtvwyUFM-RvsHgYH","msg":"User credentials created"}
{"level":30,"time":1764880075840,"env":"test","module":"auth-routes","userId":"qJAOyEtvwyUFM-RvsHgYH","email":"viewer-Qz4QUPCtdxynBC6ne4-on@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880075929,"env":"test","module":"rbac-middleware","userId":"qJAOyEtvwyUFM-RvsHgYH","userRole":"viewer","permission":"workflow:create","path":"/projects/f8cfc68d-906a-46c2-8ef9-acb3a8a928c7/workflows","msg":"Permission denied"}
{"level":50,"time":1764880082148,"env":"test","error":{},"workflowId":"14e5ad62-ee04-43c8-8525-cd6e4460415b","userId":"ELhrC0JXeTb0yNtumhaUX","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880082460,"env":"test","module":"auth-middleware","path":"/api/workflows/b02e740d-a60b-42f8-a557-a0a09532d306/move","msg":"No valid authentication found"}
{"level":30,"time":1764880082977,"env":"test","module":"user-credentials-repository","userId":"eZuihOyXFb0Y-ZOWHJfVP","msg":"User credentials created"}
{"level":30,"time":1764880082978,"env":"test","module":"auth-routes","userId":"eZuihOyXFb0Y-ZOWHJfVP","email":"test-workflows-3PPxB4hMP8fCPv-ncbRQA@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880083026,"env":"test","error":{},"workflowId":"e3e5ab93-fa55-466f-968e-cebefd27a2f9","userId":"eZuihOyXFb0Y-ZOWHJfVP","projectId":"fbc7013f-8616-4256-9ac3-16bb01a73834","msg":"Error moving workflow"}
{"level":50,"time":1764880083373,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ef1f0c41-abb6-412d-9ac2-7c9dbd73f56f","userId":"ELhrC0JXeTb0yNtumhaUX","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880083739,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2fd2bf2e-cc45-4a83-99d2-b1b80f5cc81e","userId":"ELhrC0JXeTb0yNtumhaUX","msg":"Error moving workflow"}
{"level":30,"time":1764880084252,"env":"test","module":"user-credentials-repository","userId":"ipo25QPiwJU23bjMWrNel","msg":"User credentials created"}
{"level":30,"time":1764880084253,"env":"test","module":"auth-routes","userId":"ipo25QPiwJU23bjMWrNel","email":"test-workflows-cktmgkpz3BS6UDI6zMWPT@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880084460,"env":"test","module":"auth-routes","userId":"ipo25QPiwJU23bjMWrNel","email":"test-workflows-cktmgkpz3BS6UDI6zMWPT@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880084666,"env":"test","error":{},"workflowId":"9d0bb8af-cffe-407e-a0b2-426b0b771921","userId":"ELhrC0JXeTb0yNtumhaUX","projectId":"dadccc26-ec19-4ba8-9f36-cbd7fefb8173","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 686[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 444[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 929[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:27:42
[2m   Duration [22m 21.36s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx26 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880089653,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880092487,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880095450,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880095451,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880095465,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880095465,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880095465,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880095465,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880095923,"env":"test","module":"user-credentials-repository","userId":"lgkV6tKGrL23aH37uWx0d","msg":"User credentials created"}
{"level":30,"time":1764880095928,"env":"test","module":"auth-routes","userId":"lgkV6tKGrL23aH37uWx0d","email":"test-workflows-_YlTtcdocCLvGSIO73zsB@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"046b213e-a2c9-4ba7-92b8-7dcd3382da82","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"lgkV6tKGrL23aH37uWx0d","tenantId":"7d53b439-1bd0-46da-b7bb-ac699a5e4c3f","createdBy":"lgkV6tKGrL23aH37uWx0d","ownerId":"lgkV6tKGrL23aH37uWx0d","status":"active","archived":false,"createdAt":"2025-12-04T20:28:17.639Z","updatedAt":"2025-12-04T20:28:17.639Z"}

{"level":30,"time":1764880096565,"env":"test","module":"user-credentials-repository","userId":"BXpXkkTf4XMobo8oJ7IMs","msg":"User credentials created"}
{"level":30,"time":1764880096566,"env":"test","module":"auth-routes","userId":"BXpXkkTf4XMobo8oJ7IMs","email":"viewer-M1FMePMmAeOg4_nW_iR_G@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880096658,"env":"test","module":"rbac-middleware","userId":"BXpXkkTf4XMobo8oJ7IMs","userRole":"viewer","permission":"workflow:create","path":"/projects/046b213e-a2c9-4ba7-92b8-7dcd3382da82/workflows","msg":"Permission denied"}
{"level":50,"time":1764880102681,"env":"test","error":{},"workflowId":"a91911dc-9f84-4b0f-aec3-d9d7741848d3","userId":"lgkV6tKGrL23aH37uWx0d","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880102998,"env":"test","module":"auth-middleware","path":"/api/workflows/992dedc6-bd0c-4742-88dc-f0b7f3cc7ce3/move","msg":"No valid authentication found"}
{"level":30,"time":1764880103519,"env":"test","module":"user-credentials-repository","userId":"KUF0y85vRBme_j_If9MPP","msg":"User credentials created"}
{"level":30,"time":1764880103520,"env":"test","module":"auth-routes","userId":"KUF0y85vRBme_j_If9MPP","email":"test-workflows-wxVAuhCCX_Jd7_OaPHSGY@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880103570,"env":"test","error":{},"workflowId":"77ab476e-00b0-49d9-a8de-b8e222fef28c","userId":"KUF0y85vRBme_j_If9MPP","projectId":"6d6625f4-4485-48cc-aa4d-a8ec7114d5c9","msg":"Error moving workflow"}
{"level":50,"time":1764880103934,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9300e1a2-0e95-48fb-92e6-843ed9035d44","userId":"lgkV6tKGrL23aH37uWx0d","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880104278,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"92921114-8f2d-49c0-81d8-f6fd923e96cb","userId":"lgkV6tKGrL23aH37uWx0d","msg":"Error moving workflow"}
{"level":30,"time":1764880104788,"env":"test","module":"user-credentials-repository","userId":"n2W5YKnUuhXF4TzCvPHym","msg":"User credentials created"}
{"level":30,"time":1764880104788,"env":"test","module":"auth-routes","userId":"n2W5YKnUuhXF4TzCvPHym","email":"test-workflows-17tMazQ8bejWo2el60dps@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880104985,"env":"test","module":"auth-routes","userId":"n2W5YKnUuhXF4TzCvPHym","email":"test-workflows-17tMazQ8bejWo2el60dps@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880105164,"env":"test","error":{},"workflowId":"9d206918-7f40-41e4-a55e-5ec9c8021f65","userId":"lgkV6tKGrL23aH37uWx0d","projectId":"a3d30290-8a01-4eef-b80e-2e9e648eb842","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9961[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 313[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 276[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 762[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 345[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 886[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

[2m   Start at [22m 14:28:05
[2m   Duration [22m 19.32s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx27 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880107829,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880109849,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880112584,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880112585,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880112597,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880112598,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880112598,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880112598,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880113094,"env":"test","module":"user-credentials-repository","userId":"h2uVokCR72LQq96MHciro","msg":"User credentials created"}
{"level":30,"time":1764880113098,"env":"test","module":"auth-routes","userId":"h2uVokCR72LQq96MHciro","email":"test-workflows-ZNcInsX0u6bYj7x5weP8O@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"1397f49a-c640-4765-991b-e7f4a3ac69c6","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"h2uVokCR72LQq96MHciro","tenantId":"5aea7afd-e706-4115-a0bd-c662c8ea229e","createdBy":"h2uVokCR72LQq96MHciro","ownerId":"h2uVokCR72LQq96MHciro","status":"active","archived":false,"createdAt":"2025-12-04T20:28:34.832Z","updatedAt":"2025-12-04T20:28:34.832Z"}

{"level":30,"time":1764880113793,"env":"test","module":"user-credentials-repository","userId":"hJvs6x2tBgnnx7I0VO8Kf","msg":"User credentials created"}
{"level":30,"time":1764880113793,"env":"test","module":"auth-routes","userId":"hJvs6x2tBgnnx7I0VO8Kf","email":"viewer-CezfRZWdxK5G1hx3oOraS@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880113888,"env":"test","module":"rbac-middleware","userId":"hJvs6x2tBgnnx7I0VO8Kf","userRole":"viewer","permission":"workflow:create","path":"/projects/1397f49a-c640-4765-991b-e7f4a3ac69c6/workflows","msg":"Permission denied"}
{"level":50,"time":1764880120140,"env":"test","error":{},"workflowId":"d4b3caa4-61f2-43bb-aaca-3a127e2da6a3","userId":"h2uVokCR72LQq96MHciro","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880120459,"env":"test","module":"auth-middleware","path":"/api/workflows/742d211c-88f6-4166-8580-b23083e7060e/move","msg":"No valid authentication found"}
{"level":30,"time":1764880120967,"env":"test","module":"user-credentials-repository","userId":"zrt_vqW6L5OPygu_EoWbm","msg":"User credentials created"}
{"level":30,"time":1764880120968,"env":"test","module":"auth-routes","userId":"zrt_vqW6L5OPygu_EoWbm","email":"test-workflows-0Fa9X771WEG8lnM2pcElo@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880121011,"env":"test","error":{},"workflowId":"3e6ddb7d-3cd0-41df-a409-371aa27ba685","userId":"zrt_vqW6L5OPygu_EoWbm","projectId":"b605f817-85e4-444f-8a92-4244960a8e0b","msg":"Error moving workflow"}
{"level":50,"time":1764880121379,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"fde9c637-b9c3-4a26-bb94-3ceecf042292","userId":"h2uVokCR72LQq96MHciro","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880121737,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9c009288-6088-4f1e-9c76-4046f210f983","userId":"h2uVokCR72LQq96MHciro","msg":"Error moving workflow"}
{"level":30,"time":1764880122288,"env":"test","module":"user-credentials-repository","userId":"DQOkB05PEFZviLw_HgCvH","msg":"User credentials created"}
{"level":30,"time":1764880122289,"env":"test","module":"auth-routes","userId":"DQOkB05PEFZviLw_HgCvH","email":"test-workflows-vHWx5BSN0ktYwar4CYX43@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880122469,"env":"test","module":"auth-routes","userId":"DQOkB05PEFZviLw_HgCvH","email":"test-workflows-vHWx5BSN0ktYwar4CYX43@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880122657,"env":"test","error":{},"workflowId":"8b712268-8292-4aec-a851-a0d434dc835e","userId":"h2uVokCR72LQq96MHciro","projectId":"fefc6b25-a318-46d4-b43a-381326eda984","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 336[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 755[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 319[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 552[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 357[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 922[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:25
[2m   Duration [22m 17.15s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/sections.routes.ts [22m[34mx28 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764880140327,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880143826,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880148211,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880148212,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880148222,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880148222,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880148223,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880148223,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880148709,"env":"test","module":"user-credentials-repository","userId":"8lOnN86mLHow8U6gwYAZX","msg":"User credentials created"}
{"level":30,"time":1764880148712,"env":"test","module":"auth-routes","userId":"8lOnN86mLHow8U6gwYAZX","email":"test-workflows-XkyrNsrJL1aE8luFlVzeU@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9be0a4fb-e074-456c-91c4-45aeadb029b5","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"8lOnN86mLHow8U6gwYAZX","tenantId":"a4f56e47-73d9-47ae-8ec8-a8f44e0b314e","createdBy":"8lOnN86mLHow8U6gwYAZX","ownerId":"8lOnN86mLHow8U6gwYAZX","status":"active","archived":false,"createdAt":"2025-12-04T20:29:10.433Z","updatedAt":"2025-12-04T20:29:10.433Z"}

{"level":30,"time":1764880149400,"env":"test","module":"user-credentials-repository","userId":"0MEjoPx7zitmm9vOpCpbR","msg":"User credentials created"}
{"level":30,"time":1764880149400,"env":"test","module":"auth-routes","userId":"0MEjoPx7zitmm9vOpCpbR","email":"viewer-r3n2pyEXdHI16ohmUYM-w@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880149505,"env":"test","module":"rbac-middleware","userId":"0MEjoPx7zitmm9vOpCpbR","userRole":"viewer","permission":"workflow:create","path":"/projects/9be0a4fb-e074-456c-91c4-45aeadb029b5/workflows","msg":"Permission denied"}
{"level":50,"time":1764880155448,"env":"test","error":{},"workflowId":"67405cd8-9a2a-4684-aa07-0e99bc083c7f","userId":"8lOnN86mLHow8U6gwYAZX","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880155757,"env":"test","module":"auth-middleware","path":"/api/workflows/5f4ff5e6-1bfc-4571-8f83-e895a3fdfed4/move","msg":"No valid authentication found"}
{"level":30,"time":1764880156244,"env":"test","module":"user-credentials-repository","userId":"TzGiU3uRh84jRWsDdFCvm","msg":"User credentials created"}
{"level":30,"time":1764880156244,"env":"test","module":"auth-routes","userId":"TzGiU3uRh84jRWsDdFCvm","email":"test-workflows-2ETOSEN06Jl5Uyw7emWI_@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880156288,"env":"test","error":{},"workflowId":"440b69fe-1ff2-4001-8e31-032097255451","userId":"TzGiU3uRh84jRWsDdFCvm","projectId":"d0e58cf3-c870-4c20-9e05-845de977af43","msg":"Error moving workflow"}
{"level":50,"time":1764880156639,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f27f5743-fa1e-4964-af31-780c1368f88e","userId":"8lOnN86mLHow8U6gwYAZX","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880156989,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0d590985-0a20-4949-88c4-7e4e95b49026","userId":"8lOnN86mLHow8U6gwYAZX","msg":"Error moving workflow"}
{"level":30,"time":1764880157486,"env":"test","module":"user-credentials-repository","userId":"sTF0jryaAeI0uBf8zSXJB","msg":"User credentials created"}
{"level":30,"time":1764880157486,"env":"test","module":"auth-routes","userId":"sTF0jryaAeI0uBf8zSXJB","email":"test-workflows-UVqzCcR1y9RZFpbt_-PBI@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880157663,"env":"test","module":"auth-routes","userId":"sTF0jryaAeI0uBf8zSXJB","email":"test-workflows-UVqzCcR1y9RZFpbt_-PBI@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880157845,"env":"test","error":{},"workflowId":"4003d5d2-5143-4994-93f8-b1333bf52711","userId":"8lOnN86mLHow8U6gwYAZX","projectId":"87659856-7c5c-4444-ac16-5b001ac15f6f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9926[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 683[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 350[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 858[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:56
[2m   Duration [22m 21.29s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx29 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764880169186,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880174071,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880177075,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880177076,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880177088,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880177088,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880177088,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880177088,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880177633,"env":"test","module":"user-credentials-repository","userId":"jdBZzdp-un-MrnXKgl7nb","msg":"User credentials created"}
{"level":30,"time":1764880177636,"env":"test","module":"auth-routes","userId":"jdBZzdp-un-MrnXKgl7nb","email":"test-workflows-vpOANgBKXA8owCDbrgkvF@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0292de20-410a-4660-b935-2102ecbcfe10","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"jdBZzdp-un-MrnXKgl7nb","tenantId":"d7d34ee8-cc20-46ed-8d9e-6843b80a291f","createdBy":"jdBZzdp-un-MrnXKgl7nb","ownerId":"jdBZzdp-un-MrnXKgl7nb","status":"active","archived":false,"createdAt":"2025-12-04T20:29:39.360Z","updatedAt":"2025-12-04T20:29:39.360Z"}

{"level":30,"time":1764880178301,"env":"test","module":"user-credentials-repository","userId":"avb6jEFhV5ijU8arV07co","msg":"User credentials created"}
{"level":30,"time":1764880178302,"env":"test","module":"auth-routes","userId":"avb6jEFhV5ijU8arV07co","email":"viewer-LJ7VEMUyOBiQHKbo22Lsr@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880178395,"env":"test","module":"rbac-middleware","userId":"avb6jEFhV5ijU8arV07co","userRole":"viewer","permission":"workflow:create","path":"/projects/0292de20-410a-4660-b935-2102ecbcfe10/workflows","msg":"Permission denied"}
{"level":50,"time":1764880184367,"env":"test","error":{},"workflowId":"83a586c2-8c35-42bf-97ca-f5b3c19fa248","userId":"jdBZzdp-un-MrnXKgl7nb","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880184678,"env":"test","module":"auth-middleware","path":"/api/workflows/cb6ce391-96ec-41f2-972b-02ad7e8b0728/move","msg":"No valid authentication found"}
{"level":30,"time":1764880185198,"env":"test","module":"user-credentials-repository","userId":"9xyCKw1pEgd0bsql9nWzc","msg":"User credentials created"}
{"level":30,"time":1764880185199,"env":"test","module":"auth-routes","userId":"9xyCKw1pEgd0bsql9nWzc","email":"test-workflows-n-UHAYjoiV_hkWhAYV1ae@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880185247,"env":"test","error":{},"workflowId":"aa54af8b-e881-463a-b984-3fe6e0c28569","userId":"9xyCKw1pEgd0bsql9nWzc","projectId":"15dce68a-3443-415b-b667-c45bd26de7c3","msg":"Error moving workflow"}
{"level":50,"time":1764880185604,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"dcbcd96a-08da-4899-9ed4-0d0c498ba0fe","userId":"jdBZzdp-un-MrnXKgl7nb","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880185956,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"72c260b7-b4bc-4988-bfb4-c28c540fe13b","userId":"jdBZzdp-un-MrnXKgl7nb","msg":"Error moving workflow"}
{"level":30,"time":1764880186457,"env":"test","module":"user-credentials-repository","userId":"Myaq9Qo3jeFsVoQWQ0hFt","msg":"User credentials created"}
{"level":30,"time":1764880186457,"env":"test","module":"auth-routes","userId":"Myaq9Qo3jeFsVoQWQ0hFt","email":"test-workflows-Nc8xJ2PzTCIFTrBkitqDE@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880186650,"env":"test","module":"auth-routes","userId":"Myaq9Qo3jeFsVoQWQ0hFt","email":"test-workflows-Nc8xJ2PzTCIFTrBkitqDE@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880186832,"env":"test","error":{},"workflowId":"b1e50464-6d4f-4323-a7e8-5b7acd8e982f","userId":"jdBZzdp-un-MrnXKgl7nb","projectId":"bcfdcb06-14d2-4dce-bc4c-a87fbb78364b","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10089[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 312[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 702[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 742[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 357[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 352[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 878[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:25
[2m   Duration [22m 20.83s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx30 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764880190060,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880191900,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880194301,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880194301,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880194313,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880194313,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880194313,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880194313,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880194791,"env":"test","module":"user-credentials-repository","userId":"-MNG63BHdFCaK3L1uXL0M","msg":"User credentials created"}
{"level":30,"time":1764880194795,"env":"test","module":"auth-routes","userId":"-MNG63BHdFCaK3L1uXL0M","email":"test-workflows-dcGPzFEP1caNaidRJ9-GR@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9f9e4109-07fd-4499-8a3a-9b567a7885ea","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"-MNG63BHdFCaK3L1uXL0M","tenantId":"d49974d0-63e1-488d-8bd8-2b71df4457ee","createdBy":"-MNG63BHdFCaK3L1uXL0M","ownerId":"-MNG63BHdFCaK3L1uXL0M","status":"active","archived":false,"createdAt":"2025-12-04T20:29:56.514Z","updatedAt":"2025-12-04T20:29:56.514Z"}

{"level":30,"time":1764880195482,"env":"test","module":"user-credentials-repository","userId":"9sxttgnXm2kBU8pY_JHGF","msg":"User credentials created"}
{"level":30,"time":1764880195483,"env":"test","module":"auth-routes","userId":"9sxttgnXm2kBU8pY_JHGF","email":"viewer-cb4gs2EV26vS68QMitHeY@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880195577,"env":"test","module":"rbac-middleware","userId":"9sxttgnXm2kBU8pY_JHGF","userRole":"viewer","permission":"workflow:create","path":"/projects/9f9e4109-07fd-4499-8a3a-9b567a7885ea/workflows","msg":"Permission denied"}
{"level":50,"time":1764880201785,"env":"test","error":{},"workflowId":"7a472287-03b8-4433-b32c-e3016060edb3","userId":"-MNG63BHdFCaK3L1uXL0M","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880202104,"env":"test","module":"auth-middleware","path":"/api/workflows/ab6053f3-718b-4437-9fd0-680a8b954f14/move","msg":"No valid authentication found"}
{"level":30,"time":1764880202623,"env":"test","module":"user-credentials-repository","userId":"7bRbJEZRjJBFlxwHCV75v","msg":"User credentials created"}
{"level":30,"time":1764880202623,"env":"test","module":"auth-routes","userId":"7bRbJEZRjJBFlxwHCV75v","email":"test-workflows-5q-FKjoAYWf8_CUMQA-NO@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880202668,"env":"test","error":{},"workflowId":"12ab5834-9173-4e35-942f-8c6d506f1697","userId":"7bRbJEZRjJBFlxwHCV75v","projectId":"feedf0b2-f7f9-4918-98fd-c9eae9d72eb2","msg":"Error moving workflow"}
{"level":50,"time":1764880203086,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"0b5f0fad-da9a-4499-a542-8e5b88179c0d","userId":"-MNG63BHdFCaK3L1uXL0M","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880203458,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9bf5f5bc-eea6-4975-a8f7-b86cc3953332","userId":"-MNG63BHdFCaK3L1uXL0M","msg":"Error moving workflow"}
{"level":30,"time":1764880203954,"env":"test","module":"user-credentials-repository","userId":"YDmPQ9GxQGtPBdI3FoG_Q","msg":"User credentials created"}
{"level":30,"time":1764880203954,"env":"test","module":"auth-routes","userId":"YDmPQ9GxQGtPBdI3FoG_Q","email":"test-workflows-MKQPUNg17wMvEd1DO2Dr_@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880204150,"env":"test","module":"auth-routes","userId":"YDmPQ9GxQGtPBdI3FoG_Q","email":"test-workflows-MKQPUNg17wMvEd1DO2Dr_@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880204339,"env":"test","error":{},"workflowId":"f9e8ebc2-7a86-4871-aa0a-f5d7cb5a53fb","userId":"-MNG63BHdFCaK3L1uXL0M","projectId":"ab81286d-f076-4cb6-bca6-f77fabac89bb","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 731[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 319[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 418[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 372[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 882[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:47
[2m   Duration [22m 16.70s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/steps.routes.ts [22m[34mx31 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764880218995,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880222316,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880226713,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880226713,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880226726,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880226726,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880226726,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880226726,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880227240,"env":"test","module":"user-credentials-repository","userId":"XilXvbM9uZXSEDadngK2-","msg":"User credentials created"}
{"level":30,"time":1764880227243,"env":"test","module":"auth-routes","userId":"XilXvbM9uZXSEDadngK2-","email":"test-workflows-RB-eCU7acPDIhrbJLvO1L@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"848d720b-96f5-48aa-a836-21f1daa01d7c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"XilXvbM9uZXSEDadngK2-","tenantId":"636c1fb1-3d04-459a-947f-7fe2764a5664","createdBy":"XilXvbM9uZXSEDadngK2-","ownerId":"XilXvbM9uZXSEDadngK2-","status":"active","archived":false,"createdAt":"2025-12-04T20:30:28.974Z","updatedAt":"2025-12-04T20:30:28.974Z"}

{"level":30,"time":1764880227933,"env":"test","module":"user-credentials-repository","userId":"oDz1iu6Wq2WGtK7iIteWF","msg":"User credentials created"}
{"level":30,"time":1764880227934,"env":"test","module":"auth-routes","userId":"oDz1iu6Wq2WGtK7iIteWF","email":"viewer-DNw6eORdjXf2Ig1fsuVBr@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880228031,"env":"test","module":"rbac-middleware","userId":"oDz1iu6Wq2WGtK7iIteWF","userRole":"viewer","permission":"workflow:create","path":"/projects/848d720b-96f5-48aa-a836-21f1daa01d7c/workflows","msg":"Permission denied"}
{"level":50,"time":1764880234269,"env":"test","error":{},"workflowId":"85d8e69c-fb7d-4e77-91a5-595ed715c55f","userId":"XilXvbM9uZXSEDadngK2-","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880234599,"env":"test","module":"auth-middleware","path":"/api/workflows/dd458185-213f-470e-8a5e-f56ce2fcb414/move","msg":"No valid authentication found"}
{"level":30,"time":1764880235101,"env":"test","module":"user-credentials-repository","userId":"w2d3kGx9qFnP50kk_8u_7","msg":"User credentials created"}
{"level":30,"time":1764880235101,"env":"test","module":"auth-routes","userId":"w2d3kGx9qFnP50kk_8u_7","email":"test-workflows-5AXpETLNZbqQ8I7EBRyjZ@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880235145,"env":"test","error":{},"workflowId":"e421d591-cd97-4150-b3d5-2450cf29b1b1","userId":"w2d3kGx9qFnP50kk_8u_7","projectId":"59b1e816-2999-442b-8cb3-169b3af46a0f","msg":"Error moving workflow"}
{"level":50,"time":1764880235519,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"c4621e8d-6de4-4a3f-8bf5-d41dad9965e7","userId":"XilXvbM9uZXSEDadngK2-","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880235886,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2d131d2d-6ece-4b4a-bc7f-b236027a361a","userId":"XilXvbM9uZXSEDadngK2-","msg":"Error moving workflow"}
{"level":30,"time":1764880236400,"env":"test","module":"user-credentials-repository","userId":"pp127Vw2vTS8EEwR3sozf","msg":"User credentials created"}
{"level":30,"time":1764880236400,"env":"test","module":"auth-routes","userId":"pp127Vw2vTS8EEwR3sozf","email":"test-workflows-JjRjW5LF3-lldAfEVoaxC@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880236598,"env":"test","module":"auth-routes","userId":"pp127Vw2vTS8EEwR3sozf","email":"test-workflows-JjRjW5LF3-lldAfEVoaxC@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880236783,"env":"test","error":{},"workflowId":"a9c8a716-f66c-4e63-a82a-31ef1a9f2b44","userId":"XilXvbM9uZXSEDadngK2-","projectId":"01fea8d8-55b5-4407-b543-4711ec311b60","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 301[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 780[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 612[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 546[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 897[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:14
[2m   Duration [22m 21.37s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx32 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764880256377,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880259528,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880262976,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880262977,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880262988,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880262988,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880262988,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880262988,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880263486,"env":"test","module":"user-credentials-repository","userId":"sEpuZlTZH7YYN9uQZgsdn","msg":"User credentials created"}
{"level":30,"time":1764880263489,"env":"test","module":"auth-routes","userId":"sEpuZlTZH7YYN9uQZgsdn","email":"test-workflows-8ZWEg4dg08VFzzdI7EYrh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"dc64ccfe-6613-45ea-95a7-524b5d50faae","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"sEpuZlTZH7YYN9uQZgsdn","tenantId":"c3ad59f0-b069-4ce1-9e55-4996fdd6c7ca","createdBy":"sEpuZlTZH7YYN9uQZgsdn","ownerId":"sEpuZlTZH7YYN9uQZgsdn","status":"active","archived":false,"createdAt":"2025-12-04T20:31:05.209Z","updatedAt":"2025-12-04T20:31:05.209Z"}

{"level":30,"time":1764880264157,"env":"test","module":"user-credentials-repository","userId":"5v18THY8ZdXRRYPLLDuoR","msg":"User credentials created"}
{"level":30,"time":1764880264158,"env":"test","module":"auth-routes","userId":"5v18THY8ZdXRRYPLLDuoR","email":"viewer-cgMTRI_VCOtA9NJrN3h0k@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880264252,"env":"test","module":"rbac-middleware","userId":"5v18THY8ZdXRRYPLLDuoR","userRole":"viewer","permission":"workflow:create","path":"/projects/dc64ccfe-6613-45ea-95a7-524b5d50faae/workflows","msg":"Permission denied"}
{"level":50,"time":1764880270524,"env":"test","error":{},"workflowId":"c318da87-fe90-4532-aaeb-a4daca837acd","userId":"sEpuZlTZH7YYN9uQZgsdn","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880270855,"env":"test","module":"auth-middleware","path":"/api/workflows/2bc51cbf-3a57-4d2f-b319-6956cee8f62e/move","msg":"No valid authentication found"}
{"level":30,"time":1764880271377,"env":"test","module":"user-credentials-repository","userId":"a9ZfMUpot9XmqdR_BbbvN","msg":"User credentials created"}
{"level":30,"time":1764880271378,"env":"test","module":"auth-routes","userId":"a9ZfMUpot9XmqdR_BbbvN","email":"test-workflows-jVnTZsXI7p_zZpa3rXG6U@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880271426,"env":"test","error":{},"workflowId":"3c173218-c83b-4330-a04f-6e7975cb86e6","userId":"a9ZfMUpot9XmqdR_BbbvN","projectId":"406b501e-54f1-41f3-9156-985b6c920632","msg":"Error moving workflow"}
{"level":50,"time":1764880271796,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9e9188a8-498d-4108-8813-d53268bb6aaf","userId":"sEpuZlTZH7YYN9uQZgsdn","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880272162,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0854ee2e-bfbe-470e-8aa7-2a01517e79ff","userId":"sEpuZlTZH7YYN9uQZgsdn","msg":"Error moving workflow"}
{"level":30,"time":1764880272691,"env":"test","module":"user-credentials-repository","userId":"C16ExsNKw_hP-sDnDkEoK","msg":"User credentials created"}
{"level":30,"time":1764880272691,"env":"test","module":"auth-routes","userId":"C16ExsNKw_hP-sDnDkEoK","email":"test-workflows-ApbXc0NKzfni37-6jWK86@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880272892,"env":"test","module":"auth-routes","userId":"C16ExsNKw_hP-sDnDkEoK","email":"test-workflows-ApbXc0NKzfni37-6jWK86@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880273085,"env":"test","error":{},"workflowId":"97b35160-11b9-4df8-bdaf-bb14900dce01","userId":"sEpuZlTZH7YYN9uQZgsdn","projectId":"60c7d74d-f7ba-441d-8f5d-857d9d65b53e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10392[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 323[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 618[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 705[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 784[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 924[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:52
[2m   Duration [22m 20.48s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx33 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764880278251,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880281477,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880285293,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880285294,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880285304,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880285305,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880285305,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880285305,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880285862,"env":"test","module":"user-credentials-repository","userId":"CfmF2b6FRqWSLb_WNsuUB","msg":"User credentials created"}
{"level":30,"time":1764880285865,"env":"test","module":"auth-routes","userId":"CfmF2b6FRqWSLb_WNsuUB","email":"test-workflows-suPM5V1kz8UHZ1gQ2oLcD@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"02bdb887-3ae3-4ffe-9d6d-02eefb5a8990","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"CfmF2b6FRqWSLb_WNsuUB","tenantId":"7b50efa4-c353-4d4d-aa90-bbe2a122959d","createdBy":"CfmF2b6FRqWSLb_WNsuUB","ownerId":"CfmF2b6FRqWSLb_WNsuUB","status":"active","archived":false,"createdAt":"2025-12-04T20:31:27.587Z","updatedAt":"2025-12-04T20:31:27.587Z"}

{"level":30,"time":1764880286538,"env":"test","module":"user-credentials-repository","userId":"SAuIi3p7Ssbs2OPUYsW99","msg":"User credentials created"}
{"level":30,"time":1764880286539,"env":"test","module":"auth-routes","userId":"SAuIi3p7Ssbs2OPUYsW99","email":"viewer-7id8BMikNN9nH9CGJdHze@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880286638,"env":"test","module":"rbac-middleware","userId":"SAuIi3p7Ssbs2OPUYsW99","userRole":"viewer","permission":"workflow:create","path":"/projects/02bdb887-3ae3-4ffe-9d6d-02eefb5a8990/workflows","msg":"Permission denied"}
{"level":50,"time":1764880292647,"env":"test","error":{},"workflowId":"39b6cd43-1231-4cb9-a0ef-36a548c57bb2","userId":"CfmF2b6FRqWSLb_WNsuUB","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880292975,"env":"test","module":"auth-middleware","path":"/api/workflows/b0a50f4f-6ff1-4688-ad8f-194eae2999c4/move","msg":"No valid authentication found"}
{"level":30,"time":1764880293486,"env":"test","module":"user-credentials-repository","userId":"sJh4LvU6F-2p7heYj0Lf7","msg":"User credentials created"}
{"level":30,"time":1764880293487,"env":"test","module":"auth-routes","userId":"sJh4LvU6F-2p7heYj0Lf7","email":"test-workflows-UK3ecfQvzztEwb-cysnFx@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880293535,"env":"test","error":{},"workflowId":"5f4cbf0a-f5aa-4d5d-91b5-1ab637fdabbe","userId":"sJh4LvU6F-2p7heYj0Lf7","projectId":"a3bf557b-b2d9-4ab5-a0b8-c25280631650","msg":"Error moving workflow"}
{"level":50,"time":1764880293896,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"5baadc9d-aa08-417e-9ac9-d5c1b7555b39","userId":"CfmF2b6FRqWSLb_WNsuUB","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880294363,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"cf6553fe-5bb9-4796-a62e-929fd0b7970b","userId":"CfmF2b6FRqWSLb_WNsuUB","msg":"Error moving workflow"}
{"level":30,"time":1764880294880,"env":"test","module":"user-credentials-repository","userId":"lixYT38VaqjDg1u_e1IHk","msg":"User credentials created"}
{"level":30,"time":1764880294880,"env":"test","module":"auth-routes","userId":"lixYT38VaqjDg1u_e1IHk","email":"test-workflows-CllSMt0V2KYFPoAjptcrb@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880295074,"env":"test","module":"auth-routes","userId":"lixYT38VaqjDg1u_e1IHk","email":"test-workflows-CllSMt0V2KYFPoAjptcrb@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880295264,"env":"test","error":{},"workflowId":"4717113d-64d3-4332-837f-9a22f8f46d11","userId":"CfmF2b6FRqWSLb_WNsuUB","projectId":"5ddd2eb3-5064-4903-8a7b-4a8ddf39eb94","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10219[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 301[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 555[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 692[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 586[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 901[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:13
[2m   Duration [22m 21.23s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx34 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880299543,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880302404,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880305336,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880305337,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880305349,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880305349,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880305349,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880305349,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880305898,"env":"test","module":"user-credentials-repository","userId":"YaTF2zXEufYkif_sMmxvO","msg":"User credentials created"}
{"level":30,"time":1764880305902,"env":"test","module":"auth-routes","userId":"YaTF2zXEufYkif_sMmxvO","email":"test-workflows-jP851uOurSUiA279xDzVj@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"27c6bfa7-f412-4679-9665-62ea815fcc43","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"YaTF2zXEufYkif_sMmxvO","tenantId":"a1879426-f4e1-42bf-84dc-004f2f634599","createdBy":"YaTF2zXEufYkif_sMmxvO","ownerId":"YaTF2zXEufYkif_sMmxvO","status":"active","archived":false,"createdAt":"2025-12-04T20:31:47.629Z","updatedAt":"2025-12-04T20:31:47.629Z"}

{"level":30,"time":1764880306615,"env":"test","module":"user-credentials-repository","userId":"cGB3LAQyESF0AIr7jIT5Y","msg":"User credentials created"}
{"level":30,"time":1764880306616,"env":"test","module":"auth-routes","userId":"cGB3LAQyESF0AIr7jIT5Y","email":"viewer-1exvA8B45qDKk2D3g4tr5@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880306718,"env":"test","module":"rbac-middleware","userId":"cGB3LAQyESF0AIr7jIT5Y","userRole":"viewer","permission":"workflow:create","path":"/projects/27c6bfa7-f412-4679-9665-62ea815fcc43/workflows","msg":"Permission denied"}
{"level":50,"time":1764880313317,"env":"test","error":{},"workflowId":"11ab6b99-4400-40f5-83e9-bfa18d2a7508","userId":"YaTF2zXEufYkif_sMmxvO","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880313672,"env":"test","module":"auth-middleware","path":"/api/workflows/7786ee64-39a2-47b6-afcb-6b7d233941c4/move","msg":"No valid authentication found"}
{"level":30,"time":1764880314211,"env":"test","module":"user-credentials-repository","userId":"JPJ-5RY5nGWwa0jPjN9j9","msg":"User credentials created"}
{"level":30,"time":1764880314212,"env":"test","module":"auth-routes","userId":"JPJ-5RY5nGWwa0jPjN9j9","email":"test-workflows-U9beWaREMYYLvQ6c8727r@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880314290,"env":"test","error":{},"workflowId":"ac19ffa1-6bf4-4259-bb34-4e17123f90aa","userId":"JPJ-5RY5nGWwa0jPjN9j9","projectId":"a959a63c-4c19-4816-bf8c-340cf0f2606e","msg":"Error moving workflow"}
{"level":50,"time":1764880314676,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9f5d0552-c6ea-43cd-b823-1581260f8077","userId":"YaTF2zXEufYkif_sMmxvO","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880315210,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8751e58e-befc-4f1d-814a-6ee74ffcb8a1","userId":"YaTF2zXEufYkif_sMmxvO","msg":"Error moving workflow"}
{"level":30,"time":1764880315758,"env":"test","module":"user-credentials-repository","userId":"s1KXghiTEUJw37ZbWmph5","msg":"User credentials created"}
{"level":30,"time":1764880315758,"env":"test","module":"auth-routes","userId":"s1KXghiTEUJw37ZbWmph5","email":"test-workflows-NS4s-0Hin6T5aFj72CFhv@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880315955,"env":"test","module":"auth-routes","userId":"s1KXghiTEUJw37ZbWmph5","email":"test-workflows-NS4s-0Hin6T5aFj72CFhv@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880316152,"env":"test","error":{},"workflowId":"9065e03c-dde1-4cfb-a77d-23f29eeb2670","userId":"YaTF2zXEufYkif_sMmxvO","projectId":"ffa6deac-d5df-4678-840b-fee1fcdb303f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11132[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 490[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 512[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 815[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 784[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 668[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 639[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 386[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 533[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 945[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:35
[2m   Duration [22m 19.96s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx35 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880320340,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880322859,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880326070,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880326070,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880326086,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880326086,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880326086,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880326086,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880326573,"env":"test","module":"user-credentials-repository","userId":"7LUAWqN6dwWFm1AEdHzQf","msg":"User credentials created"}
{"level":30,"time":1764880326576,"env":"test","module":"auth-routes","userId":"7LUAWqN6dwWFm1AEdHzQf","email":"test-workflows-0G45ryxHwSGwgd7ZemX0P@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0e5ec1c6-8cdb-44b1-90ed-b09404b01e36","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"7LUAWqN6dwWFm1AEdHzQf","tenantId":"6c4d0c41-4786-4ddc-837b-1755b06bdf08","createdBy":"7LUAWqN6dwWFm1AEdHzQf","ownerId":"7LUAWqN6dwWFm1AEdHzQf","status":"active","archived":false,"createdAt":"2025-12-04T20:32:08.304Z","updatedAt":"2025-12-04T20:32:08.304Z"}

{"level":30,"time":1764880327271,"env":"test","module":"user-credentials-repository","userId":"bnbrmxrajEhFajB7_HJ6K","msg":"User credentials created"}
{"level":30,"time":1764880327272,"env":"test","module":"auth-routes","userId":"bnbrmxrajEhFajB7_HJ6K","email":"viewer-WKyqHz_CputOXtSfKHlCB@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880327376,"env":"test","module":"rbac-middleware","userId":"bnbrmxrajEhFajB7_HJ6K","userRole":"viewer","permission":"workflow:create","path":"/projects/0e5ec1c6-8cdb-44b1-90ed-b09404b01e36/workflows","msg":"Permission denied"}
{"level":50,"time":1764880333759,"env":"test","error":{},"workflowId":"0b0a39cb-ed10-495c-871f-c74f7aa48fa8","userId":"7LUAWqN6dwWFm1AEdHzQf","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880334097,"env":"test","module":"auth-middleware","path":"/api/workflows/ea5848b1-c418-42b9-b8f7-63b3172da85f/move","msg":"No valid authentication found"}
{"level":30,"time":1764880334622,"env":"test","module":"user-credentials-repository","userId":"Z-1p9tMQBS3p2HIhZqT46","msg":"User credentials created"}
{"level":30,"time":1764880334623,"env":"test","module":"auth-routes","userId":"Z-1p9tMQBS3p2HIhZqT46","email":"test-workflows-Rot8cGRq0HWZqBg2DSw4p@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880334670,"env":"test","error":{},"workflowId":"46175a21-e18c-427b-a0f7-035c79292b49","userId":"Z-1p9tMQBS3p2HIhZqT46","projectId":"842780d1-79dd-4134-86ad-46d4a493f7d7","msg":"Error moving workflow"}
{"level":50,"time":1764880335061,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"248c348a-ae91-4ebe-a939-4486741766dc","userId":"7LUAWqN6dwWFm1AEdHzQf","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880335563,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"688e0468-9a28-41e2-b604-be6340b5b2e6","userId":"7LUAWqN6dwWFm1AEdHzQf","msg":"Error moving workflow"}
{"level":30,"time":1764880336081,"env":"test","module":"user-credentials-repository","userId":"BbiJFZe8Vag8V8aWDATIo","msg":"User credentials created"}
{"level":30,"time":1764880336081,"env":"test","module":"auth-routes","userId":"BbiJFZe8Vag8V8aWDATIo","email":"test-workflows-KPXy2QsT7oBlXu3ko1D9E@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880336273,"env":"test","module":"auth-routes","userId":"BbiJFZe8Vag8V8aWDATIo","email":"test-workflows-KPXy2QsT7oBlXu3ko1D9E@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880336459,"env":"test","error":{},"workflowId":"aa38522a-2ac1-4513-8e89-1e241f3d5813","userId":"7LUAWqN6dwWFm1AEdHzQf","projectId":"9f7bbfd3-cb8e-4033-8566-139291a611b8","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10671[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 655[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 502[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 896[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:56
[2m   Duration [22m 19.37s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx36 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764880372392,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880380242,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880381644,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880381645,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880381654,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880381654,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880381654,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880381654,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880382098,"env":"test","module":"user-credentials-repository","userId":"bMDlxW09depNn-mFzxEQu","msg":"User credentials created"}
{"level":30,"time":1764880382101,"env":"test","module":"auth-routes","userId":"bMDlxW09depNn-mFzxEQu","email":"test-workflows-SlimZH0Sd9po2AlOiu7V6@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"37db81ad-8c54-4afe-9704-ec508ab3d000","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"bMDlxW09depNn-mFzxEQu","tenantId":"d89f0adf-9b00-41ee-9eec-c18d9a47d460","createdBy":"bMDlxW09depNn-mFzxEQu","ownerId":"bMDlxW09depNn-mFzxEQu","status":"active","archived":false,"createdAt":"2025-12-04T20:33:03.827Z","updatedAt":"2025-12-04T20:33:03.827Z"}

{"level":30,"time":1764880382770,"env":"test","module":"user-credentials-repository","userId":"EeM_2u5QV417TSb8Muk-A","msg":"User credentials created"}
{"level":30,"time":1764880382771,"env":"test","module":"auth-routes","userId":"EeM_2u5QV417TSb8Muk-A","email":"viewer-BDYKeI8pkuzV8Hpa0Gykd@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880382866,"env":"test","module":"rbac-middleware","userId":"EeM_2u5QV417TSb8Muk-A","userRole":"viewer","permission":"workflow:create","path":"/projects/37db81ad-8c54-4afe-9704-ec508ab3d000/workflows","msg":"Permission denied"}
{"level":50,"time":1764880388515,"env":"test","error":{},"workflowId":"0e2b03f5-3ec0-451f-ad7e-55f05b451029","userId":"bMDlxW09depNn-mFzxEQu","projectId":"10abfc7d-c301-44e6-b450-2721055c75bf","msg":"Error moving workflow"}
{"level":50,"time":1764880388660,"env":"test","error":{},"workflowId":"0e2b03f5-3ec0-451f-ad7e-55f05b451029","userId":"bMDlxW09depNn-mFzxEQu","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764880389124,"env":"test","error":{},"workflowId":"2b36ee5d-3d50-48c8-8849-a78a7517715c","userId":"bMDlxW09depNn-mFzxEQu","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":50,"time":1764880389315,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(bMDlxW09depNn-mFzxEQu) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"bMDlxW09depNn-mFzxEQu","msg":"Error creating workflow"}
{"level":50,"time":1764880389498,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(bMDlxW09depNn-mFzxEQu) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"bMDlxW09depNn-mFzxEQu","msg":"Error creating workflow"}
{"level":50,"time":1764880389677,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(bMDlxW09depNn-mFzxEQu) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"bMDlxW09depNn-mFzxEQu","msg":"Error creating workflow"}
{"level":50,"time":1764880389864,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(bMDlxW09depNn-mFzxEQu) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"bMDlxW09depNn-mFzxEQu","msg":"Error creating workflow"}
{"level":50,"time":1764880390034,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(bMDlxW09depNn-mFzxEQu) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"bMDlxW09depNn-mFzxEQu","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 8653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 287[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 493[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 805[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 776[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 519[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without authentication[39m[32m 192[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 182[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 180[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 187[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 170[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
AssertionError: expected '' to have property "id" with value '46b9935d-e242-4100-9414-6e11d7d21e77'

- Expected: 
"46b9935d-e242-4100-9414-6e11d7d21e77"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/api.workflows.test.ts:308:29
    306|         .expect(200);
    307| 
    308|       expect(response.body).toHaveProperty("id", workflowId);
       |                             ^
    309|       expect(response.body).toHaveProperty("projectId", targetProjectIÎ“Ã‡Âª
    310| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:332:10
    330|         .set("Authorization", `Bearer ${authToken}`)
    331|         .send({ projectId: null })
    332|         .expect(200);
       |          ^
    333| 
    334|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/7]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without authentication
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/7]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m10 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:32:47
[2m   Duration [22m 21.79s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx37 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764891573402,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764891576649,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764891580192,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764891580192,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764891580203,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764891580203,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764891580204,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764891580204,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764891580804,"env":"test","module":"user-credentials-repository","userId":"9rDUrh8aCxWRNC40wHt81","msg":"User credentials created"}
{"level":30,"time":1764891580808,"env":"test","module":"auth-routes","userId":"9rDUrh8aCxWRNC40wHt81","email":"test-workflows-eTb3s95Dr9vXgPkwans-X@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"4b3d7ec9-3eb9-4be4-aa00-6b1acaefe6f6","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"9rDUrh8aCxWRNC40wHt81","tenantId":"78460472-42c4-4ac2-9b06-adba45c6f127","createdBy":"9rDUrh8aCxWRNC40wHt81","ownerId":"9rDUrh8aCxWRNC40wHt81","status":"active","archived":false,"createdAt":"2025-12-04T23:39:42.724Z","updatedAt":"2025-12-04T23:39:42.724Z"}

{"level":30,"time":1764891581501,"env":"test","module":"user-credentials-repository","userId":"bpuqZiqV0tXW43BKTSn8c","msg":"User credentials created"}
{"level":30,"time":1764891581502,"env":"test","module":"auth-routes","userId":"bpuqZiqV0tXW43BKTSn8c","email":"viewer-WFuEuWPZXXMstXRSmmEnE@example.com","msg":"User registered successfully"}
{"level":40,"time":1764891581602,"env":"test","module":"rbac-middleware","userId":"bpuqZiqV0tXW43BKTSn8c","userRole":"viewer","permission":"workflow:create","path":"/projects/4b3d7ec9-3eb9-4be4-aa00-6b1acaefe6f6/workflows","msg":"Permission denied"}
{"level":50,"time":1764891588373,"env":"test","error":{},"workflowId":"afdeb480-988e-4859-b0f1-a387a43d8b3d","userId":"9rDUrh8aCxWRNC40wHt81","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764891588700,"env":"test","module":"auth-middleware","path":"/api/workflows/5d0f23b7-b8dd-4a9a-816d-da8b615b7b17/move","msg":"No valid authentication found"}
{"level":30,"time":1764891589212,"env":"test","module":"user-credentials-repository","userId":"3ezJOKY_BTiPv1yDoHRXE","msg":"User credentials created"}
{"level":30,"time":1764891589213,"env":"test","module":"auth-routes","userId":"3ezJOKY_BTiPv1yDoHRXE","email":"test-workflows-2fZtmmNg_c8o1WUgYfUGC@example.com","msg":"User registered successfully"}
{"level":50,"time":1764891589262,"env":"test","error":{},"workflowId":"463e7021-c042-40ce-bc68-c56af43d9eda","userId":"3ezJOKY_BTiPv1yDoHRXE","projectId":"9a40c0e5-564b-48c0-97f7-bd7eccfa14c5","msg":"Error moving workflow"}
{"level":50,"time":1764891589635,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"83d1b285-d0c4-4f3f-8f23-c6d06c1cd82c","userId":"9rDUrh8aCxWRNC40wHt81","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764891590018,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"5a4b19d1-6296-430e-a85c-590aea388945","userId":"9rDUrh8aCxWRNC40wHt81","msg":"Error moving workflow"}
{"level":30,"time":1764891590546,"env":"test","module":"user-credentials-repository","userId":"4aRPD7wAGEr58rbqSnBgk","msg":"User credentials created"}
{"level":30,"time":1764891590547,"env":"test","module":"auth-routes","userId":"4aRPD7wAGEr58rbqSnBgk","email":"test-workflows-IUB5Mz1Os5Uyb_YjFXRXA@example.com","msg":"User registered successfully"}
{"level":30,"time":1764891590737,"env":"test","module":"auth-routes","userId":"4aRPD7wAGEr58rbqSnBgk","email":"test-workflows-IUB5Mz1Os5Uyb_YjFXRXA@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764891590924,"env":"test","error":{},"workflowId":"49a26047-cd99-464e-bd82-8d4f25fb923f","userId":"9rDUrh8aCxWRNC40wHt81","projectId":"a53d8134-c839-4a3f-8630-580c64046315","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10992[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 612[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 676[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 811[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 383[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 907[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:39:28
[2m   Duration [22m 21.37s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/auth.ts [22m[34mx38 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764892165531,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892169157,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892173909,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892173911,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892173921,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892173921,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892173921,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892173921,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892174433,"env":"test","module":"user-credentials-repository","userId":"WqLrrnfCsrSUKgiObfM1R","msg":"User credentials created"}
{"level":30,"time":1764892174436,"env":"test","module":"auth-routes","userId":"WqLrrnfCsrSUKgiObfM1R","email":"test-workflows-IZvn-G96gQzRXGq1GQJmZ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"25039861-04cb-4784-8f5b-44cd75736027","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"WqLrrnfCsrSUKgiObfM1R","tenantId":"af37356d-8fea-4ac0-a2b4-901b1a95c341","createdBy":"WqLrrnfCsrSUKgiObfM1R","ownerId":"WqLrrnfCsrSUKgiObfM1R","status":"active","archived":false,"createdAt":"2025-12-04T23:49:36.370Z","updatedAt":"2025-12-04T23:49:36.370Z"}

{"level":30,"time":1764892175135,"env":"test","module":"user-credentials-repository","userId":"E0xepH995fVn679CanwzH","msg":"User credentials created"}
{"level":30,"time":1764892175136,"env":"test","module":"auth-routes","userId":"E0xepH995fVn679CanwzH","email":"viewer-aHxmN9NisNPJmSyY8gHy5@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892175229,"env":"test","module":"rbac-middleware","userId":"E0xepH995fVn679CanwzH","userRole":"viewer","permission":"workflow:create","path":"/projects/25039861-04cb-4784-8f5b-44cd75736027/workflows","msg":"Permission denied"}
{"level":50,"time":1764892181762,"env":"test","error":{},"workflowId":"cc96066a-252f-4928-8307-f620084ba05e","userId":"WqLrrnfCsrSUKgiObfM1R","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892182087,"env":"test","module":"auth-middleware","path":"/api/workflows/6105770e-73c6-4767-9262-e09f3920cc3e/move","msg":"No valid authentication found"}
{"level":30,"time":1764892182630,"env":"test","module":"user-credentials-repository","userId":"kRQCfryD1A0LbrAGSH6iB","msg":"User credentials created"}
{"level":30,"time":1764892182631,"env":"test","module":"auth-routes","userId":"kRQCfryD1A0LbrAGSH6iB","email":"test-workflows-9pXA1MzSpeilTdGngDpkV@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892182681,"env":"test","error":{},"workflowId":"abbc9fee-b80a-4faf-b11c-5d9b3738dc0b","userId":"kRQCfryD1A0LbrAGSH6iB","projectId":"ce58fe07-86a8-458e-9f45-9a60d77a00af","msg":"Error moving workflow"}
{"level":50,"time":1764892183070,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"99471c4f-266e-4c65-97b2-c6b3cb61ba7f","userId":"WqLrrnfCsrSUKgiObfM1R","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892183460,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"06f4938c-c139-43ea-9c46-99d86bb1a1ed","userId":"WqLrrnfCsrSUKgiObfM1R","msg":"Error moving workflow"}
{"level":30,"time":1764892183975,"env":"test","module":"user-credentials-repository","userId":"guC-om4kbaufojZwY61Fj","msg":"User credentials created"}
{"level":30,"time":1764892183976,"env":"test","module":"auth-routes","userId":"guC-om4kbaufojZwY61Fj","email":"test-workflows-yTZaKNIcJzyiXEPwthbvS@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892184156,"env":"test","module":"auth-routes","userId":"guC-om4kbaufojZwY61Fj","email":"test-workflows-yTZaKNIcJzyiXEPwthbvS@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892184342,"env":"test","error":{},"workflowId":"2f1beb0d-4df4-4001-96d0-0081a4d5a07e","userId":"WqLrrnfCsrSUKgiObfM1R","projectId":"9a845a89-9992-4817-978d-d020f22abc53","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 589[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 391[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 883[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:49:20
[2m   Duration [22m 23.03s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx39 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764892480227,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892483062,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892486963,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892486964,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892486976,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892486976,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892486977,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892486977,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892487471,"env":"test","module":"user-credentials-repository","userId":"l9oYpkUcLVdSCpuhRtdHn","msg":"User credentials created"}
{"level":30,"time":1764892487475,"env":"test","module":"auth-routes","userId":"l9oYpkUcLVdSCpuhRtdHn","email":"test-workflows-rJfCc70_lx2WXwNVA-66O@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"5bab2809-e914-4754-8ad1-f9e3483cf315","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"l9oYpkUcLVdSCpuhRtdHn","tenantId":"6b757b9a-afab-45b9-a3b0-d238f775741f","createdBy":"l9oYpkUcLVdSCpuhRtdHn","ownerId":"l9oYpkUcLVdSCpuhRtdHn","status":"active","archived":false,"createdAt":"2025-12-04T23:54:49.409Z","updatedAt":"2025-12-04T23:54:49.409Z"}

{"level":30,"time":1764892488158,"env":"test","module":"user-credentials-repository","userId":"u1PHsihiNlawRh2_b1z2M","msg":"User credentials created"}
{"level":30,"time":1764892488159,"env":"test","module":"auth-routes","userId":"u1PHsihiNlawRh2_b1z2M","email":"viewer-G8sZlF-_zapc9xnJuYTMA@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892488255,"env":"test","module":"rbac-middleware","userId":"u1PHsihiNlawRh2_b1z2M","userRole":"viewer","permission":"workflow:create","path":"/projects/5bab2809-e914-4754-8ad1-f9e3483cf315/workflows","msg":"Permission denied"}
{"level":50,"time":1764892494536,"env":"test","error":{},"workflowId":"165bcbbc-2a2c-4288-b9db-11e5fd0ca8eb","userId":"l9oYpkUcLVdSCpuhRtdHn","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892494866,"env":"test","module":"auth-middleware","path":"/api/workflows/8276446b-f60d-411c-8a7d-eb1e44dadfa3/move","msg":"No valid authentication found"}
{"level":30,"time":1764892495404,"env":"test","module":"user-credentials-repository","userId":"icvBbipNqfKsphteYal6f","msg":"User credentials created"}
{"level":30,"time":1764892495404,"env":"test","module":"auth-routes","userId":"icvBbipNqfKsphteYal6f","email":"test-workflows-gNTc3SRVJqo20a1ExV8dP@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892495458,"env":"test","error":{},"workflowId":"c2c890fb-498f-4ff4-b0ae-ba626938771b","userId":"icvBbipNqfKsphteYal6f","projectId":"d8f8f901-ad82-4ef3-958a-8f906be08217","msg":"Error moving workflow"}
{"level":50,"time":1764892495841,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6e77b5b5-3f80-4189-9614-254233d26238","userId":"l9oYpkUcLVdSCpuhRtdHn","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892496200,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d86e4edd-a085-44a5-95fd-097b03f86dbf","userId":"l9oYpkUcLVdSCpuhRtdHn","msg":"Error moving workflow"}
{"level":30,"time":1764892496712,"env":"test","module":"user-credentials-repository","userId":"Uf9R8cl0kmhK9xgiIrnrJ","msg":"User credentials created"}
{"level":30,"time":1764892496713,"env":"test","module":"auth-routes","userId":"Uf9R8cl0kmhK9xgiIrnrJ","email":"test-workflows-yiDI8DZf7lPxv-NdZx1db@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892496902,"env":"test","module":"auth-routes","userId":"Uf9R8cl0kmhK9xgiIrnrJ","email":"test-workflows-yiDI8DZf7lPxv-NdZx1db@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892497092,"env":"test","error":{},"workflowId":"f07e7c42-1535-464b-a217-8826acc52bb0","userId":"l9oYpkUcLVdSCpuhRtdHn","projectId":"69581468-03c5-422e-be3f-c29b94d5ed69","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 319[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 720[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 359[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 895[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:36
[2m   Duration [22m 20.31s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx40 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764892500480,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892503131,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892505444,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892505445,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892505457,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892505458,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892505458,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892505458,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892505936,"env":"test","module":"user-credentials-repository","userId":"kQ2vZxx69DjxrolNvpQQe","msg":"User credentials created"}
{"level":30,"time":1764892505939,"env":"test","module":"auth-routes","userId":"kQ2vZxx69DjxrolNvpQQe","email":"test-workflows-UzAs8HioVEqBUOayrqJwx@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"5ca4f5d0-3f8b-417a-b6c9-a59871adb005","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"kQ2vZxx69DjxrolNvpQQe","tenantId":"9892a96f-ba3c-4182-9e4c-f0d720a55262","createdBy":"kQ2vZxx69DjxrolNvpQQe","ownerId":"kQ2vZxx69DjxrolNvpQQe","status":"active","archived":false,"createdAt":"2025-12-04T23:55:07.875Z","updatedAt":"2025-12-04T23:55:07.875Z"}

{"level":30,"time":1764892506638,"env":"test","module":"user-credentials-repository","userId":"YLL69UgJ2UBm1LtHlhmgR","msg":"User credentials created"}
{"level":30,"time":1764892506639,"env":"test","module":"auth-routes","userId":"YLL69UgJ2UBm1LtHlhmgR","email":"viewer-vC8ptD0KDjL8xoPZYOFK-@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892506733,"env":"test","module":"rbac-middleware","userId":"YLL69UgJ2UBm1LtHlhmgR","userRole":"viewer","permission":"workflow:create","path":"/projects/5ca4f5d0-3f8b-417a-b6c9-a59871adb005/workflows","msg":"Permission denied"}
{"level":50,"time":1764892512739,"env":"test","error":{},"workflowId":"af6a843e-2950-44f8-9897-5deeae1017b0","userId":"kQ2vZxx69DjxrolNvpQQe","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892513114,"env":"test","module":"auth-middleware","path":"/api/workflows/5bc62b71-3456-44aa-8eda-8aa98d05a602/move","msg":"No valid authentication found"}
{"level":30,"time":1764892513599,"env":"test","module":"user-credentials-repository","userId":"7uQhKLnUc3AfIiPzWS7w2","msg":"User credentials created"}
{"level":30,"time":1764892513600,"env":"test","module":"auth-routes","userId":"7uQhKLnUc3AfIiPzWS7w2","email":"test-workflows-j0F6JV2ixXuKYoBf-9k_C@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892513640,"env":"test","error":{},"workflowId":"06e032ed-46ca-4475-8f13-d23c8905dccb","userId":"7uQhKLnUc3AfIiPzWS7w2","projectId":"2e43e18d-8374-435c-bad4-8463bacdb670","msg":"Error moving workflow"}
{"level":50,"time":1764892513974,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f25c866f-0d52-4323-8502-fde70d24630f","userId":"kQ2vZxx69DjxrolNvpQQe","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892514355,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"7e9e85d8-b7d3-42f7-b176-1c8fa1249136","userId":"kQ2vZxx69DjxrolNvpQQe","msg":"Error moving workflow"}
{"level":30,"time":1764892514835,"env":"test","module":"user-credentials-repository","userId":"4A-B5kdUPZRv7evokwWv0","msg":"User credentials created"}
{"level":30,"time":1764892514836,"env":"test","module":"auth-routes","userId":"4A-B5kdUPZRv7evokwWv0","email":"test-workflows-ycZCKkTybSgNAYWFT7UP3@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892515028,"env":"test","module":"auth-routes","userId":"4A-B5kdUPZRv7evokwWv0","email":"test-workflows-ycZCKkTybSgNAYWFT7UP3@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892515201,"env":"test","error":{},"workflowId":"cc03d036-5f09-4766-b2e4-7cac9424988d","userId":"kQ2vZxx69DjxrolNvpQQe","projectId":"f848175b-7488-4711-ae8d-a4d24af31ada","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10008[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 344[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 526[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 846[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:57
[2m   Duration [22m 17.39s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx41 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764895077427,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895080510,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895084105,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895084106,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895084117,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895084118,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895084118,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895084118,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895084671,"env":"test","module":"user-credentials-repository","userId":"RaKMQWuG1-kBonPFkV3X6","msg":"User credentials created"}
{"level":30,"time":1764895084675,"env":"test","module":"auth-routes","userId":"RaKMQWuG1-kBonPFkV3X6","email":"test-workflows-x1BtYBPaNLVpSNJsfjjdd@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9c018bd8-5f4f-495d-bba7-5c8660c88aaf","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"RaKMQWuG1-kBonPFkV3X6","tenantId":"19a415aa-4cbd-408b-8c57-037e9a49e120","createdBy":"RaKMQWuG1-kBonPFkV3X6","ownerId":"RaKMQWuG1-kBonPFkV3X6","status":"active","archived":false,"createdAt":"2025-12-05T00:38:04.845Z","updatedAt":"2025-12-05T00:38:04.845Z"}

{"level":30,"time":1764895085363,"env":"test","module":"user-credentials-repository","userId":"F1oD439JhO0b-9Q5cYgdP","msg":"User credentials created"}
{"level":30,"time":1764895085364,"env":"test","module":"auth-routes","userId":"F1oD439JhO0b-9Q5cYgdP","email":"viewer-BP-bNrA_TW8rnDIX8AmzH@example.com","msg":"User registered successfully"}
{"level":40,"time":1764895085455,"env":"test","module":"rbac-middleware","userId":"F1oD439JhO0b-9Q5cYgdP","userRole":"viewer","permission":"workflow:create","path":"/projects/9c018bd8-5f4f-495d-bba7-5c8660c88aaf/workflows","msg":"Permission denied"}
{"level":50,"time":1764895091780,"env":"test","error":{},"workflowId":"d9819632-aa13-4d12-ae6a-ae2d850f5572","userId":"RaKMQWuG1-kBonPFkV3X6","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764895092117,"env":"test","module":"auth-middleware","path":"/api/workflows/dd2928ec-a8de-44a6-ac52-eaa9bc21220a/move","msg":"No valid authentication found"}
{"level":30,"time":1764895092639,"env":"test","module":"user-credentials-repository","userId":"17OroobwbeE_G0_tDclX1","msg":"User credentials created"}
{"level":30,"time":1764895092640,"env":"test","module":"auth-routes","userId":"17OroobwbeE_G0_tDclX1","email":"test-workflows-ur7BpVRbLHKNHWRrmWrlL@example.com","msg":"User registered successfully"}
{"level":50,"time":1764895092692,"env":"test","error":{},"workflowId":"7499509a-fd9f-4e37-a09b-4c90e3a34315","userId":"17OroobwbeE_G0_tDclX1","projectId":"1acdd7d9-aa9d-4713-9375-0eb464c46a4d","msg":"Error moving workflow"}
{"level":50,"time":1764895093062,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7af0a260-081d-45cf-9744-406687c8ead9","userId":"RaKMQWuG1-kBonPFkV3X6","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764895093436,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a6647d94-99b5-42a1-ba79-d0f718d4422c","userId":"RaKMQWuG1-kBonPFkV3X6","msg":"Error moving workflow"}
{"level":30,"time":1764895093964,"env":"test","module":"user-credentials-repository","userId":"vK4du6UnhYiMySyhGxq_u","msg":"User credentials created"}
{"level":30,"time":1764895093964,"env":"test","module":"auth-routes","userId":"vK4du6UnhYiMySyhGxq_u","email":"test-workflows-FaQwQxApGaZHttyEFUEc3@example.com","msg":"User registered successfully"}
{"level":30,"time":1764895094151,"env":"test","module":"auth-routes","userId":"vK4du6UnhYiMySyhGxq_u","email":"test-workflows-FaQwQxApGaZHttyEFUEc3@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764895094346,"env":"test","error":{},"workflowId":"c40a3795-27cb-4244-95b1-2643cb55bde4","userId":"RaKMQWuG1-kBonPFkV3X6","projectId":"9ced26a5-c2f4-4f2a-86ce-fc023487ef1f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10495[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 328[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 659[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 373[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 912[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 18:37:52
[2m   Duration [22m 20.70s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
