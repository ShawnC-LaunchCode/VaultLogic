npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764867335337,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867337615,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867339526,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867339527,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867339537,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867339537,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867339537,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867339537,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867339961,"env":"test","module":"user-credentials-repository","userId":"n_AhWwakMfbp-KVz0Cq1Y","msg":"User credentials created"}
{"level":30,"time":1764867339964,"env":"test","module":"auth-routes","userId":"n_AhWwakMfbp-KVz0Cq1Y","email":"test-workflows-WtB_7ddzJD0sc12cnO2-B@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"793c6e72-5e5e-42de-95fb-9cdff60093af","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"n_AhWwakMfbp-KVz0Cq1Y","tenantId":"16e36e7c-0835-43de-81fb-8e21f96e59b1","createdBy":"n_AhWwakMfbp-KVz0Cq1Y","ownerId":"n_AhWwakMfbp-KVz0Cq1Y","status":"active","archived":false,"createdAt":"2025-12-04T16:55:41.456Z","updatedAt":"2025-12-04T16:55:41.456Z"}

{"level":30,"time":1764867340621,"env":"test","module":"user-credentials-repository","userId":"v-_MnQ6QsHeM285XBJX-J","msg":"User credentials created"}
{"level":30,"time":1764867340622,"env":"test","module":"auth-routes","userId":"v-_MnQ6QsHeM285XBJX-J","email":"viewer-Df4NuzammQgEpVb-icX_n@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867340721,"env":"test","module":"rbac-middleware","userId":"v-_MnQ6QsHeM285XBJX-J","userRole":"viewer","permission":"workflow:create","path":"/projects/793c6e72-5e5e-42de-95fb-9cdff60093af/workflows","msg":"Permission denied"}
{"level":50,"time":1764867347063,"env":"test","error":{},"workflowId":"acf07223-67c1-47bf-812d-72781be91a7e","userId":"n_AhWwakMfbp-KVz0Cq1Y","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867347416,"env":"test","module":"auth-middleware","path":"/api/workflows/65135e4e-1240-4311-842a-90bf016ce005/move","msg":"No valid authentication found"}
{"level":30,"time":1764867347951,"env":"test","module":"user-credentials-repository","userId":"QUM5xO4JwoHg7kOvjlCDL","msg":"User credentials created"}
{"level":30,"time":1764867347952,"env":"test","module":"auth-routes","userId":"QUM5xO4JwoHg7kOvjlCDL","email":"test-workflows-YCaHp-0LU5Jkspa1Z8F-4@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867348000,"env":"test","error":{},"workflowId":"855f8e93-ab65-4f19-a0b5-01ced33f0740","userId":"QUM5xO4JwoHg7kOvjlCDL","projectId":"5c900065-f606-4aef-b9aa-9077c8f086bb","msg":"Error moving workflow"}
{"level":50,"time":1764867348464,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"786c3a6c-d847-4936-9b0c-ae94a96b1499","userId":"n_AhWwakMfbp-KVz0Cq1Y","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867349306,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ca9e2f3a-a709-4551-bd32-231ba677e272","userId":"n_AhWwakMfbp-KVz0Cq1Y","msg":"Error moving workflow"}
{"level":30,"time":1764867350593,"env":"test","module":"user-credentials-repository","userId":"MM09cPm_Xr38hoSKIGDki","msg":"User credentials created"}
{"level":30,"time":1764867350595,"env":"test","module":"auth-routes","userId":"MM09cPm_Xr38hoSKIGDki","email":"test-workflows-WPOdtjHkWT6Dek16grhG0@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867351001,"env":"test","module":"auth-routes","userId":"MM09cPm_Xr38hoSKIGDki","email":"test-workflows-WPOdtjHkWT6Dek16grhG0@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867351496,"env":"test","error":{},"workflowId":"5b399ea0-9ba1-4b90-970d-0c8826c01014","userId":"n_AhWwakMfbp-KVz0Cq1Y","projectId":"cd5926cb-e97e-43f4-a04a-4efb70e7e228","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 12735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 298[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 613[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 839[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 2190[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:55:31
[2m   Duration [22m 20.40s[2m (transform 3.12s, setup 884ms, collect 6.08s, tests 12.74s, environment 0ms, prepare 15ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764867556285,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867558412,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867560698,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867560699,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867560711,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867560711,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867560712,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867560712,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867561152,"env":"test","module":"user-credentials-repository","userId":"iTiLInqGGfrXAqfIMo4xk","msg":"User credentials created"}
{"level":30,"time":1764867561155,"env":"test","module":"auth-routes","userId":"iTiLInqGGfrXAqfIMo4xk","email":"test-workflows-lbxA80i89IKeGBv-PdNb1@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f48f17f0-fb3b-4f32-a483-58c76765c2ab","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"iTiLInqGGfrXAqfIMo4xk","tenantId":"776b7510-5b57-461e-a5d2-fbf059e42ac6","createdBy":"iTiLInqGGfrXAqfIMo4xk","ownerId":"iTiLInqGGfrXAqfIMo4xk","status":"active","archived":false,"createdAt":"2025-12-04T16:59:22.662Z","updatedAt":"2025-12-04T16:59:22.662Z"}

{"level":30,"time":1764867561806,"env":"test","module":"user-credentials-repository","userId":"ISLTrWmnD1JCDCMbDsAbl","msg":"User credentials created"}
{"level":30,"time":1764867561807,"env":"test","module":"auth-routes","userId":"ISLTrWmnD1JCDCMbDsAbl","email":"viewer-XYiSPkR5fP5YBMsS4PC64@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867561898,"env":"test","module":"rbac-middleware","userId":"ISLTrWmnD1JCDCMbDsAbl","userRole":"viewer","permission":"workflow:create","path":"/projects/f48f17f0-fb3b-4f32-a483-58c76765c2ab/workflows","msg":"Permission denied"}
{"level":50,"time":1764867567807,"env":"test","error":{},"workflowId":"47e72e9e-6016-4156-a242-8071e6a71383","userId":"iTiLInqGGfrXAqfIMo4xk","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867568102,"env":"test","module":"auth-middleware","path":"/api/workflows/d62a112f-44e3-4f6f-a7e9-2ce4ea49adc4/move","msg":"No valid authentication found"}
{"level":30,"time":1764867568597,"env":"test","module":"user-credentials-repository","userId":"uGQx6UdQViumga6Fryg2B","msg":"User credentials created"}
{"level":30,"time":1764867568597,"env":"test","module":"auth-routes","userId":"uGQx6UdQViumga6Fryg2B","email":"test-workflows-f347j_tkOneKi8rrNuwgO@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867568647,"env":"test","error":{},"workflowId":"3f53f430-6ad9-4bb5-822d-f8a08344d13e","userId":"uGQx6UdQViumga6Fryg2B","projectId":"c0db19be-6d1d-4d82-ad33-1519b59f0b80","msg":"Error moving workflow"}
{"level":50,"time":1764867568997,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9fbd8015-4b5f-4acb-9057-08d232b675bb","userId":"iTiLInqGGfrXAqfIMo4xk","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867569345,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"de1e67b3-1cb9-4fbb-a86c-11e5e2fba4c2","userId":"iTiLInqGGfrXAqfIMo4xk","msg":"Error moving workflow"}
{"level":30,"time":1764867569851,"env":"test","module":"user-credentials-repository","userId":"cbeJWs0ieClHkQLeIlT1X","msg":"User credentials created"}
{"level":30,"time":1764867569851,"env":"test","module":"auth-routes","userId":"cbeJWs0ieClHkQLeIlT1X","email":"test-workflows-h48jGqF17ko7w8P0hpszZ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867570084,"env":"test","module":"auth-routes","userId":"cbeJWs0ieClHkQLeIlT1X","email":"test-workflows-h48jGqF17ko7w8P0hpszZ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867570264,"env":"test","error":{},"workflowId":"c67bcfa3-5adc-4ec7-8c08-d914f467248a","userId":"iTiLInqGGfrXAqfIMo4xk","projectId":"314d4857-53af-4b9f-9e6e-d4ee035156cf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 307[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 289[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 565[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 578[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 446[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 546[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 348[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 920[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:59:13
[2m   Duration [22m 16.76s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764867689302,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867691012,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867692749,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867692750,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867692757,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867692757,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867692757,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867692757,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867693206,"env":"test","module":"user-credentials-repository","userId":"__yJkzj4roX023YEvXyba","msg":"User credentials created"}
{"level":30,"time":1764867693208,"env":"test","module":"auth-routes","userId":"__yJkzj4roX023YEvXyba","email":"test-workflows-gqCHDX5dhYiUf4c-WFSmx@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3d6b8f74-e48c-4c67-905a-57dd7eca1c6c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"__yJkzj4roX023YEvXyba","tenantId":"fcbd0d97-42e2-450a-a393-bad963b26e24","createdBy":"__yJkzj4roX023YEvXyba","ownerId":"__yJkzj4roX023YEvXyba","status":"active","archived":false,"createdAt":"2025-12-04T17:01:34.711Z","updatedAt":"2025-12-04T17:01:34.711Z"}

{"level":30,"time":1764867693857,"env":"test","module":"user-credentials-repository","userId":"3jJKdvAlgHW8t4lSOCQlz","msg":"User credentials created"}
{"level":30,"time":1764867693857,"env":"test","module":"auth-routes","userId":"3jJKdvAlgHW8t4lSOCQlz","email":"viewer-n_CaeqzVjISuSqScccRS7@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867693947,"env":"test","module":"rbac-middleware","userId":"3jJKdvAlgHW8t4lSOCQlz","userRole":"viewer","permission":"workflow:create","path":"/projects/3d6b8f74-e48c-4c67-905a-57dd7eca1c6c/workflows","msg":"Permission denied"}
{"level":50,"time":1764867700015,"env":"test","error":{},"workflowId":"796a3733-a5c8-4758-b324-ba0cdfac2111","userId":"__yJkzj4roX023YEvXyba","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867700313,"env":"test","module":"auth-middleware","path":"/api/workflows/3bd66a17-0cbb-46ad-9f62-c520f9dd6b27/move","msg":"No valid authentication found"}
{"level":30,"time":1764867700856,"env":"test","module":"user-credentials-repository","userId":"c98tnl2B0WVEWGXKAuhvq","msg":"User credentials created"}
{"level":30,"time":1764867700857,"env":"test","module":"auth-routes","userId":"c98tnl2B0WVEWGXKAuhvq","email":"test-workflows-9y5FWDPZi9MXG3eKfH7yv@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867700913,"env":"test","error":{},"workflowId":"1d9a5536-4c90-432a-b18b-36c89f6deaf6","userId":"c98tnl2B0WVEWGXKAuhvq","projectId":"f8d0a6df-fd0a-441e-8889-c5dbf0420bf7","msg":"Error moving workflow"}
{"level":50,"time":1764867701282,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9bf1daa2-d38b-4d79-998c-fc658206a38c","userId":"__yJkzj4roX023YEvXyba","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867701625,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1e8ca94e-69ed-4347-8fe7-b97099cfae27","userId":"__yJkzj4roX023YEvXyba","msg":"Error moving workflow"}
{"level":50,"time":1764867702124,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rLqtL2ahz_cKEoUVtnGgx) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"rLqtL2ahz_cKEoUVtnGgx","msg":"Failed to create user credentials"}
{"level":50,"time":1764867702124,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rLqtL2ahz_cKEoUVtnGgx) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 280[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 606[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 705[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 448[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 297[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 343[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 500[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:01:26
[2m   Duration [22m 15.91s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764868031607,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868033407,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868035482,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868035482,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868035493,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868035493,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868035494,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868035494,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868036998,"env":"test","module":"user-credentials-repository","userId":"HXXqgbtHrvCim1zxI9297","msg":"User credentials created"}
{"level":30,"time":1764868037003,"env":"test","module":"auth-routes","userId":"HXXqgbtHrvCim1zxI9297","email":"test-workflows-HmbKd0XiQimXlvgxr_PTh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e795daa9-8409-4b4a-ac2f-8f95d9bcb45c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"HXXqgbtHrvCim1zxI9297","tenantId":"1d7c8fa4-769a-433c-b8be-7e1ab31ee482","createdBy":"HXXqgbtHrvCim1zxI9297","ownerId":"HXXqgbtHrvCim1zxI9297","status":"active","archived":false,"createdAt":"2025-12-04T17:07:18.521Z","updatedAt":"2025-12-04T17:07:18.521Z"}

{"level":30,"time":1764868037656,"env":"test","module":"user-credentials-repository","userId":"FsBOBNzo8LX7tv62ToEpn","msg":"User credentials created"}
{"level":30,"time":1764868037657,"env":"test","module":"auth-routes","userId":"FsBOBNzo8LX7tv62ToEpn","email":"viewer-M0UzMZu9qsJ7S7HMFwCZ9@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868037748,"env":"test","module":"rbac-middleware","userId":"FsBOBNzo8LX7tv62ToEpn","userRole":"viewer","permission":"workflow:create","path":"/projects/e795daa9-8409-4b4a-ac2f-8f95d9bcb45c/workflows","msg":"Permission denied"}
{"level":50,"time":1764868043970,"env":"test","error":{},"workflowId":"85be08fd-0645-4e33-87d2-4bf1ea87b3ac","userId":"HXXqgbtHrvCim1zxI9297","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868044304,"env":"test","module":"auth-middleware","path":"/api/workflows/27214331-8641-4f30-ae80-fed53406643b/move","msg":"No valid authentication found"}
{"level":30,"time":1764868044801,"env":"test","module":"user-credentials-repository","userId":"7baCjN4fg76jWPKOht1Ra","msg":"User credentials created"}
{"level":30,"time":1764868044802,"env":"test","module":"auth-routes","userId":"7baCjN4fg76jWPKOht1Ra","email":"test-workflows-4VU0ZcQDhH-rxxaa3ny5Z@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868044852,"env":"test","error":{},"workflowId":"688a2c9d-47d9-402d-85c9-1172ce9bc7c1","userId":"7baCjN4fg76jWPKOht1Ra","projectId":"6b553486-d9ec-4a29-b9c9-0900385ad6d6","msg":"Error moving workflow"}
{"level":50,"time":1764868045222,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7721c327-c21c-4165-b2ce-eea6bb21bcde","userId":"HXXqgbtHrvCim1zxI9297","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868045595,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e0eacc40-b7b2-41ac-be0f-1bd14929ab0b","userId":"HXXqgbtHrvCim1zxI9297","msg":"Error moving workflow"}
{"level":30,"time":1764868046119,"env":"test","module":"user-credentials-repository","userId":"dNZjjty9VrCz2hd35d7IG","msg":"User credentials created"}
{"level":30,"time":1764868046120,"env":"test","module":"auth-routes","userId":"dNZjjty9VrCz2hd35d7IG","email":"test-workflows-AzjzGBv-SlhAzdFkNhiL4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868046328,"env":"test","module":"auth-routes","userId":"dNZjjty9VrCz2hd35d7IG","email":"test-workflows-AzjzGBv-SlhAzdFkNhiL4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868046510,"env":"test","error":{},"workflowId":"f2cb878d-d5c4-437b-8ad8-6f2773a2db20","userId":"HXXqgbtHrvCim1zxI9297","projectId":"02446088-c604-440d-8c50-aefd18b2ca2f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 274[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 603[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 373[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 917[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:07:08
[2m   Duration [22m 17.69s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764868270640,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868272374,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868274194,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868274195,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868274206,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868274206,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868274206,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868274206,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868274660,"env":"test","module":"user-credentials-repository","userId":"SesN3IwvAkozAM6VH0yKv","msg":"User credentials created"}
{"level":30,"time":1764868274663,"env":"test","module":"auth-routes","userId":"SesN3IwvAkozAM6VH0yKv","email":"test-workflows-H47U3-CsPBZDNdc7LmXVT@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7b394b4f-afbf-4c96-9364-68bdb7493a20","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"SesN3IwvAkozAM6VH0yKv","tenantId":"20cf9008-738d-4ad9-bbcb-141dba657891","createdBy":"SesN3IwvAkozAM6VH0yKv","ownerId":"SesN3IwvAkozAM6VH0yKv","status":"active","archived":false,"createdAt":"2025-12-04T17:11:16.168Z","updatedAt":"2025-12-04T17:11:16.168Z"}

{"level":30,"time":1764868275329,"env":"test","module":"user-credentials-repository","userId":"Wshr5S4brBDP2sNmPCz91","msg":"User credentials created"}
{"level":30,"time":1764868275331,"env":"test","module":"auth-routes","userId":"Wshr5S4brBDP2sNmPCz91","email":"viewer-BTKHO65mm4VOjiNwfYZyc@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868275427,"env":"test","module":"rbac-middleware","userId":"Wshr5S4brBDP2sNmPCz91","userRole":"viewer","permission":"workflow:create","path":"/projects/7b394b4f-afbf-4c96-9364-68bdb7493a20/workflows","msg":"Permission denied"}
{"level":50,"time":1764868281786,"env":"test","error":{},"workflowId":"a8abc182-2342-42f5-860d-3a9893e7a25e","userId":"SesN3IwvAkozAM6VH0yKv","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868282119,"env":"test","module":"auth-middleware","path":"/api/workflows/7fd02a52-a879-4423-bf1a-8c6e4af23c9d/move","msg":"No valid authentication found"}
{"level":30,"time":1764868282644,"env":"test","module":"user-credentials-repository","userId":"loipOzSaTAzK4rj3rcq1E","msg":"User credentials created"}
{"level":30,"time":1764868282644,"env":"test","module":"auth-routes","userId":"loipOzSaTAzK4rj3rcq1E","email":"test-workflows-JzQxnuGB8l4oWNBZrdrXC@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868282695,"env":"test","error":{},"workflowId":"03750cb7-043e-4f80-ba9e-5efedacd913d","userId":"loipOzSaTAzK4rj3rcq1E","projectId":"4123b93d-2e8d-4020-a4cd-ff92a3c973e1","msg":"Error moving workflow"}
{"level":50,"time":1764868283065,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b049a974-d67b-4717-bb11-044a8573e678","userId":"SesN3IwvAkozAM6VH0yKv","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868283442,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b77a068d-c44d-40eb-a4a1-a6d9734282c3","userId":"SesN3IwvAkozAM6VH0yKv","msg":"Error moving workflow"}
{"level":50,"time":1764868283969,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(tAA3Q40BHsxFFZqA_Mtk5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"tAA3Q40BHsxFFZqA_Mtk5","msg":"Failed to create user credentials"}
{"level":50,"time":1764868283969,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(tAA3Q40BHsxFFZqA_Mtk5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10164[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 290[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 827[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 613[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 529[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:11:07
[2m   Duration [22m 16.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764868528894,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531043,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533336,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533336,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533354,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533354,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533355,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533355,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868533814,"env":"test","module":"user-credentials-repository","userId":"G8hJILui9Jhp7kK9CMsaK","msg":"User credentials created"}
{"level":30,"time":1764868533816,"env":"test","module":"auth-routes","userId":"G8hJILui9Jhp7kK9CMsaK","email":"test-workflows-8kq2iyCstk0MGPczLBLwK@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9090abbf-debc-4309-b224-f63056b0d63a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"G8hJILui9Jhp7kK9CMsaK","tenantId":"d1c0e36a-c45b-4235-b96d-c72a560d3c75","createdBy":"G8hJILui9Jhp7kK9CMsaK","ownerId":"G8hJILui9Jhp7kK9CMsaK","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.336Z","updatedAt":"2025-12-04T17:15:35.336Z"}

{"level":30,"time":1764868534500,"env":"test","module":"user-credentials-repository","userId":"aVTYicKhTy9fGBUrxfrG4","msg":"User credentials created"}
{"level":30,"time":1764868534501,"env":"test","module":"auth-routes","userId":"aVTYicKhTy9fGBUrxfrG4","email":"viewer-sNwAGo-510dHtOe0D0bIJ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534591,"env":"test","module":"rbac-middleware","userId":"aVTYicKhTy9fGBUrxfrG4","userRole":"viewer","permission":"workflow:create","path":"/projects/9090abbf-debc-4309-b224-f63056b0d63a/workflows","msg":"Permission denied"}
{"level":50,"time":1764868540848,"env":"test","error":{},"workflowId":"4dd23760-17a8-4520-ac42-0747ba64770c","userId":"G8hJILui9Jhp7kK9CMsaK","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541162,"env":"test","module":"auth-middleware","path":"/api/workflows/2bc537db-f930-454f-b2f6-4188b3987d72/move","msg":"No valid authentication found"}
{"level":30,"time":1764868541668,"env":"test","module":"user-credentials-repository","userId":"8-kdqVN-Gq_nQHXfW4oLm","msg":"User credentials created"}
{"level":30,"time":1764868541668,"env":"test","module":"auth-routes","userId":"8-kdqVN-Gq_nQHXfW4oLm","email":"test-workflows-9nSXEJWr2EPGpKPcDfox1@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868541712,"env":"test","error":{},"workflowId":"fb0000bc-384a-44d6-825b-356804c39192","userId":"8-kdqVN-Gq_nQHXfW4oLm","projectId":"27d83555-5ed4-40ce-a5c5-b69a25a5f552","msg":"Error moving workflow"}
{"level":50,"time":1764868542083,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3746b720-af9e-4db7-bfe2-911e8a6818e9","userId":"G8hJILui9Jhp7kK9CMsaK","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868542550,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e18d5176-fff2-4043-a836-850521c57284","userId":"G8hJILui9Jhp7kK9CMsaK","msg":"Error moving workflow"}
{"level":30,"time":1764868543279,"env":"test","module":"user-credentials-repository","userId":"Vu5GO0hXAWNC4Mc9oZeln","msg":"User credentials created"}
{"level":30,"time":1764868543280,"env":"test","module":"auth-routes","userId":"Vu5GO0hXAWNC4Mc9oZeln","email":"test-workflows-L3TTwPQGBkWYsid3ZukFI@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868543487,"env":"test","module":"auth-routes","userId":"Vu5GO0hXAWNC4Mc9oZeln","email":"test-workflows-L3TTwPQGBkWYsid3ZukFI@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868543685,"env":"test","error":{},"workflowId":"66ba193a-781d-4b5f-aece-601426a717e0","userId":"G8hJILui9Jhp7kK9CMsaK","projectId":"165c9c34-542b-40e7-b8fd-0c6e6a9f64c6","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 550[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 467[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1137[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 17.91s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764868816231,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818422,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820549,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820550,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820591,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820591,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820592,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820592,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821064,"env":"test","module":"user-credentials-repository","userId":"BK_BYPqXIDyTgbjkilWlk","msg":"User credentials created"}
{"level":30,"time":1764868821067,"env":"test","module":"auth-routes","userId":"BK_BYPqXIDyTgbjkilWlk","email":"test-workflows-M8NiEXD9DYC6t-eh3-Hzt@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"67c6eb7e-5408-4b05-a3c4-a03b4b4f0214","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"BK_BYPqXIDyTgbjkilWlk","tenantId":"95c8a6d5-0ef6-4880-986a-bdb1ffcfee58","createdBy":"BK_BYPqXIDyTgbjkilWlk","ownerId":"BK_BYPqXIDyTgbjkilWlk","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.598Z","updatedAt":"2025-12-04T17:20:22.598Z"}

{"level":30,"time":1764868821781,"env":"test","module":"user-credentials-repository","userId":"ZRqX7i7500lrOTuRTrKBQ","msg":"User credentials created"}
{"level":30,"time":1764868821782,"env":"test","module":"auth-routes","userId":"ZRqX7i7500lrOTuRTrKBQ","email":"viewer-iiuS7Oguh_1idAKsie8GA@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821882,"env":"test","module":"rbac-middleware","userId":"ZRqX7i7500lrOTuRTrKBQ","userRole":"viewer","permission":"workflow:create","path":"/projects/67c6eb7e-5408-4b05-a3c4-a03b4b4f0214/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828301,"env":"test","error":{},"workflowId":"78796961-4d6a-4330-862f-e0823f0e90e5","userId":"BK_BYPqXIDyTgbjkilWlk","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828633,"env":"test","module":"auth-middleware","path":"/api/workflows/ff65731f-afed-43bf-b622-34892c1df313/move","msg":"No valid authentication found"}
{"level":30,"time":1764868829178,"env":"test","module":"user-credentials-repository","userId":"U7zKEol77EhjG8Z5kksyk","msg":"User credentials created"}
{"level":30,"time":1764868829179,"env":"test","module":"auth-routes","userId":"U7zKEol77EhjG8Z5kksyk","email":"test-workflows-3yn_0CyeVZgOsJsHDjZhA@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868829227,"env":"test","error":{},"workflowId":"afde417f-15d6-40c6-bcdf-98e410a6be30","userId":"U7zKEol77EhjG8Z5kksyk","projectId":"b954a6af-2b5b-41f0-965c-1c606cb68adc","msg":"Error moving workflow"}
{"level":50,"time":1764868829603,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"1397538a-28c4-49f1-b65c-ce324566c752","userId":"BK_BYPqXIDyTgbjkilWlk","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868830043,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a58aeab4-1f47-4c5a-acfd-959502d730c9","userId":"BK_BYPqXIDyTgbjkilWlk","msg":"Error moving workflow"}
{"level":30,"time":1764868830643,"env":"test","module":"user-credentials-repository","userId":"1FGGsjCw8SjFULk0WazKO","msg":"User credentials created"}
{"level":30,"time":1764868830644,"env":"test","module":"auth-routes","userId":"1FGGsjCw8SjFULk0WazKO","email":"test-workflows-cSN4sUAgeFr3z_y0adTRk@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830845,"env":"test","module":"auth-routes","userId":"1FGGsjCw8SjFULk0WazKO","email":"test-workflows-cSN4sUAgeFr3z_y0adTRk@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868831093,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4636e286-9204-422d-b090-e13e14b2df61","userId":"BK_BYPqXIDyTgbjkilWlk","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 818[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 652[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 648[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 440[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1051[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.62s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764871635126,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871638602,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871642592,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871642593,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871642603,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871642603,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871642604,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871642604,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871643064,"env":"test","module":"user-credentials-repository","userId":"NT2CXSSKZbjZ218LEgxs5","msg":"User credentials created"}
{"level":30,"time":1764871643069,"env":"test","module":"auth-routes","userId":"NT2CXSSKZbjZ218LEgxs5","email":"test-workflows-WawSO3bZHlyAjqlGRAxu0@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a11c8a66-e3f8-4af0-912c-b314cb122fa7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"NT2CXSSKZbjZ218LEgxs5","tenantId":"b1f0dd63-5c61-4c83-8dd9-8a086c72f5c0","createdBy":"NT2CXSSKZbjZ218LEgxs5","ownerId":"NT2CXSSKZbjZ218LEgxs5","status":"active","archived":false,"createdAt":"2025-12-04T18:07:24.662Z","updatedAt":"2025-12-04T18:07:24.662Z"}

{"level":30,"time":1764871643776,"env":"test","module":"user-credentials-repository","userId":"sQL5EQ55XZJocU4ON1hXU","msg":"User credentials created"}
{"level":30,"time":1764871643777,"env":"test","module":"auth-routes","userId":"sQL5EQ55XZJocU4ON1hXU","email":"viewer-rfhVf1oWHaDEraSjwxEFt@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871643870,"env":"test","module":"rbac-middleware","userId":"sQL5EQ55XZJocU4ON1hXU","userRole":"viewer","permission":"workflow:create","path":"/projects/a11c8a66-e3f8-4af0-912c-b314cb122fa7/workflows","msg":"Permission denied"}
{"level":50,"time":1764871650422,"env":"test","error":{},"workflowId":"069bf813-8387-439e-8ef0-7f30906cf46c","userId":"NT2CXSSKZbjZ218LEgxs5","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871650769,"env":"test","module":"auth-middleware","path":"/api/workflows/7baef924-3595-457a-9633-d62c26eef4f9/move","msg":"No valid authentication found"}
{"level":30,"time":1764871651314,"env":"test","module":"user-credentials-repository","userId":"Q10BvxO7HS7Skej0I662d","msg":"User credentials created"}
{"level":30,"time":1764871651315,"env":"test","module":"auth-routes","userId":"Q10BvxO7HS7Skej0I662d","email":"test-workflows-7oImORxK4A_0faakOkReg@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871651405,"env":"test","error":{},"workflowId":"1d4e643e-7bd0-41f8-a609-c6f56a3305f2","userId":"Q10BvxO7HS7Skej0I662d","projectId":"22ac327e-bf61-4615-8452-997704697881","msg":"Error moving workflow"}
{"level":50,"time":1764871651608,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(NT2CXSSKZbjZ218LEgxs5) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"NT2CXSSKZbjZ218LEgxs5","msg":"Error creating workflow"}
{"level":50,"time":1764871651792,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(NT2CXSSKZbjZ218LEgxs5) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"NT2CXSSKZbjZ218LEgxs5","msg":"Error creating workflow"}
{"level":50,"time":1764871651978,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(NT2CXSSKZbjZ218LEgxs5) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"NT2CXSSKZbjZ218LEgxs5","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 9682[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 343[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 667[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 825[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 649[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 778[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 342[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 639[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 201[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 184[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 188[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 22.38s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764871701765,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871705811,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871709639,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871709640,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871709656,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871709656,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871709656,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871709656,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710133,"env":"test","module":"user-credentials-repository","userId":"uRr42LvamXtshkmwFPhFB","msg":"User credentials created"}
{"level":30,"time":1764871710136,"env":"test","module":"auth-routes","userId":"uRr42LvamXtshkmwFPhFB","email":"test-workflows-H9Kl3LRrpQVDGvwRGyzvz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7a9bac8f-499f-4e8d-a7db-f259c7bb89a1","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"uRr42LvamXtshkmwFPhFB","tenantId":"9cc8209a-d50c-4048-8478-8166118c84d1","createdBy":"uRr42LvamXtshkmwFPhFB","ownerId":"uRr42LvamXtshkmwFPhFB","status":"active","archived":false,"createdAt":"2025-12-04T18:08:31.714Z","updatedAt":"2025-12-04T18:08:31.714Z"}

{"level":30,"time":1764871710809,"env":"test","module":"user-credentials-repository","userId":"U7jbzm9iRt_iawmQb_F8Z","msg":"User credentials created"}
{"level":30,"time":1764871710810,"env":"test","module":"auth-routes","userId":"U7jbzm9iRt_iawmQb_F8Z","email":"viewer-T38gOY45Hl2dbUcCiZtYv@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871710898,"env":"test","module":"rbac-middleware","userId":"U7jbzm9iRt_iawmQb_F8Z","userRole":"viewer","permission":"workflow:create","path":"/projects/7a9bac8f-499f-4e8d-a7db-f259c7bb89a1/workflows","msg":"Permission denied"}
{"level":50,"time":1764871716725,"env":"test","error":{},"workflowId":"ce79711b-a986-4b77-a156-a3e25b053031","userId":"uRr42LvamXtshkmwFPhFB","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871717033,"env":"test","module":"auth-middleware","path":"/api/workflows/87115c55-e95d-4080-8b53-c7bb1d429c06/move","msg":"No valid authentication found"}
{"level":30,"time":1764871717595,"env":"test","module":"user-credentials-repository","userId":"Y7HIDuwqLV5dFsgOXyXhn","msg":"User credentials created"}
{"level":30,"time":1764871717595,"env":"test","module":"auth-routes","userId":"Y7HIDuwqLV5dFsgOXyXhn","email":"test-workflows-79jHiJjKF4uZb0PerHT6q@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871717643,"env":"test","error":{},"workflowId":"cfbd80ac-565d-49ea-a5fd-3b1eb46c107a","userId":"Y7HIDuwqLV5dFsgOXyXhn","projectId":"d758e410-1887-49e7-87a6-38c4a33dd2a9","msg":"Error moving workflow"}
{"level":50,"time":1764871718042,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"58ffccae-f089-4b8a-a34d-2aa48c171ccd","userId":"uRr42LvamXtshkmwFPhFB","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871718393,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e63f472a-d54c-41c9-9330-31c67d229dc0","userId":"uRr42LvamXtshkmwFPhFB","msg":"Error moving workflow"}
{"level":30,"time":1764871718885,"env":"test","module":"user-credentials-repository","userId":"_3mJFgllxPDGNAKTu9uR5","msg":"User credentials created"}
{"level":30,"time":1764871718886,"env":"test","module":"auth-routes","userId":"_3mJFgllxPDGNAKTu9uR5","email":"test-workflows-X143_lAajx3cyoxniRqQf@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871719086,"env":"test","module":"auth-routes","userId":"_3mJFgllxPDGNAKTu9uR5","email":"test-workflows-X143_lAajx3cyoxniRqQf@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871719269,"env":"test","error":{},"workflowId":"5ce3b75f-67b0-477c-bc7c-36b4d22886f5","userId":"uRr42LvamXtshkmwFPhFB","projectId":"78678091-2960-4420-b380-1063d66adfac","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9902[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 290[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 654[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 397[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 349[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 877[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 20.90s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764871752689,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871756426,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871759623,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871759623,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871759634,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871759634,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871759635,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871759635,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871760121,"env":"test","module":"user-credentials-repository","userId":"tXvafZ4frvbSM6DMuLM90","msg":"User credentials created"}
{"level":30,"time":1764871760124,"env":"test","module":"auth-routes","userId":"tXvafZ4frvbSM6DMuLM90","email":"test-workflows-7vq4X8AFv7prthxI8Qstg@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e50031fd-6104-475c-a0f6-76b2459bc8b2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"tXvafZ4frvbSM6DMuLM90","tenantId":"b628826e-405e-4f3a-b4d2-8fad0b9f5585","createdBy":"tXvafZ4frvbSM6DMuLM90","ownerId":"tXvafZ4frvbSM6DMuLM90","status":"active","archived":false,"createdAt":"2025-12-04T18:09:21.707Z","updatedAt":"2025-12-04T18:09:21.707Z"}

{"level":30,"time":1764871760795,"env":"test","module":"user-credentials-repository","userId":"mlNDKF4oPT-xqwNY3B3My","msg":"User credentials created"}
{"level":30,"time":1764871760796,"env":"test","module":"auth-routes","userId":"mlNDKF4oPT-xqwNY3B3My","email":"viewer-hSetqoOIaLPh4tgYqX1fL@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871760890,"env":"test","module":"rbac-middleware","userId":"mlNDKF4oPT-xqwNY3B3My","userRole":"viewer","permission":"workflow:create","path":"/projects/e50031fd-6104-475c-a0f6-76b2459bc8b2/workflows","msg":"Permission denied"}
{"level":50,"time":1764871766932,"env":"test","error":{},"workflowId":"46528d33-7a79-4047-93c7-1951f19b3468","userId":"tXvafZ4frvbSM6DMuLM90","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871767238,"env":"test","module":"auth-middleware","path":"/api/workflows/7f8b678a-2c82-4f5f-9c00-2f244f99701e/move","msg":"No valid authentication found"}
{"level":30,"time":1764871767727,"env":"test","module":"user-credentials-repository","userId":"X8MPInbrXilyutYYjc5eb","msg":"User credentials created"}
{"level":30,"time":1764871767728,"env":"test","module":"auth-routes","userId":"X8MPInbrXilyutYYjc5eb","email":"test-workflows-taiBITdCyELXMP11Otucy@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871767777,"env":"test","error":{},"workflowId":"39453289-558e-4db8-a128-1a8bdd9cae87","userId":"X8MPInbrXilyutYYjc5eb","projectId":"a702b6a0-4607-48c6-beaa-f98776aeb9e8","msg":"Error moving workflow"}
{"level":50,"time":1764871768126,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"e2a05da7-e9ba-4892-a51d-331bff8aca55","userId":"tXvafZ4frvbSM6DMuLM90","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871768482,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"96328bb1-70f9-4d13-bbc0-32061b247d50","userId":"tXvafZ4frvbSM6DMuLM90","msg":"Error moving workflow"}
{"level":30,"time":1764871768993,"env":"test","module":"user-credentials-repository","userId":"gvQxiLAiJLMFXIO5tfaUj","msg":"User credentials created"}
{"level":30,"time":1764871768994,"env":"test","module":"auth-routes","userId":"gvQxiLAiJLMFXIO5tfaUj","email":"test-workflows-EvCg6GWQwe8J0PHXu3oNR@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871769192,"env":"test","module":"auth-routes","userId":"gvQxiLAiJLMFXIO5tfaUj","email":"test-workflows-EvCg6GWQwe8J0PHXu3oNR@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871769384,"env":"test","error":{},"workflowId":"b0ca9f09-5bfc-431d-838b-628abc2da234","userId":"tXvafZ4frvbSM6DMuLM90","projectId":"efe67f88-6c92-48a3-bed5-ce52074d1eba","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9992[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 445[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 903[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 20.21s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764873689413,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873693067,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873696989,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873696989,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873697001,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873697001,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873697001,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873697001,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873697542,"env":"test","module":"user-credentials-repository","userId":"vatJqxpkcoDOIlD78U5h9","msg":"User credentials created"}
{"level":30,"time":1764873697547,"env":"test","module":"auth-routes","userId":"vatJqxpkcoDOIlD78U5h9","email":"test-workflows-t3waSFsUmLaKpxwFBI8ez@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b457be00-b4ec-4ecf-892e-2b8bbeee06a9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"vatJqxpkcoDOIlD78U5h9","tenantId":"200c5dcc-1c84-4c91-a746-451fd33d7fbc","createdBy":"vatJqxpkcoDOIlD78U5h9","ownerId":"vatJqxpkcoDOIlD78U5h9","status":"active","archived":false,"createdAt":"2025-12-04T18:41:39.164Z","updatedAt":"2025-12-04T18:41:39.164Z"}

{"level":30,"time":1764873698268,"env":"test","module":"user-credentials-repository","userId":"iz9u0yH7FqzICXJeVvotw","msg":"User credentials created"}
{"level":30,"time":1764873698268,"env":"test","module":"auth-routes","userId":"iz9u0yH7FqzICXJeVvotw","email":"viewer-AZ3FJHId-Y78YNMqsL1MA@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873698365,"env":"test","module":"rbac-middleware","userId":"iz9u0yH7FqzICXJeVvotw","userRole":"viewer","permission":"workflow:create","path":"/projects/b457be00-b4ec-4ecf-892e-2b8bbeee06a9/workflows","msg":"Permission denied"}
{"level":50,"time":1764873704569,"env":"test","error":{},"workflowId":"628fe9a4-a468-48d5-b82f-121cb1b4b4d5","userId":"vatJqxpkcoDOIlD78U5h9","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873704888,"env":"test","module":"auth-middleware","path":"/api/workflows/206bd2b2-a5e0-44bc-af65-3134e797e5dd/move","msg":"No valid authentication found"}
{"level":30,"time":1764873705406,"env":"test","module":"user-credentials-repository","userId":"f1Fs9khshWii91uIR74ds","msg":"User credentials created"}
{"level":30,"time":1764873705407,"env":"test","module":"auth-routes","userId":"f1Fs9khshWii91uIR74ds","email":"test-workflows-orrEAE8czlZJjaD0SjDVu@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873705455,"env":"test","error":{},"workflowId":"d21909c2-59ba-4074-8790-4430d93d1240","userId":"f1Fs9khshWii91uIR74ds","projectId":"e8e6f7b0-48ac-4889-8559-cf8c07421258","msg":"Error moving workflow"}
{"level":50,"time":1764873705846,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6d73c2f1-22d9-4717-ab97-01a7230d296c","userId":"vatJqxpkcoDOIlD78U5h9","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873706241,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"71adc014-25a5-497a-8162-71263a44f37d","userId":"vatJqxpkcoDOIlD78U5h9","msg":"Error moving workflow"}
{"level":30,"time":1764873707030,"env":"test","module":"user-credentials-repository","userId":"QfG6XpAAotQi6w17kyhbH","msg":"User credentials created"}
{"level":30,"time":1764873707031,"env":"test","module":"auth-routes","userId":"QfG6XpAAotQi6w17kyhbH","email":"test-workflows--6J6tgvorSpdIqK8lK8eu@example.com","msg":"User registered successfully"}
{"level":30,"time":1764873707232,"env":"test","module":"auth-routes","userId":"QfG6XpAAotQi6w17kyhbH","email":"test-workflows--6J6tgvorSpdIqK8lK8eu@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764873707424,"env":"test","error":{},"workflowId":"4a092c0e-e90c-4cad-a0f4-ea8f0aaa3c77","userId":"vatJqxpkcoDOIlD78U5h9","projectId":"168943d0-4e7c-4388-923a-84b212c18925","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 441[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 516[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 394[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1188[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 21.69s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764874579523,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874585591,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874592166,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874592167,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874592200,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874592200,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874592200,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874592200,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874592802,"env":"test","module":"user-credentials-repository","userId":"5IEVLVJNZzeh2ZNJW0hvt","msg":"User credentials created"}
{"level":30,"time":1764874592806,"env":"test","module":"auth-routes","userId":"5IEVLVJNZzeh2ZNJW0hvt","email":"test-workflows-_3PwWDfV96Hsv8pJ8jj4m@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b2080bdd-4af9-4846-98f9-dce597b1cd05","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"5IEVLVJNZzeh2ZNJW0hvt","tenantId":"0b0aaaf4-2a00-4ad3-8d9e-a143a695c12e","createdBy":"5IEVLVJNZzeh2ZNJW0hvt","ownerId":"5IEVLVJNZzeh2ZNJW0hvt","status":"active","archived":false,"createdAt":"2025-12-04T18:56:34.438Z","updatedAt":"2025-12-04T18:56:34.438Z"}

{"level":30,"time":1764874593528,"env":"test","module":"user-credentials-repository","userId":"4woYfeMr9vL9dxQE5p605","msg":"User credentials created"}
{"level":30,"time":1764874593529,"env":"test","module":"auth-routes","userId":"4woYfeMr9vL9dxQE5p605","email":"viewer-HgxrEUhaXbncWR2CsHwd-@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874593630,"env":"test","module":"rbac-middleware","userId":"4woYfeMr9vL9dxQE5p605","userRole":"viewer","permission":"workflow:create","path":"/projects/b2080bdd-4af9-4846-98f9-dce597b1cd05/workflows","msg":"Permission denied"}
{"level":50,"time":1764874599966,"env":"test","error":{},"workflowId":"db238853-faac-4596-9ee0-072b2163bd3a","userId":"5IEVLVJNZzeh2ZNJW0hvt","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874600303,"env":"test","module":"auth-middleware","path":"/api/workflows/171460b0-0090-440a-8dfc-88dde424410a/move","msg":"No valid authentication found"}
{"level":30,"time":1764874600808,"env":"test","module":"user-credentials-repository","userId":"IQ1EOaMVSbz46LH6iyReK","msg":"User credentials created"}
{"level":30,"time":1764874600809,"env":"test","module":"auth-routes","userId":"IQ1EOaMVSbz46LH6iyReK","email":"test-workflows-rKkaA_NZU98hvLN4YO-R0@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874600858,"env":"test","error":{},"workflowId":"1e6f8e65-1bdd-43a2-8f25-72933c9bc756","userId":"IQ1EOaMVSbz46LH6iyReK","projectId":"be726285-f7e5-4072-b87f-97feeea0c750","msg":"Error moving workflow"}
{"level":50,"time":1764874601309,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"24522d88-db82-42d1-b3a8-2af90172fac2","userId":"5IEVLVJNZzeh2ZNJW0hvt","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874601687,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"313cb498-8c02-41f5-92e6-85a000167811","userId":"5IEVLVJNZzeh2ZNJW0hvt","msg":"Error moving workflow"}
{"level":50,"time":1764874602213,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(HoZd19n6SZxQu6FdIci38) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"HoZd19n6SZxQu6FdIci38","msg":"Failed to create user credentials"}
{"level":50,"time":1764874602214,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(HoZd19n6SZxQu6FdIci38) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 785[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 527[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.51s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764874686518,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874691452,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874696590,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874696591,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874696602,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874696602,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874696603,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874696603,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874697375,"env":"test","module":"user-credentials-repository","userId":"LOOenuj-JkNSEKSmsjq4R","msg":"User credentials created"}
{"level":30,"time":1764874697378,"env":"test","module":"auth-routes","userId":"LOOenuj-JkNSEKSmsjq4R","email":"test-workflows-64qra3SqJjOIXDAsMMXKr@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c588c448-31c2-4cc3-84c2-375203afa0a5","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"LOOenuj-JkNSEKSmsjq4R","tenantId":"4fe1f374-56e3-4103-a7b6-87565b2fcc64","createdBy":"LOOenuj-JkNSEKSmsjq4R","ownerId":"LOOenuj-JkNSEKSmsjq4R","status":"active","archived":false,"createdAt":"2025-12-04T18:58:19.012Z","updatedAt":"2025-12-04T18:58:19.012Z"}

{"level":30,"time":1764874698112,"env":"test","module":"user-credentials-repository","userId":"-H8m_qqjEjBBptK41G8Rb","msg":"User credentials created"}
{"level":30,"time":1764874698112,"env":"test","module":"auth-routes","userId":"-H8m_qqjEjBBptK41G8Rb","email":"viewer-3NU08iOdTAmbrYRwS4x4M@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874698209,"env":"test","module":"rbac-middleware","userId":"-H8m_qqjEjBBptK41G8Rb","userRole":"viewer","permission":"workflow:create","path":"/projects/c588c448-31c2-4cc3-84c2-375203afa0a5/workflows","msg":"Permission denied"}
{"level":50,"time":1764874704933,"env":"test","error":{},"workflowId":"b7d0958a-504f-4c4b-8fee-a3b7b31e36f1","userId":"LOOenuj-JkNSEKSmsjq4R","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874705282,"env":"test","module":"auth-middleware","path":"/api/workflows/8b29801b-7dc3-4459-828d-90aa461b0359/move","msg":"No valid authentication found"}
{"level":30,"time":1764874705792,"env":"test","module":"user-credentials-repository","userId":"nALdbUfmI5JnkXhQwwwke","msg":"User credentials created"}
{"level":30,"time":1764874705793,"env":"test","module":"auth-routes","userId":"nALdbUfmI5JnkXhQwwwke","email":"test-workflows-YR9uYlouGgKGRneGm8mUK@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874705848,"env":"test","error":{},"workflowId":"8447e7cb-2ec8-47b8-b7cc-e6678da24a38","userId":"nALdbUfmI5JnkXhQwwwke","projectId":"517f501f-a01b-42a9-8b55-74cd6054c93b","msg":"Error moving workflow"}
{"level":50,"time":1764874706226,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"0792a1bc-41dc-444a-bf6c-81cca803795f","userId":"LOOenuj-JkNSEKSmsjq4R","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874706664,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c6d8bca1-a45b-48c7-879d-558c00c04a12","userId":"LOOenuj-JkNSEKSmsjq4R","msg":"Error moving workflow"}
{"level":30,"time":1764874707192,"env":"test","module":"user-credentials-repository","userId":"SZGKF-Zvg5u5saELn_Mye","msg":"User credentials created"}
{"level":30,"time":1764874707193,"env":"test","module":"auth-routes","userId":"SZGKF-Zvg5u5saELn_Mye","email":"test-workflows-6oGMai8lFa-aI5oJ-Vurp@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874707381,"env":"test","module":"auth-routes","userId":"SZGKF-Zvg5u5saELn_Mye","email":"test-workflows-6oGMai8lFa-aI5oJ-Vurp@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874707561,"env":"test","error":{},"workflowId":"52145f33-121a-4cfc-b129-ce771f172f39","userId":"LOOenuj-JkNSEKSmsjq4R","projectId":"f5e4ef6c-8571-4700-b5be-6162eb18bc14","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 1066[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 841[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 438[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 897[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 27.59s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
