npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764867335337,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867337615,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867339526,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867339527,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867339537,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867339537,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867339537,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867339537,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867339961,"env":"test","module":"user-credentials-repository","userId":"n_AhWwakMfbp-KVz0Cq1Y","msg":"User credentials created"}
{"level":30,"time":1764867339964,"env":"test","module":"auth-routes","userId":"n_AhWwakMfbp-KVz0Cq1Y","email":"test-workflows-WtB_7ddzJD0sc12cnO2-B@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"793c6e72-5e5e-42de-95fb-9cdff60093af","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"n_AhWwakMfbp-KVz0Cq1Y","tenantId":"16e36e7c-0835-43de-81fb-8e21f96e59b1","createdBy":"n_AhWwakMfbp-KVz0Cq1Y","ownerId":"n_AhWwakMfbp-KVz0Cq1Y","status":"active","archived":false,"createdAt":"2025-12-04T16:55:41.456Z","updatedAt":"2025-12-04T16:55:41.456Z"}

{"level":30,"time":1764867340621,"env":"test","module":"user-credentials-repository","userId":"v-_MnQ6QsHeM285XBJX-J","msg":"User credentials created"}
{"level":30,"time":1764867340622,"env":"test","module":"auth-routes","userId":"v-_MnQ6QsHeM285XBJX-J","email":"viewer-Df4NuzammQgEpVb-icX_n@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867340721,"env":"test","module":"rbac-middleware","userId":"v-_MnQ6QsHeM285XBJX-J","userRole":"viewer","permission":"workflow:create","path":"/projects/793c6e72-5e5e-42de-95fb-9cdff60093af/workflows","msg":"Permission denied"}
{"level":50,"time":1764867347063,"env":"test","error":{},"workflowId":"acf07223-67c1-47bf-812d-72781be91a7e","userId":"n_AhWwakMfbp-KVz0Cq1Y","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867347416,"env":"test","module":"auth-middleware","path":"/api/workflows/65135e4e-1240-4311-842a-90bf016ce005/move","msg":"No valid authentication found"}
{"level":30,"time":1764867347951,"env":"test","module":"user-credentials-repository","userId":"QUM5xO4JwoHg7kOvjlCDL","msg":"User credentials created"}
{"level":30,"time":1764867347952,"env":"test","module":"auth-routes","userId":"QUM5xO4JwoHg7kOvjlCDL","email":"test-workflows-YCaHp-0LU5Jkspa1Z8F-4@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867348000,"env":"test","error":{},"workflowId":"855f8e93-ab65-4f19-a0b5-01ced33f0740","userId":"QUM5xO4JwoHg7kOvjlCDL","projectId":"5c900065-f606-4aef-b9aa-9077c8f086bb","msg":"Error moving workflow"}
{"level":50,"time":1764867348464,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"786c3a6c-d847-4936-9b0c-ae94a96b1499","userId":"n_AhWwakMfbp-KVz0Cq1Y","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867349306,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ca9e2f3a-a709-4551-bd32-231ba677e272","userId":"n_AhWwakMfbp-KVz0Cq1Y","msg":"Error moving workflow"}
{"level":30,"time":1764867350593,"env":"test","module":"user-credentials-repository","userId":"MM09cPm_Xr38hoSKIGDki","msg":"User credentials created"}
{"level":30,"time":1764867350595,"env":"test","module":"auth-routes","userId":"MM09cPm_Xr38hoSKIGDki","email":"test-workflows-WPOdtjHkWT6Dek16grhG0@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867351001,"env":"test","module":"auth-routes","userId":"MM09cPm_Xr38hoSKIGDki","email":"test-workflows-WPOdtjHkWT6Dek16grhG0@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867351496,"env":"test","error":{},"workflowId":"5b399ea0-9ba1-4b90-970d-0c8826c01014","userId":"n_AhWwakMfbp-KVz0Cq1Y","projectId":"cd5926cb-e97e-43f4-a04a-4efb70e7e228","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 12735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 298[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 613[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 839[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 2190[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:55:31
[2m   Duration [22m 20.40s[2m (transform 3.12s, setup 884ms, collect 6.08s, tests 12.74s, environment 0ms, prepare 15ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764867556285,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867558412,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867560698,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867560699,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867560711,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867560711,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867560712,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867560712,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867561152,"env":"test","module":"user-credentials-repository","userId":"iTiLInqGGfrXAqfIMo4xk","msg":"User credentials created"}
{"level":30,"time":1764867561155,"env":"test","module":"auth-routes","userId":"iTiLInqGGfrXAqfIMo4xk","email":"test-workflows-lbxA80i89IKeGBv-PdNb1@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f48f17f0-fb3b-4f32-a483-58c76765c2ab","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"iTiLInqGGfrXAqfIMo4xk","tenantId":"776b7510-5b57-461e-a5d2-fbf059e42ac6","createdBy":"iTiLInqGGfrXAqfIMo4xk","ownerId":"iTiLInqGGfrXAqfIMo4xk","status":"active","archived":false,"createdAt":"2025-12-04T16:59:22.662Z","updatedAt":"2025-12-04T16:59:22.662Z"}

{"level":30,"time":1764867561806,"env":"test","module":"user-credentials-repository","userId":"ISLTrWmnD1JCDCMbDsAbl","msg":"User credentials created"}
{"level":30,"time":1764867561807,"env":"test","module":"auth-routes","userId":"ISLTrWmnD1JCDCMbDsAbl","email":"viewer-XYiSPkR5fP5YBMsS4PC64@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867561898,"env":"test","module":"rbac-middleware","userId":"ISLTrWmnD1JCDCMbDsAbl","userRole":"viewer","permission":"workflow:create","path":"/projects/f48f17f0-fb3b-4f32-a483-58c76765c2ab/workflows","msg":"Permission denied"}
{"level":50,"time":1764867567807,"env":"test","error":{},"workflowId":"47e72e9e-6016-4156-a242-8071e6a71383","userId":"iTiLInqGGfrXAqfIMo4xk","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867568102,"env":"test","module":"auth-middleware","path":"/api/workflows/d62a112f-44e3-4f6f-a7e9-2ce4ea49adc4/move","msg":"No valid authentication found"}
{"level":30,"time":1764867568597,"env":"test","module":"user-credentials-repository","userId":"uGQx6UdQViumga6Fryg2B","msg":"User credentials created"}
{"level":30,"time":1764867568597,"env":"test","module":"auth-routes","userId":"uGQx6UdQViumga6Fryg2B","email":"test-workflows-f347j_tkOneKi8rrNuwgO@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867568647,"env":"test","error":{},"workflowId":"3f53f430-6ad9-4bb5-822d-f8a08344d13e","userId":"uGQx6UdQViumga6Fryg2B","projectId":"c0db19be-6d1d-4d82-ad33-1519b59f0b80","msg":"Error moving workflow"}
{"level":50,"time":1764867568997,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9fbd8015-4b5f-4acb-9057-08d232b675bb","userId":"iTiLInqGGfrXAqfIMo4xk","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867569345,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"de1e67b3-1cb9-4fbb-a86c-11e5e2fba4c2","userId":"iTiLInqGGfrXAqfIMo4xk","msg":"Error moving workflow"}
{"level":30,"time":1764867569851,"env":"test","module":"user-credentials-repository","userId":"cbeJWs0ieClHkQLeIlT1X","msg":"User credentials created"}
{"level":30,"time":1764867569851,"env":"test","module":"auth-routes","userId":"cbeJWs0ieClHkQLeIlT1X","email":"test-workflows-h48jGqF17ko7w8P0hpszZ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867570084,"env":"test","module":"auth-routes","userId":"cbeJWs0ieClHkQLeIlT1X","email":"test-workflows-h48jGqF17ko7w8P0hpszZ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867570264,"env":"test","error":{},"workflowId":"c67bcfa3-5adc-4ec7-8c08-d914f467248a","userId":"iTiLInqGGfrXAqfIMo4xk","projectId":"314d4857-53af-4b9f-9e6e-d4ee035156cf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 307[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 289[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 565[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 578[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 446[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 546[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 348[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 920[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:59:13
[2m   Duration [22m 16.76s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764867689302,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867691012,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867692749,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867692750,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867692757,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867692757,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867692757,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867692757,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867693206,"env":"test","module":"user-credentials-repository","userId":"__yJkzj4roX023YEvXyba","msg":"User credentials created"}
{"level":30,"time":1764867693208,"env":"test","module":"auth-routes","userId":"__yJkzj4roX023YEvXyba","email":"test-workflows-gqCHDX5dhYiUf4c-WFSmx@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3d6b8f74-e48c-4c67-905a-57dd7eca1c6c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"__yJkzj4roX023YEvXyba","tenantId":"fcbd0d97-42e2-450a-a393-bad963b26e24","createdBy":"__yJkzj4roX023YEvXyba","ownerId":"__yJkzj4roX023YEvXyba","status":"active","archived":false,"createdAt":"2025-12-04T17:01:34.711Z","updatedAt":"2025-12-04T17:01:34.711Z"}

{"level":30,"time":1764867693857,"env":"test","module":"user-credentials-repository","userId":"3jJKdvAlgHW8t4lSOCQlz","msg":"User credentials created"}
{"level":30,"time":1764867693857,"env":"test","module":"auth-routes","userId":"3jJKdvAlgHW8t4lSOCQlz","email":"viewer-n_CaeqzVjISuSqScccRS7@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867693947,"env":"test","module":"rbac-middleware","userId":"3jJKdvAlgHW8t4lSOCQlz","userRole":"viewer","permission":"workflow:create","path":"/projects/3d6b8f74-e48c-4c67-905a-57dd7eca1c6c/workflows","msg":"Permission denied"}
{"level":50,"time":1764867700015,"env":"test","error":{},"workflowId":"796a3733-a5c8-4758-b324-ba0cdfac2111","userId":"__yJkzj4roX023YEvXyba","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867700313,"env":"test","module":"auth-middleware","path":"/api/workflows/3bd66a17-0cbb-46ad-9f62-c520f9dd6b27/move","msg":"No valid authentication found"}
{"level":30,"time":1764867700856,"env":"test","module":"user-credentials-repository","userId":"c98tnl2B0WVEWGXKAuhvq","msg":"User credentials created"}
{"level":30,"time":1764867700857,"env":"test","module":"auth-routes","userId":"c98tnl2B0WVEWGXKAuhvq","email":"test-workflows-9y5FWDPZi9MXG3eKfH7yv@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867700913,"env":"test","error":{},"workflowId":"1d9a5536-4c90-432a-b18b-36c89f6deaf6","userId":"c98tnl2B0WVEWGXKAuhvq","projectId":"f8d0a6df-fd0a-441e-8889-c5dbf0420bf7","msg":"Error moving workflow"}
{"level":50,"time":1764867701282,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9bf1daa2-d38b-4d79-998c-fc658206a38c","userId":"__yJkzj4roX023YEvXyba","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867701625,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1e8ca94e-69ed-4347-8fe7-b97099cfae27","userId":"__yJkzj4roX023YEvXyba","msg":"Error moving workflow"}
{"level":50,"time":1764867702124,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rLqtL2ahz_cKEoUVtnGgx) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"rLqtL2ahz_cKEoUVtnGgx","msg":"Failed to create user credentials"}
{"level":50,"time":1764867702124,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rLqtL2ahz_cKEoUVtnGgx) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 280[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 606[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 705[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 448[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 297[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 343[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 500[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:01:26
[2m   Duration [22m 15.91s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764868031607,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868033407,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868035482,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868035482,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868035493,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868035493,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868035494,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868035494,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868036998,"env":"test","module":"user-credentials-repository","userId":"HXXqgbtHrvCim1zxI9297","msg":"User credentials created"}
{"level":30,"time":1764868037003,"env":"test","module":"auth-routes","userId":"HXXqgbtHrvCim1zxI9297","email":"test-workflows-HmbKd0XiQimXlvgxr_PTh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e795daa9-8409-4b4a-ac2f-8f95d9bcb45c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"HXXqgbtHrvCim1zxI9297","tenantId":"1d7c8fa4-769a-433c-b8be-7e1ab31ee482","createdBy":"HXXqgbtHrvCim1zxI9297","ownerId":"HXXqgbtHrvCim1zxI9297","status":"active","archived":false,"createdAt":"2025-12-04T17:07:18.521Z","updatedAt":"2025-12-04T17:07:18.521Z"}

{"level":30,"time":1764868037656,"env":"test","module":"user-credentials-repository","userId":"FsBOBNzo8LX7tv62ToEpn","msg":"User credentials created"}
{"level":30,"time":1764868037657,"env":"test","module":"auth-routes","userId":"FsBOBNzo8LX7tv62ToEpn","email":"viewer-M0UzMZu9qsJ7S7HMFwCZ9@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868037748,"env":"test","module":"rbac-middleware","userId":"FsBOBNzo8LX7tv62ToEpn","userRole":"viewer","permission":"workflow:create","path":"/projects/e795daa9-8409-4b4a-ac2f-8f95d9bcb45c/workflows","msg":"Permission denied"}
{"level":50,"time":1764868043970,"env":"test","error":{},"workflowId":"85be08fd-0645-4e33-87d2-4bf1ea87b3ac","userId":"HXXqgbtHrvCim1zxI9297","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868044304,"env":"test","module":"auth-middleware","path":"/api/workflows/27214331-8641-4f30-ae80-fed53406643b/move","msg":"No valid authentication found"}
{"level":30,"time":1764868044801,"env":"test","module":"user-credentials-repository","userId":"7baCjN4fg76jWPKOht1Ra","msg":"User credentials created"}
{"level":30,"time":1764868044802,"env":"test","module":"auth-routes","userId":"7baCjN4fg76jWPKOht1Ra","email":"test-workflows-4VU0ZcQDhH-rxxaa3ny5Z@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868044852,"env":"test","error":{},"workflowId":"688a2c9d-47d9-402d-85c9-1172ce9bc7c1","userId":"7baCjN4fg76jWPKOht1Ra","projectId":"6b553486-d9ec-4a29-b9c9-0900385ad6d6","msg":"Error moving workflow"}
{"level":50,"time":1764868045222,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7721c327-c21c-4165-b2ce-eea6bb21bcde","userId":"HXXqgbtHrvCim1zxI9297","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868045595,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e0eacc40-b7b2-41ac-be0f-1bd14929ab0b","userId":"HXXqgbtHrvCim1zxI9297","msg":"Error moving workflow"}
{"level":30,"time":1764868046119,"env":"test","module":"user-credentials-repository","userId":"dNZjjty9VrCz2hd35d7IG","msg":"User credentials created"}
{"level":30,"time":1764868046120,"env":"test","module":"auth-routes","userId":"dNZjjty9VrCz2hd35d7IG","email":"test-workflows-AzjzGBv-SlhAzdFkNhiL4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868046328,"env":"test","module":"auth-routes","userId":"dNZjjty9VrCz2hd35d7IG","email":"test-workflows-AzjzGBv-SlhAzdFkNhiL4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868046510,"env":"test","error":{},"workflowId":"f2cb878d-d5c4-437b-8ad8-6f2773a2db20","userId":"HXXqgbtHrvCim1zxI9297","projectId":"02446088-c604-440d-8c50-aefd18b2ca2f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 274[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 603[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 373[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 917[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:07:08
[2m   Duration [22m 17.69s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764868270640,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868272374,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868274194,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868274195,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868274206,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868274206,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868274206,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868274206,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868274660,"env":"test","module":"user-credentials-repository","userId":"SesN3IwvAkozAM6VH0yKv","msg":"User credentials created"}
{"level":30,"time":1764868274663,"env":"test","module":"auth-routes","userId":"SesN3IwvAkozAM6VH0yKv","email":"test-workflows-H47U3-CsPBZDNdc7LmXVT@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7b394b4f-afbf-4c96-9364-68bdb7493a20","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"SesN3IwvAkozAM6VH0yKv","tenantId":"20cf9008-738d-4ad9-bbcb-141dba657891","createdBy":"SesN3IwvAkozAM6VH0yKv","ownerId":"SesN3IwvAkozAM6VH0yKv","status":"active","archived":false,"createdAt":"2025-12-04T17:11:16.168Z","updatedAt":"2025-12-04T17:11:16.168Z"}

{"level":30,"time":1764868275329,"env":"test","module":"user-credentials-repository","userId":"Wshr5S4brBDP2sNmPCz91","msg":"User credentials created"}
{"level":30,"time":1764868275331,"env":"test","module":"auth-routes","userId":"Wshr5S4brBDP2sNmPCz91","email":"viewer-BTKHO65mm4VOjiNwfYZyc@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868275427,"env":"test","module":"rbac-middleware","userId":"Wshr5S4brBDP2sNmPCz91","userRole":"viewer","permission":"workflow:create","path":"/projects/7b394b4f-afbf-4c96-9364-68bdb7493a20/workflows","msg":"Permission denied"}
{"level":50,"time":1764868281786,"env":"test","error":{},"workflowId":"a8abc182-2342-42f5-860d-3a9893e7a25e","userId":"SesN3IwvAkozAM6VH0yKv","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868282119,"env":"test","module":"auth-middleware","path":"/api/workflows/7fd02a52-a879-4423-bf1a-8c6e4af23c9d/move","msg":"No valid authentication found"}
{"level":30,"time":1764868282644,"env":"test","module":"user-credentials-repository","userId":"loipOzSaTAzK4rj3rcq1E","msg":"User credentials created"}
{"level":30,"time":1764868282644,"env":"test","module":"auth-routes","userId":"loipOzSaTAzK4rj3rcq1E","email":"test-workflows-JzQxnuGB8l4oWNBZrdrXC@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868282695,"env":"test","error":{},"workflowId":"03750cb7-043e-4f80-ba9e-5efedacd913d","userId":"loipOzSaTAzK4rj3rcq1E","projectId":"4123b93d-2e8d-4020-a4cd-ff92a3c973e1","msg":"Error moving workflow"}
{"level":50,"time":1764868283065,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b049a974-d67b-4717-bb11-044a8573e678","userId":"SesN3IwvAkozAM6VH0yKv","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868283442,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b77a068d-c44d-40eb-a4a1-a6d9734282c3","userId":"SesN3IwvAkozAM6VH0yKv","msg":"Error moving workflow"}
{"level":50,"time":1764868283969,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(tAA3Q40BHsxFFZqA_Mtk5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"tAA3Q40BHsxFFZqA_Mtk5","msg":"Failed to create user credentials"}
{"level":50,"time":1764868283969,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(tAA3Q40BHsxFFZqA_Mtk5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10164[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 290[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 827[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 613[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 529[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:11:07
[2m   Duration [22m 16.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764868528894,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531043,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533336,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533336,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533354,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533354,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533355,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533355,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868533814,"env":"test","module":"user-credentials-repository","userId":"G8hJILui9Jhp7kK9CMsaK","msg":"User credentials created"}
{"level":30,"time":1764868533816,"env":"test","module":"auth-routes","userId":"G8hJILui9Jhp7kK9CMsaK","email":"test-workflows-8kq2iyCstk0MGPczLBLwK@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9090abbf-debc-4309-b224-f63056b0d63a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"G8hJILui9Jhp7kK9CMsaK","tenantId":"d1c0e36a-c45b-4235-b96d-c72a560d3c75","createdBy":"G8hJILui9Jhp7kK9CMsaK","ownerId":"G8hJILui9Jhp7kK9CMsaK","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.336Z","updatedAt":"2025-12-04T17:15:35.336Z"}

{"level":30,"time":1764868534500,"env":"test","module":"user-credentials-repository","userId":"aVTYicKhTy9fGBUrxfrG4","msg":"User credentials created"}
{"level":30,"time":1764868534501,"env":"test","module":"auth-routes","userId":"aVTYicKhTy9fGBUrxfrG4","email":"viewer-sNwAGo-510dHtOe0D0bIJ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534591,"env":"test","module":"rbac-middleware","userId":"aVTYicKhTy9fGBUrxfrG4","userRole":"viewer","permission":"workflow:create","path":"/projects/9090abbf-debc-4309-b224-f63056b0d63a/workflows","msg":"Permission denied"}
{"level":50,"time":1764868540848,"env":"test","error":{},"workflowId":"4dd23760-17a8-4520-ac42-0747ba64770c","userId":"G8hJILui9Jhp7kK9CMsaK","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541162,"env":"test","module":"auth-middleware","path":"/api/workflows/2bc537db-f930-454f-b2f6-4188b3987d72/move","msg":"No valid authentication found"}
{"level":30,"time":1764868541668,"env":"test","module":"user-credentials-repository","userId":"8-kdqVN-Gq_nQHXfW4oLm","msg":"User credentials created"}
{"level":30,"time":1764868541668,"env":"test","module":"auth-routes","userId":"8-kdqVN-Gq_nQHXfW4oLm","email":"test-workflows-9nSXEJWr2EPGpKPcDfox1@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868541712,"env":"test","error":{},"workflowId":"fb0000bc-384a-44d6-825b-356804c39192","userId":"8-kdqVN-Gq_nQHXfW4oLm","projectId":"27d83555-5ed4-40ce-a5c5-b69a25a5f552","msg":"Error moving workflow"}
{"level":50,"time":1764868542083,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3746b720-af9e-4db7-bfe2-911e8a6818e9","userId":"G8hJILui9Jhp7kK9CMsaK","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868542550,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e18d5176-fff2-4043-a836-850521c57284","userId":"G8hJILui9Jhp7kK9CMsaK","msg":"Error moving workflow"}
{"level":30,"time":1764868543279,"env":"test","module":"user-credentials-repository","userId":"Vu5GO0hXAWNC4Mc9oZeln","msg":"User credentials created"}
{"level":30,"time":1764868543280,"env":"test","module":"auth-routes","userId":"Vu5GO0hXAWNC4Mc9oZeln","email":"test-workflows-L3TTwPQGBkWYsid3ZukFI@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868543487,"env":"test","module":"auth-routes","userId":"Vu5GO0hXAWNC4Mc9oZeln","email":"test-workflows-L3TTwPQGBkWYsid3ZukFI@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868543685,"env":"test","error":{},"workflowId":"66ba193a-781d-4b5f-aece-601426a717e0","userId":"G8hJILui9Jhp7kK9CMsaK","projectId":"165c9c34-542b-40e7-b8fd-0c6e6a9f64c6","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 550[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 467[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1137[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 17.91s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764868816231,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818422,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820549,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820550,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820591,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820591,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820592,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820592,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821064,"env":"test","module":"user-credentials-repository","userId":"BK_BYPqXIDyTgbjkilWlk","msg":"User credentials created"}
{"level":30,"time":1764868821067,"env":"test","module":"auth-routes","userId":"BK_BYPqXIDyTgbjkilWlk","email":"test-workflows-M8NiEXD9DYC6t-eh3-Hzt@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"67c6eb7e-5408-4b05-a3c4-a03b4b4f0214","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"BK_BYPqXIDyTgbjkilWlk","tenantId":"95c8a6d5-0ef6-4880-986a-bdb1ffcfee58","createdBy":"BK_BYPqXIDyTgbjkilWlk","ownerId":"BK_BYPqXIDyTgbjkilWlk","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.598Z","updatedAt":"2025-12-04T17:20:22.598Z"}

{"level":30,"time":1764868821781,"env":"test","module":"user-credentials-repository","userId":"ZRqX7i7500lrOTuRTrKBQ","msg":"User credentials created"}
{"level":30,"time":1764868821782,"env":"test","module":"auth-routes","userId":"ZRqX7i7500lrOTuRTrKBQ","email":"viewer-iiuS7Oguh_1idAKsie8GA@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821882,"env":"test","module":"rbac-middleware","userId":"ZRqX7i7500lrOTuRTrKBQ","userRole":"viewer","permission":"workflow:create","path":"/projects/67c6eb7e-5408-4b05-a3c4-a03b4b4f0214/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828301,"env":"test","error":{},"workflowId":"78796961-4d6a-4330-862f-e0823f0e90e5","userId":"BK_BYPqXIDyTgbjkilWlk","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828633,"env":"test","module":"auth-middleware","path":"/api/workflows/ff65731f-afed-43bf-b622-34892c1df313/move","msg":"No valid authentication found"}
{"level":30,"time":1764868829178,"env":"test","module":"user-credentials-repository","userId":"U7zKEol77EhjG8Z5kksyk","msg":"User credentials created"}
{"level":30,"time":1764868829179,"env":"test","module":"auth-routes","userId":"U7zKEol77EhjG8Z5kksyk","email":"test-workflows-3yn_0CyeVZgOsJsHDjZhA@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868829227,"env":"test","error":{},"workflowId":"afde417f-15d6-40c6-bcdf-98e410a6be30","userId":"U7zKEol77EhjG8Z5kksyk","projectId":"b954a6af-2b5b-41f0-965c-1c606cb68adc","msg":"Error moving workflow"}
{"level":50,"time":1764868829603,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"1397538a-28c4-49f1-b65c-ce324566c752","userId":"BK_BYPqXIDyTgbjkilWlk","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868830043,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a58aeab4-1f47-4c5a-acfd-959502d730c9","userId":"BK_BYPqXIDyTgbjkilWlk","msg":"Error moving workflow"}
{"level":30,"time":1764868830643,"env":"test","module":"user-credentials-repository","userId":"1FGGsjCw8SjFULk0WazKO","msg":"User credentials created"}
{"level":30,"time":1764868830644,"env":"test","module":"auth-routes","userId":"1FGGsjCw8SjFULk0WazKO","email":"test-workflows-cSN4sUAgeFr3z_y0adTRk@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830845,"env":"test","module":"auth-routes","userId":"1FGGsjCw8SjFULk0WazKO","email":"test-workflows-cSN4sUAgeFr3z_y0adTRk@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868831093,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4636e286-9204-422d-b090-e13e14b2df61","userId":"BK_BYPqXIDyTgbjkilWlk","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 818[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 652[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 648[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 440[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1051[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.62s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764871635126,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871638602,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871642592,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871642593,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871642603,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871642603,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871642604,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871642604,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871643064,"env":"test","module":"user-credentials-repository","userId":"NT2CXSSKZbjZ218LEgxs5","msg":"User credentials created"}
{"level":30,"time":1764871643069,"env":"test","module":"auth-routes","userId":"NT2CXSSKZbjZ218LEgxs5","email":"test-workflows-WawSO3bZHlyAjqlGRAxu0@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a11c8a66-e3f8-4af0-912c-b314cb122fa7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"NT2CXSSKZbjZ218LEgxs5","tenantId":"b1f0dd63-5c61-4c83-8dd9-8a086c72f5c0","createdBy":"NT2CXSSKZbjZ218LEgxs5","ownerId":"NT2CXSSKZbjZ218LEgxs5","status":"active","archived":false,"createdAt":"2025-12-04T18:07:24.662Z","updatedAt":"2025-12-04T18:07:24.662Z"}

{"level":30,"time":1764871643776,"env":"test","module":"user-credentials-repository","userId":"sQL5EQ55XZJocU4ON1hXU","msg":"User credentials created"}
{"level":30,"time":1764871643777,"env":"test","module":"auth-routes","userId":"sQL5EQ55XZJocU4ON1hXU","email":"viewer-rfhVf1oWHaDEraSjwxEFt@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871643870,"env":"test","module":"rbac-middleware","userId":"sQL5EQ55XZJocU4ON1hXU","userRole":"viewer","permission":"workflow:create","path":"/projects/a11c8a66-e3f8-4af0-912c-b314cb122fa7/workflows","msg":"Permission denied"}
{"level":50,"time":1764871650422,"env":"test","error":{},"workflowId":"069bf813-8387-439e-8ef0-7f30906cf46c","userId":"NT2CXSSKZbjZ218LEgxs5","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871650769,"env":"test","module":"auth-middleware","path":"/api/workflows/7baef924-3595-457a-9633-d62c26eef4f9/move","msg":"No valid authentication found"}
{"level":30,"time":1764871651314,"env":"test","module":"user-credentials-repository","userId":"Q10BvxO7HS7Skej0I662d","msg":"User credentials created"}
{"level":30,"time":1764871651315,"env":"test","module":"auth-routes","userId":"Q10BvxO7HS7Skej0I662d","email":"test-workflows-7oImORxK4A_0faakOkReg@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871651405,"env":"test","error":{},"workflowId":"1d4e643e-7bd0-41f8-a609-c6f56a3305f2","userId":"Q10BvxO7HS7Skej0I662d","projectId":"22ac327e-bf61-4615-8452-997704697881","msg":"Error moving workflow"}
{"level":50,"time":1764871651608,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(NT2CXSSKZbjZ218LEgxs5) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"NT2CXSSKZbjZ218LEgxs5","msg":"Error creating workflow"}
{"level":50,"time":1764871651792,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(NT2CXSSKZbjZ218LEgxs5) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"NT2CXSSKZbjZ218LEgxs5","msg":"Error creating workflow"}
{"level":50,"time":1764871651978,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(NT2CXSSKZbjZ218LEgxs5) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"NT2CXSSKZbjZ218LEgxs5","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 9682[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 343[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 667[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 825[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 649[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 778[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 342[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 639[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 201[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 184[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 188[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 22.38s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764871701765,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871705811,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871709639,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871709640,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871709656,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871709656,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871709656,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871709656,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710133,"env":"test","module":"user-credentials-repository","userId":"uRr42LvamXtshkmwFPhFB","msg":"User credentials created"}
{"level":30,"time":1764871710136,"env":"test","module":"auth-routes","userId":"uRr42LvamXtshkmwFPhFB","email":"test-workflows-H9Kl3LRrpQVDGvwRGyzvz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7a9bac8f-499f-4e8d-a7db-f259c7bb89a1","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"uRr42LvamXtshkmwFPhFB","tenantId":"9cc8209a-d50c-4048-8478-8166118c84d1","createdBy":"uRr42LvamXtshkmwFPhFB","ownerId":"uRr42LvamXtshkmwFPhFB","status":"active","archived":false,"createdAt":"2025-12-04T18:08:31.714Z","updatedAt":"2025-12-04T18:08:31.714Z"}

{"level":30,"time":1764871710809,"env":"test","module":"user-credentials-repository","userId":"U7jbzm9iRt_iawmQb_F8Z","msg":"User credentials created"}
{"level":30,"time":1764871710810,"env":"test","module":"auth-routes","userId":"U7jbzm9iRt_iawmQb_F8Z","email":"viewer-T38gOY45Hl2dbUcCiZtYv@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871710898,"env":"test","module":"rbac-middleware","userId":"U7jbzm9iRt_iawmQb_F8Z","userRole":"viewer","permission":"workflow:create","path":"/projects/7a9bac8f-499f-4e8d-a7db-f259c7bb89a1/workflows","msg":"Permission denied"}
{"level":50,"time":1764871716725,"env":"test","error":{},"workflowId":"ce79711b-a986-4b77-a156-a3e25b053031","userId":"uRr42LvamXtshkmwFPhFB","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871717033,"env":"test","module":"auth-middleware","path":"/api/workflows/87115c55-e95d-4080-8b53-c7bb1d429c06/move","msg":"No valid authentication found"}
{"level":30,"time":1764871717595,"env":"test","module":"user-credentials-repository","userId":"Y7HIDuwqLV5dFsgOXyXhn","msg":"User credentials created"}
{"level":30,"time":1764871717595,"env":"test","module":"auth-routes","userId":"Y7HIDuwqLV5dFsgOXyXhn","email":"test-workflows-79jHiJjKF4uZb0PerHT6q@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871717643,"env":"test","error":{},"workflowId":"cfbd80ac-565d-49ea-a5fd-3b1eb46c107a","userId":"Y7HIDuwqLV5dFsgOXyXhn","projectId":"d758e410-1887-49e7-87a6-38c4a33dd2a9","msg":"Error moving workflow"}
{"level":50,"time":1764871718042,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"58ffccae-f089-4b8a-a34d-2aa48c171ccd","userId":"uRr42LvamXtshkmwFPhFB","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871718393,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e63f472a-d54c-41c9-9330-31c67d229dc0","userId":"uRr42LvamXtshkmwFPhFB","msg":"Error moving workflow"}
{"level":30,"time":1764871718885,"env":"test","module":"user-credentials-repository","userId":"_3mJFgllxPDGNAKTu9uR5","msg":"User credentials created"}
{"level":30,"time":1764871718886,"env":"test","module":"auth-routes","userId":"_3mJFgllxPDGNAKTu9uR5","email":"test-workflows-X143_lAajx3cyoxniRqQf@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871719086,"env":"test","module":"auth-routes","userId":"_3mJFgllxPDGNAKTu9uR5","email":"test-workflows-X143_lAajx3cyoxniRqQf@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871719269,"env":"test","error":{},"workflowId":"5ce3b75f-67b0-477c-bc7c-36b4d22886f5","userId":"uRr42LvamXtshkmwFPhFB","projectId":"78678091-2960-4420-b380-1063d66adfac","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9902[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 290[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 654[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 397[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 349[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 877[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 20.90s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764871752689,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871756426,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871759623,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871759623,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871759634,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871759634,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871759635,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871759635,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871760121,"env":"test","module":"user-credentials-repository","userId":"tXvafZ4frvbSM6DMuLM90","msg":"User credentials created"}
{"level":30,"time":1764871760124,"env":"test","module":"auth-routes","userId":"tXvafZ4frvbSM6DMuLM90","email":"test-workflows-7vq4X8AFv7prthxI8Qstg@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e50031fd-6104-475c-a0f6-76b2459bc8b2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"tXvafZ4frvbSM6DMuLM90","tenantId":"b628826e-405e-4f3a-b4d2-8fad0b9f5585","createdBy":"tXvafZ4frvbSM6DMuLM90","ownerId":"tXvafZ4frvbSM6DMuLM90","status":"active","archived":false,"createdAt":"2025-12-04T18:09:21.707Z","updatedAt":"2025-12-04T18:09:21.707Z"}

{"level":30,"time":1764871760795,"env":"test","module":"user-credentials-repository","userId":"mlNDKF4oPT-xqwNY3B3My","msg":"User credentials created"}
{"level":30,"time":1764871760796,"env":"test","module":"auth-routes","userId":"mlNDKF4oPT-xqwNY3B3My","email":"viewer-hSetqoOIaLPh4tgYqX1fL@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871760890,"env":"test","module":"rbac-middleware","userId":"mlNDKF4oPT-xqwNY3B3My","userRole":"viewer","permission":"workflow:create","path":"/projects/e50031fd-6104-475c-a0f6-76b2459bc8b2/workflows","msg":"Permission denied"}
{"level":50,"time":1764871766932,"env":"test","error":{},"workflowId":"46528d33-7a79-4047-93c7-1951f19b3468","userId":"tXvafZ4frvbSM6DMuLM90","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871767238,"env":"test","module":"auth-middleware","path":"/api/workflows/7f8b678a-2c82-4f5f-9c00-2f244f99701e/move","msg":"No valid authentication found"}
{"level":30,"time":1764871767727,"env":"test","module":"user-credentials-repository","userId":"X8MPInbrXilyutYYjc5eb","msg":"User credentials created"}
{"level":30,"time":1764871767728,"env":"test","module":"auth-routes","userId":"X8MPInbrXilyutYYjc5eb","email":"test-workflows-taiBITdCyELXMP11Otucy@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871767777,"env":"test","error":{},"workflowId":"39453289-558e-4db8-a128-1a8bdd9cae87","userId":"X8MPInbrXilyutYYjc5eb","projectId":"a702b6a0-4607-48c6-beaa-f98776aeb9e8","msg":"Error moving workflow"}
{"level":50,"time":1764871768126,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"e2a05da7-e9ba-4892-a51d-331bff8aca55","userId":"tXvafZ4frvbSM6DMuLM90","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871768482,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"96328bb1-70f9-4d13-bbc0-32061b247d50","userId":"tXvafZ4frvbSM6DMuLM90","msg":"Error moving workflow"}
{"level":30,"time":1764871768993,"env":"test","module":"user-credentials-repository","userId":"gvQxiLAiJLMFXIO5tfaUj","msg":"User credentials created"}
{"level":30,"time":1764871768994,"env":"test","module":"auth-routes","userId":"gvQxiLAiJLMFXIO5tfaUj","email":"test-workflows-EvCg6GWQwe8J0PHXu3oNR@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871769192,"env":"test","module":"auth-routes","userId":"gvQxiLAiJLMFXIO5tfaUj","email":"test-workflows-EvCg6GWQwe8J0PHXu3oNR@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871769384,"env":"test","error":{},"workflowId":"b0ca9f09-5bfc-431d-838b-628abc2da234","userId":"tXvafZ4frvbSM6DMuLM90","projectId":"efe67f88-6c92-48a3-bed5-ce52074d1eba","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9992[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 445[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 903[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 20.21s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764873689413,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873693067,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873696989,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873696989,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873697001,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873697001,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873697001,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873697001,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873697542,"env":"test","module":"user-credentials-repository","userId":"vatJqxpkcoDOIlD78U5h9","msg":"User credentials created"}
{"level":30,"time":1764873697547,"env":"test","module":"auth-routes","userId":"vatJqxpkcoDOIlD78U5h9","email":"test-workflows-t3waSFsUmLaKpxwFBI8ez@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b457be00-b4ec-4ecf-892e-2b8bbeee06a9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"vatJqxpkcoDOIlD78U5h9","tenantId":"200c5dcc-1c84-4c91-a746-451fd33d7fbc","createdBy":"vatJqxpkcoDOIlD78U5h9","ownerId":"vatJqxpkcoDOIlD78U5h9","status":"active","archived":false,"createdAt":"2025-12-04T18:41:39.164Z","updatedAt":"2025-12-04T18:41:39.164Z"}

{"level":30,"time":1764873698268,"env":"test","module":"user-credentials-repository","userId":"iz9u0yH7FqzICXJeVvotw","msg":"User credentials created"}
{"level":30,"time":1764873698268,"env":"test","module":"auth-routes","userId":"iz9u0yH7FqzICXJeVvotw","email":"viewer-AZ3FJHId-Y78YNMqsL1MA@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873698365,"env":"test","module":"rbac-middleware","userId":"iz9u0yH7FqzICXJeVvotw","userRole":"viewer","permission":"workflow:create","path":"/projects/b457be00-b4ec-4ecf-892e-2b8bbeee06a9/workflows","msg":"Permission denied"}
{"level":50,"time":1764873704569,"env":"test","error":{},"workflowId":"628fe9a4-a468-48d5-b82f-121cb1b4b4d5","userId":"vatJqxpkcoDOIlD78U5h9","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873704888,"env":"test","module":"auth-middleware","path":"/api/workflows/206bd2b2-a5e0-44bc-af65-3134e797e5dd/move","msg":"No valid authentication found"}
{"level":30,"time":1764873705406,"env":"test","module":"user-credentials-repository","userId":"f1Fs9khshWii91uIR74ds","msg":"User credentials created"}
{"level":30,"time":1764873705407,"env":"test","module":"auth-routes","userId":"f1Fs9khshWii91uIR74ds","email":"test-workflows-orrEAE8czlZJjaD0SjDVu@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873705455,"env":"test","error":{},"workflowId":"d21909c2-59ba-4074-8790-4430d93d1240","userId":"f1Fs9khshWii91uIR74ds","projectId":"e8e6f7b0-48ac-4889-8559-cf8c07421258","msg":"Error moving workflow"}
{"level":50,"time":1764873705846,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6d73c2f1-22d9-4717-ab97-01a7230d296c","userId":"vatJqxpkcoDOIlD78U5h9","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873706241,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"71adc014-25a5-497a-8162-71263a44f37d","userId":"vatJqxpkcoDOIlD78U5h9","msg":"Error moving workflow"}
{"level":30,"time":1764873707030,"env":"test","module":"user-credentials-repository","userId":"QfG6XpAAotQi6w17kyhbH","msg":"User credentials created"}
{"level":30,"time":1764873707031,"env":"test","module":"auth-routes","userId":"QfG6XpAAotQi6w17kyhbH","email":"test-workflows--6J6tgvorSpdIqK8lK8eu@example.com","msg":"User registered successfully"}
{"level":30,"time":1764873707232,"env":"test","module":"auth-routes","userId":"QfG6XpAAotQi6w17kyhbH","email":"test-workflows--6J6tgvorSpdIqK8lK8eu@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764873707424,"env":"test","error":{},"workflowId":"4a092c0e-e90c-4cad-a0f4-ea8f0aaa3c77","userId":"vatJqxpkcoDOIlD78U5h9","projectId":"168943d0-4e7c-4388-923a-84b212c18925","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 441[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 516[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 394[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1188[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 21.69s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764874579523,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874585591,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874592166,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874592167,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874592200,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874592200,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874592200,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874592200,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874592802,"env":"test","module":"user-credentials-repository","userId":"5IEVLVJNZzeh2ZNJW0hvt","msg":"User credentials created"}
{"level":30,"time":1764874592806,"env":"test","module":"auth-routes","userId":"5IEVLVJNZzeh2ZNJW0hvt","email":"test-workflows-_3PwWDfV96Hsv8pJ8jj4m@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b2080bdd-4af9-4846-98f9-dce597b1cd05","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"5IEVLVJNZzeh2ZNJW0hvt","tenantId":"0b0aaaf4-2a00-4ad3-8d9e-a143a695c12e","createdBy":"5IEVLVJNZzeh2ZNJW0hvt","ownerId":"5IEVLVJNZzeh2ZNJW0hvt","status":"active","archived":false,"createdAt":"2025-12-04T18:56:34.438Z","updatedAt":"2025-12-04T18:56:34.438Z"}

{"level":30,"time":1764874593528,"env":"test","module":"user-credentials-repository","userId":"4woYfeMr9vL9dxQE5p605","msg":"User credentials created"}
{"level":30,"time":1764874593529,"env":"test","module":"auth-routes","userId":"4woYfeMr9vL9dxQE5p605","email":"viewer-HgxrEUhaXbncWR2CsHwd-@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874593630,"env":"test","module":"rbac-middleware","userId":"4woYfeMr9vL9dxQE5p605","userRole":"viewer","permission":"workflow:create","path":"/projects/b2080bdd-4af9-4846-98f9-dce597b1cd05/workflows","msg":"Permission denied"}
{"level":50,"time":1764874599966,"env":"test","error":{},"workflowId":"db238853-faac-4596-9ee0-072b2163bd3a","userId":"5IEVLVJNZzeh2ZNJW0hvt","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874600303,"env":"test","module":"auth-middleware","path":"/api/workflows/171460b0-0090-440a-8dfc-88dde424410a/move","msg":"No valid authentication found"}
{"level":30,"time":1764874600808,"env":"test","module":"user-credentials-repository","userId":"IQ1EOaMVSbz46LH6iyReK","msg":"User credentials created"}
{"level":30,"time":1764874600809,"env":"test","module":"auth-routes","userId":"IQ1EOaMVSbz46LH6iyReK","email":"test-workflows-rKkaA_NZU98hvLN4YO-R0@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874600858,"env":"test","error":{},"workflowId":"1e6f8e65-1bdd-43a2-8f25-72933c9bc756","userId":"IQ1EOaMVSbz46LH6iyReK","projectId":"be726285-f7e5-4072-b87f-97feeea0c750","msg":"Error moving workflow"}
{"level":50,"time":1764874601309,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"24522d88-db82-42d1-b3a8-2af90172fac2","userId":"5IEVLVJNZzeh2ZNJW0hvt","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874601687,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"313cb498-8c02-41f5-92e6-85a000167811","userId":"5IEVLVJNZzeh2ZNJW0hvt","msg":"Error moving workflow"}
{"level":50,"time":1764874602213,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(HoZd19n6SZxQu6FdIci38) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"HoZd19n6SZxQu6FdIci38","msg":"Failed to create user credentials"}
{"level":50,"time":1764874602214,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(HoZd19n6SZxQu6FdIci38) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 785[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 527[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.51s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764874686518,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874691452,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874696590,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874696591,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874696602,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874696602,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874696603,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874696603,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874697375,"env":"test","module":"user-credentials-repository","userId":"LOOenuj-JkNSEKSmsjq4R","msg":"User credentials created"}
{"level":30,"time":1764874697378,"env":"test","module":"auth-routes","userId":"LOOenuj-JkNSEKSmsjq4R","email":"test-workflows-64qra3SqJjOIXDAsMMXKr@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c588c448-31c2-4cc3-84c2-375203afa0a5","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"LOOenuj-JkNSEKSmsjq4R","tenantId":"4fe1f374-56e3-4103-a7b6-87565b2fcc64","createdBy":"LOOenuj-JkNSEKSmsjq4R","ownerId":"LOOenuj-JkNSEKSmsjq4R","status":"active","archived":false,"createdAt":"2025-12-04T18:58:19.012Z","updatedAt":"2025-12-04T18:58:19.012Z"}

{"level":30,"time":1764874698112,"env":"test","module":"user-credentials-repository","userId":"-H8m_qqjEjBBptK41G8Rb","msg":"User credentials created"}
{"level":30,"time":1764874698112,"env":"test","module":"auth-routes","userId":"-H8m_qqjEjBBptK41G8Rb","email":"viewer-3NU08iOdTAmbrYRwS4x4M@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874698209,"env":"test","module":"rbac-middleware","userId":"-H8m_qqjEjBBptK41G8Rb","userRole":"viewer","permission":"workflow:create","path":"/projects/c588c448-31c2-4cc3-84c2-375203afa0a5/workflows","msg":"Permission denied"}
{"level":50,"time":1764874704933,"env":"test","error":{},"workflowId":"b7d0958a-504f-4c4b-8fee-a3b7b31e36f1","userId":"LOOenuj-JkNSEKSmsjq4R","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874705282,"env":"test","module":"auth-middleware","path":"/api/workflows/8b29801b-7dc3-4459-828d-90aa461b0359/move","msg":"No valid authentication found"}
{"level":30,"time":1764874705792,"env":"test","module":"user-credentials-repository","userId":"nALdbUfmI5JnkXhQwwwke","msg":"User credentials created"}
{"level":30,"time":1764874705793,"env":"test","module":"auth-routes","userId":"nALdbUfmI5JnkXhQwwwke","email":"test-workflows-YR9uYlouGgKGRneGm8mUK@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874705848,"env":"test","error":{},"workflowId":"8447e7cb-2ec8-47b8-b7cc-e6678da24a38","userId":"nALdbUfmI5JnkXhQwwwke","projectId":"517f501f-a01b-42a9-8b55-74cd6054c93b","msg":"Error moving workflow"}
{"level":50,"time":1764874706226,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"0792a1bc-41dc-444a-bf6c-81cca803795f","userId":"LOOenuj-JkNSEKSmsjq4R","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874706664,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c6d8bca1-a45b-48c7-879d-558c00c04a12","userId":"LOOenuj-JkNSEKSmsjq4R","msg":"Error moving workflow"}
{"level":30,"time":1764874707192,"env":"test","module":"user-credentials-repository","userId":"SZGKF-Zvg5u5saELn_Mye","msg":"User credentials created"}
{"level":30,"time":1764874707193,"env":"test","module":"auth-routes","userId":"SZGKF-Zvg5u5saELn_Mye","email":"test-workflows-6oGMai8lFa-aI5oJ-Vurp@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874707381,"env":"test","module":"auth-routes","userId":"SZGKF-Zvg5u5saELn_Mye","email":"test-workflows-6oGMai8lFa-aI5oJ-Vurp@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874707561,"env":"test","error":{},"workflowId":"52145f33-121a-4cfc-b129-ce771f172f39","userId":"LOOenuj-JkNSEKSmsjq4R","projectId":"f5e4ef6c-8571-4700-b5be-6162eb18bc14","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 1066[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 841[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 438[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 897[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 27.59s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764876566433,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876570583,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876575161,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876575162,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876575172,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876575172,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876575173,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876575173,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876575638,"env":"test","module":"user-credentials-repository","userId":"UFq4zcGJqSZDbfDfdVIMq","msg":"User credentials created"}
{"level":30,"time":1764876575641,"env":"test","module":"auth-routes","userId":"UFq4zcGJqSZDbfDfdVIMq","email":"test-workflows-yEzGCADA-yMkyT6sNYTqR@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2e3b412b-3848-4298-a49a-68d5387060c4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"UFq4zcGJqSZDbfDfdVIMq","tenantId":"fe54144b-0774-422b-8e2a-da6e8e7aa3bc","createdBy":"UFq4zcGJqSZDbfDfdVIMq","ownerId":"UFq4zcGJqSZDbfDfdVIMq","status":"active","archived":false,"createdAt":"2025-12-04T19:29:37.300Z","updatedAt":"2025-12-04T19:29:37.300Z"}

{"level":30,"time":1764876576317,"env":"test","module":"user-credentials-repository","userId":"zh0oQITRYh1iQnOS7O6mJ","msg":"User credentials created"}
{"level":30,"time":1764876576318,"env":"test","module":"auth-routes","userId":"zh0oQITRYh1iQnOS7O6mJ","email":"viewer-ozVVwIYwlpMfseOPsUM6N@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876576411,"env":"test","module":"rbac-middleware","userId":"zh0oQITRYh1iQnOS7O6mJ","userRole":"viewer","permission":"workflow:create","path":"/projects/2e3b412b-3848-4298-a49a-68d5387060c4/workflows","msg":"Permission denied"}
{"level":50,"time":1764876582648,"env":"test","error":{},"workflowId":"0c58f1cb-1271-4c50-9016-106124759588","userId":"UFq4zcGJqSZDbfDfdVIMq","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876582985,"env":"test","module":"auth-middleware","path":"/api/workflows/8d24d58b-ae58-4744-b26c-777e4c2a5fac/move","msg":"No valid authentication found"}
{"level":30,"time":1764876583494,"env":"test","module":"user-credentials-repository","userId":"jAE5pDlr8Zk3sm-NmYbku","msg":"User credentials created"}
{"level":30,"time":1764876583494,"env":"test","module":"auth-routes","userId":"jAE5pDlr8Zk3sm-NmYbku","email":"test-workflows-H3Icrf6KP_47kCpGu4Moa@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876583551,"env":"test","error":{},"workflowId":"e5c68de9-07c8-4449-9466-45c4f9c30e05","userId":"jAE5pDlr8Zk3sm-NmYbku","projectId":"2b1ba012-bceb-4436-bdae-7fb80b3db982","msg":"Error moving workflow"}
{"level":50,"time":1764876583919,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"15745087-293b-4656-8c27-d7208e3d9b6d","userId":"UFq4zcGJqSZDbfDfdVIMq","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876584269,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c5cbb927-9c59-4aab-bef6-68026b5b6094","userId":"UFq4zcGJqSZDbfDfdVIMq","msg":"Error moving workflow"}
{"level":50,"time":1764876585349,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(UFq4zcGJqSZDbfDfdVIMq) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"UFq4zcGJqSZDbfDfdVIMq","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 350[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1082[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:29:20
[2m   Duration [22m 23.83s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764876646218,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876648866,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876653400,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876653401,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876653411,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876653412,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876653412,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876653412,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876653989,"env":"test","module":"user-credentials-repository","userId":"yew3fLQgLnZDU0W4JWnuw","msg":"User credentials created"}
{"level":30,"time":1764876653994,"env":"test","module":"auth-routes","userId":"yew3fLQgLnZDU0W4JWnuw","email":"test-workflows-2zGCEPTyw7OZ8y8e0VP0v@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b12200ed-57e1-48fe-ba93-20355e4669b8","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"yew3fLQgLnZDU0W4JWnuw","tenantId":"88eade17-b2ea-48bb-96c7-ca5b2d72922a","createdBy":"yew3fLQgLnZDU0W4JWnuw","ownerId":"yew3fLQgLnZDU0W4JWnuw","status":"active","archived":false,"createdAt":"2025-12-04T19:30:55.665Z","updatedAt":"2025-12-04T19:30:55.665Z"}

{"level":30,"time":1764876654722,"env":"test","module":"user-credentials-repository","userId":"nVR0Zhxbymo4u5dCMDvhB","msg":"User credentials created"}
{"level":30,"time":1764876654723,"env":"test","module":"auth-routes","userId":"nVR0Zhxbymo4u5dCMDvhB","email":"viewer-tSzVjl-t65iV9ppcZhAD-@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876654824,"env":"test","module":"rbac-middleware","userId":"nVR0Zhxbymo4u5dCMDvhB","userRole":"viewer","permission":"workflow:create","path":"/projects/b12200ed-57e1-48fe-ba93-20355e4669b8/workflows","msg":"Permission denied"}
{"level":50,"time":1764876661437,"env":"test","error":{},"workflowId":"e90f4d22-b08c-4298-91bd-8c08b11a5d80","userId":"yew3fLQgLnZDU0W4JWnuw","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876661751,"env":"test","module":"auth-middleware","path":"/api/workflows/eff188f2-1be1-438f-a3e1-762a67a230d0/move","msg":"No valid authentication found"}
{"level":30,"time":1764876662280,"env":"test","module":"user-credentials-repository","userId":"H66jjhMhRFK6jHm54KrHi","msg":"User credentials created"}
{"level":30,"time":1764876662280,"env":"test","module":"auth-routes","userId":"H66jjhMhRFK6jHm54KrHi","email":"test-workflows-_G7FeGSwKB4QV_DAYn-UP@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876662332,"env":"test","error":{},"workflowId":"45c7d76a-68e0-4707-8760-bc47c20b6880","userId":"H66jjhMhRFK6jHm54KrHi","projectId":"31ff7869-4e68-4f97-90ec-ca535cd00a54","msg":"Error moving workflow"}
{"level":50,"time":1764876662712,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"d93cc7a9-12aa-4e20-aaad-f4cb8936eaf6","userId":"yew3fLQgLnZDU0W4JWnuw","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876663078,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ff89d430-ee1a-4eb3-bdb1-33e730d851be","userId":"yew3fLQgLnZDU0W4JWnuw","msg":"Error moving workflow"}
{"level":30,"time":1764876663596,"env":"test","module":"user-credentials-repository","userId":"HhB5_igIIBfjdet--YvDK","msg":"User credentials created"}
{"level":30,"time":1764876663597,"env":"test","module":"auth-routes","userId":"HhB5_igIIBfjdet--YvDK","email":"test-workflows-fqucqNIsCHFeAmar7yC3A@example.com","msg":"User registered successfully"}
{"level":30,"time":1764876663785,"env":"test","module":"auth-routes","userId":"HhB5_igIIBfjdet--YvDK","email":"test-workflows-fqucqNIsCHFeAmar7yC3A@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764876663975,"env":"test","error":{},"workflowId":"014c85f4-d196-47c3-9443-3c80ba93eeea","userId":"yew3fLQgLnZDU0W4JWnuw","projectId":"c085015b-4e47-4be7-bf5f-78fdf3f0e6ca","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11145[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 742[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 652[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 898[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:30:40
[2m   Duration [22m 22.52s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764877227587,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877230764,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877235220,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877235221,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877235242,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877235242,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877235242,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877235242,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877235770,"env":"test","module":"user-credentials-repository","userId":"C5SXPyuSKLe_Uc2IeOcVR","msg":"User credentials created"}
{"level":30,"time":1764877235775,"env":"test","module":"auth-routes","userId":"C5SXPyuSKLe_Uc2IeOcVR","email":"test-workflows--JRCrArf5J9hjHs9rL18Q@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"044a00dc-1017-42fd-b60c-89bab2273c87","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"C5SXPyuSKLe_Uc2IeOcVR","tenantId":"0c8b2784-6943-4a06-a90c-c5c859afda09","createdBy":"C5SXPyuSKLe_Uc2IeOcVR","ownerId":"C5SXPyuSKLe_Uc2IeOcVR","status":"active","archived":false,"createdAt":"2025-12-04T19:40:37.446Z","updatedAt":"2025-12-04T19:40:37.446Z"}

{"level":30,"time":1764877236451,"env":"test","module":"user-credentials-repository","userId":"tQtKt47OJ4WjJpJIku25h","msg":"User credentials created"}
{"level":30,"time":1764877236452,"env":"test","module":"auth-routes","userId":"tQtKt47OJ4WjJpJIku25h","email":"viewer-sg1kCEeeZkn653VOHHQlK@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877236546,"env":"test","module":"rbac-middleware","userId":"tQtKt47OJ4WjJpJIku25h","userRole":"viewer","permission":"workflow:create","path":"/projects/044a00dc-1017-42fd-b60c-89bab2273c87/workflows","msg":"Permission denied"}
{"level":50,"time":1764877242663,"env":"test","error":{},"workflowId":"d97f134b-e2b3-4b69-9f54-f45e704efd09","userId":"C5SXPyuSKLe_Uc2IeOcVR","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877242983,"env":"test","module":"auth-middleware","path":"/api/workflows/ffd00f22-356f-42dc-b9d1-33b2b00de115/move","msg":"No valid authentication found"}
{"level":30,"time":1764877243491,"env":"test","module":"user-credentials-repository","userId":"76wjSSmogXprtzHxQgBch","msg":"User credentials created"}
{"level":30,"time":1764877243492,"env":"test","module":"auth-routes","userId":"76wjSSmogXprtzHxQgBch","email":"test-workflows-wzsMBHaMdwizXbTDGvRLf@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877243539,"env":"test","error":{},"workflowId":"13f01565-0221-4604-b134-af3b0fff2195","userId":"76wjSSmogXprtzHxQgBch","projectId":"7d9b964a-2cc2-45f6-b896-5e95f5b36766","msg":"Error moving workflow"}
{"level":50,"time":1764877243912,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"e0f2aabb-8702-4e3a-9346-de645fa93dd2","userId":"C5SXPyuSKLe_Uc2IeOcVR","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877244274,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2ea7b568-cad7-4ee0-882a-978bb2222e76","userId":"C5SXPyuSKLe_Uc2IeOcVR","msg":"Error moving workflow"}
{"level":30,"time":1764877244787,"env":"test","module":"user-credentials-repository","userId":"Ng3swJ2N7tZ4VuOJul9-Y","msg":"User credentials created"}
{"level":30,"time":1764877244788,"env":"test","module":"auth-routes","userId":"Ng3swJ2N7tZ4VuOJul9-Y","email":"test-workflows-2ssDkKdzbP7Yf6nDGe36Z@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877244983,"env":"test","module":"auth-routes","userId":"Ng3swJ2N7tZ4VuOJul9-Y","email":"test-workflows-2ssDkKdzbP7Yf6nDGe36Z@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877245169,"env":"test","error":{},"workflowId":"4c9d2fd4-eee7-466c-ab94-2540f2235142","userId":"C5SXPyuSKLe_Uc2IeOcVR","projectId":"69823811-633c-45eb-9557-e3c3f8a181c4","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10200[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 328[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 625[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 426[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 362[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 897[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:40:22
[2m   Duration [22m 22.27s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/googleAuth.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764877489310,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877492434,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877496555,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877496556,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877496569,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877496569,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877496569,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877496569,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877497090,"env":"test","module":"user-credentials-repository","userId":"60CoBXctg5cIB7ncikCV6","msg":"User credentials created"}
{"level":30,"time":1764877497093,"env":"test","module":"auth-routes","userId":"60CoBXctg5cIB7ncikCV6","email":"test-workflows-G0JPAMLoHIBVWq3m9Yifm@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b81f790c-a56c-4d92-96ef-9ade7d16fb27","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"60CoBXctg5cIB7ncikCV6","tenantId":"9a794ea5-6ac0-481a-a340-b9a117ad2d95","createdBy":"60CoBXctg5cIB7ncikCV6","ownerId":"60CoBXctg5cIB7ncikCV6","status":"active","archived":false,"createdAt":"2025-12-04T19:44:58.772Z","updatedAt":"2025-12-04T19:44:58.772Z"}

{"level":30,"time":1764877497785,"env":"test","module":"user-credentials-repository","userId":"p1cWwgEioD3uP4Zkh4kmJ","msg":"User credentials created"}
{"level":30,"time":1764877497786,"env":"test","module":"auth-routes","userId":"p1cWwgEioD3uP4Zkh4kmJ","email":"viewer-koPiy7LjrgXLGv28Y5197@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877497886,"env":"test","module":"rbac-middleware","userId":"p1cWwgEioD3uP4Zkh4kmJ","userRole":"viewer","permission":"workflow:create","path":"/projects/b81f790c-a56c-4d92-96ef-9ade7d16fb27/workflows","msg":"Permission denied"}
{"level":50,"time":1764877504471,"env":"test","error":{},"workflowId":"43ad8757-d6d6-4921-b010-8e207bb349e5","userId":"60CoBXctg5cIB7ncikCV6","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877504797,"env":"test","module":"auth-middleware","path":"/api/workflows/2aa303bd-ea1f-42a5-9840-c9e9817c4407/move","msg":"No valid authentication found"}
{"level":30,"time":1764877505308,"env":"test","module":"user-credentials-repository","userId":"_fyCPAZOUE1DIhim8DxqP","msg":"User credentials created"}
{"level":30,"time":1764877505308,"env":"test","module":"auth-routes","userId":"_fyCPAZOUE1DIhim8DxqP","email":"test-workflows-b7Ga1WYiniIpyNAD9Y8XH@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877505359,"env":"test","error":{},"workflowId":"8e6519de-ccf6-4d6b-8d89-820bc1457ce4","userId":"_fyCPAZOUE1DIhim8DxqP","projectId":"b71c1dbb-04bc-4e7a-bfc3-e1e5c4d5a845","msg":"Error moving workflow"}
{"level":50,"time":1764877505728,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8cacb3eb-eba0-49d2-bbf2-1b3e3e08738b","userId":"60CoBXctg5cIB7ncikCV6","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877506108,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"751b3b90-2dcb-4a42-9c56-3bed32fb07c0","userId":"60CoBXctg5cIB7ncikCV6","msg":"Error moving workflow"}
{"level":30,"time":1764877506640,"env":"test","module":"user-credentials-repository","userId":"VhJTwZS7Q2dyDzbcfekzb","msg":"User credentials created"}
{"level":30,"time":1764877506641,"env":"test","module":"auth-routes","userId":"VhJTwZS7Q2dyDzbcfekzb","email":"test-workflows-7GplCbt0aYj2mproNvMSv@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877506833,"env":"test","module":"auth-routes","userId":"VhJTwZS7Q2dyDzbcfekzb","email":"test-workflows-7GplCbt0aYj2mproNvMSv@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877507033,"env":"test","error":{},"workflowId":"521ff745-8d2b-4c6b-b3a0-fc669d880189","userId":"60CoBXctg5cIB7ncikCV6","projectId":"5f3211cf-50ec-4484-bb42-04b2a770c6d4","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10815[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 498[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 982[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 652[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 784[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 925[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:44:44
[2m   Duration [22m 22.17s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764877823005,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877826381,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877829964,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877829965,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877829979,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877829979,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877829980,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877829980,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877830518,"env":"test","module":"user-credentials-repository","userId":"bJS_tTMtzRVZ-bqXont9L","msg":"User credentials created"}
{"level":30,"time":1764877830522,"env":"test","module":"auth-routes","userId":"bJS_tTMtzRVZ-bqXont9L","email":"test-workflows-ZBBX9pp-9RcBMi23jOgLe@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"1e946ac4-be98-4cd2-b889-28c0c2648ba9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"bJS_tTMtzRVZ-bqXont9L","tenantId":"5cca5299-99a5-48f5-be3f-a4866a877489","createdBy":"bJS_tTMtzRVZ-bqXont9L","ownerId":"bJS_tTMtzRVZ-bqXont9L","status":"active","archived":false,"createdAt":"2025-12-04T19:50:32.203Z","updatedAt":"2025-12-04T19:50:32.203Z"}

{"level":30,"time":1764877831234,"env":"test","module":"user-credentials-repository","userId":"R3kcZ98yzlyVTBGiPbEaE","msg":"User credentials created"}
{"level":30,"time":1764877831234,"env":"test","module":"auth-routes","userId":"R3kcZ98yzlyVTBGiPbEaE","email":"viewer-1BW-tI_WtTprPdMnAm2t1@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877831332,"env":"test","module":"rbac-middleware","userId":"R3kcZ98yzlyVTBGiPbEaE","userRole":"viewer","permission":"workflow:create","path":"/projects/1e946ac4-be98-4cd2-b889-28c0c2648ba9/workflows","msg":"Permission denied"}
{"level":50,"time":1764877837652,"env":"test","error":{},"workflowId":"86e235a2-df46-45da-bf0c-72e60a0abcd5","userId":"bJS_tTMtzRVZ-bqXont9L","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877837994,"env":"test","module":"auth-middleware","path":"/api/workflows/9d5211af-cbbe-492a-b1f5-4a570b096fa1/move","msg":"No valid authentication found"}
{"level":30,"time":1764877838583,"env":"test","module":"user-credentials-repository","userId":"Ei1KEUW9a-BwEqNnSpzP9","msg":"User credentials created"}
{"level":30,"time":1764877838583,"env":"test","module":"auth-routes","userId":"Ei1KEUW9a-BwEqNnSpzP9","email":"test-workflows-QP2Fr5SPSfEHRl19WA7dv@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877838635,"env":"test","error":{},"workflowId":"8e4ac758-d37e-4e73-acfd-8596c793cb11","userId":"Ei1KEUW9a-BwEqNnSpzP9","projectId":"1b3531c2-ba38-4768-9d02-eff72a6813bf","msg":"Error moving workflow"}
{"level":50,"time":1764877839016,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b5102e54-f0a1-4b93-947b-c0496bdc75cf","userId":"bJS_tTMtzRVZ-bqXont9L","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877839488,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4e094a14-e513-4e2c-bff0-7ae3537f34fa","userId":"bJS_tTMtzRVZ-bqXont9L","msg":"Error moving workflow"}
{"level":50,"time":1764877840044,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(mhD0aBBr9rw2tceDRkt0q) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"mhD0aBBr9rw2tceDRkt0q","msg":"Failed to create user credentials"}
{"level":50,"time":1764877840044,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(mhD0aBBr9rw2tceDRkt0q) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10510[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 472[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 557[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:18
[2m   Duration [22m 21.67s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764877846334,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877848793,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877850948,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877850949,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877850960,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877850960,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877850960,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877850960,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877851431,"env":"test","module":"user-credentials-repository","userId":"e6xhxaUON_vsm3RhlELzG","msg":"User credentials created"}
{"level":30,"time":1764877851434,"env":"test","module":"auth-routes","userId":"e6xhxaUON_vsm3RhlELzG","email":"test-workflows-fVoUtltp4Xe5DI4yk4xx6@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"67500714-0179-4472-ac16-4157e188948d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"e6xhxaUON_vsm3RhlELzG","tenantId":"75ebc632-5c21-49bb-8564-e4a362a78c1d","createdBy":"e6xhxaUON_vsm3RhlELzG","ownerId":"e6xhxaUON_vsm3RhlELzG","status":"active","archived":false,"createdAt":"2025-12-04T19:50:53.120Z","updatedAt":"2025-12-04T19:50:53.120Z"}

{"level":30,"time":1764877852154,"env":"test","module":"user-credentials-repository","userId":"JoLs7HUf_o5j16BWPIZWt","msg":"User credentials created"}
{"level":30,"time":1764877852155,"env":"test","module":"auth-routes","userId":"JoLs7HUf_o5j16BWPIZWt","email":"viewer--x0hI7knwZnhVJFXOlTzL@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877852259,"env":"test","module":"rbac-middleware","userId":"JoLs7HUf_o5j16BWPIZWt","userRole":"viewer","permission":"workflow:create","path":"/projects/67500714-0179-4472-ac16-4157e188948d/workflows","msg":"Permission denied"}
{"level":50,"time":1764877858845,"env":"test","error":{},"workflowId":"3d9a218a-e4e1-4598-b35b-4b170060d764","userId":"e6xhxaUON_vsm3RhlELzG","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877859362,"env":"test","module":"auth-middleware","path":"/api/workflows/d59cfb00-08e1-4c1c-ae7d-c4912aee42f4/move","msg":"No valid authentication found"}
{"level":30,"time":1764877859922,"env":"test","module":"user-credentials-repository","userId":"2kkvYgFnTEUncv4NA0skA","msg":"User credentials created"}
{"level":30,"time":1764877859923,"env":"test","module":"auth-routes","userId":"2kkvYgFnTEUncv4NA0skA","email":"test-workflows-oMVwod1urQTPIL49DVyPI@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877859973,"env":"test","error":{},"workflowId":"63fc6323-1bff-4ef3-b837-7cb087c8ddd6","userId":"2kkvYgFnTEUncv4NA0skA","projectId":"97bf9394-a0be-4eb7-a0d9-a0e141282d16","msg":"Error moving workflow"}
{"level":50,"time":1764877860361,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"531c76c4-39fc-4263-8925-c2b676f604b7","userId":"e6xhxaUON_vsm3RhlELzG","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877860879,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9f599fce-c111-466a-8562-f6dcf3665a67","userId":"e6xhxaUON_vsm3RhlELzG","msg":"Error moving workflow"}
{"level":30,"time":1764877861432,"env":"test","module":"user-credentials-repository","userId":"WjsZjlrlR1RsAiY-ecAXK","msg":"User credentials created"}
{"level":30,"time":1764877861433,"env":"test","module":"auth-routes","userId":"WjsZjlrlR1RsAiY-ecAXK","email":"test-workflows-OjuqbDha60CdVmarLrLnV@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877861536,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764877861589,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"936afa7a-9a4c-402d-a46a-7d76b927128c","userId":"e6xhxaUON_vsm3RhlELzG","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10930[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 496[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 854[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 811[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 655[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 769[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 516[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 519[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 712[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:40
[2m   Duration [22m 19.77s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764877866554,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877869424,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877872805,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877872806,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877872818,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877872818,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877872819,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877872819,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877873299,"env":"test","module":"user-credentials-repository","userId":"y4HZdkSnOMDy1cybP2blG","msg":"User credentials created"}
{"level":30,"time":1764877873302,"env":"test","module":"auth-routes","userId":"y4HZdkSnOMDy1cybP2blG","email":"test-workflows-crRfiK_Uw0cwlB_PRmoTp@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"196ea173-cd57-46c5-806c-212a45c2c881","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"y4HZdkSnOMDy1cybP2blG","tenantId":"3363cb84-d96f-4938-bce1-e0a003623a78","createdBy":"y4HZdkSnOMDy1cybP2blG","ownerId":"y4HZdkSnOMDy1cybP2blG","status":"active","archived":false,"createdAt":"2025-12-04T19:51:14.984Z","updatedAt":"2025-12-04T19:51:14.984Z"}

{"level":30,"time":1764877874005,"env":"test","module":"user-credentials-repository","userId":"wK05-QQUsSAihBZTe4iFP","msg":"User credentials created"}
{"level":30,"time":1764877874006,"env":"test","module":"auth-routes","userId":"wK05-QQUsSAihBZTe4iFP","email":"viewer-tJsPdCWsq1mSZowLctgGa@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877874106,"env":"test","module":"rbac-middleware","userId":"wK05-QQUsSAihBZTe4iFP","userRole":"viewer","permission":"workflow:create","path":"/projects/196ea173-cd57-46c5-806c-212a45c2c881/workflows","msg":"Permission denied"}
{"level":50,"time":1764877880241,"env":"test","error":{},"workflowId":"85865a62-ed92-416a-b416-7fd31c5626e2","userId":"y4HZdkSnOMDy1cybP2blG","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877880556,"env":"test","module":"auth-middleware","path":"/api/workflows/49433769-ee0d-49bd-8cdc-6b8ba294a6af/move","msg":"No valid authentication found"}
{"level":30,"time":1764877881051,"env":"test","module":"user-credentials-repository","userId":"AkzIGunEqK0JUq7qGurby","msg":"User credentials created"}
{"level":30,"time":1764877881051,"env":"test","module":"auth-routes","userId":"AkzIGunEqK0JUq7qGurby","email":"test-workflows-SrhxhIHjhKJbWvv-GcS82@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877881103,"env":"test","error":{},"workflowId":"a5fc2b50-2b3d-41a8-b21c-c72f837453f6","userId":"AkzIGunEqK0JUq7qGurby","projectId":"2105c58a-98e0-4fbe-8e9b-b175f8284044","msg":"Error moving workflow"}
{"level":50,"time":1764877881486,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"251345ef-e4c7-4362-900f-ed3aa2d383ef","userId":"y4HZdkSnOMDy1cybP2blG","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877881856,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"40f78b68-d587-4e63-bd1c-2ba2e9c9c72b","userId":"y4HZdkSnOMDy1cybP2blG","msg":"Error moving workflow"}
{"level":30,"time":1764877882367,"env":"test","module":"user-credentials-repository","userId":"Tdx5Dhbflk0S36bOC294s","msg":"User credentials created"}
{"level":30,"time":1764877882368,"env":"test","module":"auth-routes","userId":"Tdx5Dhbflk0S36bOC294s","email":"test-workflows-wByBxJbvQz5NVFt_pYTNq@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877882550,"env":"test","module":"auth-routes","userId":"Tdx5Dhbflk0S36bOC294s","email":"test-workflows-wByBxJbvQz5NVFt_pYTNq@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877882783,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"597ee6ea-48b1-447a-9238-5b8260590720","userId":"y4HZdkSnOMDy1cybP2blG","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10236[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 699[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 929[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:51:01
[2m   Duration [22m 20.03s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764879993666,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764879997841,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880001701,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880001702,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880001711,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880001711,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880001711,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880001711,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880002209,"env":"test","module":"user-credentials-repository","userId":"s2A7ViHMehHx6Fwqi3DOz","msg":"User credentials created"}
{"level":30,"time":1764880002212,"env":"test","module":"auth-routes","userId":"s2A7ViHMehHx6Fwqi3DOz","email":"test-workflows-Dz7J_6vshBANJUuHeDPp3@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"24092fa7-d0e3-4a57-acd4-ba877398c5f7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"s2A7ViHMehHx6Fwqi3DOz","tenantId":"036ff8e9-decf-403c-848a-270f86cebfdb","createdBy":"s2A7ViHMehHx6Fwqi3DOz","ownerId":"s2A7ViHMehHx6Fwqi3DOz","status":"active","archived":false,"createdAt":"2025-12-04T20:26:43.922Z","updatedAt":"2025-12-04T20:26:43.922Z"}

{"level":30,"time":1764880002857,"env":"test","module":"user-credentials-repository","userId":"jvE1sqIpEzTJcLJ1xWxQt","msg":"User credentials created"}
{"level":30,"time":1764880002858,"env":"test","module":"auth-routes","userId":"jvE1sqIpEzTJcLJ1xWxQt","email":"viewer-yqlGiS5DRyRsAhYk_5fnc@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880002946,"env":"test","module":"rbac-middleware","userId":"jvE1sqIpEzTJcLJ1xWxQt","userRole":"viewer","permission":"workflow:create","path":"/projects/24092fa7-d0e3-4a57-acd4-ba877398c5f7/workflows","msg":"Permission denied"}
{"level":50,"time":1764880009003,"env":"test","error":{},"workflowId":"67badf31-178e-4cbc-9822-20f791d1695f","userId":"s2A7ViHMehHx6Fwqi3DOz","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880009313,"env":"test","module":"auth-middleware","path":"/api/workflows/ac9382b6-cddd-4e6e-a202-cbfb91dc0ee7/move","msg":"No valid authentication found"}
{"level":30,"time":1764880009806,"env":"test","module":"user-credentials-repository","userId":"jc1Vdp6nNloQXYPr17u_N","msg":"User credentials created"}
{"level":30,"time":1764880009807,"env":"test","module":"auth-routes","userId":"jc1Vdp6nNloQXYPr17u_N","email":"test-workflows-EDYjb6MVFoEBayA58sJYk@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880009858,"env":"test","error":{},"workflowId":"6631beed-3bc7-44cb-8029-54bb74d9bbd0","userId":"jc1Vdp6nNloQXYPr17u_N","projectId":"01368358-4e06-4a49-89a5-957c570a15d1","msg":"Error moving workflow"}
{"level":50,"time":1764880010208,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2327af6a-79a2-432d-acf0-f7396716069b","userId":"s2A7ViHMehHx6Fwqi3DOz","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880010555,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9e242fb5-4a16-4d83-b1fd-f99138228804","userId":"s2A7ViHMehHx6Fwqi3DOz","msg":"Error moving workflow"}
{"level":30,"time":1764880011025,"env":"test","module":"user-credentials-repository","userId":"GrveQTFUzsERgQ2Tyl-mY","msg":"User credentials created"}
{"level":30,"time":1764880011026,"env":"test","module":"auth-routes","userId":"GrveQTFUzsERgQ2Tyl-mY","email":"test-workflows-ZnqwuLnf0r-IzhMfXZK-7@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880011214,"env":"test","module":"auth-routes","userId":"GrveQTFUzsERgQ2Tyl-mY","email":"test-workflows-ZnqwuLnf0r-IzhMfXZK-7@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880011393,"env":"test","error":{},"workflowId":"757b5b23-939d-497c-9322-f5515e5bf84f","userId":"s2A7ViHMehHx6Fwqi3DOz","projectId":"80a952ee-2fd2-4c68-b8d0-c2b4aa8968d9","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9958[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 275[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 684[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 688[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 347[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 840[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:29
[2m   Duration [22m 21.06s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880015795,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880018935,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880022837,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880022838,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880022849,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880022849,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880022850,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880022850,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880023406,"env":"test","module":"user-credentials-repository","userId":"v02mvMxH8__QLHmpzx4qr","msg":"User credentials created"}
{"level":30,"time":1764880023410,"env":"test","module":"auth-routes","userId":"v02mvMxH8__QLHmpzx4qr","email":"test-workflows-s6mK15-TNbaiTi9q-FPrh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"10df7be6-bd05-4a4f-967e-38e989fa3bdb","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"v02mvMxH8__QLHmpzx4qr","tenantId":"5fdd6d84-126d-439e-ad79-84697aca1f46","createdBy":"v02mvMxH8__QLHmpzx4qr","ownerId":"v02mvMxH8__QLHmpzx4qr","status":"active","archived":false,"createdAt":"2025-12-04T20:27:05.134Z","updatedAt":"2025-12-04T20:27:05.134Z"}

{"level":30,"time":1764880024125,"env":"test","module":"user-credentials-repository","userId":"03mi_OBctKgd5FEjanCQp","msg":"User credentials created"}
{"level":30,"time":1764880024126,"env":"test","module":"auth-routes","userId":"03mi_OBctKgd5FEjanCQp","email":"viewer-zzoOjlLn3OXkGxbJyvLZ3@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880024227,"env":"test","module":"rbac-middleware","userId":"03mi_OBctKgd5FEjanCQp","userRole":"viewer","permission":"workflow:create","path":"/projects/10df7be6-bd05-4a4f-967e-38e989fa3bdb/workflows","msg":"Permission denied"}
{"level":50,"time":1764880030626,"env":"test","error":{},"workflowId":"64ee7040-8842-4669-87be-c6fb751ebfd5","userId":"v02mvMxH8__QLHmpzx4qr","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880030944,"env":"test","module":"auth-middleware","path":"/api/workflows/1c5223bc-6451-4f6d-b33a-64176153d0a7/move","msg":"No valid authentication found"}
{"level":30,"time":1764880031451,"env":"test","module":"user-credentials-repository","userId":"k2cxzqjbml2N3wZwua0bw","msg":"User credentials created"}
{"level":30,"time":1764880031451,"env":"test","module":"auth-routes","userId":"k2cxzqjbml2N3wZwua0bw","email":"test-workflows-VzTVg11cwZwl7sRvnOzcE@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880031501,"env":"test","error":{},"workflowId":"a6851964-dbfb-496d-8775-236dcbd57b0b","userId":"k2cxzqjbml2N3wZwua0bw","projectId":"5241fff4-dee1-4668-b905-a4ac8445870f","msg":"Error moving workflow"}
{"level":50,"time":1764880031867,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"4a1e31dc-8142-4313-9b23-d20c392f2c17","userId":"v02mvMxH8__QLHmpzx4qr","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880032244,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"aca3785f-023b-40b1-bd77-d7d6b331a66e","userId":"v02mvMxH8__QLHmpzx4qr","msg":"Error moving workflow"}
{"level":30,"time":1764880032787,"env":"test","module":"user-credentials-repository","userId":"cnrForn3WDtmpRZP5xxPm","msg":"User credentials created"}
{"level":30,"time":1764880032788,"env":"test","module":"auth-routes","userId":"cnrForn3WDtmpRZP5xxPm","email":"test-workflows-XlqaSXXuAAvrfTCfg46w_@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880032973,"env":"test","module":"auth-routes","userId":"cnrForn3WDtmpRZP5xxPm","email":"test-workflows-XlqaSXXuAAvrfTCfg46w_@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880033164,"env":"test","error":{},"workflowId":"4a4d5ffd-f531-497a-a8c5-c6fd0f1d0f20","userId":"v02mvMxH8__QLHmpzx4qr","projectId":"c18e2ad7-b1c4-4e9e-8842-87275ae7fd12","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10664[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 345[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 504[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 673[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 444[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 367[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 377[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 920[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:51
[2m   Duration [22m 21.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764880066982,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880070747,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880074890,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880074891,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880074902,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880074902,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880074902,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880074902,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880075400,"env":"test","module":"user-credentials-repository","userId":"46pRJ_HjiFnfNycZu79MM","msg":"User credentials created"}
{"level":30,"time":1764880075403,"env":"test","module":"auth-routes","userId":"46pRJ_HjiFnfNycZu79MM","email":"test-workflows-QBfPHCS3Xy3SbUeD8KExC@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2b8945bf-0cf8-40d9-8fb1-6bd5c5678afa","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"46pRJ_HjiFnfNycZu79MM","tenantId":"46bacad5-4998-462f-87e6-b255722e2dc2","createdBy":"46pRJ_HjiFnfNycZu79MM","ownerId":"46pRJ_HjiFnfNycZu79MM","status":"active","archived":false,"createdAt":"2025-12-04T20:27:57.129Z","updatedAt":"2025-12-04T20:27:57.129Z"}

{"level":30,"time":1764880076109,"env":"test","module":"user-credentials-repository","userId":"0YjEQ1bIl-tKYnAahLp9W","msg":"User credentials created"}
{"level":30,"time":1764880076109,"env":"test","module":"auth-routes","userId":"0YjEQ1bIl-tKYnAahLp9W","email":"viewer-dxXbknPwPSELi-Hj7SSt4@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880076202,"env":"test","module":"rbac-middleware","userId":"0YjEQ1bIl-tKYnAahLp9W","userRole":"viewer","permission":"workflow:create","path":"/projects/2b8945bf-0cf8-40d9-8fb1-6bd5c5678afa/workflows","msg":"Permission denied"}
{"level":50,"time":1764880082509,"env":"test","error":{},"workflowId":"970dc054-8dd0-46f0-a764-a0df019f4d86","userId":"46pRJ_HjiFnfNycZu79MM","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880082833,"env":"test","module":"auth-middleware","path":"/api/workflows/e08a8440-9e2e-4667-a2af-8ff550dacf98/move","msg":"No valid authentication found"}
{"level":30,"time":1764880083348,"env":"test","module":"user-credentials-repository","userId":"NpZxnfu9_5XKZ1-UdO_0G","msg":"User credentials created"}
{"level":30,"time":1764880083349,"env":"test","module":"auth-routes","userId":"NpZxnfu9_5XKZ1-UdO_0G","email":"test-workflows-jy4a2k2gRBoVeb894ydcF@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880083392,"env":"test","error":{},"workflowId":"181133e7-2046-434f-82c3-a31251ee171a","userId":"NpZxnfu9_5XKZ1-UdO_0G","projectId":"4a0f2b67-6c35-4487-b92a-5709cdbfc796","msg":"Error moving workflow"}
{"level":50,"time":1764880083759,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"e6ddcb05-f04e-4707-848a-c101760c769b","userId":"46pRJ_HjiFnfNycZu79MM","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880084129,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f073b968-7ad9-4c95-9a75-881a830d8b2a","userId":"46pRJ_HjiFnfNycZu79MM","msg":"Error moving workflow"}
{"level":30,"time":1764880084674,"env":"test","module":"user-credentials-repository","userId":"g-J5yMcxlY29lD14SL0Mn","msg":"User credentials created"}
{"level":30,"time":1764880084675,"env":"test","module":"auth-routes","userId":"g-J5yMcxlY29lD14SL0Mn","email":"test-workflows-7Rb_8TAd5JVClzO9boAmx@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880084874,"env":"test","module":"auth-routes","userId":"g-J5yMcxlY29lD14SL0Mn","email":"test-workflows-7Rb_8TAd5JVClzO9boAmx@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880085105,"env":"test","error":{},"workflowId":"b31636ee-3ce1-405a-8637-7d18516a0ce4","userId":"46pRJ_HjiFnfNycZu79MM","projectId":"f98376a4-7bb8-4f68-a33a-ae352182612f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10503[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 589[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 670[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 367[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 978[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:27:42
[2m   Duration [22m 22.09s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764880090617,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880093557,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880096296,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880096296,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880096306,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880096306,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880096307,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880096307,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880096784,"env":"test","module":"user-credentials-repository","userId":"9uV4esYTP8Fnzlrup0Avt","msg":"User credentials created"}
{"level":30,"time":1764880096788,"env":"test","module":"auth-routes","userId":"9uV4esYTP8Fnzlrup0Avt","email":"test-workflows-czDOF8KOYDR7blH3vbaqg@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d7053919-b8f5-4ca8-8132-e794d59c4385","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"9uV4esYTP8Fnzlrup0Avt","tenantId":"a536e131-da96-419c-a407-31db5534ac7c","createdBy":"9uV4esYTP8Fnzlrup0Avt","ownerId":"9uV4esYTP8Fnzlrup0Avt","status":"active","archived":false,"createdAt":"2025-12-04T20:28:18.513Z","updatedAt":"2025-12-04T20:28:18.513Z"}

{"level":30,"time":1764880097491,"env":"test","module":"user-credentials-repository","userId":"EUrh-10n4vzasPw2eimbf","msg":"User credentials created"}
{"level":30,"time":1764880097493,"env":"test","module":"auth-routes","userId":"EUrh-10n4vzasPw2eimbf","email":"viewer-CAwAIjXydThR1YrLTR-WS@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880097593,"env":"test","module":"rbac-middleware","userId":"EUrh-10n4vzasPw2eimbf","userRole":"viewer","permission":"workflow:create","path":"/projects/d7053919-b8f5-4ca8-8132-e794d59c4385/workflows","msg":"Permission denied"}
{"level":50,"time":1764880103985,"env":"test","error":{},"workflowId":"75666bba-32b6-424e-8547-67b554abd588","userId":"9uV4esYTP8Fnzlrup0Avt","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880104334,"env":"test","module":"auth-middleware","path":"/api/workflows/6829314e-9e0d-46e0-9962-2cf72840b1a7/move","msg":"No valid authentication found"}
{"level":30,"time":1764880104874,"env":"test","module":"user-credentials-repository","userId":"-4caQBxm1qVVX5BPQp5D6","msg":"User credentials created"}
{"level":30,"time":1764880104874,"env":"test","module":"auth-routes","userId":"-4caQBxm1qVVX5BPQp5D6","email":"test-workflows-xI_85DQAQXc0ZF7CZUoRb@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880104970,"env":"test","error":{},"workflowId":"768a2025-0092-45f5-bb3f-933e7f3d74cc","userId":"-4caQBxm1qVVX5BPQp5D6","projectId":"ac8ccb9a-3e40-4038-a5ba-f37c98201efd","msg":"Error moving workflow"}
{"level":50,"time":1764880105326,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"a94485ca-4dc7-49da-a63d-a091dca79fdc","userId":"9uV4esYTP8Fnzlrup0Avt","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880105694,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"27abd310-23d3-4dab-95ce-cfd28aa82a79","userId":"9uV4esYTP8Fnzlrup0Avt","msg":"Error moving workflow"}
{"level":30,"time":1764880106206,"env":"test","module":"user-credentials-repository","userId":"qmAnQyKNSEKHdsOnTULhp","msg":"User credentials created"}
{"level":30,"time":1764880106207,"env":"test","module":"auth-routes","userId":"qmAnQyKNSEKHdsOnTULhp","email":"test-workflows-jsuncvPs0GHLW0KBhqq5L@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880106295,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764880106344,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d98cb2a7-3214-4c97-84ea-afa7f48c560c","userId":"9uV4esYTP8Fnzlrup0Avt","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 801[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 348[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 354[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 650[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:05
[2m   Duration [22m 20.12s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764880109515,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880111569,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880113854,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880113855,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880113865,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880113865,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880113865,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880113865,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880114298,"env":"test","module":"user-credentials-repository","userId":"nm1hBjLYXrPFx_U0J0CEx","msg":"User credentials created"}
{"level":30,"time":1764880114301,"env":"test","module":"auth-routes","userId":"nm1hBjLYXrPFx_U0J0CEx","email":"test-workflows-_s6867MQTWmnkwA9ruTSz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d20a1580-5771-4ac3-bad1-4c0e4c69b4b5","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"nm1hBjLYXrPFx_U0J0CEx","tenantId":"8c5943b6-8ad7-49f6-ad92-caf917cf93c8","createdBy":"nm1hBjLYXrPFx_U0J0CEx","ownerId":"nm1hBjLYXrPFx_U0J0CEx","status":"active","archived":false,"createdAt":"2025-12-04T20:28:36.010Z","updatedAt":"2025-12-04T20:28:36.010Z"}

{"level":30,"time":1764880114945,"env":"test","module":"user-credentials-repository","userId":"cwuv4stUcem64WhaaK6bI","msg":"User credentials created"}
{"level":30,"time":1764880114946,"env":"test","module":"auth-routes","userId":"cwuv4stUcem64WhaaK6bI","email":"viewer-m_hyadFyZsfs06AuvFL0X@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880115041,"env":"test","module":"rbac-middleware","userId":"cwuv4stUcem64WhaaK6bI","userRole":"viewer","permission":"workflow:create","path":"/projects/d20a1580-5771-4ac3-bad1-4c0e4c69b4b5/workflows","msg":"Permission denied"}
{"level":50,"time":1764880120950,"env":"test","error":{},"workflowId":"52a5b542-faa7-4d50-88db-211284126dd5","userId":"nm1hBjLYXrPFx_U0J0CEx","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880121245,"env":"test","module":"auth-middleware","path":"/api/workflows/e5536e2f-713f-4bde-9d5d-63d4f345593d/move","msg":"No valid authentication found"}
{"level":30,"time":1764880121743,"env":"test","module":"user-credentials-repository","userId":"AxmjmqxRvk_oKzSUNCzWm","msg":"User credentials created"}
{"level":30,"time":1764880121743,"env":"test","module":"auth-routes","userId":"AxmjmqxRvk_oKzSUNCzWm","email":"test-workflows-buJvwG8QTOqTYiNx97LXz@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880121783,"env":"test","error":{},"workflowId":"82b3317a-5dd7-4a79-ba5f-ceba2e0a5b77","userId":"AxmjmqxRvk_oKzSUNCzWm","projectId":"0de15d12-720c-4d73-89af-8e35d102a4d2","msg":"Error moving workflow"}
{"level":50,"time":1764880122151,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6ac3918a-216b-45f0-a857-366d845a700b","userId":"nm1hBjLYXrPFx_U0J0CEx","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880122483,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bcc280ad-6ee0-474c-b34b-43046c770980","userId":"nm1hBjLYXrPFx_U0J0CEx","msg":"Error moving workflow"}
{"level":30,"time":1764880122988,"env":"test","module":"user-credentials-repository","userId":"kswwbm6uQCQsAdnc4CkG9","msg":"User credentials created"}
{"level":30,"time":1764880122989,"env":"test","module":"auth-routes","userId":"kswwbm6uQCQsAdnc4CkG9","email":"test-workflows-xrV3Wgib7mVOPQO6jvWdy@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880123175,"env":"test","module":"auth-routes","userId":"kswwbm6uQCQsAdnc4CkG9","email":"test-workflows-xrV3Wgib7mVOPQO6jvWdy@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880123351,"env":"test","error":{},"workflowId":"7a399a3a-3dc6-4acd-94c0-e63997611700","userId":"nm1hBjLYXrPFx_U0J0CEx","projectId":"f7af6e25-43af-4c7f-9ab2-020512343252","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 313[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 289[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 444[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 554[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 430[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 330[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 870[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:26
[2m   Duration [22m 16.46s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/sections.routes.ts [22m[34mx26 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880140720,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880144007,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880148415,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880148415,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880148423,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880148423,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880148423,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880148423,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880149020,"env":"test","module":"user-credentials-repository","userId":"gD7fFfr1z4qN3XxCHT3Wg","msg":"User credentials created"}
{"level":30,"time":1764880149023,"env":"test","module":"auth-routes","userId":"gD7fFfr1z4qN3XxCHT3Wg","email":"test-workflows-0BPnSSvsLlLcqX4axREaR@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"eb7903c5-b23b-4854-9748-78c4510613cb","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"gD7fFfr1z4qN3XxCHT3Wg","tenantId":"837c6ea5-51be-4cd7-8a90-e9feee95008f","createdBy":"gD7fFfr1z4qN3XxCHT3Wg","ownerId":"gD7fFfr1z4qN3XxCHT3Wg","status":"active","archived":false,"createdAt":"2025-12-04T20:29:10.735Z","updatedAt":"2025-12-04T20:29:10.735Z"}

{"level":30,"time":1764880149713,"env":"test","module":"user-credentials-repository","userId":"brAmU-BYnzhVYZ-OiGU7N","msg":"User credentials created"}
{"level":30,"time":1764880149714,"env":"test","module":"auth-routes","userId":"brAmU-BYnzhVYZ-OiGU7N","email":"viewer-FIlN6PM0e306lUUC2NJ45@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880149808,"env":"test","module":"rbac-middleware","userId":"brAmU-BYnzhVYZ-OiGU7N","userRole":"viewer","permission":"workflow:create","path":"/projects/eb7903c5-b23b-4854-9748-78c4510613cb/workflows","msg":"Permission denied"}
{"level":50,"time":1764880156023,"env":"test","error":{},"workflowId":"86416b4c-4a00-4f4f-a033-083a20a9fd39","userId":"gD7fFfr1z4qN3XxCHT3Wg","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880156365,"env":"test","module":"auth-middleware","path":"/api/workflows/f7c5fbe2-4e6f-4b05-9a77-4096e916a21f/move","msg":"No valid authentication found"}
{"level":30,"time":1764880156874,"env":"test","module":"user-credentials-repository","userId":"S_lk8ehIp-TBlTsHA80ZH","msg":"User credentials created"}
{"level":30,"time":1764880156874,"env":"test","module":"auth-routes","userId":"S_lk8ehIp-TBlTsHA80ZH","email":"test-workflows-Nul50YHDhCfY9L75FNshX@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880156921,"env":"test","error":{},"workflowId":"fc878965-8cf2-4444-aa6a-ad957f559d50","userId":"S_lk8ehIp-TBlTsHA80ZH","projectId":"6b7cb3a5-c87b-4f69-bb2a-6c2a5fe1c6b2","msg":"Error moving workflow"}
{"level":50,"time":1764880157300,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"219a964a-f304-4dca-b4cd-19c86660e5b0","userId":"gD7fFfr1z4qN3XxCHT3Wg","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880157660,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"58ee4c66-a88a-4080-a2f6-2457b82404ee","userId":"gD7fFfr1z4qN3XxCHT3Wg","msg":"Error moving workflow"}
{"level":30,"time":1764880158166,"env":"test","module":"user-credentials-repository","userId":"EdzG9J_ZSSJnHNG0d7Zeg","msg":"User credentials created"}
{"level":30,"time":1764880158167,"env":"test","module":"auth-routes","userId":"EdzG9J_ZSSJnHNG0d7Zeg","email":"test-workflows-bYOpZjRmbeh3X7OqYg0_h@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880158350,"env":"test","module":"auth-routes","userId":"EdzG9J_ZSSJnHNG0d7Zeg","email":"test-workflows-bYOpZjRmbeh3X7OqYg0_h@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880158524,"env":"test","error":{},"workflowId":"764dfe64-f1c1-445d-957d-e5931e50b01b","userId":"gD7fFfr1z4qN3XxCHT3Wg","projectId":"4e712b52-8f17-4bdc-a6e7-b9c84c1b16ba","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 742[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 360[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 865[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:56
[2m   Duration [22m 21.58s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx27 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764880170204,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880173579,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880177148,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880177149,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880177162,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880177162,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880177163,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880177163,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880177748,"env":"test","module":"user-credentials-repository","userId":"Ak9sCiYp3nn7iZOnRwHda","msg":"User credentials created"}
{"level":30,"time":1764880177751,"env":"test","module":"auth-routes","userId":"Ak9sCiYp3nn7iZOnRwHda","email":"test-workflows-g3Bj1iNCSbvWqmKjZPRX2@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"ce984e01-17aa-4ce0-a40e-f6d3cb9e7626","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Ak9sCiYp3nn7iZOnRwHda","tenantId":"e7bd36ee-91b1-4908-844e-77d2c45c1a5d","createdBy":"Ak9sCiYp3nn7iZOnRwHda","ownerId":"Ak9sCiYp3nn7iZOnRwHda","status":"active","archived":false,"createdAt":"2025-12-04T20:29:39.470Z","updatedAt":"2025-12-04T20:29:39.470Z"}

{"level":30,"time":1764880178468,"env":"test","module":"user-credentials-repository","userId":"SFLoyuquG6dQo9HAjPHaF","msg":"User credentials created"}
{"level":30,"time":1764880178469,"env":"test","module":"auth-routes","userId":"SFLoyuquG6dQo9HAjPHaF","email":"viewer-vDVFU8E38jQzoz3_k1xWO@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880178566,"env":"test","module":"rbac-middleware","userId":"SFLoyuquG6dQo9HAjPHaF","userRole":"viewer","permission":"workflow:create","path":"/projects/ce984e01-17aa-4ce0-a40e-f6d3cb9e7626/workflows","msg":"Permission denied"}
{"level":50,"time":1764880185052,"env":"test","error":{},"workflowId":"985d7be2-3593-40f3-9019-ede426e1d2f0","userId":"Ak9sCiYp3nn7iZOnRwHda","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880185404,"env":"test","module":"auth-middleware","path":"/api/workflows/05f7cedf-d5ea-4920-99ef-80d90558933f/move","msg":"No valid authentication found"}
{"level":30,"time":1764880185954,"env":"test","module":"user-credentials-repository","userId":"BDmTg-JhSElTqudOGHAU2","msg":"User credentials created"}
{"level":30,"time":1764880185955,"env":"test","module":"auth-routes","userId":"BDmTg-JhSElTqudOGHAU2","email":"test-workflows-6OgGdS4tA2yy0g0xS77fW@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880186004,"env":"test","error":{},"workflowId":"a60b615b-b893-4331-940b-3b832d97023a","userId":"BDmTg-JhSElTqudOGHAU2","projectId":"fc7c16e7-b006-4980-b9f7-05817ec6ea9e","msg":"Error moving workflow"}
{"level":50,"time":1764880186388,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"e89f0795-ed0a-4360-88a3-3e6801aadc82","userId":"Ak9sCiYp3nn7iZOnRwHda","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880186773,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a3bce333-6b19-4fd6-a527-c9c221ffcf80","userId":"Ak9sCiYp3nn7iZOnRwHda","msg":"Error moving workflow"}
{"level":30,"time":1764880187380,"env":"test","module":"user-credentials-repository","userId":"eCSECNavfQeYslZqpK1ZR","msg":"User credentials created"}
{"level":30,"time":1764880187380,"env":"test","module":"auth-routes","userId":"eCSECNavfQeYslZqpK1ZR","email":"test-workflows-3m_4-0QT-BxQhVPVyMxcD@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880187584,"env":"test","module":"auth-routes","userId":"eCSECNavfQeYslZqpK1ZR","email":"test-workflows-3m_4-0QT-BxQhVPVyMxcD@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880187785,"env":"test","error":{},"workflowId":"c9406de6-4063-47a1-8678-3ba49f4b1128","userId":"Ak9sCiYp3nn7iZOnRwHda","projectId":"b38bd8c9-326a-43bd-8d29-b03d7bbc39c9","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10997[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 825[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 661[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 490[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 386[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1014[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:25
[2m   Duration [22m 21.61s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx28 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764880191146,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880193306,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880195671,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880195671,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880195682,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880195682,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880195682,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880195682,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880196147,"env":"test","module":"user-credentials-repository","userId":"S-Z7diTOyrTJozi1WMSIc","msg":"User credentials created"}
{"level":30,"time":1764880196150,"env":"test","module":"auth-routes","userId":"S-Z7diTOyrTJozi1WMSIc","email":"test-workflows-7kVzdhVt-0Fl1H7GwcOBX@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3d560c7e-cbd3-4170-a3ee-c2bb4507f99c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"S-Z7diTOyrTJozi1WMSIc","tenantId":"e82f9be5-3c45-4244-af51-c41eab12023b","createdBy":"S-Z7diTOyrTJozi1WMSIc","ownerId":"S-Z7diTOyrTJozi1WMSIc","status":"active","archived":false,"createdAt":"2025-12-04T20:29:57.865Z","updatedAt":"2025-12-04T20:29:57.865Z"}

{"level":30,"time":1764880196813,"env":"test","module":"user-credentials-repository","userId":"W_zVMXZP_VcgEIveETBi6","msg":"User credentials created"}
{"level":30,"time":1764880196814,"env":"test","module":"auth-routes","userId":"W_zVMXZP_VcgEIveETBi6","email":"viewer-xo3Bqd0MKjm-_JzGu_T3d@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880196908,"env":"test","module":"rbac-middleware","userId":"W_zVMXZP_VcgEIveETBi6","userRole":"viewer","permission":"workflow:create","path":"/projects/3d560c7e-cbd3-4170-a3ee-c2bb4507f99c/workflows","msg":"Permission denied"}
{"level":50,"time":1764880203135,"env":"test","error":{},"workflowId":"1525cc0e-b9dd-43d5-9278-0cc26fb9d14a","userId":"S-Z7diTOyrTJozi1WMSIc","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880203480,"env":"test","module":"auth-middleware","path":"/api/workflows/a84de617-8d09-4637-8182-dfb1d90d1bce/move","msg":"No valid authentication found"}
{"level":30,"time":1764880203993,"env":"test","module":"user-credentials-repository","userId":"ee_2Otl_HkbBj7rzQpH4r","msg":"User credentials created"}
{"level":30,"time":1764880203993,"env":"test","module":"auth-routes","userId":"ee_2Otl_HkbBj7rzQpH4r","email":"test-workflows-perZjCBfWylX1HhWdfpLE@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880204046,"env":"test","error":{},"workflowId":"ececd2f5-e424-433d-a897-dd1f6bf60d37","userId":"ee_2Otl_HkbBj7rzQpH4r","projectId":"9ef7cb9e-16b1-4b77-b6f0-1a3f77a54733","msg":"Error moving workflow"}
{"level":50,"time":1764880204415,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"efb3f0ec-38fe-425a-95ed-9874622afec9","userId":"S-Z7diTOyrTJozi1WMSIc","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880204782,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"faae4b8f-3f43-4b49-9833-0e2192f72c09","userId":"S-Z7diTOyrTJozi1WMSIc","msg":"Error moving workflow"}
{"level":30,"time":1764880205269,"env":"test","module":"user-credentials-repository","userId":"AnuvmM2I8XJgzUgRJKyzT","msg":"User credentials created"}
{"level":30,"time":1764880205270,"env":"test","module":"auth-routes","userId":"AnuvmM2I8XJgzUgRJKyzT","email":"test-workflows-fpwzAKAieZLJfW6Lnfb-8@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880205454,"env":"test","module":"auth-routes","userId":"AnuvmM2I8XJgzUgRJKyzT","email":"test-workflows-fpwzAKAieZLJfW6Lnfb-8@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880205635,"env":"test","error":{},"workflowId":"29267034-6342-4a75-8563-f8a61438f8fd","userId":"S-Z7diTOyrTJozi1WMSIc","projectId":"f868246f-e83e-474b-857f-e1e2b41946fb","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10275[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 286[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 345[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 855[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:48
[2m   Duration [22m 17.15s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/steps.routes.ts [22m[34mx29 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880220015,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880223312,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880226964,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880226964,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880226976,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880226976,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880226976,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880226976,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880227451,"env":"test","module":"user-credentials-repository","userId":"BrIfI6xgQLSPIdco8dzYS","msg":"User credentials created"}
{"level":30,"time":1764880227455,"env":"test","module":"auth-routes","userId":"BrIfI6xgQLSPIdco8dzYS","email":"test-workflows-MckXZ31ATP3mwRrLRv0n1@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"ab100880-8908-4c02-8604-5f235f0e2bf2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"BrIfI6xgQLSPIdco8dzYS","tenantId":"f685d8a2-323c-4062-90ed-62654b8fb23c","createdBy":"BrIfI6xgQLSPIdco8dzYS","ownerId":"BrIfI6xgQLSPIdco8dzYS","status":"active","archived":false,"createdAt":"2025-12-04T20:30:29.181Z","updatedAt":"2025-12-04T20:30:29.181Z"}

{"level":30,"time":1764880228149,"env":"test","module":"user-credentials-repository","userId":"ZxkSeCahR4cV6eBmNbb_S","msg":"User credentials created"}
{"level":30,"time":1764880228149,"env":"test","module":"auth-routes","userId":"ZxkSeCahR4cV6eBmNbb_S","email":"viewer-GlB06I9vlQX2y1HnkwmK5@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880228248,"env":"test","module":"rbac-middleware","userId":"ZxkSeCahR4cV6eBmNbb_S","userRole":"viewer","permission":"workflow:create","path":"/projects/ab100880-8908-4c02-8604-5f235f0e2bf2/workflows","msg":"Permission denied"}
{"level":50,"time":1764880234566,"env":"test","error":{},"workflowId":"d81ec6e5-61fe-4b80-b5b5-c861c5c224c8","userId":"BrIfI6xgQLSPIdco8dzYS","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880234896,"env":"test","module":"auth-middleware","path":"/api/workflows/4eccbdfe-18b9-4f21-bf0d-902ac3353090/move","msg":"No valid authentication found"}
{"level":30,"time":1764880235414,"env":"test","module":"user-credentials-repository","userId":"nZ5SC847mNn7FZF7W61Om","msg":"User credentials created"}
{"level":30,"time":1764880235414,"env":"test","module":"auth-routes","userId":"nZ5SC847mNn7FZF7W61Om","email":"test-workflows-UEkvK2nhPzWVZ9bWO_kqU@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880235470,"env":"test","error":{},"workflowId":"c1737834-1241-42d8-ae44-c81cc744a63d","userId":"nZ5SC847mNn7FZF7W61Om","projectId":"e5b40615-6880-4b93-bec9-e33473d26d8b","msg":"Error moving workflow"}
{"level":50,"time":1764880235853,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f2151c83-e885-4852-bc15-85d00bd2f183","userId":"BrIfI6xgQLSPIdco8dzYS","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880236212,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"75b57506-9a72-4b21-9f06-855b049b37e9","userId":"BrIfI6xgQLSPIdco8dzYS","msg":"Error moving workflow"}
{"level":30,"time":1764880236721,"env":"test","module":"user-credentials-repository","userId":"Hfzbqs6GLDIEMTEfacI-L","msg":"User credentials created"}
{"level":30,"time":1764880236722,"env":"test","module":"auth-routes","userId":"Hfzbqs6GLDIEMTEfacI-L","email":"test-workflows-E7ipUUE4v0MLOO4hr1Kc4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880236913,"env":"test","module":"auth-routes","userId":"Hfzbqs6GLDIEMTEfacI-L","email":"test-workflows-E7ipUUE4v0MLOO4hr1Kc4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880237135,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4640ffce-d233-4bfa-afbb-c649556faa18","userId":"BrIfI6xgQLSPIdco8dzYS","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 724[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 780[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 359[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 924[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:14
[2m   Duration [22m 21.46s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx30 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764880256295,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880259934,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880263705,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880263706,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880263717,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880263717,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880263718,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880263718,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880264226,"env":"test","module":"user-credentials-repository","userId":"dG6XZrFIZfSEQWvnUTj-T","msg":"User credentials created"}
{"level":30,"time":1764880264229,"env":"test","module":"auth-routes","userId":"dG6XZrFIZfSEQWvnUTj-T","email":"test-workflows-VjfuYvrzZVkLfaP1-to0P@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"67b3d83b-0dc9-4347-a42a-76190d5b6f9a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"dG6XZrFIZfSEQWvnUTj-T","tenantId":"c7de839a-15c8-47de-b453-4e1ed2213edc","createdBy":"dG6XZrFIZfSEQWvnUTj-T","ownerId":"dG6XZrFIZfSEQWvnUTj-T","status":"active","archived":false,"createdAt":"2025-12-04T20:31:05.940Z","updatedAt":"2025-12-04T20:31:05.940Z"}

{"level":30,"time":1764880264947,"env":"test","module":"user-credentials-repository","userId":"UKTSacqHWv8MC-tkUBln0","msg":"User credentials created"}
{"level":30,"time":1764880264947,"env":"test","module":"auth-routes","userId":"UKTSacqHWv8MC-tkUBln0","email":"viewer-2iExk0TXcmYddQb5eHfBB@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880265048,"env":"test","module":"rbac-middleware","userId":"UKTSacqHWv8MC-tkUBln0","userRole":"viewer","permission":"workflow:create","path":"/projects/67b3d83b-0dc9-4347-a42a-76190d5b6f9a/workflows","msg":"Permission denied"}
{"level":50,"time":1764880271090,"env":"test","error":{},"workflowId":"a93b9d2e-c035-4638-9be8-b65ae0f2eb21","userId":"dG6XZrFIZfSEQWvnUTj-T","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880271397,"env":"test","module":"auth-middleware","path":"/api/workflows/1a9770bf-6d2d-48eb-80bb-38c768dff219/move","msg":"No valid authentication found"}
{"level":30,"time":1764880271897,"env":"test","module":"user-credentials-repository","userId":"I25ycoOKB9cYZRpK57OMC","msg":"User credentials created"}
{"level":30,"time":1764880271898,"env":"test","module":"auth-routes","userId":"I25ycoOKB9cYZRpK57OMC","email":"test-workflows-gqwdFow3J-gLSNwopVd4s@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880271943,"env":"test","error":{},"workflowId":"17ba95df-6bfe-47ca-8265-1f731c178817","userId":"I25ycoOKB9cYZRpK57OMC","projectId":"14299f86-0446-48c9-a2fe-7ccc6b7c2d4b","msg":"Error moving workflow"}
{"level":50,"time":1764880272294,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"75cc8f8a-2f74-4ce4-9cfd-3e4ca47941a4","userId":"dG6XZrFIZfSEQWvnUTj-T","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880272651,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f4c613f5-e351-4bb6-a2e2-3c11b9fb5845","userId":"dG6XZrFIZfSEQWvnUTj-T","msg":"Error moving workflow"}
{"level":30,"time":1764880273184,"env":"test","module":"user-credentials-repository","userId":"QXpr2raMUMGdQ_93oeaUD","msg":"User credentials created"}
{"level":30,"time":1764880273184,"env":"test","module":"auth-routes","userId":"QXpr2raMUMGdQ_93oeaUD","email":"test-workflows-V5cZw5Yvu3Oh0YJ-1O8Ns@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880273377,"env":"test","module":"auth-routes","userId":"QXpr2raMUMGdQ_93oeaUD","email":"test-workflows-V5cZw5Yvu3Oh0YJ-1O8Ns@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880273560,"env":"test","error":{},"workflowId":"d323f491-70f2-4267-845d-edd8175dd1d1","userId":"dG6XZrFIZfSEQWvnUTj-T","projectId":"17e080fc-8236-4ccf-aa1c-133a43b6db23","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10134[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 301[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 704[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 589[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 724[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 545[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 357[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 911[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:52
[2m   Duration [22m 21.07s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx31 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880278250,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880281560,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880285372,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880285373,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880285384,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880285384,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880285385,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880285385,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880285888,"env":"test","module":"user-credentials-repository","userId":"rLw5q_GYscDJrukV8_4O4","msg":"User credentials created"}
{"level":30,"time":1764880285891,"env":"test","module":"auth-routes","userId":"rLw5q_GYscDJrukV8_4O4","email":"test-workflows-z2Fq-JkF3E7nq5lfd4li2@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b407dd58-1958-4a19-83e3-eab5938739f4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"rLw5q_GYscDJrukV8_4O4","tenantId":"cb0169c5-3031-487a-a3b3-419f8baab6ea","createdBy":"rLw5q_GYscDJrukV8_4O4","ownerId":"rLw5q_GYscDJrukV8_4O4","status":"active","archived":false,"createdAt":"2025-12-04T20:31:27.607Z","updatedAt":"2025-12-04T20:31:27.607Z"}

{"level":30,"time":1764880286543,"env":"test","module":"user-credentials-repository","userId":"L7dJTgXT2JozR9TpJ93hj","msg":"User credentials created"}
{"level":30,"time":1764880286544,"env":"test","module":"auth-routes","userId":"L7dJTgXT2JozR9TpJ93hj","email":"viewer-EDl-qNYvyA2MvKFt9rk3n@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880286637,"env":"test","module":"rbac-middleware","userId":"L7dJTgXT2JozR9TpJ93hj","userRole":"viewer","permission":"workflow:create","path":"/projects/b407dd58-1958-4a19-83e3-eab5938739f4/workflows","msg":"Permission denied"}
{"level":50,"time":1764880292969,"env":"test","error":{},"workflowId":"626b954a-edf1-45c8-a6ff-8451f82acddb","userId":"rLw5q_GYscDJrukV8_4O4","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880293281,"env":"test","module":"auth-middleware","path":"/api/workflows/5d3d6010-c43d-474c-a92f-041c9df8f95b/move","msg":"No valid authentication found"}
{"level":30,"time":1764880293787,"env":"test","module":"user-credentials-repository","userId":"ld8IQgAcldra_ldTh_1R6","msg":"User credentials created"}
{"level":30,"time":1764880293788,"env":"test","module":"auth-routes","userId":"ld8IQgAcldra_ldTh_1R6","email":"test-workflows-o1O29eNG6b6JesMQ4Y5b-@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880293837,"env":"test","error":{},"workflowId":"d94f96ec-3ca7-4a91-9be5-47c5b81d85c1","userId":"ld8IQgAcldra_ldTh_1R6","projectId":"9882b947-dd74-49f2-acf9-d477b6799a1e","msg":"Error moving workflow"}
{"level":50,"time":1764880294223,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b315688d-7ccd-4c06-ad14-0f75676f05de","userId":"rLw5q_GYscDJrukV8_4O4","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880294575,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a0011802-419f-4ef3-bdbb-62dda4ee1da0","userId":"rLw5q_GYscDJrukV8_4O4","msg":"Error moving workflow"}
{"level":30,"time":1764880295110,"env":"test","module":"user-credentials-repository","userId":"LyRorcrA1iHMeZVHCPPnb","msg":"User credentials created"}
{"level":30,"time":1764880295111,"env":"test","module":"auth-routes","userId":"LyRorcrA1iHMeZVHCPPnb","email":"test-workflows-Bq2C7TjIWNB-T94Hu22tJ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880295326,"env":"test","module":"auth-routes","userId":"LyRorcrA1iHMeZVHCPPnb","email":"test-workflows-Bq2C7TjIWNB-T94Hu22tJ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880295507,"env":"test","error":{},"workflowId":"dd7ba0cc-61ee-4043-8215-a99eac0eb8e3","userId":"rLw5q_GYscDJrukV8_4O4","projectId":"394469b9-da46-4fdd-b77f-92a8ad4f702a","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 310[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 441[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 980[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 311[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 385[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 353[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 932[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:13
[2m   Duration [22m 21.10s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx32 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764880300522,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880303278,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880305881,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880305882,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880305897,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880305897,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880305897,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880305897,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880306457,"env":"test","module":"user-credentials-repository","userId":"QpSJMa2N3qo89JO_pxJTQ","msg":"User credentials created"}
{"level":30,"time":1764880306461,"env":"test","module":"auth-routes","userId":"QpSJMa2N3qo89JO_pxJTQ","email":"test-workflows-pkAYSQkzKvU_TPSiEkQ90@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e416ab3d-99c2-4a1a-816f-183837660abd","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"QpSJMa2N3qo89JO_pxJTQ","tenantId":"5886d3e0-4f30-4cb9-8f77-301f4f5f2760","createdBy":"QpSJMa2N3qo89JO_pxJTQ","ownerId":"QpSJMa2N3qo89JO_pxJTQ","status":"active","archived":false,"createdAt":"2025-12-04T20:31:48.185Z","updatedAt":"2025-12-04T20:31:48.185Z"}

{"level":30,"time":1764880307137,"env":"test","module":"user-credentials-repository","userId":"nyLc5vrHBuNsJpOf2Qy80","msg":"User credentials created"}
{"level":30,"time":1764880307138,"env":"test","module":"auth-routes","userId":"nyLc5vrHBuNsJpOf2Qy80","email":"viewer-O-ymIfTL3MimX3H87KzgW@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880307231,"env":"test","module":"rbac-middleware","userId":"nyLc5vrHBuNsJpOf2Qy80","userRole":"viewer","permission":"workflow:create","path":"/projects/e416ab3d-99c2-4a1a-816f-183837660abd/workflows","msg":"Permission denied"}
{"level":50,"time":1764880313333,"env":"test","error":{},"workflowId":"83c934be-658b-4dd4-b1dc-ccef258723f8","userId":"QpSJMa2N3qo89JO_pxJTQ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880313655,"env":"test","module":"auth-middleware","path":"/api/workflows/84c530c7-2d59-4ea9-988f-d9bdaba4d30c/move","msg":"No valid authentication found"}
{"level":30,"time":1764880314156,"env":"test","module":"user-credentials-repository","userId":"Be3yBifny_5t8E74FeS1i","msg":"User credentials created"}
{"level":30,"time":1764880314157,"env":"test","module":"auth-routes","userId":"Be3yBifny_5t8E74FeS1i","email":"test-workflows-N_7KGXvmP37gd3UYG0ULP@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880314208,"env":"test","error":{},"workflowId":"8aa6453a-68df-4598-8bb8-7ce12508b974","userId":"Be3yBifny_5t8E74FeS1i","projectId":"7e8a07d5-2b2d-493a-84c3-dbef2431e889","msg":"Error moving workflow"}
{"level":50,"time":1764880314579,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"35119d5d-8e9e-4a2d-bf09-48fc1146a127","userId":"QpSJMa2N3qo89JO_pxJTQ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880315011,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b40ecd48-6bbc-4597-bf98-e076eda70a05","userId":"QpSJMa2N3qo89JO_pxJTQ","msg":"Error moving workflow"}
{"level":30,"time":1764880315530,"env":"test","module":"user-credentials-repository","userId":"aUNqovbME3zfD60fHoAFz","msg":"User credentials created"}
{"level":30,"time":1764880315531,"env":"test","module":"auth-routes","userId":"aUNqovbME3zfD60fHoAFz","email":"test-workflows-HU3XFwbGKOqcteM3LvZTY@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880315727,"env":"test","module":"auth-routes","userId":"aUNqovbME3zfD60fHoAFz","email":"test-workflows-HU3XFwbGKOqcteM3LvZTY@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880315911,"env":"test","error":{},"workflowId":"961d8b53-35c3-4318-ba50-5a0fb2a17966","userId":"QpSJMa2N3qo89JO_pxJTQ","projectId":"feb68bd3-25a9-4f96-a02e-96e7318db75e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10247[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 319[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 299[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 588[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 720[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 553[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 900[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:35
[2m   Duration [22m 18.84s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx33 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764880320604,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880323979,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880327029,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880327030,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880327042,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880327042,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880327043,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880327043,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880327551,"env":"test","module":"user-credentials-repository","userId":"YiI9gSNVLeNaSaEwMCCFX","msg":"User credentials created"}
{"level":30,"time":1764880327555,"env":"test","module":"auth-routes","userId":"YiI9gSNVLeNaSaEwMCCFX","email":"test-workflows-xghR9R7RBnzXS_j7Ai21h@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b22be84b-9710-4429-bb7f-efadbc198485","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"YiI9gSNVLeNaSaEwMCCFX","tenantId":"0a00ac76-0bd2-4e6f-9e4c-9fc8ad71fca3","createdBy":"YiI9gSNVLeNaSaEwMCCFX","ownerId":"YiI9gSNVLeNaSaEwMCCFX","status":"active","archived":false,"createdAt":"2025-12-04T20:32:09.301Z","updatedAt":"2025-12-04T20:32:09.301Z"}

{"level":30,"time":1764880328288,"env":"test","module":"user-credentials-repository","userId":"vzM803ZNpGJ6bnmWGFhwx","msg":"User credentials created"}
{"level":30,"time":1764880328288,"env":"test","module":"auth-routes","userId":"vzM803ZNpGJ6bnmWGFhwx","email":"viewer-IAB1_00q7t6XUrsZLXDSB@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880328382,"env":"test","module":"rbac-middleware","userId":"vzM803ZNpGJ6bnmWGFhwx","userRole":"viewer","permission":"workflow:create","path":"/projects/b22be84b-9710-4429-bb7f-efadbc198485/workflows","msg":"Permission denied"}
{"level":50,"time":1764880334526,"env":"test","error":{},"workflowId":"78989f99-fc4e-4102-b47f-ed350e7f1a53","userId":"YiI9gSNVLeNaSaEwMCCFX","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880334834,"env":"test","module":"auth-middleware","path":"/api/workflows/e8106171-79a4-4ac8-9ce2-8252e56bc4a4/move","msg":"No valid authentication found"}
{"level":30,"time":1764880335337,"env":"test","module":"user-credentials-repository","userId":"5c-YITZjZprrKH8KOLQhZ","msg":"User credentials created"}
{"level":30,"time":1764880335338,"env":"test","module":"auth-routes","userId":"5c-YITZjZprrKH8KOLQhZ","email":"test-workflows-dcRbsdXTnjbMhlU9bXfhz@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880335426,"env":"test","error":{},"workflowId":"be3d82c3-ac16-48f0-9c4b-8ed70da6967b","userId":"5c-YITZjZprrKH8KOLQhZ","projectId":"ddc09550-cdb2-4b27-a933-7c3dcfec4e23","msg":"Error moving workflow"}
{"level":50,"time":1764880335796,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"5c989113-4ae7-4e86-acef-bba5ac0c4516","userId":"YiI9gSNVLeNaSaEwMCCFX","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880336157,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"51e35c1d-b5e7-416b-8e6f-547890e830a1","userId":"YiI9gSNVLeNaSaEwMCCFX","msg":"Error moving workflow"}
{"level":30,"time":1764880336642,"env":"test","module":"user-credentials-repository","userId":"7rBqqmw9dB7catWAl6aLM","msg":"User credentials created"}
{"level":30,"time":1764880336642,"env":"test","module":"auth-routes","userId":"7rBqqmw9dB7catWAl6aLM","email":"test-workflows-5USfO4wKGgqI7NPlSUzvv@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880336828,"env":"test","module":"auth-routes","userId":"7rBqqmw9dB7catWAl6aLM","email":"test-workflows-5USfO4wKGgqI7NPlSUzvv@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880337010,"env":"test","error":{},"workflowId":"1a496810-1cd9-41a6-90ef-420747d46449","userId":"YiI9gSNVLeNaSaEwMCCFX","projectId":"9d8aee25-5101-4fa8-a636-837883a103e8","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10216[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 357[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 298[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 700[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 307[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 361[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 854[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:56
[2m   Duration [22m 19.86s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx34 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764880371963,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880374799,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880378579,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880378579,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880378590,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880378590,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880378590,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880378590,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880379113,"env":"test","module":"user-credentials-repository","userId":"hVzsdFG5Q9Xq3Kac1BLEW","msg":"User credentials created"}
{"level":30,"time":1764880379117,"env":"test","module":"auth-routes","userId":"hVzsdFG5Q9Xq3Kac1BLEW","email":"test-workflows-Y32sNJphNS7tLVntp357Y@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"17ef9e47-ca0b-40ab-8ec8-24da4b2b7ece","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"hVzsdFG5Q9Xq3Kac1BLEW","tenantId":"2651f3ac-0f0e-4fbb-b7d4-8bfd183248aa","createdBy":"hVzsdFG5Q9Xq3Kac1BLEW","ownerId":"hVzsdFG5Q9Xq3Kac1BLEW","status":"active","archived":false,"createdAt":"2025-12-04T20:33:00.847Z","updatedAt":"2025-12-04T20:33:00.847Z"}

{"level":30,"time":1764880379815,"env":"test","module":"user-credentials-repository","userId":"406wDgsCTnpHvsXgB2rz7","msg":"User credentials created"}
{"level":30,"time":1764880379816,"env":"test","module":"auth-routes","userId":"406wDgsCTnpHvsXgB2rz7","email":"viewer-PR0EJkDmHdl37kQrxYJHP@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880379908,"env":"test","module":"rbac-middleware","userId":"406wDgsCTnpHvsXgB2rz7","userRole":"viewer","permission":"workflow:create","path":"/projects/17ef9e47-ca0b-40ab-8ec8-24da4b2b7ece/workflows","msg":"Permission denied"}
{"level":50,"time":1764880385863,"env":"test","error":{},"workflowId":"e2df8c39-5080-4e17-903d-4e5ccfb47ea5","userId":"hVzsdFG5Q9Xq3Kac1BLEW","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880386183,"env":"test","module":"auth-middleware","path":"/api/workflows/567b3434-8203-417e-acba-b74d28d183d6/move","msg":"No valid authentication found"}
{"level":30,"time":1764880386722,"env":"test","module":"user-credentials-repository","userId":"ffVMoTLuBc2EVRHXgNhn6","msg":"User credentials created"}
{"level":30,"time":1764880386723,"env":"test","module":"auth-routes","userId":"ffVMoTLuBc2EVRHXgNhn6","email":"test-workflows-Neur1DI7VP7QacGJMKmK2@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880386779,"env":"test","error":{},"workflowId":"f685be88-f694-44db-bc34-a57d88d3594a","userId":"ffVMoTLuBc2EVRHXgNhn6","projectId":"10aeb687-6600-490e-abaf-a450e94ef0f8","msg":"Error moving workflow"}
{"level":50,"time":1764880387126,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8f0b64a8-a9d4-4884-ac18-aba70071a902","userId":"hVzsdFG5Q9Xq3Kac1BLEW","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880387471,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"6507c3d6-30bb-4866-ba61-97db649a946c","userId":"hVzsdFG5Q9Xq3Kac1BLEW","msg":"Error moving workflow"}
{"level":30,"time":1764880387958,"env":"test","module":"user-credentials-repository","userId":"oP3MDH1fWwCZ3NjEADuG6","msg":"User credentials created"}
{"level":30,"time":1764880387958,"env":"test","module":"auth-routes","userId":"oP3MDH1fWwCZ3NjEADuG6","email":"test-workflows-GAE4PPBvqsMSkDy2Yu0hp@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880388136,"env":"test","module":"auth-routes","userId":"oP3MDH1fWwCZ3NjEADuG6","email":"test-workflows-GAE4PPBvqsMSkDy2Yu0hp@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880388313,"env":"test","error":{},"workflowId":"91f932b4-2b42-4a69-8a8b-85b493d578f4","userId":"hVzsdFG5Q9Xq3Kac1BLEW","projectId":"e5d9426b-93ec-4ae8-a17a-5684b8928ed4","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9997[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 445[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 705[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 843[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:32:47
[2m   Duration [22m 20.13s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx35 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764891574413,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764891577719,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764891581632,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764891581633,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764891581646,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764891581646,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764891581647,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764891581647,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764891582196,"env":"test","module":"user-credentials-repository","userId":"NYL96QsAJfDO6pIK_tTlS","msg":"User credentials created"}
{"level":30,"time":1764891582201,"env":"test","module":"auth-routes","userId":"NYL96QsAJfDO6pIK_tTlS","email":"test-workflows-kmnyRwHNA6peID1XThOxS@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c961b461-a301-49ce-873c-2c18617b477a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"NYL96QsAJfDO6pIK_tTlS","tenantId":"1525cac2-be3f-4041-99d9-9c43368b5324","createdBy":"NYL96QsAJfDO6pIK_tTlS","ownerId":"NYL96QsAJfDO6pIK_tTlS","status":"active","archived":false,"createdAt":"2025-12-04T23:39:44.113Z","updatedAt":"2025-12-04T23:39:44.113Z"}

{"level":30,"time":1764891582899,"env":"test","module":"user-credentials-repository","userId":"839sn1TS_GoEBqh3jkzwF","msg":"User credentials created"}
{"level":30,"time":1764891582900,"env":"test","module":"auth-routes","userId":"839sn1TS_GoEBqh3jkzwF","email":"viewer-hRzxzPP265FfvHKP5Ypi6@example.com","msg":"User registered successfully"}
{"level":40,"time":1764891583004,"env":"test","module":"rbac-middleware","userId":"839sn1TS_GoEBqh3jkzwF","userRole":"viewer","permission":"workflow:create","path":"/projects/c961b461-a301-49ce-873c-2c18617b477a/workflows","msg":"Permission denied"}
{"level":50,"time":1764891589210,"env":"test","error":{},"workflowId":"cf03d1e0-a6e3-4db3-ad72-4f4852ccaae7","userId":"NYL96QsAJfDO6pIK_tTlS","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764891589545,"env":"test","module":"auth-middleware","path":"/api/workflows/6d6c7117-e3c7-4745-8bc9-c2a5fa93e7e4/move","msg":"No valid authentication found"}
{"level":30,"time":1764891590073,"env":"test","module":"user-credentials-repository","userId":"mpYnDNhD1y6Sg8A_XTdCR","msg":"User credentials created"}
{"level":30,"time":1764891590074,"env":"test","module":"auth-routes","userId":"mpYnDNhD1y6Sg8A_XTdCR","email":"test-workflows-vj3Cc5U8odqkI0gUdAgp2@example.com","msg":"User registered successfully"}
{"level":50,"time":1764891590127,"env":"test","error":{},"workflowId":"dd855b84-90ee-409e-a4ef-daf54a3eec34","userId":"mpYnDNhD1y6Sg8A_XTdCR","projectId":"311c5eab-7014-437e-b609-cd5c4a9407da","msg":"Error moving workflow"}
{"level":50,"time":1764891590498,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"65d2f5e3-8937-4ce0-a3dc-aaff13582fb1","userId":"NYL96QsAJfDO6pIK_tTlS","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764891590863,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d9db9a24-d0e9-474b-a00a-af6090b0ce80","userId":"NYL96QsAJfDO6pIK_tTlS","msg":"Error moving workflow"}
{"level":30,"time":1764891591378,"env":"test","module":"user-credentials-repository","userId":"4Tmc2_Q5BmtS1zv6xDXGR","msg":"User credentials created"}
{"level":30,"time":1764891591379,"env":"test","module":"auth-routes","userId":"4Tmc2_Q5BmtS1zv6xDXGR","email":"test-workflows-b0YMMRUVP0XdLIcdKZctN@example.com","msg":"User registered successfully"}
{"level":30,"time":1764891591565,"env":"test","module":"auth-routes","userId":"4Tmc2_Q5BmtS1zv6xDXGR","email":"test-workflows-b0YMMRUVP0XdLIcdKZctN@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764891591747,"env":"test","error":{},"workflowId":"6f5360d5-29a1-45e6-bd38-5d77fa5fb977","userId":"NYL96QsAJfDO6pIK_tTlS","projectId":"b174f982-a07c-48f7-af0a-6f79661e9831","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 366[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 884[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:39:28
[2m   Duration [22m 21.78s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/auth.ts [22m[34mx36 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764892165815,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892169726,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892173863,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892173864,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892173876,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892173876,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892173877,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892173877,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892174392,"env":"test","module":"user-credentials-repository","userId":"rXUs8FqDKyEJIa4vd0_8I","msg":"User credentials created"}
{"level":30,"time":1764892174396,"env":"test","module":"auth-routes","userId":"rXUs8FqDKyEJIa4vd0_8I","email":"test-workflows-ImSWuyAvhbEpWijYCSP-E@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"fba791b3-ac9b-49d7-8cc4-ed1f43d7efcc","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"rXUs8FqDKyEJIa4vd0_8I","tenantId":"44706b86-698b-422e-b3e8-4142a7c69233","createdBy":"rXUs8FqDKyEJIa4vd0_8I","ownerId":"rXUs8FqDKyEJIa4vd0_8I","status":"active","archived":false,"createdAt":"2025-12-04T23:49:36.324Z","updatedAt":"2025-12-04T23:49:36.324Z"}

{"level":30,"time":1764892175078,"env":"test","module":"user-credentials-repository","userId":"-RYNp12wJS-frT75-lORM","msg":"User credentials created"}
{"level":30,"time":1764892175079,"env":"test","module":"auth-routes","userId":"-RYNp12wJS-frT75-lORM","email":"viewer-vlxep1dW_u8c7D3YYKx3r@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892175174,"env":"test","module":"rbac-middleware","userId":"-RYNp12wJS-frT75-lORM","userRole":"viewer","permission":"workflow:create","path":"/projects/fba791b3-ac9b-49d7-8cc4-ed1f43d7efcc/workflows","msg":"Permission denied"}
{"level":50,"time":1764892181361,"env":"test","error":{},"workflowId":"b14fb2f1-807a-4f94-b871-0d865f07d87a","userId":"rXUs8FqDKyEJIa4vd0_8I","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892181948,"env":"test","module":"auth-middleware","path":"/api/workflows/6a16d7b9-3574-4c2b-8c71-60a0d4bd3666/move","msg":"No valid authentication found"}
{"level":30,"time":1764892182483,"env":"test","module":"user-credentials-repository","userId":"g8rJJzI_TSUrhyUqgy49S","msg":"User credentials created"}
{"level":30,"time":1764892182484,"env":"test","module":"auth-routes","userId":"g8rJJzI_TSUrhyUqgy49S","email":"test-workflows-bCETxRepdvXdb89uoNdgt@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892182533,"env":"test","error":{},"workflowId":"36a1a8ac-eb18-4e16-b59e-9d2c3d611374","userId":"g8rJJzI_TSUrhyUqgy49S","projectId":"80769205-630c-4e67-b417-bd6cf4796405","msg":"Error moving workflow"}
{"level":50,"time":1764892182885,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8e539977-78a7-4386-89e2-4e6b99687774","userId":"rXUs8FqDKyEJIa4vd0_8I","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892183232,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f50bfda2-df1e-416f-9bb5-c8f10783773e","userId":"rXUs8FqDKyEJIa4vd0_8I","msg":"Error moving workflow"}
{"level":30,"time":1764892183732,"env":"test","module":"user-credentials-repository","userId":"9a4FbsKeZUgbLUXaCz26K","msg":"User credentials created"}
{"level":30,"time":1764892183732,"env":"test","module":"auth-routes","userId":"9a4FbsKeZUgbLUXaCz26K","email":"test-workflows-BW9Um3oLOCfKrzw_WkhF-@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892183918,"env":"test","module":"auth-routes","userId":"9a4FbsKeZUgbLUXaCz26K","email":"test-workflows-BW9Um3oLOCfKrzw_WkhF-@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892184102,"env":"test","error":{},"workflowId":"49411a0f-2da0-484f-8296-a730b57f8b3e","userId":"rXUs8FqDKyEJIa4vd0_8I","projectId":"6c8b3c51-212e-4588-9eaf-b4baf86c402f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 589[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 871[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:49:20
[2m   Duration [22m 22.30s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx37 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764892480593,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892485579,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892488358,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892488359,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892488371,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892488371,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892488371,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892488371,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892488872,"env":"test","module":"user-credentials-repository","userId":"VIQD_41h_ND7mPrpOcOHH","msg":"User credentials created"}
{"level":30,"time":1764892488875,"env":"test","module":"auth-routes","userId":"VIQD_41h_ND7mPrpOcOHH","email":"test-workflows-CCH06rNicisUHCQk3PGHU@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a9c96fc5-d45c-4793-adfa-8b73032abec7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"VIQD_41h_ND7mPrpOcOHH","tenantId":"c9a8e276-4020-4ea8-977f-aca40f8479e5","createdBy":"VIQD_41h_ND7mPrpOcOHH","ownerId":"VIQD_41h_ND7mPrpOcOHH","status":"active","archived":false,"createdAt":"2025-12-04T23:54:50.812Z","updatedAt":"2025-12-04T23:54:50.812Z"}

{"level":30,"time":1764892489581,"env":"test","module":"user-credentials-repository","userId":"wr-ho6pROzsea2Ic0kmzn","msg":"User credentials created"}
{"level":30,"time":1764892489582,"env":"test","module":"auth-routes","userId":"wr-ho6pROzsea2Ic0kmzn","email":"viewer-XKWKViCmMT-6-Y-IB3nM4@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892489685,"env":"test","module":"rbac-middleware","userId":"wr-ho6pROzsea2Ic0kmzn","userRole":"viewer","permission":"workflow:create","path":"/projects/a9c96fc5-d45c-4793-adfa-8b73032abec7/workflows","msg":"Permission denied"}
{"level":50,"time":1764892496271,"env":"test","error":{},"workflowId":"1963fc03-7d58-4ab8-9b29-f746c3ffcbab","userId":"VIQD_41h_ND7mPrpOcOHH","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892496655,"env":"test","module":"auth-middleware","path":"/api/workflows/bcede1d4-8e4c-4602-bd1b-65038aa5d097/move","msg":"No valid authentication found"}
{"level":30,"time":1764892497197,"env":"test","module":"user-credentials-repository","userId":"TudRhoKJc7U2LbS73YKLE","msg":"User credentials created"}
{"level":30,"time":1764892497198,"env":"test","module":"auth-routes","userId":"TudRhoKJc7U2LbS73YKLE","email":"test-workflows-YoE2gsCeq2UWh57JipB5S@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892497300,"env":"test","error":{},"workflowId":"20827b93-6dcb-4cfb-a2c9-5d8f1d30198c","userId":"TudRhoKJc7U2LbS73YKLE","projectId":"8fb26b54-9915-43a9-aea7-a1d983a312c5","msg":"Error moving workflow"}
{"level":50,"time":1764892497689,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"83f76ef8-839c-4f2c-a538-7a00fb1078dd","userId":"VIQD_41h_ND7mPrpOcOHH","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892498058,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"16d0e60c-9430-4017-8bd4-e54e4b32bf78","userId":"VIQD_41h_ND7mPrpOcOHH","msg":"Error moving workflow"}
{"level":50,"time":1764892498245,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(VIQD_41h_ND7mPrpOcOHH) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"VIQD_41h_ND7mPrpOcOHH","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10161[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 681[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 857[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 648[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 383[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 647[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 387[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 186[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:36
[2m   Duration [22m 21.26s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx38 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764892502928,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892505310,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892507399,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892507400,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892507413,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892507413,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892507414,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892507414,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892507854,"env":"test","module":"user-credentials-repository","userId":"V7ZOU9DZ1B1HE-db82vTS","msg":"User credentials created"}
{"level":30,"time":1764892507859,"env":"test","module":"auth-routes","userId":"V7ZOU9DZ1B1HE-db82vTS","email":"test-workflows-QeHorHJA5COohGsOKvtQF@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"19f88d48-0711-40e1-ab58-1397cff9fb65","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"V7ZOU9DZ1B1HE-db82vTS","tenantId":"c3337e6c-1488-48bf-ae30-6b4e29dfaf1b","createdBy":"V7ZOU9DZ1B1HE-db82vTS","ownerId":"V7ZOU9DZ1B1HE-db82vTS","status":"active","archived":false,"createdAt":"2025-12-04T23:55:09.786Z","updatedAt":"2025-12-04T23:55:09.786Z"}

{"level":30,"time":1764892508533,"env":"test","module":"user-credentials-repository","userId":"HnRfFEet42qCsal2v7TY-","msg":"User credentials created"}
{"level":30,"time":1764892508534,"env":"test","module":"auth-routes","userId":"HnRfFEet42qCsal2v7TY-","email":"viewer-MgbDszLESi4RnJUf_tfq3@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892508628,"env":"test","module":"rbac-middleware","userId":"HnRfFEet42qCsal2v7TY-","userRole":"viewer","permission":"workflow:create","path":"/projects/19f88d48-0711-40e1-ab58-1397cff9fb65/workflows","msg":"Permission denied"}
{"level":50,"time":1764892514849,"env":"test","error":{},"workflowId":"ae6180db-aefd-4615-abac-b2a3fd918634","userId":"V7ZOU9DZ1B1HE-db82vTS","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892515177,"env":"test","module":"auth-middleware","path":"/api/workflows/42dab5ee-309f-4b75-bb25-034abf31645f/move","msg":"No valid authentication found"}
{"level":30,"time":1764892515696,"env":"test","module":"user-credentials-repository","userId":"8YeF23ynKwzBXBSpc8lxR","msg":"User credentials created"}
{"level":30,"time":1764892515697,"env":"test","module":"auth-routes","userId":"8YeF23ynKwzBXBSpc8lxR","email":"test-workflows-Fr1QTwjeyXzHTttKaoihW@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892515741,"env":"test","error":{},"workflowId":"c5438a62-81db-4f24-888b-25da78e1c5a5","userId":"8YeF23ynKwzBXBSpc8lxR","projectId":"f5d0f4df-3a11-477b-8320-124f3d7b66fc","msg":"Error moving workflow"}
{"level":50,"time":1764892516117,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b3cbe0e4-5359-4235-b047-9ec25a7d6efb","userId":"V7ZOU9DZ1B1HE-db82vTS","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892516461,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a934eb29-cd86-4a95-86b8-a33de1a50f30","userId":"V7ZOU9DZ1B1HE-db82vTS","msg":"Error moving workflow"}
{"level":50,"time":1764892516648,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(V7ZOU9DZ1B1HE-db82vTS) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"V7ZOU9DZ1B1HE-db82vTS","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9514[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 830[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 344[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 189[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:58
[2m   Duration [22m 17.21s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx39 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764895077371,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895080878,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895084737,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895084737,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895084799,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895084800,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895084801,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895084801,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895085532,"env":"test","module":"user-credentials-repository","userId":"gLSxwuaIrZ4OPVAt3j9fF","msg":"User credentials created"}
{"level":30,"time":1764895085535,"env":"test","module":"auth-routes","userId":"gLSxwuaIrZ4OPVAt3j9fF","email":"test-workflows-mGCXd2pLU5UCkZ6UyDctT@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"61ecaf66-c3cd-4ca5-93c4-05adaeff81b4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"gLSxwuaIrZ4OPVAt3j9fF","tenantId":"1fd625c7-f8df-4e78-9ab8-898aece01c75","createdBy":"gLSxwuaIrZ4OPVAt3j9fF","ownerId":"gLSxwuaIrZ4OPVAt3j9fF","status":"active","archived":false,"createdAt":"2025-12-05T00:38:05.710Z","updatedAt":"2025-12-05T00:38:05.710Z"}

{"level":30,"time":1764895086246,"env":"test","module":"user-credentials-repository","userId":"tWNFL17pkt5ef-63K5Amn","msg":"User credentials created"}
{"level":30,"time":1764895086247,"env":"test","module":"auth-routes","userId":"tWNFL17pkt5ef-63K5Amn","email":"viewer-oYxkyRSy6LnA-Mj4VPcy5@example.com","msg":"User registered successfully"}
{"level":40,"time":1764895086349,"env":"test","module":"rbac-middleware","userId":"tWNFL17pkt5ef-63K5Amn","userRole":"viewer","permission":"workflow:create","path":"/projects/61ecaf66-c3cd-4ca5-93c4-05adaeff81b4/workflows","msg":"Permission denied"}
{"level":50,"time":1764895092910,"env":"test","error":{},"workflowId":"9d7481f3-5275-4c79-8547-980044031bd5","userId":"gLSxwuaIrZ4OPVAt3j9fF","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764895093252,"env":"test","module":"auth-middleware","path":"/api/workflows/302fe72f-c823-40b4-b000-a79567eb673b/move","msg":"No valid authentication found"}
{"level":30,"time":1764895093771,"env":"test","module":"user-credentials-repository","userId":"IEWstuwv6YAwmeHALPrud","msg":"User credentials created"}
{"level":30,"time":1764895093771,"env":"test","module":"auth-routes","userId":"IEWstuwv6YAwmeHALPrud","email":"test-workflows-0nOer2UDlkkgFprbugAje@example.com","msg":"User registered successfully"}
{"level":50,"time":1764895093822,"env":"test","error":{},"workflowId":"599d26be-8eca-45fa-9e49-cd5f3a67758b","userId":"IEWstuwv6YAwmeHALPrud","projectId":"b6be0d8b-818a-4d71-933c-465b460541be","msg":"Error moving workflow"}
{"level":50,"time":1764895094226,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"61914eac-6f0d-43ad-898f-ffbed51c0453","userId":"gLSxwuaIrZ4OPVAt3j9fF","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764895094637,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b4d97638-56dc-4041-9dd3-3517b7596893","userId":"gLSxwuaIrZ4OPVAt3j9fF","msg":"Error moving workflow"}
{"level":50,"time":1764895094818,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(gLSxwuaIrZ4OPVAt3j9fF) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"gLSxwuaIrZ4OPVAt3j9fF","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 502[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 654[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 849[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 411[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 181[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 18:37:52
[2m   Duration [22m 21.24s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
