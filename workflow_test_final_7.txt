npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764861517100,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764861518908,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764861520261,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764861520261,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764861520266,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764861520266,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764861520266,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764861520266,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764861521370,"env":"test","module":"user-credentials-repository","userId":"mKAoht6_mvuJaSq4rnak7","msg":"User credentials created"}
{"level":30,"time":1764861521373,"env":"test","module":"auth-routes","userId":"mKAoht6_mvuJaSq4rnak7","email":"test-workflows-OPWz5_Ny9L8lk8tSl5ijP@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f0245379-220b-4624-b5a3-b3190df2daa0","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"mKAoht6_mvuJaSq4rnak7","tenantId":"5d8f31f9-912f-47dc-b1b0-e8c32d729019","createdBy":"mKAoht6_mvuJaSq4rnak7","ownerId":"mKAoht6_mvuJaSq4rnak7","status":"active","archived":false,"createdAt":"2025-12-04T15:18:42.796Z","updatedAt":"2025-12-04T15:18:42.796Z"}

{"level":30,"time":1764861522275,"env":"test","module":"user-credentials-repository","userId":"csp0EQNKcEcs3NFZN6_0y","msg":"User credentials created"}
{"level":30,"time":1764861522276,"env":"test","module":"auth-routes","userId":"csp0EQNKcEcs3NFZN6_0y","email":"viewer-_gf19iAiBO0z953gC4fTz@example.com","msg":"User registered successfully"}
{"level":40,"time":1764861522367,"env":"test","module":"rbac-middleware","userId":"csp0EQNKcEcs3NFZN6_0y","userRole":"viewer","permission":"workflow:create","path":"/projects/f0245379-220b-4624-b5a3-b3190df2daa0/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'999910ba-82e1-40c1-9bbc-01ca07c559df'[39m,
  projectId: [32m'5cb7e8d0-ec1d-4552-85b8-65995105f161'[39m,
  body: { projectId: [32m'5cb7e8d0-ec1d-4552-85b8-65995105f161'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'999910ba-82e1-40c1-9bbc-01ca07c559df'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'mKAoht6_mvuJaSq4rnak7'[39m,
  ownerId: [32m'mKAoht6_mvuJaSq4rnak7'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'5cb7e8d0-ec1d-4552-85b8-65995105f161'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T15:18:48.305Z[39m,
  updatedAt: [35m2025-12-04T15:18:47.442Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'21854fb9-a078-48ee-8537-2e92a0555914'[39m,
  projectId: [32m'948b7a50-db23-4384-a722-628f009e55ac'[39m,
  body: { projectId: [32m'948b7a50-db23-4384-a722-628f009e55ac'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'21854fb9-a078-48ee-8537-2e92a0555914'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'mKAoht6_mvuJaSq4rnak7'[39m,
  ownerId: [32m'mKAoht6_mvuJaSq4rnak7'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'948b7a50-db23-4384-a722-628f009e55ac'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T15:18:48.950Z[39m,
  updatedAt: [35m2025-12-04T15:18:48.084Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'21854fb9-a078-48ee-8537-2e92a0555914'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'21854fb9-a078-48ee-8537-2e92a0555914'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'mKAoht6_mvuJaSq4rnak7'[39m,
  ownerId: [32m'mKAoht6_mvuJaSq4rnak7'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T15:18:48.950Z[39m,
  updatedAt: [35m2025-12-04T15:18:48.223Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'425f10aa-b1bc-44eb-ba52-22757c349823'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764861528881,"env":"test","error":{},"workflowId":"425f10aa-b1bc-44eb-ba52-22757c349823","userId":"mKAoht6_mvuJaSq4rnak7","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764861529191,"env":"test","module":"auth-middleware","path":"/api/workflows/ec44e416-500f-4a9c-9dcd-96cfeb0e7c8d/move","msg":"No valid authentication found"}
{"level":30,"time":1764861529710,"env":"test","module":"user-credentials-repository","userId":"oh8mn54CD_bVoFayIEP2t","msg":"User credentials created"}
{"level":30,"time":1764861529710,"env":"test","module":"auth-routes","userId":"oh8mn54CD_bVoFayIEP2t","email":"test-workflows-webIoobk5bfKviaOX-rVS@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'bafe703b-4dc8-4f33-b172-17e5bcae71ba'[39m,
  projectId: [32m'baca6e7d-9a30-4d49-962d-70584350d488'[39m,
  body: { projectId: [32m'baca6e7d-9a30-4d49-962d-70584350d488'[39m }
}

{"level":50,"time":1764861529766,"env":"test","error":{},"workflowId":"bafe703b-4dc8-4f33-b172-17e5bcae71ba","userId":"oh8mn54CD_bVoFayIEP2t","projectId":"baca6e7d-9a30-4d49-962d-70584350d488","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764861591182,"env":"test","module":"user-credentials-repository","userId":"KL6t3M0vHrZaguMaap0Kt","msg":"User credentials created"}
{"level":30,"time":1764861591183,"env":"test","module":"auth-routes","userId":"KL6t3M0vHrZaguMaap0Kt","email":"test-workflows-EeONr_pzT0PDapYtblNR7@example.com","msg":"User registered successfully"}
{"level":30,"time":1764861591374,"env":"test","module":"auth-routes","userId":"KL6t3M0vHrZaguMaap0Kt","email":"test-workflows-EeONr_pzT0PDapYtblNR7@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'cc9e793d-e6d8-4c80-aee9-4a6a8c8423ea'[39m,
  projectId: [32m'39a790b3-1337-4c9f-8b20-9725abe0392d'[39m,
  body: { projectId: [32m'39a790b3-1337-4c9f-8b20-9725abe0392d'[39m }
}

{"level":50,"time":1764861591563,"env":"test","error":{},"workflowId":"cc9e793d-e6d8-4c80-aee9-4a6a8c8423ea","userId":"mKAoht6_mvuJaSq4rnak7","projectId":"39a790b3-1337-4c9f-8b20-9725abe0392d","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: Error: Access denied - you do not have access to the target project
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:199:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mRunning afterAll cleanup...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 101323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 524[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 283[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 513[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 807[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 762[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 647[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 639[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 512[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 575[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30330[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1015[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:343:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:395:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:405:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/4]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 09:18:34
[2m   Duration [22m 107.35s[2m (transform 2.47s, setup 757ms, collect 4.63s, tests 101.32s, environment 0ms, prepare 16ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764861623702,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764861624815,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764861626030,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764861626030,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764861626037,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764861626037,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764861626037,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764861626037,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764861626481,"env":"test","module":"user-credentials-repository","userId":"TArj6DNhHMfWzPc_wXRrl","msg":"User credentials created"}
{"level":30,"time":1764861626485,"env":"test","module":"auth-routes","userId":"TArj6DNhHMfWzPc_wXRrl","email":"test-workflows-rPyf_pHvSiavoCB19pB49@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"045ef712-2d8e-40ff-aa55-4855de9e4e59","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"TArj6DNhHMfWzPc_wXRrl","tenantId":"e811e015-043b-4cbe-8f1c-f63c4331b4ee","createdBy":"TArj6DNhHMfWzPc_wXRrl","ownerId":"TArj6DNhHMfWzPc_wXRrl","status":"active","archived":false,"createdAt":"2025-12-04T15:20:27.896Z","updatedAt":"2025-12-04T15:20:27.896Z"}

{"level":30,"time":1764861627207,"env":"test","module":"user-credentials-repository","userId":"aKeDQ3MITXu2Xm822ON6x","msg":"User credentials created"}
{"level":30,"time":1764861627208,"env":"test","module":"auth-routes","userId":"aKeDQ3MITXu2Xm822ON6x","email":"viewer-x2RFEFFj3jMhZgwiVtOHI@example.com","msg":"User registered successfully"}
{"level":40,"time":1764861627306,"env":"test","module":"rbac-middleware","userId":"aKeDQ3MITXu2Xm822ON6x","userRole":"viewer","permission":"workflow:create","path":"/projects/045ef712-2d8e-40ff-aa55-4855de9e4e59/workflows","msg":"Permission denied"}
{"level":50,"time":1764861634073,"env":"test","error":{},"workflowId":"3febd149-fc0b-4a3a-b3a5-243f816cf057","userId":"TArj6DNhHMfWzPc_wXRrl","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764861634417,"env":"test","module":"auth-middleware","path":"/api/workflows/58130c66-d64a-4734-8f95-dc187804ea93/move","msg":"No valid authentication found"}
{"level":30,"time":1764861634937,"env":"test","module":"user-credentials-repository","userId":"UJrYnwcs0ALGjCs5mzj38","msg":"User credentials created"}
{"level":30,"time":1764861634938,"env":"test","module":"auth-routes","userId":"UJrYnwcs0ALGjCs5mzj38","email":"test-workflows-uNkxrAILjliHBEPNDd0KK@example.com","msg":"User registered successfully"}
{"level":50,"time":1764861635038,"env":"test","error":{},"workflowId":"2b9ce33e-b11d-4b1f-ade0-e7de85fe5c91","userId":"UJrYnwcs0ALGjCs5mzj38","projectId":"4f03b229-f9f6-4255-b8bd-5dcd23f8b063","msg":"Error moving workflow"}
{"level":50,"time":1764861635219,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(TArj6DNhHMfWzPc_wXRrl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"TArj6DNhHMfWzPc_wXRrl","msg":"Error creating workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Failed to create workflow in beforeEach: 500 { message: 'Failed to create workflow' }

{"level":50,"time":1764861635409,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(TArj6DNhHMfWzPc_wXRrl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"TArj6DNhHMfWzPc_wXRrl","msg":"Error creating workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Failed to create workflow in beforeEach: 500 { message: 'Failed to create workflow' }

{"level":50,"time":1764861635581,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(TArj6DNhHMfWzPc_wXRrl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"TArj6DNhHMfWzPc_wXRrl","msg":"Error creating workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Failed to create workflow in beforeEach: 500 { message: 'Failed to create workflow' }

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mRunning afterAll cleanup...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 9826[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 302[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 500[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 504[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 838[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 684[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 877[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 662[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 808[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 343[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 622[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 182[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 189[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 172[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:343:10
    341|         .get(`/api/workflows/${workflowId}`)
    342|         .set("Authorization", `Bearer ${authToken}`)
    343|         .expect(200);
       |          ^
    344| 
    345|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:10
    387|         .set("Authorization", `Bearer ${authToken2}`)
    388|         .send({ projectId: targetProjectId })
    389|         .expect(403);
       |          ^
    390| 
    391|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:288:15
    286|       if (workflowResponse.status !== 201) {
    287|         console.error('Failed to create workflow in beforeEach:', workÎ“Ã‡Âª
    288|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    289|       }
    290|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 09:20:21
[2m   Duration [22m 13.78s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764861705022,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764861706105,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764861707456,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764861707457,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764861707467,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764861707467,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764861707468,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764861707468,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764861707888,"env":"test","module":"user-credentials-repository","userId":"0SL0aSXUfRna2hZPPrM5q","msg":"User credentials created"}
{"level":30,"time":1764861707892,"env":"test","module":"auth-routes","userId":"0SL0aSXUfRna2hZPPrM5q","email":"test-workflows-dT96LF99xxExsysJHv5eE@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"80d131b9-245f-4432-8e2c-059cafe5fc97","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"0SL0aSXUfRna2hZPPrM5q","tenantId":"aed679c4-3e69-40db-9d86-e27b83710ae4","createdBy":"0SL0aSXUfRna2hZPPrM5q","ownerId":"0SL0aSXUfRna2hZPPrM5q","status":"active","archived":false,"createdAt":"2025-12-04T15:21:49.316Z","updatedAt":"2025-12-04T15:21:49.316Z"}

{"level":30,"time":1764861708562,"env":"test","module":"user-credentials-repository","userId":"_0heMDexXco6Ez3QtlC2T","msg":"User credentials created"}
{"level":30,"time":1764861708563,"env":"test","module":"auth-routes","userId":"_0heMDexXco6Ez3QtlC2T","email":"viewer-GzR-aVFsJt1HTzq1ZcN6h@example.com","msg":"User registered successfully"}
{"level":40,"time":1764861708654,"env":"test","module":"rbac-middleware","userId":"_0heMDexXco6Ez3QtlC2T","userRole":"viewer","permission":"workflow:create","path":"/projects/80d131b9-245f-4432-8e2c-059cafe5fc97/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 6746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 312[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 289[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 790[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[32m 96[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[32m 78[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[32m 87[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without authentication[39m[32m 96[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 101[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 91[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 87[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 101[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 8 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without authentication
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
ReferenceError: projectResponse is not defined
 Î“Â¥Â» tests/integration/api.workflows.test.ts:284:7
    282|           description: "Target project for move tests",
    283|         });
    284|       targetProjectId = projectResponse.body.id;
       |       ^
    285|     });
    286| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/8]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m9 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 09:21:43
[2m   Duration [22m 10.65s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764862028015,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764862029204,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764862030588,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764862030589,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764862030597,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764862030597,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764862030597,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764862030597,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764862031026,"env":"test","module":"user-credentials-repository","userId":"mkXXWaN6ipJ8tLbt8TA-E","msg":"User credentials created"}
{"level":30,"time":1764862031028,"env":"test","module":"auth-routes","userId":"mkXXWaN6ipJ8tLbt8TA-E","email":"test-workflows-DmplLEZuH5pDskO5TiJeI@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9cf45c3f-b5f5-470c-bdd3-328d4827c5a1","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"mkXXWaN6ipJ8tLbt8TA-E","tenantId":"7f18f1e7-9ae6-41c1-b334-b71693dff9b7","createdBy":"mkXXWaN6ipJ8tLbt8TA-E","ownerId":"mkXXWaN6ipJ8tLbt8TA-E","status":"active","archived":false,"createdAt":"2025-12-04T15:27:12.455Z","updatedAt":"2025-12-04T15:27:12.455Z"}

{"level":30,"time":1764862031773,"env":"test","module":"user-credentials-repository","userId":"vNqDWsIM9X4kUqV8bC0sp","msg":"User credentials created"}
{"level":30,"time":1764862031773,"env":"test","module":"auth-routes","userId":"vNqDWsIM9X4kUqV8bC0sp","email":"viewer-N34OXVHPeqKLOZ97Xtv2H@example.com","msg":"User registered successfully"}
{"level":40,"time":1764862031867,"env":"test","module":"rbac-middleware","userId":"vNqDWsIM9X4kUqV8bC0sp","userRole":"viewer","permission":"workflow:create","path":"/projects/9cf45c3f-b5f5-470c-bdd3-328d4827c5a1/workflows","msg":"Permission denied"}
{"level":50,"time":1764862038371,"env":"test","error":{},"workflowId":"69687e03-39f7-482e-b64d-e1da49ca2ad2","userId":"mkXXWaN6ipJ8tLbt8TA-E","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764862038714,"env":"test","module":"auth-middleware","path":"/api/workflows/bd99a65f-f916-44b4-bc14-f18f95c15dd6/move","msg":"No valid authentication found"}
{"level":30,"time":1764862039242,"env":"test","module":"user-credentials-repository","userId":"ObNE2ldyHM9Dh5V9E2TXv","msg":"User credentials created"}
{"level":30,"time":1764862039243,"env":"test","module":"auth-routes","userId":"ObNE2ldyHM9Dh5V9E2TXv","email":"test-workflows-QOQSqzmb9G37SBbNjvbXh@example.com","msg":"User registered successfully"}
{"level":50,"time":1764862039288,"env":"test","error":{},"workflowId":"a2133fdb-c038-4f29-b14d-7bad2d90898f","userId":"ObNE2ldyHM9Dh5V9E2TXv","projectId":"2ff2af94-63f1-4eec-a447-c8f85222d122","msg":"Error moving workflow"}
{"level":50,"time":1764862039690,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"668ba9d5-965b-4f7b-ae67-8ee9dee32491","userId":"mkXXWaN6ipJ8tLbt8TA-E","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764862040071,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f62bf423-05dd-450f-9b6b-fa983256a559","userId":"mkXXWaN6ipJ8tLbt8TA-E","msg":"Error moving workflow"}
{"level":30,"time":1764862040603,"env":"test","module":"user-credentials-repository","userId":"pxFLXjnLDvg8ruw8czSB-","msg":"User credentials created"}
{"level":30,"time":1764862040604,"env":"test","module":"auth-routes","userId":"pxFLXjnLDvg8ruw8czSB-","email":"test-workflows-WQ8cOdsxPqfebP1vTC--8@example.com","msg":"User registered successfully"}
{"level":30,"time":1764862040817,"env":"test","module":"auth-routes","userId":"pxFLXjnLDvg8ruw8czSB-","email":"test-workflows-WQ8cOdsxPqfebP1vTC--8@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764862041022,"env":"test","error":{},"workflowId":"3312cc22-b0f7-49ef-9f6d-015cf3854639","userId":"mkXXWaN6ipJ8tLbt8TA-E","projectId":"cbe01bb3-3cbb-40f1-ab1d-c8d430596118","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 825[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 651[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 499[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 402[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 951[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 09:27:06
[2m   Duration [22m 14.87s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764866788405,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764866789691,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764866791143,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764866791143,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764866791155,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764866791155,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764866791156,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764866791156,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764866791604,"env":"test","module":"user-credentials-repository","userId":"FeGo95-unanlqHS2_qOuB","msg":"User credentials created"}
{"level":30,"time":1764866791607,"env":"test","module":"auth-routes","userId":"FeGo95-unanlqHS2_qOuB","email":"test-workflows-IqLcXhLDpocxpROprQNi5@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"28ab2bca-6d4a-4514-acf5-fef7fccca65b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"FeGo95-unanlqHS2_qOuB","tenantId":"7c0e367a-d55d-41ec-8658-c9146325c803","createdBy":"FeGo95-unanlqHS2_qOuB","ownerId":"FeGo95-unanlqHS2_qOuB","status":"active","archived":false,"createdAt":"2025-12-04T16:46:33.109Z","updatedAt":"2025-12-04T16:46:33.109Z"}

{"level":30,"time":1764866792291,"env":"test","module":"user-credentials-repository","userId":"pvHpLATWkqb7OJftV219B","msg":"User credentials created"}
{"level":30,"time":1764866792292,"env":"test","module":"auth-routes","userId":"pvHpLATWkqb7OJftV219B","email":"viewer-2AcGesXtSsFMrVqOqtOXZ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764866792398,"env":"test","module":"rbac-middleware","userId":"pvHpLATWkqb7OJftV219B","userRole":"viewer","permission":"workflow:create","path":"/projects/28ab2bca-6d4a-4514-acf5-fef7fccca65b/workflows","msg":"Permission denied"}
{"level":50,"time":1764866798986,"env":"test","error":{},"workflowId":"c4eb98f0-acc5-43e1-9d51-fcb2596098ec","userId":"FeGo95-unanlqHS2_qOuB","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764866799332,"env":"test","module":"auth-middleware","path":"/api/workflows/1dd5c452-e57e-4c71-8401-26f345fad201/move","msg":"No valid authentication found"}
{"level":30,"time":1764866799858,"env":"test","module":"user-credentials-repository","userId":"fCB4dK457T--wwlhv0PXI","msg":"User credentials created"}
{"level":30,"time":1764866799858,"env":"test","module":"auth-routes","userId":"fCB4dK457T--wwlhv0PXI","email":"test-workflows-MQPI08-hKV5Muin4N2M2X@example.com","msg":"User registered successfully"}
{"level":50,"time":1764866799921,"env":"test","error":{},"workflowId":"667155f8-bd1d-4f87-957a-0afa783ce5f0","userId":"fCB4dK457T--wwlhv0PXI","projectId":"3954c49f-42b8-42cd-b167-1655bce6e951","msg":"Error moving workflow"}
{"level":50,"time":1764866800305,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b26b4c86-e0a9-4755-b58b-337aa0a6f535","userId":"FeGo95-unanlqHS2_qOuB","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764866800701,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"31804d57-8e5b-4f2c-92e1-7d2517c0cd19","userId":"FeGo95-unanlqHS2_qOuB","msg":"Error moving workflow"}
{"level":30,"time":1764866801258,"env":"test","module":"user-credentials-repository","userId":"AkIz_pFpcefYyJy7v1YiE","msg":"User credentials created"}
{"level":30,"time":1764866801259,"env":"test","module":"auth-routes","userId":"AkIz_pFpcefYyJy7v1YiE","email":"test-workflows-osz9aSDdV0M2zy06jqLyA@example.com","msg":"User registered successfully"}
{"level":30,"time":1764866801472,"env":"test","module":"auth-routes","userId":"AkIz_pFpcefYyJy7v1YiE","email":"test-workflows-osz9aSDdV0M2zy06jqLyA@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764866801665,"env":"test","error":{},"workflowId":"02a6678d-e767-4eec-9966-8d6085d67b31","userId":"FeGo95-unanlqHS2_qOuB","projectId":"ce09335e-0f60-4515-a763-23996c804753","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10860[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 336[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 298[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 827[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 673[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 646[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 802[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 345[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 397[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 964[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:46:26
[2m   Duration [22m 15.42s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764867267269,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867268743,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867270438,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867270439,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867270450,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867270451,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867270451,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867270451,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867270912,"env":"test","module":"user-credentials-repository","userId":"Nh8feUZr2Wdcw2WBWdtKm","msg":"User credentials created"}
{"level":30,"time":1764867270915,"env":"test","module":"auth-routes","userId":"Nh8feUZr2Wdcw2WBWdtKm","email":"test-workflows-MbnBz-1vk3qS0G4j2PsjM@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"5827bef1-bf03-4669-9ceb-aff7c9e85f34","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Nh8feUZr2Wdcw2WBWdtKm","tenantId":"17f61cf6-9655-42a8-a5b1-c39d66125767","createdBy":"Nh8feUZr2Wdcw2WBWdtKm","ownerId":"Nh8feUZr2Wdcw2WBWdtKm","status":"active","archived":false,"createdAt":"2025-12-04T16:54:32.424Z","updatedAt":"2025-12-04T16:54:32.424Z"}

{"level":30,"time":1764867271636,"env":"test","module":"user-credentials-repository","userId":"wThcCvF73WpURkd4Y11JC","msg":"User credentials created"}
{"level":30,"time":1764867271637,"env":"test","module":"auth-routes","userId":"wThcCvF73WpURkd4Y11JC","email":"viewer-LHpzKVwfKyT7NIUqePLKn@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867271741,"env":"test","module":"rbac-middleware","userId":"wThcCvF73WpURkd4Y11JC","userRole":"viewer","permission":"workflow:create","path":"/projects/5827bef1-bf03-4669-9ceb-aff7c9e85f34/workflows","msg":"Permission denied"}
{"level":50,"time":1764867278788,"env":"test","error":{},"workflowId":"1ddade7c-4265-4b50-8126-a0fd50c1348d","userId":"Nh8feUZr2Wdcw2WBWdtKm","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867279125,"env":"test","module":"auth-middleware","path":"/api/workflows/7bce43f1-c832-42d7-8903-20518eeb0030/move","msg":"No valid authentication found"}
{"level":30,"time":1764867279677,"env":"test","module":"user-credentials-repository","userId":"jZIiYqdPTtinujFTm4vYY","msg":"User credentials created"}
{"level":30,"time":1764867279677,"env":"test","module":"auth-routes","userId":"jZIiYqdPTtinujFTm4vYY","email":"test-workflows-8jg9Hj2_T62UQw31tNnl4@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867279731,"env":"test","error":{},"workflowId":"5541dbc4-7e7d-4f5d-bfee-fdbc2cb268d0","userId":"jZIiYqdPTtinujFTm4vYY","projectId":"31a27e98-b2fd-463c-9de9-6141065d32be","msg":"Error moving workflow"}
{"level":50,"time":1764867280133,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"dfa51bbd-847e-4ca3-8fbd-8859b3bd2f6f","userId":"Nh8feUZr2Wdcw2WBWdtKm","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867280557,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a116d4fc-8539-441c-a0de-2cf862fc9587","userId":"Nh8feUZr2Wdcw2WBWdtKm","msg":"Error moving workflow"}
{"level":30,"time":1764867281110,"env":"test","module":"user-credentials-repository","userId":"v8IFbwIJJluxSyufoktMT","msg":"User credentials created"}
{"level":30,"time":1764867281110,"env":"test","module":"auth-routes","userId":"v8IFbwIJJluxSyufoktMT","email":"test-workflows-w8nDb_GZrSw-yRjGFyjM-@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867281316,"env":"test","module":"auth-routes","userId":"v8IFbwIJJluxSyufoktMT","email":"test-workflows-w8nDb_GZrSw-yRjGFyjM-@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867281543,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"02949152-cd7b-43d5-8997-248ba32bc66e","userId":"Nh8feUZr2Wdcw2WBWdtKm","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11416[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 529[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 837[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 669[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 826[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 854[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 701[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 869[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 509[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 402[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 423[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 987[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:54:25
[2m   Duration [22m 16.43s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764867555984,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867558121,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867560481,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867560481,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867560493,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867560493,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867560494,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867560494,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867560971,"env":"test","module":"user-credentials-repository","userId":"VM6BsKjx7iWJTlc7XZVqV","msg":"User credentials created"}
{"level":30,"time":1764867560974,"env":"test","module":"auth-routes","userId":"VM6BsKjx7iWJTlc7XZVqV","email":"test-workflows-4wDGLffSQxEJp5CCkPuLJ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d788cbfb-35bf-491d-b251-ae15d8f67ff6","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"VM6BsKjx7iWJTlc7XZVqV","tenantId":"4244e9b2-6978-4845-9ee5-1e3290cdb562","createdBy":"VM6BsKjx7iWJTlc7XZVqV","ownerId":"VM6BsKjx7iWJTlc7XZVqV","status":"active","archived":false,"createdAt":"2025-12-04T16:59:22.471Z","updatedAt":"2025-12-04T16:59:22.471Z"}

{"level":30,"time":1764867561618,"env":"test","module":"user-credentials-repository","userId":"I9r_tXQPhqHsMyD55tAAw","msg":"User credentials created"}
{"level":30,"time":1764867561619,"env":"test","module":"auth-routes","userId":"I9r_tXQPhqHsMyD55tAAw","email":"viewer-UaFPSaE57PWHgZ-JaOfxD@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867561711,"env":"test","module":"rbac-middleware","userId":"I9r_tXQPhqHsMyD55tAAw","userRole":"viewer","permission":"workflow:create","path":"/projects/d788cbfb-35bf-491d-b251-ae15d8f67ff6/workflows","msg":"Permission denied"}
{"level":50,"time":1764867567519,"env":"test","error":{},"workflowId":"11277e46-26b1-43a6-b3c2-c9a369aaa570","userId":"VM6BsKjx7iWJTlc7XZVqV","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867567814,"env":"test","module":"auth-middleware","path":"/api/workflows/755cad48-fd19-4897-b05c-a88f182cd0e3/move","msg":"No valid authentication found"}
{"level":30,"time":1764867568283,"env":"test","module":"user-credentials-repository","userId":"p_6qs3lUjswlQ66vAQjSZ","msg":"User credentials created"}
{"level":30,"time":1764867568283,"env":"test","module":"auth-routes","userId":"p_6qs3lUjswlQ66vAQjSZ","email":"test-workflows-22bUNB9bEZSvPL8n0icfd@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867568330,"env":"test","error":{},"workflowId":"e3153055-9a3d-4f3e-adcc-fc5b641ffb6b","userId":"p_6qs3lUjswlQ66vAQjSZ","projectId":"426de00a-433a-41f2-8f1f-c270f5b7001c","msg":"Error moving workflow"}
{"level":50,"time":1764867568673,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"cca74bdd-93a4-49b4-975c-d4d50bfcc4e6","userId":"VM6BsKjx7iWJTlc7XZVqV","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867569010,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"00a47278-75be-4a8c-8158-12b83ce4f052","userId":"VM6BsKjx7iWJTlc7XZVqV","msg":"Error moving workflow"}
{"level":30,"time":1764867569505,"env":"test","module":"user-credentials-repository","userId":"qXkdVDwnaIbkp9Eb0jU32","msg":"User credentials created"}
{"level":30,"time":1764867569506,"env":"test","module":"auth-routes","userId":"qXkdVDwnaIbkp9Eb0jU32","email":"test-workflows-ljInstNNwBIXho7c10TPD@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867569691,"env":"test","module":"auth-routes","userId":"qXkdVDwnaIbkp9Eb0jU32","email":"test-workflows-ljInstNNwBIXho7c10TPD@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867569861,"env":"test","error":{},"workflowId":"a2d4f23e-7249-41a7-aadd-3958986a667b","userId":"VM6BsKjx7iWJTlc7XZVqV","projectId":"32378d32-7ac2-4157-85cc-138953cb1166","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9683[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 315[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 284[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 430[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 705[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 680[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 568[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 704[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 432[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 516[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 852[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();

 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:59:13
[2m   Duration [22m 16.41s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764867688848,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867690640,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867692437,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867692438,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867692449,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867692449,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867692449,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867692449,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867692906,"env":"test","module":"user-credentials-repository","userId":"GIVLFc0JlsVK1EIPq774K","msg":"User credentials created"}
{"level":30,"time":1764867692908,"env":"test","module":"auth-routes","userId":"GIVLFc0JlsVK1EIPq774K","email":"test-workflows-JsmOi64he4kCljrMElQJp@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"8d548cb5-9fc3-42e2-8b63-63598460f336","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"GIVLFc0JlsVK1EIPq774K","tenantId":"7371846b-7428-41d0-81bf-94afffbc3576","createdBy":"GIVLFc0JlsVK1EIPq774K","ownerId":"GIVLFc0JlsVK1EIPq774K","status":"active","archived":false,"createdAt":"2025-12-04T17:01:34.414Z","updatedAt":"2025-12-04T17:01:34.414Z"}

{"level":30,"time":1764867693568,"env":"test","module":"user-credentials-repository","userId":"5hzmzqTnfU3rVVHvoHGIC","msg":"User credentials created"}
{"level":30,"time":1764867693570,"env":"test","module":"auth-routes","userId":"5hzmzqTnfU3rVVHvoHGIC","email":"viewer-L1sJJrKMrALvdS5iUdk8T@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867693666,"env":"test","module":"rbac-middleware","userId":"5hzmzqTnfU3rVVHvoHGIC","userRole":"viewer","permission":"workflow:create","path":"/projects/8d548cb5-9fc3-42e2-8b63-63598460f336/workflows","msg":"Permission denied"}
{"level":50,"time":1764867699936,"env":"test","error":{},"workflowId":"e91a5357-6d6b-4a4a-8669-5623e67cb810","userId":"GIVLFc0JlsVK1EIPq774K","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867700248,"env":"test","module":"auth-middleware","path":"/api/workflows/5f6a63ac-e3b3-4637-a3a4-ad04410a311a/move","msg":"No valid authentication found"}
{"level":30,"time":1764867700763,"env":"test","module":"user-credentials-repository","userId":"sA-EHPDr400dRaereHgKH","msg":"User credentials created"}
{"level":30,"time":1764867700764,"env":"test","module":"auth-routes","userId":"sA-EHPDr400dRaereHgKH","email":"test-workflows-pyCG1EW--77E_DOf5Q14g@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867700814,"env":"test","error":{},"workflowId":"a93841be-82a0-475a-a023-cb5aa7f9e99c","userId":"sA-EHPDr400dRaereHgKH","projectId":"7fde27a4-7202-4919-bc7c-1f971ee4a4ce","msg":"Error moving workflow"}
{"level":50,"time":1764867701191,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2979e429-d17e-4096-9eaa-f87052ae1734","userId":"GIVLFc0JlsVK1EIPq774K","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867701560,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"df0e344f-b68a-4381-9378-b46025f33cc6","userId":"GIVLFc0JlsVK1EIPq774K","msg":"Error moving workflow"}
{"level":30,"time":1764867702070,"env":"test","module":"user-credentials-repository","userId":"Zh-QXpC8xaUIl5Mwtxy5P","msg":"User credentials created"}
{"level":30,"time":1764867702070,"env":"test","module":"auth-routes","userId":"Zh-QXpC8xaUIl5Mwtxy5P","email":"test-workflows-rzhuGAvm8iiSxvnLVS8FH@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867702161,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764867702207,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"50ca57be-9238-43c1-adaf-21038ffee9c2","userId":"GIVLFc0JlsVK1EIPq774K","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10025[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 315[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 796[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 623[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 647[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:01:26
[2m   Duration [22m 15.90s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764868031481,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868033405,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868035489,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868035489,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868035502,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868035503,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868035505,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868035505,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868036519,"env":"test","module":"user-credentials-repository","userId":"mg2jVcCmd8OZuji54UZ_8","msg":"User credentials created"}
{"level":30,"time":1764868036522,"env":"test","module":"auth-routes","userId":"mg2jVcCmd8OZuji54UZ_8","email":"test-workflows--KkP70kikvc4j9OMgjIFA@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"6ef61f1c-ddfc-4ce7-a34b-c3689521617d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"mg2jVcCmd8OZuji54UZ_8","tenantId":"7bec5101-dbfe-42b8-a902-e6f12af18ea8","createdBy":"mg2jVcCmd8OZuji54UZ_8","ownerId":"mg2jVcCmd8OZuji54UZ_8","status":"active","archived":false,"createdAt":"2025-12-04T17:07:18.045Z","updatedAt":"2025-12-04T17:07:18.045Z"}

{"level":30,"time":1764868037302,"env":"test","module":"user-credentials-repository","userId":"-ED9k0WEC_vpOTf-dkpLe","msg":"User credentials created"}
{"level":30,"time":1764868037303,"env":"test","module":"auth-routes","userId":"-ED9k0WEC_vpOTf-dkpLe","email":"viewer-RciNBtTohCuBJzi84ePv7@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868037401,"env":"test","module":"rbac-middleware","userId":"-ED9k0WEC_vpOTf-dkpLe","userRole":"viewer","permission":"workflow:create","path":"/projects/6ef61f1c-ddfc-4ce7-a34b-c3689521617d/workflows","msg":"Permission denied"}
{"level":50,"time":1764868043930,"env":"test","error":{},"workflowId":"92d32c13-3261-4e8b-abf3-9efbb521530b","userId":"mg2jVcCmd8OZuji54UZ_8","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868044275,"env":"test","module":"auth-middleware","path":"/api/workflows/858248d6-5472-4d29-a94c-87764518a0eb/move","msg":"No valid authentication found"}
{"level":30,"time":1764868044797,"env":"test","module":"user-credentials-repository","userId":"NRcOyb-gppnVHjpzENhNb","msg":"User credentials created"}
{"level":30,"time":1764868044798,"env":"test","module":"auth-routes","userId":"NRcOyb-gppnVHjpzENhNb","email":"test-workflows-aYewiJeuzWZh2x9jD02OB@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868044847,"env":"test","error":{},"workflowId":"627eb915-4eb6-4b46-9784-f75fdc65d355","userId":"NRcOyb-gppnVHjpzENhNb","projectId":"62ea38ef-1bbd-44f0-a0b7-055551040384","msg":"Error moving workflow"}
{"level":50,"time":1764868045335,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"a4c0a00a-6acf-4065-8424-f679c1ba16bf","userId":"mg2jVcCmd8OZuji54UZ_8","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868045724,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"5a498861-9517-4325-aff2-d06000917493","userId":"mg2jVcCmd8OZuji54UZ_8","msg":"Error moving workflow"}
{"level":30,"time":1764868046300,"env":"test","module":"user-credentials-repository","userId":"GcZi6Rl2e00QdnMBX1jyP","msg":"User credentials created"}
{"level":30,"time":1764868046301,"env":"test","module":"auth-routes","userId":"GcZi6Rl2e00QdnMBX1jyP","email":"test-workflows-uQOkZqxrsHX1hxdx929nH@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868046522,"env":"test","module":"auth-routes","userId":"GcZi6Rl2e00QdnMBX1jyP","email":"test-workflows-uQOkZqxrsHX1hxdx929nH@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868046742,"env":"test","error":{},"workflowId":"cd0f08d6-6e39-4b31-9df2-fe19183db1b1","userId":"mg2jVcCmd8OZuji54UZ_8","projectId":"729326fb-af24-49b8-910c-0c7217860855","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11542[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 841[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 812[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 617[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 504[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1020[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:07:08
[2m   Duration [22m 17.98s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764868270617,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868272307,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868274112,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868274113,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868274127,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868274127,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868274128,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868274128,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868274557,"env":"test","module":"user-credentials-repository","userId":"2jVzeyGXHqGyxTQL_ZPBT","msg":"User credentials created"}
{"level":30,"time":1764868274560,"env":"test","module":"auth-routes","userId":"2jVzeyGXHqGyxTQL_ZPBT","email":"test-workflows-iWguhJBKge_8-lA-vkJ0I@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"094d04ca-d17b-4708-a44c-bac2c514b150","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"2jVzeyGXHqGyxTQL_ZPBT","tenantId":"0ca63ca7-0d38-4241-ac94-a01bb58d060b","createdBy":"2jVzeyGXHqGyxTQL_ZPBT","ownerId":"2jVzeyGXHqGyxTQL_ZPBT","status":"active","archived":false,"createdAt":"2025-12-04T17:11:16.072Z","updatedAt":"2025-12-04T17:11:16.072Z"}

{"level":30,"time":1764868275190,"env":"test","module":"user-credentials-repository","userId":"RZmCOWTcktdNx3eHqqZuJ","msg":"User credentials created"}
{"level":30,"time":1764868275191,"env":"test","module":"auth-routes","userId":"RZmCOWTcktdNx3eHqqZuJ","email":"viewer-wwhcaQalAn8Bv9bcRbVub@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868275288,"env":"test","module":"rbac-middleware","userId":"RZmCOWTcktdNx3eHqqZuJ","userRole":"viewer","permission":"workflow:create","path":"/projects/094d04ca-d17b-4708-a44c-bac2c514b150/workflows","msg":"Permission denied"}
{"level":50,"time":1764868281225,"env":"test","error":{},"workflowId":"69281ca3-803c-4c5b-9d6d-dae248cb2cb7","userId":"2jVzeyGXHqGyxTQL_ZPBT","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868281539,"env":"test","module":"auth-middleware","path":"/api/workflows/2a14200e-67bf-4bb9-ad79-64428a355020/move","msg":"No valid authentication found"}
{"level":30,"time":1764868282052,"env":"test","module":"user-credentials-repository","userId":"60rZdINvhaN6bb4eBUdKy","msg":"User credentials created"}
{"level":30,"time":1764868282053,"env":"test","module":"auth-routes","userId":"60rZdINvhaN6bb4eBUdKy","email":"test-workflows-3t1-KE4P2BlI-xi56UR-a@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868282099,"env":"test","error":{},"workflowId":"53e2e8ff-31f2-40e9-8b08-679fa22f8f07","userId":"60rZdINvhaN6bb4eBUdKy","projectId":"81495f27-5995-4e18-96a9-172f4914be4e","msg":"Error moving workflow"}
{"level":50,"time":1764868282454,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"38db5a9f-2d6e-40b3-94a8-ca5734df2fc7","userId":"2jVzeyGXHqGyxTQL_ZPBT","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868282809,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4d0fe300-ac27-463a-8444-4d29511abc7f","userId":"2jVzeyGXHqGyxTQL_ZPBT","msg":"Error moving workflow"}
{"level":30,"time":1764868283305,"env":"test","module":"user-credentials-repository","userId":"2S03JLKjvNL0Iz3KSP7gZ","msg":"User credentials created"}
{"level":30,"time":1764868283306,"env":"test","module":"auth-routes","userId":"2S03JLKjvNL0Iz3KSP7gZ","email":"test-workflows-Hy6NEQp4n1er_dsApAHxT@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868283497,"env":"test","module":"auth-routes","userId":"2S03JLKjvNL0Iz3KSP7gZ","email":"test-workflows-Hy6NEQp4n1er_dsApAHxT@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868283684,"env":"test","error":{},"workflowId":"a5e8af11-7459-4647-8ae6-79ee4e630a3f","userId":"2jVzeyGXHqGyxTQL_ZPBT","projectId":"c233f008-8d4a-48df-84f6-78c6c26cfc73","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9873[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create a new draft workflow[32m 291[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 299[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 552[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 677[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 600[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 698[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 311[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 876[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:11:07
[2m   Duration [22m 15.65s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764868529030,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531245,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533496,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533497,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533505,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533505,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533506,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533506,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868533946,"env":"test","module":"user-credentials-repository","userId":"HP3DiXzRzVonT1MpgTrTK","msg":"User credentials created"}
{"level":30,"time":1764868533949,"env":"test","module":"auth-routes","userId":"HP3DiXzRzVonT1MpgTrTK","email":"test-workflows-dYuTrhbzpZxumoDqRB6EO@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"87d3f5d2-c092-4f84-8c1f-a536c6affce9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"HP3DiXzRzVonT1MpgTrTK","tenantId":"d774018a-a506-4dcd-a330-e5df659c0b14","createdBy":"HP3DiXzRzVonT1MpgTrTK","ownerId":"HP3DiXzRzVonT1MpgTrTK","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.469Z","updatedAt":"2025-12-04T17:15:35.469Z"}

{"level":30,"time":1764868534629,"env":"test","module":"user-credentials-repository","userId":"vKy6OAHjyUO1LC-PHLfMw","msg":"User credentials created"}
{"level":30,"time":1764868534630,"env":"test","module":"auth-routes","userId":"vKy6OAHjyUO1LC-PHLfMw","email":"viewer--V08C5dD4EwLkHD19QOVc@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534723,"env":"test","module":"rbac-middleware","userId":"vKy6OAHjyUO1LC-PHLfMw","userRole":"viewer","permission":"workflow:create","path":"/projects/87d3f5d2-c092-4f84-8c1f-a536c6affce9/workflows","msg":"Permission denied"}
{"level":50,"time":1764868541007,"env":"test","error":{},"workflowId":"92ae02c9-7cf6-4b75-ab4c-fd7ff6e131f8","userId":"HP3DiXzRzVonT1MpgTrTK","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541321,"env":"test","module":"auth-middleware","path":"/api/workflows/3a87857e-e589-4594-b325-7a1a301c104c/move","msg":"No valid authentication found"}
{"level":30,"time":1764868541833,"env":"test","module":"user-credentials-repository","userId":"IeG-iSWbwGvVNjvknmlwK","msg":"User credentials created"}
{"level":30,"time":1764868541833,"env":"test","module":"auth-routes","userId":"IeG-iSWbwGvVNjvknmlwK","email":"test-workflows-URsyEnW7EEasH328mOcul@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868541879,"env":"test","error":{},"workflowId":"853db717-9c8b-4845-87bb-3829069a0cd3","userId":"IeG-iSWbwGvVNjvknmlwK","projectId":"df83ab5d-823f-4528-9ffa-8ba411406141","msg":"Error moving workflow"}
{"level":50,"time":1764868542258,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"07b9532f-66e8-4616-8481-210a0ea73df7","userId":"HP3DiXzRzVonT1MpgTrTK","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868542734,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d341e0ce-ab60-450e-b3a9-221a8c18ab36","userId":"HP3DiXzRzVonT1MpgTrTK","msg":"Error moving workflow"}
{"level":30,"time":1764868543394,"env":"test","module":"user-credentials-repository","userId":"OY7w4T6jONeM1RpDjbNiE","msg":"User credentials created"}
{"level":30,"time":1764868543395,"env":"test","module":"auth-routes","userId":"OY7w4T6jONeM1RpDjbNiE","email":"test-workflows-OYV8sm4PYkNLhymCsWmdm@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868543587,"env":"test","module":"auth-routes","userId":"OY7w4T6jONeM1RpDjbNiE","email":"test-workflows-OYV8sm4PYkNLhymCsWmdm@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868543814,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"506de509-ec01-41da-b03e-85b2c17a151d","userId":"HP3DiXzRzVonT1MpgTrTK","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 332[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 785[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 559[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 473[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1080[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 17.97s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764868816508,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818553,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820626,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820626,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820638,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820638,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820639,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820639,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821111,"env":"test","module":"user-credentials-repository","userId":"nHpVUobSMMlT__CH03LuF","msg":"User credentials created"}
{"level":30,"time":1764868821113,"env":"test","module":"auth-routes","userId":"nHpVUobSMMlT__CH03LuF","email":"test-workflows-F7IkblhkfZg9-mnRqv6Nr@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0b3fbe6d-8b8f-435f-8d35-3d02cbdf8398","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"nHpVUobSMMlT__CH03LuF","tenantId":"f8ff46c7-3b33-4db7-9342-ffef60f9dc96","createdBy":"nHpVUobSMMlT__CH03LuF","ownerId":"nHpVUobSMMlT__CH03LuF","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.654Z","updatedAt":"2025-12-04T17:20:22.654Z"}

{"level":30,"time":1764868821814,"env":"test","module":"user-credentials-repository","userId":"GurP5BHc--tLMFMsriMex","msg":"User credentials created"}
{"level":30,"time":1764868821815,"env":"test","module":"auth-routes","userId":"GurP5BHc--tLMFMsriMex","email":"viewer-Jpyt89PFlFdYA7QGmLTNM@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821917,"env":"test","module":"rbac-middleware","userId":"GurP5BHc--tLMFMsriMex","userRole":"viewer","permission":"workflow:create","path":"/projects/0b3fbe6d-8b8f-435f-8d35-3d02cbdf8398/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828239,"env":"test","error":{},"workflowId":"9e7ed887-aa1a-4fa3-aaf2-42204c0e45a2","userId":"nHpVUobSMMlT__CH03LuF","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828561,"env":"test","module":"auth-middleware","path":"/api/workflows/e3aaf643-660c-443f-a6dd-95ed5d2dc05d/move","msg":"No valid authentication found"}
{"level":30,"time":1764868829075,"env":"test","module":"user-credentials-repository","userId":"p1l-5TaKLzHs4JSi3PDq2","msg":"User credentials created"}
{"level":30,"time":1764868829076,"env":"test","module":"auth-routes","userId":"p1l-5TaKLzHs4JSi3PDq2","email":"test-workflows-32T-chjB_nR_L4SztgEWK@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868829122,"env":"test","error":{},"workflowId":"6420f9c2-455e-4bf6-a4fe-51deffa830ab","userId":"p1l-5TaKLzHs4JSi3PDq2","projectId":"afad4dfa-8188-4ce1-9d62-9be1c8ece6b2","msg":"Error moving workflow"}
{"level":50,"time":1764868829501,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"40fa2ed2-5f81-419c-b649-571f0437b833","userId":"nHpVUobSMMlT__CH03LuF","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868829893,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f63c52c1-f634-4727-a27d-50e6760123e1","userId":"nHpVUobSMMlT__CH03LuF","msg":"Error moving workflow"}
{"level":30,"time":1764868830420,"env":"test","module":"user-credentials-repository","userId":"4dfN5P2C0EPL_j_qTVQUX","msg":"User credentials created"}
{"level":30,"time":1764868830421,"env":"test","module":"auth-routes","userId":"4dfN5P2C0EPL_j_qTVQUX","email":"test-workflows-bPr_fMwg1KeRCchJaDxpf@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830634,"env":"test","module":"auth-routes","userId":"4dfN5P2C0EPL_j_qTVQUX","email":"test-workflows-bPr_fMwg1KeRCchJaDxpf@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868830822,"env":"test","error":{},"workflowId":"76605f49-09a2-4f22-afa7-a297c794138d","userId":"nHpVUobSMMlT__CH03LuF","projectId":"d19bd79d-9478-4457-ac6e-0b4d8cf5b40b","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 302[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 742[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 929[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.44s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764871633261,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871636987,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871641480,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871641481,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871641495,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871641496,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871641496,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871641496,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871642022,"env":"test","module":"user-credentials-repository","userId":"GNH63Bd5vv-tLsE7Ze8ud","msg":"User credentials created"}
{"level":30,"time":1764871642027,"env":"test","module":"auth-routes","userId":"GNH63Bd5vv-tLsE7Ze8ud","email":"test-workflows-N21m_xeDYspX8FR9E-QBZ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c4102233-3aab-4a2a-9c88-bf91344315b7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"GNH63Bd5vv-tLsE7Ze8ud","tenantId":"6e9fb645-71a6-45fe-b32d-fd1833147b67","createdBy":"GNH63Bd5vv-tLsE7Ze8ud","ownerId":"GNH63Bd5vv-tLsE7Ze8ud","status":"active","archived":false,"createdAt":"2025-12-04T18:07:23.599Z","updatedAt":"2025-12-04T18:07:23.599Z"}

{"level":30,"time":1764871642688,"env":"test","module":"user-credentials-repository","userId":"SC5Po8VWL0V7f5XO8XPNm","msg":"User credentials created"}
{"level":30,"time":1764871642689,"env":"test","module":"auth-routes","userId":"SC5Po8VWL0V7f5XO8XPNm","email":"viewer-J-XvI5OeNoH4alKnyErMG@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871642777,"env":"test","module":"rbac-middleware","userId":"SC5Po8VWL0V7f5XO8XPNm","userRole":"viewer","permission":"workflow:create","path":"/projects/c4102233-3aab-4a2a-9c88-bf91344315b7/workflows","msg":"Permission denied"}
{"level":50,"time":1764871648714,"env":"test","error":{},"workflowId":"6dd63c7d-ea43-4535-8204-0633a45db1da","userId":"GNH63Bd5vv-tLsE7Ze8ud","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871649042,"env":"test","module":"auth-middleware","path":"/api/workflows/d90bcdab-bdd2-46ef-a189-e046589e4ade/move","msg":"No valid authentication found"}
{"level":30,"time":1764871649554,"env":"test","module":"user-credentials-repository","userId":"nMwbwdmMbEhpzRxWY8Ppw","msg":"User credentials created"}
{"level":30,"time":1764871649555,"env":"test","module":"auth-routes","userId":"nMwbwdmMbEhpzRxWY8Ppw","email":"test-workflows-OjA6gKa9IXXgI9awM8sdm@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871649617,"env":"test","error":{},"workflowId":"320fa50b-e519-4ce0-b5a1-35f72db3182a","userId":"nMwbwdmMbEhpzRxWY8Ppw","projectId":"98e4a47a-cf88-4aa2-8990-e52f6786e4c8","msg":"Error moving workflow"}
{"level":50,"time":1764871649974,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"5cee6c96-cb99-4899-b77a-35df5b06003f","userId":"GNH63Bd5vv-tLsE7Ze8ud","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871650336,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c626d473-20f8-45db-983d-ad705c70f4a8","userId":"GNH63Bd5vv-tLsE7Ze8ud","msg":"Error moving workflow"}
{"level":30,"time":1764871650832,"env":"test","module":"user-credentials-repository","userId":"NdK7YbAq-As5vVUXU5tt_","msg":"User credentials created"}
{"level":30,"time":1764871650833,"env":"test","module":"auth-routes","userId":"NdK7YbAq-As5vVUXU5tt_","email":"test-workflows-dFCmPsa7Wrtu_pibIwlst@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871651025,"env":"test","module":"auth-routes","userId":"NdK7YbAq-As5vVUXU5tt_","email":"test-workflows-dFCmPsa7Wrtu_pibIwlst@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871651202,"env":"test","error":{},"workflowId":"36ae73ce-3ad4-43e8-8d9e-b9c9b309c6f8","userId":"GNH63Bd5vv-tLsE7Ze8ud","projectId":"09ca8493-b844-4e82-8f75-5751d6fedb8e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10157[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 695[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 420[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 866[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 22.08s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764871702085,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871706247,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871709597,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871709598,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871709610,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871709610,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871709610,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871709610,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710096,"env":"test","module":"user-credentials-repository","userId":"Wop1vIUz7AOc90zbhiNzS","msg":"User credentials created"}
{"level":30,"time":1764871710100,"env":"test","module":"auth-routes","userId":"Wop1vIUz7AOc90zbhiNzS","email":"test-workflows-QY-al-6KFXZMjbYHuG3ua@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9ff3b72a-b07e-4208-87ff-9e67b61cdcbe","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Wop1vIUz7AOc90zbhiNzS","tenantId":"86d9d41f-5f79-4344-92a8-28d2918a3b64","createdBy":"Wop1vIUz7AOc90zbhiNzS","ownerId":"Wop1vIUz7AOc90zbhiNzS","status":"active","archived":false,"createdAt":"2025-12-04T18:08:31.681Z","updatedAt":"2025-12-04T18:08:31.681Z"}

{"level":30,"time":1764871710767,"env":"test","module":"user-credentials-repository","userId":"4sQ4f_APM9p2Ij_CZwt6-","msg":"User credentials created"}
{"level":30,"time":1764871710768,"env":"test","module":"auth-routes","userId":"4sQ4f_APM9p2Ij_CZwt6-","email":"viewer-XwUPYpisEC1dB0ILxXyDZ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871710884,"env":"test","module":"rbac-middleware","userId":"4sQ4f_APM9p2Ij_CZwt6-","userRole":"viewer","permission":"workflow:create","path":"/projects/9ff3b72a-b07e-4208-87ff-9e67b61cdcbe/workflows","msg":"Permission denied"}
{"level":50,"time":1764871717029,"env":"test","error":{},"workflowId":"694db0b8-ea71-409d-8823-ccf0bad38cf1","userId":"Wop1vIUz7AOc90zbhiNzS","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871717346,"env":"test","module":"auth-middleware","path":"/api/workflows/25dd86bf-d3dd-433c-b995-79c617080a10/move","msg":"No valid authentication found"}
{"level":30,"time":1764871717861,"env":"test","module":"user-credentials-repository","userId":"YJk6ZNHzHBwN2VO1soBCD","msg":"User credentials created"}
{"level":30,"time":1764871717861,"env":"test","module":"auth-routes","userId":"YJk6ZNHzHBwN2VO1soBCD","email":"test-workflows-fmcVqRjtD0AmJcBNXBYiO@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871717911,"env":"test","error":{},"workflowId":"bc9d1479-0dbe-429b-b37b-0626ffc72178","userId":"YJk6ZNHzHBwN2VO1soBCD","projectId":"67b5254d-72f9-409d-bd02-be053aadf469","msg":"Error moving workflow"}
{"level":50,"time":1764871718280,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"837a2f20-c5e7-4ebb-906a-dcbf714b36c0","userId":"Wop1vIUz7AOc90zbhiNzS","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871718625,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d3da2353-872d-472a-9c8e-76e77f8b4660","userId":"Wop1vIUz7AOc90zbhiNzS","msg":"Error moving workflow"}
{"level":30,"time":1764871719145,"env":"test","module":"user-credentials-repository","userId":"AHAUqwZU52IrbRaeoM9Fb","msg":"User credentials created"}
{"level":30,"time":1764871719145,"env":"test","module":"auth-routes","userId":"AHAUqwZU52IrbRaeoM9Fb","email":"test-workflows-UjevDZ_F5lSKwK2JqnjpS@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871719338,"env":"test","module":"auth-routes","userId":"AHAUqwZU52IrbRaeoM9Fb","email":"test-workflows-UjevDZ_F5lSKwK2JqnjpS@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871719520,"env":"test","error":{},"workflowId":"618f6aa5-dd49-4795-a4e5-26cdd0ede0a9","userId":"Wop1vIUz7AOc90zbhiNzS","projectId":"7822b3a3-f84b-48d4-8209-3878b29a4e0d","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10191[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 344[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 897[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 21.30s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764871754475,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871757073,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871760279,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871760279,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871760290,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871760291,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871760291,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871760291,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871760785,"env":"test","module":"user-credentials-repository","userId":"_UVQV-DZmQBDMXgsm6PVo","msg":"User credentials created"}
{"level":30,"time":1764871760788,"env":"test","module":"auth-routes","userId":"_UVQV-DZmQBDMXgsm6PVo","email":"test-workflows-J6FcPzIPaX29jGtUN5qBR@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3b08f651-8122-4b89-afc7-2af0dee4ec9f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"_UVQV-DZmQBDMXgsm6PVo","tenantId":"bac5fd6e-af69-4e8e-8322-54960ba3196a","createdBy":"_UVQV-DZmQBDMXgsm6PVo","ownerId":"_UVQV-DZmQBDMXgsm6PVo","status":"active","archived":false,"createdAt":"2025-12-04T18:09:22.370Z","updatedAt":"2025-12-04T18:09:22.370Z"}

{"level":30,"time":1764871761497,"env":"test","module":"user-credentials-repository","userId":"grjR5e-RTifPryaXS5M8c","msg":"User credentials created"}
{"level":30,"time":1764871761498,"env":"test","module":"auth-routes","userId":"grjR5e-RTifPryaXS5M8c","email":"viewer-yiW5jvDhh3jNNxbAms-Cf@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871761602,"env":"test","module":"rbac-middleware","userId":"grjR5e-RTifPryaXS5M8c","userRole":"viewer","permission":"workflow:create","path":"/projects/3b08f651-8122-4b89-afc7-2af0dee4ec9f/workflows","msg":"Permission denied"}
{"level":50,"time":1764871768026,"env":"test","error":{},"workflowId":"b0e08617-97d7-4585-8dc3-3d2272ca3fd8","userId":"_UVQV-DZmQBDMXgsm6PVo","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871768374,"env":"test","module":"auth-middleware","path":"/api/workflows/0a87ca7c-7e3b-41f6-85b0-d0bc13068f48/move","msg":"No valid authentication found"}
{"level":30,"time":1764871768924,"env":"test","module":"user-credentials-repository","userId":"pCVgVehMsKEvafPklGHnm","msg":"User credentials created"}
{"level":30,"time":1764871768925,"env":"test","module":"auth-routes","userId":"pCVgVehMsKEvafPklGHnm","email":"test-workflows-WWE7eNcer8yDOMeRSJNN-@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871768979,"env":"test","error":{},"workflowId":"4fc813dc-2ee0-40d9-8444-43ec6cd0ac96","userId":"pCVgVehMsKEvafPklGHnm","projectId":"27ea1c78-83d6-4f4d-b986-a4cce5ed4a20","msg":"Error moving workflow"}
{"level":50,"time":1764871769368,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"11558b52-54ee-4e9e-a9bd-bae8cc376ba6","userId":"_UVQV-DZmQBDMXgsm6PVo","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871769743,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"103a0507-4495-41ec-bd10-2e164a4c1d54","userId":"_UVQV-DZmQBDMXgsm6PVo","msg":"Error moving workflow"}
{"level":30,"time":1764871770285,"env":"test","module":"user-credentials-repository","userId":"1xAM5c1eOC_c-OedWEc6s","msg":"User credentials created"}
{"level":30,"time":1764871770286,"env":"test","module":"auth-routes","userId":"1xAM5c1eOC_c-OedWEc6s","email":"test-workflows-BYQ-H791x3XDFbPJLP_zC@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871770505,"env":"test","module":"auth-routes","userId":"1xAM5c1eOC_c-OedWEc6s","email":"test-workflows-BYQ-H791x3XDFbPJLP_zC@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871770759,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e5b29045-e1b9-45b1-8f3b-4da5788b7be1","userId":"_UVQV-DZmQBDMXgsm6PVo","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 514[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 606[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1018[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 21.36s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764873692851,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873695703,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873698518,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873698519,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873698529,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873698529,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873698530,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873698530,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873698977,"env":"test","module":"user-credentials-repository","userId":"nae69yaVrQALUUKtICCOU","msg":"User credentials created"}
{"level":30,"time":1764873698980,"env":"test","module":"auth-routes","userId":"nae69yaVrQALUUKtICCOU","email":"test-workflows-Am5MQhWMsVx-Dib_aZ294@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"372fdaa4-b244-4707-a05a-aa7dd383deb4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"nae69yaVrQALUUKtICCOU","tenantId":"e4ddb2da-af28-487e-99b9-cec8d7233751","createdBy":"nae69yaVrQALUUKtICCOU","ownerId":"nae69yaVrQALUUKtICCOU","status":"active","archived":false,"createdAt":"2025-12-04T18:41:40.586Z","updatedAt":"2025-12-04T18:41:40.586Z"}

{"level":30,"time":1764873699683,"env":"test","module":"user-credentials-repository","userId":"Umt2_Dckzz3YTpVDj2DdM","msg":"User credentials created"}
{"level":30,"time":1764873699684,"env":"test","module":"auth-routes","userId":"Umt2_Dckzz3YTpVDj2DdM","email":"viewer-fNE1BEM0c94ZcCTa5s4W1@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873699783,"env":"test","module":"rbac-middleware","userId":"Umt2_Dckzz3YTpVDj2DdM","userRole":"viewer","permission":"workflow:create","path":"/projects/372fdaa4-b244-4707-a05a-aa7dd383deb4/workflows","msg":"Permission denied"}
{"level":50,"time":1764873706252,"env":"test","error":{},"workflowId":"64d4c922-13a2-4391-8252-4c93816e1adb","userId":"nae69yaVrQALUUKtICCOU","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873706600,"env":"test","module":"auth-middleware","path":"/api/workflows/6e3d6906-c200-4334-8c23-402065663ce5/move","msg":"No valid authentication found"}
{"level":30,"time":1764873707120,"env":"test","module":"user-credentials-repository","userId":"tIUC7732j5j2K7DT1RRee","msg":"User credentials created"}
{"level":30,"time":1764873707121,"env":"test","module":"auth-routes","userId":"tIUC7732j5j2K7DT1RRee","email":"test-workflows-VWNVeVJXLm0p7qWASd3xr@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873707171,"env":"test","error":{},"workflowId":"63b191fc-395a-4b68-95d0-d0956cb10e80","userId":"tIUC7732j5j2K7DT1RRee","projectId":"c953f2b5-f65c-4421-a781-3caf6f5854f5","msg":"Error moving workflow"}
{"level":50,"time":1764873707764,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"14f075df-09f9-4182-b30d-3172bd5893be","userId":"nae69yaVrQALUUKtICCOU","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873707950,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(nae69yaVrQALUUKtICCOU) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"nae69yaVrQALUUKtICCOU","msg":"Error creating workflow"}
{"level":50,"time":1764873708140,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(nae69yaVrQALUUKtICCOU) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"nae69yaVrQALUUKtICCOU","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9880[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 655[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 877[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 593[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 187[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 189[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 22.82s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764874579072,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874584582,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874591587,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874591588,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874591600,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874591601,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874591601,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874591601,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874592226,"env":"test","module":"user-credentials-repository","userId":"alIYdnmUrX2_IEqDXe4ie","msg":"User credentials created"}
{"level":30,"time":1764874592230,"env":"test","module":"auth-routes","userId":"alIYdnmUrX2_IEqDXe4ie","email":"test-workflows-pLYOPfRbA6we0KN_M5N2x@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f50effcb-e577-490b-8e7d-724d0a84b305","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"alIYdnmUrX2_IEqDXe4ie","tenantId":"f157b4e8-4a01-4875-a8b3-2f021f96974a","createdBy":"alIYdnmUrX2_IEqDXe4ie","ownerId":"alIYdnmUrX2_IEqDXe4ie","status":"active","archived":false,"createdAt":"2025-12-04T18:56:33.857Z","updatedAt":"2025-12-04T18:56:33.857Z"}

{"level":30,"time":1764874592977,"env":"test","module":"user-credentials-repository","userId":"mQh39vML4z8asl8SzOnrP","msg":"User credentials created"}
{"level":30,"time":1764874592978,"env":"test","module":"auth-routes","userId":"mQh39vML4z8asl8SzOnrP","email":"viewer-O-p3vCv1Qr3973hzGsKOm@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874593072,"env":"test","module":"rbac-middleware","userId":"mQh39vML4z8asl8SzOnrP","userRole":"viewer","permission":"workflow:create","path":"/projects/f50effcb-e577-490b-8e7d-724d0a84b305/workflows","msg":"Permission denied"}
{"level":50,"time":1764874599318,"env":"test","error":{},"workflowId":"77e1d082-c1ce-46ca-9baf-5d827bb0ebb8","userId":"alIYdnmUrX2_IEqDXe4ie","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874599642,"env":"test","module":"auth-middleware","path":"/api/workflows/137533d8-c960-4d6c-a95e-97952c05786b/move","msg":"No valid authentication found"}
{"level":30,"time":1764874600165,"env":"test","module":"user-credentials-repository","userId":"kl019sX6ll6ncc9l4kooR","msg":"User credentials created"}
{"level":30,"time":1764874600165,"env":"test","module":"auth-routes","userId":"kl019sX6ll6ncc9l4kooR","email":"test-workflows-_BymdOtcgQhPhdoZ31_By@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874600216,"env":"test","error":{},"workflowId":"5d153d5d-3a7c-4188-b856-243d47a319aa","userId":"kl019sX6ll6ncc9l4kooR","projectId":"d43005cf-b3af-4853-b582-1e66f7e3039d","msg":"Error moving workflow"}
{"level":50,"time":1764874600586,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8a4aa731-5bea-4fbc-8494-4ac45c72f38a","userId":"alIYdnmUrX2_IEqDXe4ie","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874600995,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"769c1b70-210e-425d-8e32-52c482f0491a","userId":"alIYdnmUrX2_IEqDXe4ie","msg":"Error moving workflow"}
{"level":30,"time":1764874601545,"env":"test","module":"user-credentials-repository","userId":"fdjfFTti5RqUbg1zdu6lD","msg":"User credentials created"}
{"level":30,"time":1764874601545,"env":"test","module":"auth-routes","userId":"fdjfFTti5RqUbg1zdu6lD","email":"test-workflows-Fjckku9OYpsuFQiEsOjgM@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874601735,"env":"test","module":"auth-routes","userId":"fdjfFTti5RqUbg1zdu6lD","email":"test-workflows-Fjckku9OYpsuFQiEsOjgM@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874601918,"env":"test","error":{},"workflowId":"6d4370e5-415f-419c-830e-c5dbe8fd8cc6","userId":"alIYdnmUrX2_IEqDXe4ie","projectId":"cc19949d-3b94-4f0b-a575-eab6d329f69d","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 726[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 410[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 925[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.89s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764874685666,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874692002,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874697970,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874697970,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874697981,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874697981,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874697981,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874697981,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874698499,"env":"test","module":"user-credentials-repository","userId":"VaOD0g1pA2DPgZZUbSKNt","msg":"User credentials created"}
{"level":30,"time":1764874698502,"env":"test","module":"auth-routes","userId":"VaOD0g1pA2DPgZZUbSKNt","email":"test-workflows-mc-aht6EtlWkdw9Fhv4ga@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"dda03ba4-f2cf-45bc-97f2-106a83e0f1f7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"VaOD0g1pA2DPgZZUbSKNt","tenantId":"66b08e43-8819-4c23-a337-078322b17bd7","createdBy":"VaOD0g1pA2DPgZZUbSKNt","ownerId":"VaOD0g1pA2DPgZZUbSKNt","status":"active","archived":false,"createdAt":"2025-12-04T18:58:20.125Z","updatedAt":"2025-12-04T18:58:20.125Z"}

{"level":30,"time":1764874699200,"env":"test","module":"user-credentials-repository","userId":"WWaPQ6SaXf0EX7I6f0z2B","msg":"User credentials created"}
{"level":30,"time":1764874699201,"env":"test","module":"auth-routes","userId":"WWaPQ6SaXf0EX7I6f0z2B","email":"viewer-fK0x0DiaT64lJkhon8S2D@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874699296,"env":"test","module":"rbac-middleware","userId":"WWaPQ6SaXf0EX7I6f0z2B","userRole":"viewer","permission":"workflow:create","path":"/projects/dda03ba4-f2cf-45bc-97f2-106a83e0f1f7/workflows","msg":"Permission denied"}
{"level":50,"time":1764874705737,"env":"test","error":{},"workflowId":"c8d5dc00-ab31-4c63-8d87-51809350442f","userId":"VaOD0g1pA2DPgZZUbSKNt","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874706077,"env":"test","module":"auth-middleware","path":"/api/workflows/d2789bfe-58cd-4c91-9d48-be60f2a65c54/move","msg":"No valid authentication found"}
{"level":30,"time":1764874706608,"env":"test","module":"user-credentials-repository","userId":"b5fJF2anXhy2I_ofkd4fQ","msg":"User credentials created"}
{"level":30,"time":1764874706609,"env":"test","module":"auth-routes","userId":"b5fJF2anXhy2I_ofkd4fQ","email":"test-workflows-3seBGm8izJ-n0LHVSz3Lp@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874706704,"env":"test","error":{},"workflowId":"6d8cb65d-5a5a-4101-a9a8-eefa8d94ae57","userId":"b5fJF2anXhy2I_ofkd4fQ","projectId":"7818ee3f-84cd-43d7-a58c-a384db4787ec","msg":"Error moving workflow"}
{"level":50,"time":1764874707093,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9b210974-0a20-48f6-8311-690c97a7714f","userId":"VaOD0g1pA2DPgZZUbSKNt","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874707470,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d092d523-a875-461e-ad2a-744789ffc54e","userId":"VaOD0g1pA2DPgZZUbSKNt","msg":"Error moving workflow"}
{"level":50,"time":1764874708144,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(Un0CmeIweYWBmKLb_CnTm) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"Un0CmeIweYWBmKLb_CnTm","msg":"Failed to create user credentials"}
{"level":50,"time":1764874708144,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(Un0CmeIweYWBmKLb_CnTm) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 345[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 801[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 339[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 673[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 28.53s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764876565503,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876570920,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876575163,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876575163,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876575187,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876575187,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876575187,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876575187,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876575669,"env":"test","module":"user-credentials-repository","userId":"egI518lc-1L4M1oxlt-_s","msg":"User credentials created"}
{"level":30,"time":1764876575672,"env":"test","module":"auth-routes","userId":"egI518lc-1L4M1oxlt-_s","email":"test-workflows-XvELNgjNyfluAfyP4e73G@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d8f9742a-7a3e-490f-b3f4-e2c3d5b93b0a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"egI518lc-1L4M1oxlt-_s","tenantId":"a7a01073-81a5-4397-b2ef-3e71a9322c3c","createdBy":"egI518lc-1L4M1oxlt-_s","ownerId":"egI518lc-1L4M1oxlt-_s","status":"active","archived":false,"createdAt":"2025-12-04T19:29:37.339Z","updatedAt":"2025-12-04T19:29:37.339Z"}

{"level":30,"time":1764876576389,"env":"test","module":"user-credentials-repository","userId":"YN1AaJbnHUSjGSyfDXsV0","msg":"User credentials created"}
{"level":30,"time":1764876576390,"env":"test","module":"auth-routes","userId":"YN1AaJbnHUSjGSyfDXsV0","email":"viewer-NloaucJ3EC3LeMNTte_DP@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876576504,"env":"test","module":"rbac-middleware","userId":"YN1AaJbnHUSjGSyfDXsV0","userRole":"viewer","permission":"workflow:create","path":"/projects/d8f9742a-7a3e-490f-b3f4-e2c3d5b93b0a/workflows","msg":"Permission denied"}
{"level":50,"time":1764876582790,"env":"test","error":{},"workflowId":"ba404610-657d-4182-8dbb-090656440905","userId":"egI518lc-1L4M1oxlt-_s","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876583118,"env":"test","module":"auth-middleware","path":"/api/workflows/6268dbd6-06ae-4d93-85eb-ffd688535fe4/move","msg":"No valid authentication found"}
{"level":30,"time":1764876583651,"env":"test","module":"user-credentials-repository","userId":"5OFFCUgAx7wQH3Lz5WfE0","msg":"User credentials created"}
{"level":30,"time":1764876583651,"env":"test","module":"auth-routes","userId":"5OFFCUgAx7wQH3Lz5WfE0","email":"test-workflows-UmXnYQVNWqJqxahOhrC7V@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876583700,"env":"test","error":{},"workflowId":"eaa594b2-17d9-461c-8e37-16e864bea046","userId":"5OFFCUgAx7wQH3Lz5WfE0","projectId":"0e78ab83-6e75-4d64-a46e-62cb9033f30b","msg":"Error moving workflow"}
{"level":50,"time":1764876584058,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6eb1a133-28c4-4f7c-88f8-e554f9bdf867","userId":"egI518lc-1L4M1oxlt-_s","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876585463,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"425eca58-c630-4999-bad8-70a61abae32c","userId":"egI518lc-1L4M1oxlt-_s","msg":"Error moving workflow"}
{"level":50,"time":1764876585640,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(egI518lc-1L4M1oxlt-_s) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"egI518lc-1L4M1oxlt-_s","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 1405[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 178[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:29:20
[2m   Duration [22m 24.44s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764876646833,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876650408,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876654047,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876654048,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876654059,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876654059,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876654060,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876654060,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876654599,"env":"test","module":"user-credentials-repository","userId":"ytlHeedjyR5DNxNgBN0lr","msg":"User credentials created"}
{"level":30,"time":1764876654603,"env":"test","module":"auth-routes","userId":"ytlHeedjyR5DNxNgBN0lr","email":"test-workflows-p13dGsglvVXTpqu_5rBJQ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"db482021-c27f-446a-9f12-25b502b31e49","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ytlHeedjyR5DNxNgBN0lr","tenantId":"5393c58f-3e4c-4565-8717-b40d29baf983","createdBy":"ytlHeedjyR5DNxNgBN0lr","ownerId":"ytlHeedjyR5DNxNgBN0lr","status":"active","archived":false,"createdAt":"2025-12-04T19:30:56.263Z","updatedAt":"2025-12-04T19:30:56.263Z"}

{"level":30,"time":1764876655303,"env":"test","module":"user-credentials-repository","userId":"Ou-zgBiN9RGn8a3TZNgRE","msg":"User credentials created"}
{"level":30,"time":1764876655304,"env":"test","module":"auth-routes","userId":"Ou-zgBiN9RGn8a3TZNgRE","email":"viewer-bYtSXmCzhjt8vskg4gKQr@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876655398,"env":"test","module":"rbac-middleware","userId":"Ou-zgBiN9RGn8a3TZNgRE","userRole":"viewer","permission":"workflow:create","path":"/projects/db482021-c27f-446a-9f12-25b502b31e49/workflows","msg":"Permission denied"}
{"level":50,"time":1764876661901,"env":"test","error":{},"workflowId":"a2b76da7-37b8-4b8f-8090-a7ebb79cd29a","userId":"ytlHeedjyR5DNxNgBN0lr","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876662228,"env":"test","module":"auth-middleware","path":"/api/workflows/e87804ff-193c-46ec-b564-bd75ca699c2c/move","msg":"No valid authentication found"}
{"level":30,"time":1764876662725,"env":"test","module":"user-credentials-repository","userId":"4gQwWtHypInnjNKHcFQwS","msg":"User credentials created"}
{"level":30,"time":1764876662726,"env":"test","module":"auth-routes","userId":"4gQwWtHypInnjNKHcFQwS","email":"test-workflows-KweeTD66hypummhzuqPy9@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876662773,"env":"test","error":{},"workflowId":"c0b40e5a-9369-4ad9-9fb0-862d172ea5fd","userId":"4gQwWtHypInnjNKHcFQwS","projectId":"b6af0e50-ef06-4fda-abbd-8408430d515f","msg":"Error moving workflow"}
{"level":50,"time":1764876663143,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"d5ea7874-61f5-41c8-8d3f-485b1d551965","userId":"ytlHeedjyR5DNxNgBN0lr","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876663497,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"7c0c5906-1962-4ab2-b30a-7841543b62c4","userId":"ytlHeedjyR5DNxNgBN0lr","msg":"Error moving workflow"}
{"level":50,"time":1764876664532,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(ytlHeedjyR5DNxNgBN0lr) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ytlHeedjyR5DNxNgBN0lr","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 881[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 545[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 354[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1037[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:30:40
[2m   Duration [22m 22.68s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764877227174,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877230840,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877234983,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877234983,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877234994,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877234994,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877234995,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877234995,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877235632,"env":"test","module":"user-credentials-repository","userId":"e0C6DLG-kawxcZMKMtdvq","msg":"User credentials created"}
{"level":30,"time":1764877235637,"env":"test","module":"auth-routes","userId":"e0C6DLG-kawxcZMKMtdvq","email":"test-workflows-nGnGULl-sReT6yovf5Mln@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f44ebbf3-5910-4169-9a80-b8529cdf0081","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"e0C6DLG-kawxcZMKMtdvq","tenantId":"d04f845f-d9c5-4254-9989-5bfa583afd02","createdBy":"e0C6DLG-kawxcZMKMtdvq","ownerId":"e0C6DLG-kawxcZMKMtdvq","status":"active","archived":false,"createdAt":"2025-12-04T19:40:37.318Z","updatedAt":"2025-12-04T19:40:37.318Z"}

{"level":30,"time":1764877236353,"env":"test","module":"user-credentials-repository","userId":"JpDYt8XBFDdzYFw4nOc-t","msg":"User credentials created"}
{"level":30,"time":1764877236354,"env":"test","module":"auth-routes","userId":"JpDYt8XBFDdzYFw4nOc-t","email":"viewer-DTlicnaVNHORZ5k8uZKih@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877236450,"env":"test","module":"rbac-middleware","userId":"JpDYt8XBFDdzYFw4nOc-t","userRole":"viewer","permission":"workflow:create","path":"/projects/f44ebbf3-5910-4169-9a80-b8529cdf0081/workflows","msg":"Permission denied"}
{"level":50,"time":1764877242755,"env":"test","error":{},"workflowId":"14e313f4-a1af-4a89-a33e-0581e573c5fc","userId":"e0C6DLG-kawxcZMKMtdvq","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877243092,"env":"test","module":"auth-middleware","path":"/api/workflows/aab50cd4-d451-4d2c-b8e1-56f51efdbbba/move","msg":"No valid authentication found"}
{"level":30,"time":1764877243601,"env":"test","module":"user-credentials-repository","userId":"AikshwUara9MEDcbcfWgm","msg":"User credentials created"}
{"level":30,"time":1764877243601,"env":"test","module":"auth-routes","userId":"AikshwUara9MEDcbcfWgm","email":"test-workflows-WuXb4ZxKmkgHQgME7yPkl@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877243652,"env":"test","error":{},"workflowId":"9d88a7ca-7a38-492c-ab50-4538e428a3a0","userId":"AikshwUara9MEDcbcfWgm","projectId":"b4df5a45-8a3c-4fca-aa56-56454cb09f3f","msg":"Error moving workflow"}
{"level":50,"time":1764877244035,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"68afe164-9aa1-4c9d-ab19-f10bf0e99776","userId":"e0C6DLG-kawxcZMKMtdvq","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877244400,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"302782a2-6c0d-4782-aba0-50a1ebcc0f0f","userId":"e0C6DLG-kawxcZMKMtdvq","msg":"Error moving workflow"}
{"level":30,"time":1764877244928,"env":"test","module":"user-credentials-repository","userId":"Eo45jC3OwsoXg64GVpJfW","msg":"User credentials created"}
{"level":30,"time":1764877244929,"env":"test","module":"auth-routes","userId":"Eo45jC3OwsoXg64GVpJfW","email":"test-workflows-FFFP4vAgIOYZ9gaEtblLZ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877245127,"env":"test","module":"auth-routes","userId":"Eo45jC3OwsoXg64GVpJfW","email":"test-workflows-FFFP4vAgIOYZ9gaEtblLZ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877245303,"env":"test","error":{},"workflowId":"ce1ab15a-2386-4de0-b93e-4d939f7ea24a","userId":"e0C6DLG-kawxcZMKMtdvq","projectId":"5bd8029d-d8e0-4298-84f0-e0b0d8ba81ff","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10559[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 364[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 906[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:40:22
[2m   Duration [22m 22.41s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/googleAuth.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764877495025,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877498025,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877500137,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877500138,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877500148,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877500148,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877500148,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877500148,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877500589,"env":"test","module":"user-credentials-repository","userId":"SByakvS0S9exgk5Coeb9Q","msg":"User credentials created"}
{"level":30,"time":1764877500591,"env":"test","module":"auth-routes","userId":"SByakvS0S9exgk5Coeb9Q","email":"test-workflows-6MBn8onPhdZZ6w1Sqms6T@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"50e83f85-8bdf-40f9-94fe-9b659879dbc0","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"SByakvS0S9exgk5Coeb9Q","tenantId":"cc3ab1a7-f650-4dbc-8a8a-d8462382f270","createdBy":"SByakvS0S9exgk5Coeb9Q","ownerId":"SByakvS0S9exgk5Coeb9Q","status":"active","archived":false,"createdAt":"2025-12-04T19:45:02.262Z","updatedAt":"2025-12-04T19:45:02.262Z"}

{"level":30,"time":1764877501225,"env":"test","module":"user-credentials-repository","userId":"WOmYmLTpW_EdeQ7_5L8IZ","msg":"User credentials created"}
{"level":30,"time":1764877501225,"env":"test","module":"auth-routes","userId":"WOmYmLTpW_EdeQ7_5L8IZ","email":"viewer-KK9JE48LAOo3V7-XO0oPB@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877501310,"env":"test","module":"rbac-middleware","userId":"WOmYmLTpW_EdeQ7_5L8IZ","userRole":"viewer","permission":"workflow:create","path":"/projects/50e83f85-8bdf-40f9-94fe-9b659879dbc0/workflows","msg":"Permission denied"}
{"level":50,"time":1764877507269,"env":"test","error":{},"workflowId":"7d886c68-8ad5-4972-bd48-86504891b21d","userId":"SByakvS0S9exgk5Coeb9Q","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":50,"time":1764877507446,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(SByakvS0S9exgk5Coeb9Q) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"SByakvS0S9exgk5Coeb9Q","msg":"Error creating workflow"}
{"level":50,"time":1764877507611,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(SByakvS0S9exgk5Coeb9Q) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"SByakvS0S9exgk5Coeb9Q","msg":"Error creating workflow"}
{"level":50,"time":1764877507776,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(SByakvS0S9exgk5Coeb9Q) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"SByakvS0S9exgk5Coeb9Q","msg":"Error creating workflow"}
{"level":50,"time":1764877507945,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(SByakvS0S9exgk5Coeb9Q) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"SByakvS0S9exgk5Coeb9Q","msg":"Error creating workflow"}
{"level":50,"time":1764877508112,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(SByakvS0S9exgk5Coeb9Q) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"SByakvS0S9exgk5Coeb9Q","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 8251[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 305[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 270[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 444[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 755[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 437[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without authentication[39m[32m 177[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 164[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 165[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 169[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 167[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without authentication
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:44:44
[2m   Duration [22m 23.03s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764877822798,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877825868,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877830171,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877830172,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877830187,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877830187,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877830187,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877830188,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877830743,"env":"test","module":"user-credentials-repository","userId":"Zi8gqgSPtA-RzBKnomcSd","msg":"User credentials created"}
{"level":30,"time":1764877830746,"env":"test","module":"auth-routes","userId":"Zi8gqgSPtA-RzBKnomcSd","email":"test-workflows-5iiAL8a3j0Hhso1Bpnbya@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"205cb7f4-4cfa-4970-9acc-09ffc3cc5513","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Zi8gqgSPtA-RzBKnomcSd","tenantId":"93646490-49db-44b8-8ac7-9cefe6780670","createdBy":"Zi8gqgSPtA-RzBKnomcSd","ownerId":"Zi8gqgSPtA-RzBKnomcSd","status":"active","archived":false,"createdAt":"2025-12-04T19:50:32.422Z","updatedAt":"2025-12-04T19:50:32.422Z"}

{"level":30,"time":1764877831446,"env":"test","module":"user-credentials-repository","userId":"6mglMkr25wsojBm-scJB3","msg":"User credentials created"}
{"level":30,"time":1764877831447,"env":"test","module":"auth-routes","userId":"6mglMkr25wsojBm-scJB3","email":"viewer-K7N7sKShq1PqORXyHGwNr@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877831547,"env":"test","module":"rbac-middleware","userId":"6mglMkr25wsojBm-scJB3","userRole":"viewer","permission":"workflow:create","path":"/projects/205cb7f4-4cfa-4970-9acc-09ffc3cc5513/workflows","msg":"Permission denied"}
{"level":50,"time":1764877837856,"env":"test","error":{},"workflowId":"62afdd86-cc35-4d9a-abdb-c2f4b1ac02e8","userId":"Zi8gqgSPtA-RzBKnomcSd","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877838191,"env":"test","module":"auth-middleware","path":"/api/workflows/6caeae8d-0071-46ea-b4b7-1c15a30aea66/move","msg":"No valid authentication found"}
{"level":30,"time":1764877838754,"env":"test","module":"user-credentials-repository","userId":"Dbdk5ag7gObuOTlcGA1br","msg":"User credentials created"}
{"level":30,"time":1764877838755,"env":"test","module":"auth-routes","userId":"Dbdk5ag7gObuOTlcGA1br","email":"test-workflows-2fnDWqgZMifYL9Pj7GrMh@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877838806,"env":"test","error":{},"workflowId":"558a3677-a54a-45e8-8e85-1664caef7a1c","userId":"Dbdk5ag7gObuOTlcGA1br","projectId":"79f6847f-1cb0-4d06-8e07-bdaaee378918","msg":"Error moving workflow"}
{"level":50,"time":1764877839191,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"fb578496-c825-42df-9969-9bd67afa6785","userId":"Zi8gqgSPtA-RzBKnomcSd","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877839569,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1424cacb-22a7-467e-87a1-56ba29350261","userId":"Zi8gqgSPtA-RzBKnomcSd","msg":"Error moving workflow"}
{"level":50,"time":1764877840102,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(6hTycDJEL6t4ZHO_fZSjy) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"6hTycDJEL6t4ZHO_fZSjy","msg":"Failed to create user credentials"}
{"level":50,"time":1764877840102,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(6hTycDJEL6t4ZHO_fZSjy) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 345[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 796[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 762[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 536[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:18
[2m   Duration [22m 21.78s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764877846148,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877848335,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877850690,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877850691,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877850702,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877850702,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877850702,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877850703,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877851207,"env":"test","module":"user-credentials-repository","userId":"ijajDV7typpLYQazKuW2x","msg":"User credentials created"}
{"level":30,"time":1764877851211,"env":"test","module":"auth-routes","userId":"ijajDV7typpLYQazKuW2x","email":"test-workflows-UxwyhukupDCcTWdGIs0_E@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d0c0d2d0-779c-4a14-a6cd-5ec0e3b96f38","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ijajDV7typpLYQazKuW2x","tenantId":"7d791022-4c7b-42c0-9aed-b552cd9409df","createdBy":"ijajDV7typpLYQazKuW2x","ownerId":"ijajDV7typpLYQazKuW2x","status":"active","archived":false,"createdAt":"2025-12-04T19:50:52.908Z","updatedAt":"2025-12-04T19:50:52.908Z"}

{"level":30,"time":1764877851952,"env":"test","module":"user-credentials-repository","userId":"_QzS9sWO2ytmDIaWViTCK","msg":"User credentials created"}
{"level":30,"time":1764877851953,"env":"test","module":"auth-routes","userId":"_QzS9sWO2ytmDIaWViTCK","email":"viewer-LI4l9tc9KLpUIoRrh7oWH@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877852050,"env":"test","module":"rbac-middleware","userId":"_QzS9sWO2ytmDIaWViTCK","userRole":"viewer","permission":"workflow:create","path":"/projects/d0c0d2d0-779c-4a14-a6cd-5ec0e3b96f38/workflows","msg":"Permission denied"}
{"level":50,"time":1764877858460,"env":"test","error":{},"workflowId":"aa782c1a-4657-4170-bace-f66e6ea35cdd","userId":"ijajDV7typpLYQazKuW2x","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877858787,"env":"test","module":"auth-middleware","path":"/api/workflows/b035a080-897c-46a8-b2cb-a18059913ba1/move","msg":"No valid authentication found"}
{"level":30,"time":1764877859528,"env":"test","module":"user-credentials-repository","userId":"lKykFmatscTAFqDmAeKqw","msg":"User credentials created"}
{"level":30,"time":1764877859529,"env":"test","module":"auth-routes","userId":"lKykFmatscTAFqDmAeKqw","email":"test-workflows-CV5AXdGiMykvrESjF0eyY@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877859584,"env":"test","error":{},"workflowId":"b7f0ace0-6b1c-483d-b70d-55a8682354fe","userId":"lKykFmatscTAFqDmAeKqw","projectId":"a314a635-f46b-4e36-88c2-7a70ba56b9e2","msg":"Error moving workflow"}
{"level":50,"time":1764877859966,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9a104fd5-066c-45eb-b46c-799cedd994bb","userId":"ijajDV7typpLYQazKuW2x","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877860354,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2d39fb58-9c39-4e4a-a8b8-7783779cc853","userId":"ijajDV7typpLYQazKuW2x","msg":"Error moving workflow"}
{"level":30,"time":1764877861052,"env":"test","module":"user-credentials-repository","userId":"0IZO7XAknpwwP_plP2ryd","msg":"User credentials created"}
{"level":30,"time":1764877861053,"env":"test","module":"auth-routes","userId":"0IZO7XAknpwwP_plP2ryd","email":"test-workflows-ec6ywfIirUl8BBvbxmcg2@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877861260,"env":"test","module":"auth-routes","userId":"0IZO7XAknpwwP_plP2ryd","email":"test-workflows-ec6ywfIirUl8BBvbxmcg2@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877861453,"env":"test","error":{},"workflowId":"d602d080-a0d3-44b7-ad29-7e4c961adb48","userId":"ijajDV7typpLYQazKuW2x","projectId":"13a2e42d-eec2-4125-afbc-ac8de221ba79","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11042[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 357[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1103[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:40
[2m   Duration [22m 19.74s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764877866706,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877869518,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877872745,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877872746,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877872761,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877872761,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877872761,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877872761,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877873236,"env":"test","module":"user-credentials-repository","userId":"1809LsWOyGjYPpy9K0qXF","msg":"User credentials created"}
{"level":30,"time":1764877873239,"env":"test","module":"auth-routes","userId":"1809LsWOyGjYPpy9K0qXF","email":"test-workflows-YU64eCmZNLd37Ki5Nwxlw@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"31ca85ce-b2d0-4ad5-a86c-e392c3b03e37","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"1809LsWOyGjYPpy9K0qXF","tenantId":"755b0be3-7093-4137-8989-95c0eee3494c","createdBy":"1809LsWOyGjYPpy9K0qXF","ownerId":"1809LsWOyGjYPpy9K0qXF","status":"active","archived":false,"createdAt":"2025-12-04T19:51:14.925Z","updatedAt":"2025-12-04T19:51:14.925Z"}

{"level":30,"time":1764877873953,"env":"test","module":"user-credentials-repository","userId":"2V2h05qypzBgnG9xw733q","msg":"User credentials created"}
{"level":30,"time":1764877873954,"env":"test","module":"auth-routes","userId":"2V2h05qypzBgnG9xw733q","email":"viewer-7SGHNDTt-KKe40U4OixSi@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877874049,"env":"test","module":"rbac-middleware","userId":"2V2h05qypzBgnG9xw733q","userRole":"viewer","permission":"workflow:create","path":"/projects/31ca85ce-b2d0-4ad5-a86c-e392c3b03e37/workflows","msg":"Permission denied"}
{"level":50,"time":1764877880240,"env":"test","error":{},"workflowId":"bf3e0c37-7c5e-4efc-bb3d-e4d61a7bd39e","userId":"1809LsWOyGjYPpy9K0qXF","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877880556,"env":"test","module":"auth-middleware","path":"/api/workflows/ca14b19f-d775-49da-bf7c-db21e8ff0839/move","msg":"No valid authentication found"}
{"level":30,"time":1764877881059,"env":"test","module":"user-credentials-repository","userId":"9T4gZR8R_eu4Vaa9Yh94b","msg":"User credentials created"}
{"level":30,"time":1764877881059,"env":"test","module":"auth-routes","userId":"9T4gZR8R_eu4Vaa9Yh94b","email":"test-workflows-2NOnnHe9H-ajAL0QjnXaa@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877881103,"env":"test","error":{},"workflowId":"3861a397-50db-4aa4-947b-ea5d5439d16f","userId":"9T4gZR8R_eu4Vaa9Yh94b","projectId":"cf2dee32-719d-43ea-bf87-191e65dba2fb","msg":"Error moving workflow"}
{"level":50,"time":1764877881479,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7d8033ac-c8d4-408d-bcb7-c0d3c9654813","userId":"1809LsWOyGjYPpy9K0qXF","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877881849,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"461adf02-ba87-4e8e-aa4a-72cae78181e8","userId":"1809LsWOyGjYPpy9K0qXF","msg":"Error moving workflow"}
{"level":50,"time":1764877882347,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(9T-fy4Z7zx3BupBJWvUo6) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"9T-fy4Z7zx3BupBJWvUo6","msg":"Failed to create user credentials"}
{"level":50,"time":1764877882347,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(9T-fy4Z7zx3BupBJWvUo6) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9996[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 358[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 499[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:51:01
[2m   Duration [22m 20.00s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx26 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764879994163,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764879997934,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880001744,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880001745,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880001760,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880001760,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880001761,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880001761,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880002217,"env":"test","module":"user-credentials-repository","userId":"-G9EvI0i5NWs-z4dp2UOv","msg":"User credentials created"}
{"level":30,"time":1764880002220,"env":"test","module":"auth-routes","userId":"-G9EvI0i5NWs-z4dp2UOv","email":"test-workflows-0HHog-8ABYxn-jDNS9H-Y@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"208ae41e-3054-4011-bdfd-b764221ca03c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"-G9EvI0i5NWs-z4dp2UOv","tenantId":"2eaae260-ba3b-442a-b089-0702ac478508","createdBy":"-G9EvI0i5NWs-z4dp2UOv","ownerId":"-G9EvI0i5NWs-z4dp2UOv","status":"active","archived":false,"createdAt":"2025-12-04T20:26:43.929Z","updatedAt":"2025-12-04T20:26:43.929Z"}

{"level":30,"time":1764880002858,"env":"test","module":"user-credentials-repository","userId":"UJNe6xzO24W5c-NydY-uT","msg":"User credentials created"}
{"level":30,"time":1764880002859,"env":"test","module":"auth-routes","userId":"UJNe6xzO24W5c-NydY-uT","email":"viewer-u0O0RFqpuoKMU_n_mSxrD@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880002947,"env":"test","module":"rbac-middleware","userId":"UJNe6xzO24W5c-NydY-uT","userRole":"viewer","permission":"workflow:create","path":"/projects/208ae41e-3054-4011-bdfd-b764221ca03c/workflows","msg":"Permission denied"}
{"level":50,"time":1764880009227,"env":"test","error":{},"workflowId":"54aaff54-6c02-4c60-b83a-8f8b3ce1b288","userId":"-G9EvI0i5NWs-z4dp2UOv","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880009564,"env":"test","module":"auth-middleware","path":"/api/workflows/73a8d401-a2a3-4380-add2-0d99e77d4d1d/move","msg":"No valid authentication found"}
{"level":30,"time":1764880010056,"env":"test","module":"user-credentials-repository","userId":"lo3quTfS95FFcDuvTXR27","msg":"User credentials created"}
{"level":30,"time":1764880010057,"env":"test","module":"auth-routes","userId":"lo3quTfS95FFcDuvTXR27","email":"test-workflows-3OFA8Nrd34ZiJbAydEH_X@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880010100,"env":"test","error":{},"workflowId":"b0194424-1ae2-49aa-b660-59ecd617ef8f","userId":"lo3quTfS95FFcDuvTXR27","projectId":"fcc1e8b6-2fdf-452c-b5f3-f779e2c0ccd9","msg":"Error moving workflow"}
{"level":50,"time":1764880010450,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"cd3100a8-c43b-48d2-90e2-dee61b615276","userId":"-G9EvI0i5NWs-z4dp2UOv","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880010808,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ffae63f7-61ff-4933-93d2-fdd126a21090","userId":"-G9EvI0i5NWs-z4dp2UOv","msg":"Error moving workflow"}
{"level":30,"time":1764880011306,"env":"test","module":"user-credentials-repository","userId":"3OsfeyAAuuoy0s_tw_9om","msg":"User credentials created"}
{"level":30,"time":1764880011307,"env":"test","module":"auth-routes","userId":"3OsfeyAAuuoy0s_tw_9om","email":"test-workflows-dmUTU4emAfvknOTdHW4XP@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880011509,"env":"test","module":"auth-routes","userId":"3OsfeyAAuuoy0s_tw_9om","email":"test-workflows-dmUTU4emAfvknOTdHW4XP@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880011733,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d14d0a7e-baaf-49ac-8282-dad7c53def1d","userId":"-G9EvI0i5NWs-z4dp2UOv","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10264[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 310[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 276[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 665[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 699[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 536[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 358[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 927[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:29
[2m   Duration [22m 21.65s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx27 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764880016666,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880019534,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880023884,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880023886,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880023900,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880023900,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880023900,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880023900,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880024403,"env":"test","module":"user-credentials-repository","userId":"8DsDMuSqZLtNQEvy1ojes","msg":"User credentials created"}
{"level":30,"time":1764880024407,"env":"test","module":"auth-routes","userId":"8DsDMuSqZLtNQEvy1ojes","email":"test-workflows-6uz_yo0YJ6nPWyFKlqnSG@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c8b6d12e-602a-4bee-b9ca-52a45e6eb38f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"8DsDMuSqZLtNQEvy1ojes","tenantId":"5cf8251c-95f4-4536-97ba-db334a77b4de","createdBy":"8DsDMuSqZLtNQEvy1ojes","ownerId":"8DsDMuSqZLtNQEvy1ojes","status":"active","archived":false,"createdAt":"2025-12-04T20:27:06.142Z","updatedAt":"2025-12-04T20:27:06.142Z"}

{"level":30,"time":1764880025131,"env":"test","module":"user-credentials-repository","userId":"P0_5z6vm9gD3WRbLQ62GU","msg":"User credentials created"}
{"level":30,"time":1764880025131,"env":"test","module":"auth-routes","userId":"P0_5z6vm9gD3WRbLQ62GU","email":"viewer-53qNNNeg7E7I-0H1U008t@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880025237,"env":"test","module":"rbac-middleware","userId":"P0_5z6vm9gD3WRbLQ62GU","userRole":"viewer","permission":"workflow:create","path":"/projects/c8b6d12e-602a-4bee-b9ca-52a45e6eb38f/workflows","msg":"Permission denied"}
{"level":50,"time":1764880031431,"env":"test","error":{},"workflowId":"23ff9a35-a7cd-4429-b387-c42b61a293da","userId":"8DsDMuSqZLtNQEvy1ojes","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880031751,"env":"test","module":"auth-middleware","path":"/api/workflows/255e0613-312c-4557-89df-563f6f709ef6/move","msg":"No valid authentication found"}
{"level":30,"time":1764880032250,"env":"test","module":"user-credentials-repository","userId":"dpiHjP8SUw9IM1I3MT1K5","msg":"User credentials created"}
{"level":30,"time":1764880032251,"env":"test","module":"auth-routes","userId":"dpiHjP8SUw9IM1I3MT1K5","email":"test-workflows-j5C7FZ0kkbXizkvHNQEg_@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880032352,"env":"test","error":{},"workflowId":"f304777e-f19a-4ad8-8195-2190b38a0335","userId":"dpiHjP8SUw9IM1I3MT1K5","projectId":"bf27725d-9edf-4a96-806f-56567c3361c4","msg":"Error moving workflow"}
{"level":50,"time":1764880032715,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b9eeedf3-408d-450d-b505-f7bbb709a069","userId":"8DsDMuSqZLtNQEvy1ojes","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880033082,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d90d36bd-1959-458f-bfcc-2639549faa25","userId":"8DsDMuSqZLtNQEvy1ojes","msg":"Error moving workflow"}
{"level":30,"time":1764880033593,"env":"test","module":"user-credentials-repository","userId":"8rdtu3m4VcXV2gFjsfC6x","msg":"User credentials created"}
{"level":30,"time":1764880033594,"env":"test","module":"auth-routes","userId":"8rdtu3m4VcXV2gFjsfC6x","email":"test-workflows-J9bz89H7Th0DCFhitAnQc@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880033778,"env":"test","module":"auth-routes","userId":"8rdtu3m4VcXV2gFjsfC6x","email":"test-workflows-J9bz89H7Th0DCFhitAnQc@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880033958,"env":"test","error":{},"workflowId":"613c8a5c-ce68-48d1-8eb8-364d80701a83","userId":"8DsDMuSqZLtNQEvy1ojes","projectId":"572f4dff-983d-426d-b9e0-67f437b1bf85","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 724[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 320[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 877[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:52
[2m   Duration [22m 20.99s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx28 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764880067163,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880070545,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880074259,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880074260,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880074273,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880074273,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880074273,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880074273,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880074841,"env":"test","module":"user-credentials-repository","userId":"0J6y3mBe9SloRqoe-p9nC","msg":"User credentials created"}
{"level":30,"time":1764880074844,"env":"test","module":"auth-routes","userId":"0J6y3mBe9SloRqoe-p9nC","email":"test-workflows-t39blvDB0mFLt8adLnz1e@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"cbaab326-3f02-40b1-80a6-53c77faf7a0d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"0J6y3mBe9SloRqoe-p9nC","tenantId":"0817ad5d-55cf-4a40-839b-4dda6c9f7403","createdBy":"0J6y3mBe9SloRqoe-p9nC","ownerId":"0J6y3mBe9SloRqoe-p9nC","status":"active","archived":false,"createdAt":"2025-12-04T20:27:56.567Z","updatedAt":"2025-12-04T20:27:56.567Z"}

{"level":30,"time":1764880075555,"env":"test","module":"user-credentials-repository","userId":"oZVr-MsXGawZZ_QoIqZma","msg":"User credentials created"}
{"level":30,"time":1764880075556,"env":"test","module":"auth-routes","userId":"oZVr-MsXGawZZ_QoIqZma","email":"viewer-Vu1Uaq4mMIRixkT76hM7B@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880075657,"env":"test","module":"rbac-middleware","userId":"oZVr-MsXGawZZ_QoIqZma","userRole":"viewer","permission":"workflow:create","path":"/projects/cbaab326-3f02-40b1-80a6-53c77faf7a0d/workflows","msg":"Permission denied"}
{"level":50,"time":1764880082088,"env":"test","error":{},"workflowId":"a51e4031-a7c5-44f5-ab88-54a6595d607d","userId":"0J6y3mBe9SloRqoe-p9nC","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880082420,"env":"test","module":"auth-middleware","path":"/api/workflows/941b2452-1208-4fe2-9d37-d7eae7e58a8f/move","msg":"No valid authentication found"}
{"level":30,"time":1764880082945,"env":"test","module":"user-credentials-repository","userId":"2YqgJRMOqdj3R3qChCNlH","msg":"User credentials created"}
{"level":30,"time":1764880082946,"env":"test","module":"auth-routes","userId":"2YqgJRMOqdj3R3qChCNlH","email":"test-workflows-5ejIROXGl0RFWHS-JaMOk@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880082990,"env":"test","error":{},"workflowId":"fe7744a5-c68d-42cb-8112-5d29f9d76fd9","userId":"2YqgJRMOqdj3R3qChCNlH","projectId":"ec0b2f0a-6e33-4a7b-9d4b-28d3cc884651","msg":"Error moving workflow"}
{"level":50,"time":1764880083356,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"0e20a855-c7bd-42e4-95f8-660db4e9f90f","userId":"0J6y3mBe9SloRqoe-p9nC","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880083743,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"770c6ac0-2437-4539-8f8f-8e3e7e8984f2","userId":"0J6y3mBe9SloRqoe-p9nC","msg":"Error moving workflow"}
{"level":30,"time":1764880084275,"env":"test","module":"user-credentials-repository","userId":"zi9WPkwgju7BXM4kui7Qr","msg":"User credentials created"}
{"level":30,"time":1764880084276,"env":"test","module":"auth-routes","userId":"zi9WPkwgju7BXM4kui7Qr","email":"test-workflows-0Z-7WCvQpAUeHtNNE9qUA@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880084481,"env":"test","module":"auth-routes","userId":"zi9WPkwgju7BXM4kui7Qr","email":"test-workflows-0Z-7WCvQpAUeHtNNE9qUA@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880084688,"env":"test","error":{},"workflowId":"362c682b-6bfd-4ff0-875b-990d33ca040f","userId":"0J6y3mBe9SloRqoe-p9nC","projectId":"286f1a86-0c20-4de1-8a88-10f4ac08ceab","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10687[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 490[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 683[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 795[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 625[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 946[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:27:42
[2m   Duration [22m 21.58s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx29 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764880089929,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880092889,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880096062,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880096063,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880096074,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880096074,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880096074,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880096074,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880096550,"env":"test","module":"user-credentials-repository","userId":"QdGAjCeMHHbOXgfDUWlBl","msg":"User credentials created"}
{"level":30,"time":1764880096554,"env":"test","module":"auth-routes","userId":"QdGAjCeMHHbOXgfDUWlBl","email":"test-workflows-rSZvywC5YrRgpFFncEHCW@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"231ef890-623d-430e-b6f5-4e6dd25f916d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"QdGAjCeMHHbOXgfDUWlBl","tenantId":"d8d2c041-3fe8-43fa-9c7b-a1c5400fdbb8","createdBy":"QdGAjCeMHHbOXgfDUWlBl","ownerId":"QdGAjCeMHHbOXgfDUWlBl","status":"active","archived":false,"createdAt":"2025-12-04T20:28:18.274Z","updatedAt":"2025-12-04T20:28:18.274Z"}

{"level":30,"time":1764880097229,"env":"test","module":"user-credentials-repository","userId":"jjWCOEb79WFNNNcRP6d8Y","msg":"User credentials created"}
{"level":30,"time":1764880097230,"env":"test","module":"auth-routes","userId":"jjWCOEb79WFNNNcRP6d8Y","email":"viewer-d5zn0ApxfsPqATxQO4p4A@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880097323,"env":"test","module":"rbac-middleware","userId":"jjWCOEb79WFNNNcRP6d8Y","userRole":"viewer","permission":"workflow:create","path":"/projects/231ef890-623d-430e-b6f5-4e6dd25f916d/workflows","msg":"Permission denied"}
{"level":50,"time":1764880103241,"env":"test","error":{},"workflowId":"d3ff555b-833b-48d2-ac61-d6d7e3733814","userId":"QdGAjCeMHHbOXgfDUWlBl","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880103547,"env":"test","module":"auth-middleware","path":"/api/workflows/454e2a5d-e879-41a6-b993-3bb2f9d3ce0a/move","msg":"No valid authentication found"}
{"level":30,"time":1764880104049,"env":"test","module":"user-credentials-repository","userId":"Iug6kH_PvIzAM4At3vZoj","msg":"User credentials created"}
{"level":30,"time":1764880104050,"env":"test","module":"auth-routes","userId":"Iug6kH_PvIzAM4At3vZoj","email":"test-workflows--T443cKxm_2n4Lan6FIUM@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880104108,"env":"test","error":{},"workflowId":"a94fb80a-faf4-41ee-a7e7-3c67805183da","userId":"Iug6kH_PvIzAM4At3vZoj","projectId":"732366cc-5b3a-4e81-ab28-972f4038234c","msg":"Error moving workflow"}
{"level":50,"time":1764880104464,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7ebb792c-ceec-4e84-b950-9befe28b96a1","userId":"QdGAjCeMHHbOXgfDUWlBl","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880104829,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"37406af9-4d5f-4926-b55e-192001b35b62","userId":"QdGAjCeMHHbOXgfDUWlBl","msg":"Error moving workflow"}
{"level":30,"time":1764880105490,"env":"test","module":"user-credentials-repository","userId":"uqhLyzCwSA2CwpL6kHP_L","msg":"User credentials created"}
{"level":30,"time":1764880105491,"env":"test","module":"auth-routes","userId":"uqhLyzCwSA2CwpL6kHP_L","email":"test-workflows-m9UrxUYOLKqcvpAEIxsqv@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880105697,"env":"test","module":"auth-routes","userId":"uqhLyzCwSA2CwpL6kHP_L","email":"test-workflows-m9UrxUYOLKqcvpAEIxsqv@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880105874,"env":"test","error":{},"workflowId":"7be07834-f63e-4a9d-a677-487b522df18d","userId":"QdGAjCeMHHbOXgfDUWlBl","projectId":"b4f9dafd-9ab6-486d-84f6-ab71e4db525e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10092[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 710[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 357[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1046[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:05
[2m   Duration [22m 20.03s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx30 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880108632,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880110771,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880113194,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880113195,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880113207,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880113207,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880113208,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880113208,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880113675,"env":"test","module":"user-credentials-repository","userId":"3a-TUPxs0AgCNKYWZDAIR","msg":"User credentials created"}
{"level":30,"time":1764880113679,"env":"test","module":"auth-routes","userId":"3a-TUPxs0AgCNKYWZDAIR","email":"test-workflows-bqA1yfhe68cgpTchzHSti@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e4647171-9575-4cc7-8f5c-d13db7bfe2bf","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"3a-TUPxs0AgCNKYWZDAIR","tenantId":"9c9e06dc-7418-4d24-87ac-8921bc1214a4","createdBy":"3a-TUPxs0AgCNKYWZDAIR","ownerId":"3a-TUPxs0AgCNKYWZDAIR","status":"active","archived":false,"createdAt":"2025-12-04T20:28:35.398Z","updatedAt":"2025-12-04T20:28:35.398Z"}

{"level":30,"time":1764880114365,"env":"test","module":"user-credentials-repository","userId":"HWrj6tAkhZ_e8RJiCd73Z","msg":"User credentials created"}
{"level":30,"time":1764880114366,"env":"test","module":"auth-routes","userId":"HWrj6tAkhZ_e8RJiCd73Z","email":"viewer-Tl6jyUlWFtJNhmHNNfkNT@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880114460,"env":"test","module":"rbac-middleware","userId":"HWrj6tAkhZ_e8RJiCd73Z","userRole":"viewer","permission":"workflow:create","path":"/projects/e4647171-9575-4cc7-8f5c-d13db7bfe2bf/workflows","msg":"Permission denied"}
{"level":50,"time":1764880120816,"env":"test","error":{},"workflowId":"cd01625c-6f02-4450-9506-3db11ec538f6","userId":"3a-TUPxs0AgCNKYWZDAIR","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880121141,"env":"test","module":"auth-middleware","path":"/api/workflows/86f906da-7ac7-49b0-88a2-b983abe82f3a/move","msg":"No valid authentication found"}
{"level":30,"time":1764880121652,"env":"test","module":"user-credentials-repository","userId":"N7cZFuoGI76js4--f7rWD","msg":"User credentials created"}
{"level":30,"time":1764880121653,"env":"test","module":"auth-routes","userId":"N7cZFuoGI76js4--f7rWD","email":"test-workflows-WMHO3k7YDusyklNgI6kMM@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880121700,"env":"test","error":{},"workflowId":"5b59d799-1cc4-4c47-8272-2ab467ad492b","userId":"N7cZFuoGI76js4--f7rWD","projectId":"6d7ae304-204c-49f6-974c-82baa2041394","msg":"Error moving workflow"}
{"level":50,"time":1764880122081,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"59a024e1-bd9d-4b9b-a1dd-5e333f42a903","userId":"3a-TUPxs0AgCNKYWZDAIR","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880122448,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d099506b-cdff-4aa6-818f-fb477bf0511f","userId":"3a-TUPxs0AgCNKYWZDAIR","msg":"Error moving workflow"}
{"level":30,"time":1764880122991,"env":"test","module":"user-credentials-repository","userId":"T3rdYzetBJZKegmPozfWL","msg":"User credentials created"}
{"level":30,"time":1764880122992,"env":"test","module":"auth-routes","userId":"T3rdYzetBJZKegmPozfWL","email":"test-workflows-Jp--5dOsxh3xIAntLWptm@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880123194,"env":"test","module":"auth-routes","userId":"T3rdYzetBJZKegmPozfWL","email":"test-workflows-Jp--5dOsxh3xIAntLWptm@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880123382,"env":"test","error":{},"workflowId":"4186eec8-378e-4680-9751-f9f618e3117b","userId":"3a-TUPxs0AgCNKYWZDAIR","projectId":"275af51c-d4ca-4f35-9a40-ea1a4d285bd7","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 336[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 805[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 559[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 934[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:26
[2m   Duration [22m 17.07s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/sections.routes.ts [22m[34mx31 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880140347,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880144934,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880148622,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880148623,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880148635,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880148635,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880148635,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880148635,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880149193,"env":"test","module":"user-credentials-repository","userId":"y1WWNIYSA3tE9ukWioeNi","msg":"User credentials created"}
{"level":30,"time":1764880149196,"env":"test","module":"auth-routes","userId":"y1WWNIYSA3tE9ukWioeNi","email":"test-workflows-3A8rtw1qYx-il53Wi40OV@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2a2297b1-e559-4228-8640-685dfc9995ba","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"y1WWNIYSA3tE9ukWioeNi","tenantId":"5296dcff-af5c-4ce1-bdaf-637c3c249ac2","createdBy":"y1WWNIYSA3tE9ukWioeNi","ownerId":"y1WWNIYSA3tE9ukWioeNi","status":"active","archived":false,"createdAt":"2025-12-04T20:29:10.917Z","updatedAt":"2025-12-04T20:29:10.917Z"}

{"level":30,"time":1764880149920,"env":"test","module":"user-credentials-repository","userId":"t3qNZDUZkhdY65Naq60fq","msg":"User credentials created"}
{"level":30,"time":1764880149921,"env":"test","module":"auth-routes","userId":"t3qNZDUZkhdY65Naq60fq","email":"viewer-bNEEdmuLJIxVwAeoBF199@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880150015,"env":"test","module":"rbac-middleware","userId":"t3qNZDUZkhdY65Naq60fq","userRole":"viewer","permission":"workflow:create","path":"/projects/2a2297b1-e559-4228-8640-685dfc9995ba/workflows","msg":"Permission denied"}
{"level":50,"time":1764880156536,"env":"test","error":{},"workflowId":"3803e2e2-32cf-42ad-b40f-a91c6397b264","userId":"y1WWNIYSA3tE9ukWioeNi","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880156858,"env":"test","module":"auth-middleware","path":"/api/workflows/c01de7fb-c1fa-4b9b-a643-77351a6dbe60/move","msg":"No valid authentication found"}
{"level":30,"time":1764880157375,"env":"test","module":"user-credentials-repository","userId":"ESLfQli-k9lGgY440PVZ1","msg":"User credentials created"}
{"level":30,"time":1764880157375,"env":"test","module":"auth-routes","userId":"ESLfQli-k9lGgY440PVZ1","email":"test-workflows-L2EB5o5jZkMDh8o8-GfRe@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880157427,"env":"test","error":{},"workflowId":"c61a9b61-0669-4f59-8bc2-53d44ba79769","userId":"ESLfQli-k9lGgY440PVZ1","projectId":"f0a6de0c-5209-4747-a9f7-13c28ca648d5","msg":"Error moving workflow"}
{"level":50,"time":1764880157814,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"265ecb03-b982-4ed2-9ea1-5b344d983b69","userId":"y1WWNIYSA3tE9ukWioeNi","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880158206,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f560285a-494f-4213-8a67-caa3b1317edd","userId":"y1WWNIYSA3tE9ukWioeNi","msg":"Error moving workflow"}
{"level":50,"time":1764880158745,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(f902XPJ8YMpT7mT7seJGt) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"f902XPJ8YMpT7mT7seJGt","msg":"Failed to create user credentials"}
{"level":50,"time":1764880158745,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(f902XPJ8YMpT7mT7seJGt) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10518[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 360[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 679[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 503[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 569[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 391[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 541[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:56
[2m   Duration [22m 22.16s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx32 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764880169515,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880172766,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880176172,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880176172,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880176182,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880176182,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880176183,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880176183,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880176664,"env":"test","module":"user-credentials-repository","userId":"Lj5qP4Naq9y1H9Za9U-yE","msg":"User credentials created"}
{"level":30,"time":1764880176669,"env":"test","module":"auth-routes","userId":"Lj5qP4Naq9y1H9Za9U-yE","email":"test-workflows-6XUpa8WOShx-iAmG-DI1-@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d8a3b09c-11a1-4b21-a16d-5630ba63f458","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Lj5qP4Naq9y1H9Za9U-yE","tenantId":"2f128987-f15b-4462-95ac-e4bff9c214f5","createdBy":"Lj5qP4Naq9y1H9Za9U-yE","ownerId":"Lj5qP4Naq9y1H9Za9U-yE","status":"active","archived":false,"createdAt":"2025-12-04T20:29:38.381Z","updatedAt":"2025-12-04T20:29:38.381Z"}

{"level":30,"time":1764880177320,"env":"test","module":"user-credentials-repository","userId":"Zhy0nTXxc8IewK_aA1nVy","msg":"User credentials created"}
{"level":30,"time":1764880177320,"env":"test","module":"auth-routes","userId":"Zhy0nTXxc8IewK_aA1nVy","email":"viewer-att_3V3f98zLX7oGaHu7P@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880177416,"env":"test","module":"rbac-middleware","userId":"Zhy0nTXxc8IewK_aA1nVy","userRole":"viewer","permission":"workflow:create","path":"/projects/d8a3b09c-11a1-4b21-a16d-5630ba63f458/workflows","msg":"Permission denied"}
{"level":50,"time":1764880183573,"env":"test","error":{},"workflowId":"38a2993d-c59d-4c23-8492-4bb86689ecef","userId":"Lj5qP4Naq9y1H9Za9U-yE","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880183907,"env":"test","module":"auth-middleware","path":"/api/workflows/5a551ef1-dc1b-42af-8f5f-1f013a502f72/move","msg":"No valid authentication found"}
{"level":30,"time":1764880184434,"env":"test","module":"user-credentials-repository","userId":"AUfCRQms1_KRFY1KpYXCb","msg":"User credentials created"}
{"level":30,"time":1764880184434,"env":"test","module":"auth-routes","userId":"AUfCRQms1_KRFY1KpYXCb","email":"test-workflows-sU78W6G1Z0xrgrPeFf5vD@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880184484,"env":"test","error":{},"workflowId":"4ed5451d-02e0-48af-a1f2-ed75edadbab5","userId":"AUfCRQms1_KRFY1KpYXCb","projectId":"9af9c8e7-296b-4d64-bd67-48fa43c669f5","msg":"Error moving workflow"}
{"level":50,"time":1764880184834,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"0985a9d2-0d28-444d-b777-5d408d8ec73e","userId":"Lj5qP4Naq9y1H9Za9U-yE","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880185204,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e3804e35-7508-4eef-b2e7-faa9bea108d0","userId":"Lj5qP4Naq9y1H9Za9U-yE","msg":"Error moving workflow"}
{"level":30,"time":1764880185742,"env":"test","module":"user-credentials-repository","userId":"NNMdN6SfQGVDqEGPtrREA","msg":"User credentials created"}
{"level":30,"time":1764880185743,"env":"test","module":"auth-routes","userId":"NNMdN6SfQGVDqEGPtrREA","email":"test-workflows-2yAvxColSMeD816KEoo14@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880185960,"env":"test","module":"auth-routes","userId":"NNMdN6SfQGVDqEGPtrREA","email":"test-workflows-2yAvxColSMeD816KEoo14@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880186155,"env":"test","error":{},"workflowId":"b2917b04-16e9-469c-85fa-f78fbc11b348","userId":"Lj5qP4Naq9y1H9Za9U-yE","projectId":"21336853-f0e3-4b8e-b148-9f35be7c6fd5","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10255[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 302[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 302[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 707[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 951[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"

 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:25
[2m   Duration [22m 20.08s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx33 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880189505,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880191866,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880194669,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880194670,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880194681,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880194681,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880194682,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880194682,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880195174,"env":"test","module":"user-credentials-repository","userId":"UwjUXkS_5RuNoWYyumKXJ","msg":"User credentials created"}
{"level":30,"time":1764880195178,"env":"test","module":"auth-routes","userId":"UwjUXkS_5RuNoWYyumKXJ","email":"test-workflows-Qs7ipq4m-unOlx0po1OvZ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"758cf826-84d4-4feb-b471-25716c0bc77b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"UwjUXkS_5RuNoWYyumKXJ","tenantId":"8b5ad27e-9482-42aa-ae43-5b679c92e4ab","createdBy":"UwjUXkS_5RuNoWYyumKXJ","ownerId":"UwjUXkS_5RuNoWYyumKXJ","status":"active","archived":false,"createdAt":"2025-12-04T20:29:56.909Z","updatedAt":"2025-12-04T20:29:56.909Z"}

{"level":30,"time":1764880195884,"env":"test","module":"user-credentials-repository","userId":"HF8Yze0H3mrYzOIS5ZyWd","msg":"User credentials created"}
{"level":30,"time":1764880195885,"env":"test","module":"auth-routes","userId":"HF8Yze0H3mrYzOIS5ZyWd","email":"viewer-d98O5YZvejhtOrztbXmuS@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880195984,"env":"test","module":"rbac-middleware","userId":"HF8Yze0H3mrYzOIS5ZyWd","userRole":"viewer","permission":"workflow:create","path":"/projects/758cf826-84d4-4feb-b471-25716c0bc77b/workflows","msg":"Permission denied"}
{"level":50,"time":1764880202460,"env":"test","error":{},"workflowId":"28ff4d2c-62d6-4ff3-acb1-0dd619804ddb","userId":"UwjUXkS_5RuNoWYyumKXJ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880202826,"env":"test","module":"auth-middleware","path":"/api/workflows/6298d51e-5c9f-4638-b6e9-1ab0f0d99416/move","msg":"No valid authentication found"}
{"level":30,"time":1764880203374,"env":"test","module":"user-credentials-repository","userId":"L9U0IpgrwABRnaLgR1H_n","msg":"User credentials created"}
{"level":30,"time":1764880203375,"env":"test","module":"auth-routes","userId":"L9U0IpgrwABRnaLgR1H_n","email":"test-workflows-x5g0b8YJzQQixTJ2jQGkN@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880203423,"env":"test","error":{},"workflowId":"c74c6b20-1e9e-4b94-874b-807df5c38e50","userId":"L9U0IpgrwABRnaLgR1H_n","projectId":"f4b00e42-350d-48b0-a3b1-5946ea6e1dab","msg":"Error moving workflow"}
{"level":50,"time":1764880203823,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"79a77a61-dd75-4a69-984a-ec93a9c40e65","userId":"UwjUXkS_5RuNoWYyumKXJ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880204240,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"30ded165-f07c-4293-baf2-d5c520b3a59a","userId":"UwjUXkS_5RuNoWYyumKXJ","msg":"Error moving workflow"}
{"level":30,"time":1764880204765,"env":"test","module":"user-credentials-repository","userId":"qfK1CCfJbEghw-7SIFbrz","msg":"User credentials created"}
{"level":30,"time":1764880204765,"env":"test","module":"auth-routes","userId":"qfK1CCfJbEghw-7SIFbrz","email":"test-workflows-8GQ0P5MQUdP3ugOJKEdSx@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880204971,"env":"test","module":"auth-routes","userId":"qfK1CCfJbEghw-7SIFbrz","email":"test-workflows-8GQ0P5MQUdP3ugOJKEdSx@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880205172,"env":"test","error":{},"workflowId":"7d995119-052a-4fa2-b153-9ec3e50b7d9f","userId":"UwjUXkS_5RuNoWYyumKXJ","projectId":"dbb6d120-c07f-4c59-89de-b333ef516082","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10878[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 834[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 764[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 808[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 400[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 418[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 933[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:46
[2m   Duration [22m 18.37s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/steps.routes.ts [22m[34mx34 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764880218534,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880221652,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880225490,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880225491,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880225502,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880225502,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880225502,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880225502,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880226108,"env":"test","module":"user-credentials-repository","userId":"tTFTHMsZFSdtcc_EjvDHh","msg":"User credentials created"}
{"level":30,"time":1764880226112,"env":"test","module":"auth-routes","userId":"tTFTHMsZFSdtcc_EjvDHh","email":"test-workflows-JE_NXRh-eMVbpAYTDAej5@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a38f034c-5239-473c-aaf8-eb4acbd349ca","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"tTFTHMsZFSdtcc_EjvDHh","tenantId":"b99ef5e7-d048-4ea7-b9ee-f2d4235838bf","createdBy":"tTFTHMsZFSdtcc_EjvDHh","ownerId":"tTFTHMsZFSdtcc_EjvDHh","status":"active","archived":false,"createdAt":"2025-12-04T20:30:27.820Z","updatedAt":"2025-12-04T20:30:27.820Z"}

{"level":30,"time":1764880226780,"env":"test","module":"user-credentials-repository","userId":"ktV1toIV6BrKeSjC8iFqN","msg":"User credentials created"}
{"level":30,"time":1764880226780,"env":"test","module":"auth-routes","userId":"ktV1toIV6BrKeSjC8iFqN","email":"viewer-DfurnofCU9KO80cb8zdEE@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880226880,"env":"test","module":"rbac-middleware","userId":"ktV1toIV6BrKeSjC8iFqN","userRole":"viewer","permission":"workflow:create","path":"/projects/a38f034c-5239-473c-aaf8-eb4acbd349ca/workflows","msg":"Permission denied"}
{"level":50,"time":1764880232886,"env":"test","error":{},"workflowId":"107d0b31-6cb9-48ca-ba50-2e406323c6da","userId":"tTFTHMsZFSdtcc_EjvDHh","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880233199,"env":"test","module":"auth-middleware","path":"/api/workflows/bdb093c7-6374-43df-bb55-75b413583ca7/move","msg":"No valid authentication found"}
{"level":30,"time":1764880233682,"env":"test","module":"user-credentials-repository","userId":"RfD1Ccpw4rSFwpaGq3-gL","msg":"User credentials created"}
{"level":30,"time":1764880233683,"env":"test","module":"auth-routes","userId":"RfD1Ccpw4rSFwpaGq3-gL","email":"test-workflows-93duoTRxSS2k8oCTJTAp2@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880233730,"env":"test","error":{},"workflowId":"31321d8e-cba5-4234-93a2-cb6679b4ee15","userId":"RfD1Ccpw4rSFwpaGq3-gL","projectId":"a53df420-c59d-4c7c-82a5-c705e6b5ca27","msg":"Error moving workflow"}
{"level":50,"time":1764880234092,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"41b906ce-85bf-419e-95f5-cbd12cd3a3ee","userId":"tTFTHMsZFSdtcc_EjvDHh","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880234447,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b764eb4d-4fc8-4df7-bd9e-2d8cd938bb58","userId":"tTFTHMsZFSdtcc_EjvDHh","msg":"Error moving workflow"}
{"level":30,"time":1764880234944,"env":"test","module":"user-credentials-repository","userId":"8RKopXkqdcRfUmvcKCF84","msg":"User credentials created"}
{"level":30,"time":1764880234945,"env":"test","module":"auth-routes","userId":"8RKopXkqdcRfUmvcKCF84","email":"test-workflows-2wqdz6ukdTCe2ZHHeJxms@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880235133,"env":"test","module":"auth-routes","userId":"8RKopXkqdcRfUmvcKCF84","email":"test-workflows-2wqdz6ukdTCe2ZHHeJxms@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880235317,"env":"test","error":{},"workflowId":"ecd47f1d-f424-4c9b-9751-5e149e9e87b9","userId":"tTFTHMsZFSdtcc_EjvDHh","projectId":"fa61c936-9f58-460b-a3fc-8c4fff325f80","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10095[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 870[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:14
[2m   Duration [22m 20.21s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx35 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764880255551,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880259003,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880263147,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880263148,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880263160,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880263160,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880263160,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880263160,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880263710,"env":"test","module":"user-credentials-repository","userId":"l4HvWuBZbggK8ZF_mtWFL","msg":"User credentials created"}
{"level":30,"time":1764880263714,"env":"test","module":"auth-routes","userId":"l4HvWuBZbggK8ZF_mtWFL","email":"test-workflows-m-N0oIT6KkeOrvgPqtpOp@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"96b1ba99-c083-4383-9a76-489dbd471cc3","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"l4HvWuBZbggK8ZF_mtWFL","tenantId":"be57dbd8-d773-4a72-8dab-6b52e418e366","createdBy":"l4HvWuBZbggK8ZF_mtWFL","ownerId":"l4HvWuBZbggK8ZF_mtWFL","status":"active","archived":false,"createdAt":"2025-12-04T20:31:05.436Z","updatedAt":"2025-12-04T20:31:05.436Z"}

{"level":30,"time":1764880264406,"env":"test","module":"user-credentials-repository","userId":"HSKqYZzEu6cFWO0aDajkB","msg":"User credentials created"}
{"level":30,"time":1764880264407,"env":"test","module":"auth-routes","userId":"HSKqYZzEu6cFWO0aDajkB","email":"viewer-OT87Va2rnTArtsCfiOk8K@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880264512,"env":"test","module":"rbac-middleware","userId":"HSKqYZzEu6cFWO0aDajkB","userRole":"viewer","permission":"workflow:create","path":"/projects/96b1ba99-c083-4383-9a76-489dbd471cc3/workflows","msg":"Permission denied"}
{"level":50,"time":1764880270926,"env":"test","error":{},"workflowId":"a1f65d27-56c0-46d4-8828-f63b1d21d6cf","userId":"l4HvWuBZbggK8ZF_mtWFL","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880271258,"env":"test","module":"auth-middleware","path":"/api/workflows/da42e1a4-a4fa-4fd6-a984-2a1394eb029f/move","msg":"No valid authentication found"}
{"level":30,"time":1764880271875,"env":"test","module":"user-credentials-repository","userId":"5wVK_5kdO8oMc_rUyq_FB","msg":"User credentials created"}
{"level":30,"time":1764880271876,"env":"test","module":"auth-routes","userId":"5wVK_5kdO8oMc_rUyq_FB","email":"test-workflows-Ao_H3PpkGPqINjkz10Und@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880271926,"env":"test","error":{},"workflowId":"f18af9fb-3eb3-46d9-944f-b3b78832533e","userId":"5wVK_5kdO8oMc_rUyq_FB","projectId":"915add64-8ced-4bf6-bf22-7fb979686269","msg":"Error moving workflow"}
{"level":50,"time":1764880272304,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2dc25d08-23a2-4168-9eee-2f1ae56bdbc6","userId":"l4HvWuBZbggK8ZF_mtWFL","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880272699,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"6ee66d84-2742-48a0-9699-1b07a24cf95e","userId":"l4HvWuBZbggK8ZF_mtWFL","msg":"Error moving workflow"}
{"level":30,"time":1764880273265,"env":"test","module":"user-credentials-repository","userId":"MQUCxUTtgxQEype8N9hsR","msg":"User credentials created"}
{"level":30,"time":1764880273266,"env":"test","module":"auth-routes","userId":"MQUCxUTtgxQEype8N9hsR","email":"test-workflows-FIty4h1AbNCrGMbbvxCOC@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880273471,"env":"test","module":"auth-routes","userId":"MQUCxUTtgxQEype8N9hsR","email":"test-workflows-FIty4h1AbNCrGMbbvxCOC@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880273665,"env":"test","error":{},"workflowId":"1515e884-c064-4f6f-a7b1-2ead6659a045","userId":"l4HvWuBZbggK8ZF_mtWFL","projectId":"c52e0637-dd45-4180-9d25-bacfbb55095e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10785[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 670[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 395[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 969[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:52
[2m   Duration [22m 21.12s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx36 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880278197,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880281455,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880285783,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880285784,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880285795,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880285795,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880285796,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880285796,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880286330,"env":"test","module":"user-credentials-repository","userId":"IsB7uP0BmJm7iAWtt1hvc","msg":"User credentials created"}
{"level":30,"time":1764880286334,"env":"test","module":"auth-routes","userId":"IsB7uP0BmJm7iAWtt1hvc","email":"test-workflows-Et7oFX3w8vMN6RvDdkbZ4@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0c2791b6-3d2b-43fa-925c-4bf0017f5f14","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"IsB7uP0BmJm7iAWtt1hvc","tenantId":"65afacd2-3895-4502-bc00-9d93549d3510","createdBy":"IsB7uP0BmJm7iAWtt1hvc","ownerId":"IsB7uP0BmJm7iAWtt1hvc","status":"active","archived":false,"createdAt":"2025-12-04T20:31:28.055Z","updatedAt":"2025-12-04T20:31:28.055Z"}

{"level":30,"time":1764880287058,"env":"test","module":"user-credentials-repository","userId":"WlbxrjCItdO2dkCZ6VsF0","msg":"User credentials created"}
{"level":30,"time":1764880287058,"env":"test","module":"auth-routes","userId":"WlbxrjCItdO2dkCZ6VsF0","email":"viewer-6mBbcML1mzNEtR-CZdA-v@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880287160,"env":"test","module":"rbac-middleware","userId":"WlbxrjCItdO2dkCZ6VsF0","userRole":"viewer","permission":"workflow:create","path":"/projects/0c2791b6-3d2b-43fa-925c-4bf0017f5f14/workflows","msg":"Permission denied"}
{"level":50,"time":1764880293738,"env":"test","error":{},"workflowId":"732cd379-5bda-4ab7-bdf1-70270627672f","userId":"IsB7uP0BmJm7iAWtt1hvc","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880294144,"env":"test","module":"auth-middleware","path":"/api/workflows/99f9f3f0-0482-48e9-9d84-7295b40fac81/move","msg":"No valid authentication found"}
{"level":30,"time":1764880294691,"env":"test","module":"user-credentials-repository","userId":"OZ5w2AcZawRv50S9kX6wB","msg":"User credentials created"}
{"level":30,"time":1764880294692,"env":"test","module":"auth-routes","userId":"OZ5w2AcZawRv50S9kX6wB","email":"test-workflows-tvtaEPSAaVzrbzptTNrB9@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880294740,"env":"test","error":{},"workflowId":"4a5dac63-8afb-43aa-bb9c-4c37a49e7545","userId":"OZ5w2AcZawRv50S9kX6wB","projectId":"546a05be-d037-4c02-a23c-5edddb1e06f3","msg":"Error moving workflow"}
{"level":50,"time":1764880295135,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"aa58685e-fe15-4110-8077-a329879c072a","userId":"IsB7uP0BmJm7iAWtt1hvc","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880295555,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"901d53a1-26f7-45bc-9fc6-203603d67d5c","userId":"IsB7uP0BmJm7iAWtt1hvc","msg":"Error moving workflow"}
{"level":30,"time":1764880296097,"env":"test","module":"user-credentials-repository","userId":"V779PEUKLd3smJl_L9t1x","msg":"User credentials created"}
{"level":30,"time":1764880296098,"env":"test","module":"auth-routes","userId":"V779PEUKLd3smJl_L9t1x","email":"test-workflows-UvTNbTowhhca4zfdi5E50@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880296315,"env":"test","module":"auth-routes","userId":"V779PEUKLd3smJl_L9t1x","email":"test-workflows-UvTNbTowhhca4zfdi5E50@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880296507,"env":"test","error":{},"workflowId":"810d4acb-b081-4513-bba1-04eded6adbe7","userId":"IsB7uP0BmJm7iAWtt1hvc","projectId":"83675479-9650-4b95-b385-f92fa8d661e4","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11019[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 319[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 667[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 822[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 395[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 420[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 954[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:14
[2m   Duration [22m 22.00s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx37 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764880300527,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880303399,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880306407,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880306407,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880306419,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880306419,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880306419,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880306420,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880306945,"env":"test","module":"user-credentials-repository","userId":"UIyVunK3U4Ao5VzGGLueR","msg":"User credentials created"}
{"level":30,"time":1764880306949,"env":"test","module":"auth-routes","userId":"UIyVunK3U4Ao5VzGGLueR","email":"test-workflows-sWgpt7Y7C7EmppaUG2fyV@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c4a031f5-8ba1-48a4-b37c-a1b5b40e2282","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"UIyVunK3U4Ao5VzGGLueR","tenantId":"04999c5e-0dff-4cca-ae70-0905de413cd7","createdBy":"UIyVunK3U4Ao5VzGGLueR","ownerId":"UIyVunK3U4Ao5VzGGLueR","status":"active","archived":false,"createdAt":"2025-12-04T20:31:48.686Z","updatedAt":"2025-12-04T20:31:48.686Z"}

{"level":30,"time":1764880307682,"env":"test","module":"user-credentials-repository","userId":"lSK_213G-qqFL3_X47ZrZ","msg":"User credentials created"}
{"level":30,"time":1764880307683,"env":"test","module":"auth-routes","userId":"lSK_213G-qqFL3_X47ZrZ","email":"viewer-oKuzW7fDVqHsZy8QcOAQ9@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880307782,"env":"test","module":"rbac-middleware","userId":"lSK_213G-qqFL3_X47ZrZ","userRole":"viewer","permission":"workflow:create","path":"/projects/c4a031f5-8ba1-48a4-b37c-a1b5b40e2282/workflows","msg":"Permission denied"}
{"level":50,"time":1764880314308,"env":"test","error":{},"workflowId":"a0be9073-1f2a-4b1c-9174-062e324767d4","userId":"UIyVunK3U4Ao5VzGGLueR","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880314648,"env":"test","module":"auth-middleware","path":"/api/workflows/d3e18c89-68d1-45ea-8b0c-277bf0c68d3a/move","msg":"No valid authentication found"}
{"level":30,"time":1764880315184,"env":"test","module":"user-credentials-repository","userId":"bGdblzY7bO3VB-qHziO0f","msg":"User credentials created"}
{"level":30,"time":1764880315184,"env":"test","module":"auth-routes","userId":"bGdblzY7bO3VB-qHziO0f","email":"test-workflows-mXFyAm-WV-dZKzu7rC_61@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880315236,"env":"test","error":{},"workflowId":"d2b0fa05-e930-4b20-be2e-f6987c15a972","userId":"bGdblzY7bO3VB-qHziO0f","projectId":"ea567d85-a30e-4da4-a712-f519fe2575fd","msg":"Error moving workflow"}
{"level":50,"time":1764880315608,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"4fe98dd7-101c-448e-9754-21294a9d2a08","userId":"UIyVunK3U4Ao5VzGGLueR","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880315993,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"87f3cb0e-29ac-47c6-9f05-7794bd52b777","userId":"UIyVunK3U4Ao5VzGGLueR","msg":"Error moving workflow"}
{"level":30,"time":1764880316536,"env":"test","module":"user-credentials-repository","userId":"tB2N2vVqDWX8iTmd8KZkp","msg":"User credentials created"}
{"level":30,"time":1764880316536,"env":"test","module":"auth-routes","userId":"tB2N2vVqDWX8iTmd8KZkp","email":"test-workflows-KAYYeL1aYGmsjHs8GEb1k@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880316743,"env":"test","module":"auth-routes","userId":"tB2N2vVqDWX8iTmd8KZkp","email":"test-workflows-KAYYeL1aYGmsjHs8GEb1k@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880316941,"env":"test","error":{},"workflowId":"f914a98f-ede0-413f-b956-2d6bb24cdf9b","userId":"UIyVunK3U4Ao5VzGGLueR","projectId":"c5c8260f-1bbc-4fe0-9687-17b00bca09ab","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 842[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 808[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 384[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 950[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:36
[2m   Duration [22m 19.45s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx38 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880321995,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880325060,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880327676,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880327677,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880327697,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880327697,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880327701,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880327701,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880328175,"env":"test","module":"user-credentials-repository","userId":"sUtRaRVyN5Jql7sORBdNf","msg":"User credentials created"}
{"level":30,"time":1764880328178,"env":"test","module":"auth-routes","userId":"sUtRaRVyN5Jql7sORBdNf","email":"test-workflows-vKcJ9d3GqQhXt-Klv9CfF@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b45600a5-928b-4af6-9731-36953889e3ab","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"sUtRaRVyN5Jql7sORBdNf","tenantId":"dd589952-2b31-4587-98e8-1de3e8d1bfe8","createdBy":"sUtRaRVyN5Jql7sORBdNf","ownerId":"sUtRaRVyN5Jql7sORBdNf","status":"active","archived":false,"createdAt":"2025-12-04T20:32:09.897Z","updatedAt":"2025-12-04T20:32:09.897Z"}

{"level":30,"time":1764880328827,"env":"test","module":"user-credentials-repository","userId":"A0XCxVaDatsvxTUgBRs_d","msg":"User credentials created"}
{"level":30,"time":1764880328828,"env":"test","module":"auth-routes","userId":"A0XCxVaDatsvxTUgBRs_d","email":"viewer-L9bEEsvacMHH0wKrU4iFT@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880328920,"env":"test","module":"rbac-middleware","userId":"A0XCxVaDatsvxTUgBRs_d","userRole":"viewer","permission":"workflow:create","path":"/projects/b45600a5-928b-4af6-9731-36953889e3ab/workflows","msg":"Permission denied"}
{"level":50,"time":1764880334870,"env":"test","error":{},"workflowId":"308060a8-09de-4bd5-a6c4-644fb5f159fc","userId":"sUtRaRVyN5Jql7sORBdNf","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880335192,"env":"test","module":"auth-middleware","path":"/api/workflows/7b27f733-9130-42f0-a9aa-7059d7251552/move","msg":"No valid authentication found"}
{"level":30,"time":1764880335694,"env":"test","module":"user-credentials-repository","userId":"0y-cmOV5Nj2-jwD_IB30j","msg":"User credentials created"}
{"level":30,"time":1764880335695,"env":"test","module":"auth-routes","userId":"0y-cmOV5Nj2-jwD_IB30j","email":"test-workflows-iw48gBgn5E2Fl5hYwVo3R@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880335738,"env":"test","error":{},"workflowId":"240086c6-8ee5-4be4-a032-515f17d7eeeb","userId":"0y-cmOV5Nj2-jwD_IB30j","projectId":"b6ed0c99-bdde-490b-b187-40333d3b962a","msg":"Error moving workflow"}
{"level":50,"time":1764880336079,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"76c4145a-01db-4b6f-b6be-bbb066baa41e","userId":"sUtRaRVyN5Jql7sORBdNf","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880336418,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a3b42866-dec3-47dc-8cee-1cd983549e4a","userId":"sUtRaRVyN5Jql7sORBdNf","msg":"Error moving workflow"}
{"level":30,"time":1764880336892,"env":"test","module":"user-credentials-repository","userId":"OHalypTjg5tbvfWVuLTyk","msg":"User credentials created"}
{"level":30,"time":1764880336893,"env":"test","module":"auth-routes","userId":"OHalypTjg5tbvfWVuLTyk","email":"test-workflows-it16xRRMER_9K1J7tLOX6@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880337069,"env":"test","module":"auth-routes","userId":"OHalypTjg5tbvfWVuLTyk","email":"test-workflows-it16xRRMER_9K1J7tLOX6@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880337245,"env":"test","error":{},"workflowId":"b15315c6-977e-4576-91c7-7fe0e43c744f","userId":"sUtRaRVyN5Jql7sORBdNf","projectId":"3fa4cbb8-88a9-4cbd-8818-e68db7fed91f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 303[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 445[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 422[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 582[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 700[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 339[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 829[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:57
[2m   Duration [22m 18.90s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx39 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764880373141,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880375738,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880378873,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880378874,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880378906,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880378907,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880378907,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880378907,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880379454,"env":"test","module":"user-credentials-repository","userId":"ZKDHR6u-U8s2KTP11ZpWc","msg":"User credentials created"}
{"level":30,"time":1764880379458,"env":"test","module":"auth-routes","userId":"ZKDHR6u-U8s2KTP11ZpWc","email":"test-workflows-lcgZ7Q8RhHbYI49o5zDEh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e5dbfd5a-73cc-4fe7-9c4b-0cd2e4f52312","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ZKDHR6u-U8s2KTP11ZpWc","tenantId":"4387f97e-bea8-4b25-b8f9-ffb4d6fa70bc","createdBy":"ZKDHR6u-U8s2KTP11ZpWc","ownerId":"ZKDHR6u-U8s2KTP11ZpWc","status":"active","archived":false,"createdAt":"2025-12-04T20:33:01.189Z","updatedAt":"2025-12-04T20:33:01.189Z"}

{"level":30,"time":1764880380163,"env":"test","module":"user-credentials-repository","userId":"54AFSJZ7ITCVnjvDzmHQG","msg":"User credentials created"}
{"level":30,"time":1764880380164,"env":"test","module":"auth-routes","userId":"54AFSJZ7ITCVnjvDzmHQG","email":"viewer-gC9dZ-EwebyeJ0QQHp6dj@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880380266,"env":"test","module":"rbac-middleware","userId":"54AFSJZ7ITCVnjvDzmHQG","userRole":"viewer","permission":"workflow:create","path":"/projects/e5dbfd5a-73cc-4fe7-9c4b-0cd2e4f52312/workflows","msg":"Permission denied"}
{"level":50,"time":1764880386522,"env":"test","error":{},"workflowId":"f4e4e7b1-0e91-4ab7-827f-3f5dcfac4e6c","userId":"ZKDHR6u-U8s2KTP11ZpWc","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880386886,"env":"test","module":"auth-middleware","path":"/api/workflows/031b7fe4-ae7a-4756-a28b-68b692314e80/move","msg":"No valid authentication found"}
{"level":30,"time":1764880387396,"env":"test","module":"user-credentials-repository","userId":"f8GMe398iKuEbuXKNB-oV","msg":"User credentials created"}
{"level":30,"time":1764880387397,"env":"test","module":"auth-routes","userId":"f8GMe398iKuEbuXKNB-oV","email":"test-workflows-fPNo0Mu6H11jIz18CnPuk@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880387448,"env":"test","error":{},"workflowId":"e1877104-bf1a-4a2e-a2f1-7274ff795a17","userId":"f8GMe398iKuEbuXKNB-oV","projectId":"233c1267-884b-43dd-a31b-a95c552e8b1c","msg":"Error moving workflow"}
{"level":50,"time":1764880387808,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ac5eb7d3-212f-48b9-91b7-893114f69863","userId":"ZKDHR6u-U8s2KTP11ZpWc","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880388168,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d6132247-8d9c-4d9a-87b3-c266decb7d62","userId":"ZKDHR6u-U8s2KTP11ZpWc","msg":"Error moving workflow"}
{"level":30,"time":1764880388675,"env":"test","module":"user-credentials-repository","userId":"KUU-Z3xH_1JfbEVnJ1DEQ","msg":"User credentials created"}
{"level":30,"time":1764880388675,"env":"test","module":"auth-routes","userId":"KUU-Z3xH_1JfbEVnJ1DEQ","email":"test-workflows-UT3O5y6Ncs5HF-2rMI55m@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880388861,"env":"test","module":"auth-routes","userId":"KUU-Z3xH_1JfbEVnJ1DEQ","email":"test-workflows-UT3O5y6Ncs5HF-2rMI55m@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880389058,"env":"test","error":{},"workflowId":"7fba6152-a643-448e-9aee-0a35b19f5565","userId":"ZKDHR6u-U8s2KTP11ZpWc","projectId":"d3550007-ba0c-49f2-b69d-edc9f4eb6bb4","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 729[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 360[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 891[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:32:47
[2m   Duration [22m 20.41s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx40 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764891574461,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764891577217,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764891581134,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764891581135,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764891581146,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764891581146,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764891581146,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764891581146,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764891581689,"env":"test","module":"user-credentials-repository","userId":"bVQcBzIQPNfapGWdcH-MQ","msg":"User credentials created"}
{"level":30,"time":1764891581693,"env":"test","module":"auth-routes","userId":"bVQcBzIQPNfapGWdcH-MQ","email":"test-workflows-oQNV4XOYvNrzXWPhj5EbY@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f338801a-c6b6-4360-8058-b14bc0b77bc7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"bVQcBzIQPNfapGWdcH-MQ","tenantId":"ba7f4975-b177-446a-a02c-2625f485b058","createdBy":"bVQcBzIQPNfapGWdcH-MQ","ownerId":"bVQcBzIQPNfapGWdcH-MQ","status":"active","archived":false,"createdAt":"2025-12-04T23:39:43.595Z","updatedAt":"2025-12-04T23:39:43.595Z"}

{"level":30,"time":1764891582364,"env":"test","module":"user-credentials-repository","userId":"4n8F7CTN3YB8LckV_BUhl","msg":"User credentials created"}
{"level":30,"time":1764891582365,"env":"test","module":"auth-routes","userId":"4n8F7CTN3YB8LckV_BUhl","email":"viewer-97k0E3F9vQflSd5Xa0zb-@example.com","msg":"User registered successfully"}
{"level":40,"time":1764891582465,"env":"test","module":"rbac-middleware","userId":"4n8F7CTN3YB8LckV_BUhl","userRole":"viewer","permission":"workflow:create","path":"/projects/f338801a-c6b6-4360-8058-b14bc0b77bc7/workflows","msg":"Permission denied"}
{"level":50,"time":1764891588668,"env":"test","error":{},"workflowId":"61640ebb-1084-4f3f-b6f8-1d717d69c428","userId":"bVQcBzIQPNfapGWdcH-MQ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764891588982,"env":"test","module":"auth-middleware","path":"/api/workflows/f7033d44-e353-4b11-8908-738035336286/move","msg":"No valid authentication found"}
{"level":30,"time":1764891589506,"env":"test","module":"user-credentials-repository","userId":"-RJSFoqOtZgjaM9UrdoMw","msg":"User credentials created"}
{"level":30,"time":1764891589506,"env":"test","module":"auth-routes","userId":"-RJSFoqOtZgjaM9UrdoMw","email":"test-workflows-_ExLkzK7eZ_ib_A6fZnjy@example.com","msg":"User registered successfully"}
{"level":50,"time":1764891589552,"env":"test","error":{},"workflowId":"f0420d92-35e2-4689-97cd-80d19a2d3785","userId":"-RJSFoqOtZgjaM9UrdoMw","projectId":"8816d0ed-5de1-4b0f-8849-191692bace3a","msg":"Error moving workflow"}
{"level":50,"time":1764891589925,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f0e692d3-903b-41ac-af04-f38f019d7dba","userId":"bVQcBzIQPNfapGWdcH-MQ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764891590292,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f5dbd2c8-c623-4eb1-bb5e-46ff672930f7","userId":"bVQcBzIQPNfapGWdcH-MQ","msg":"Error moving workflow"}
{"level":30,"time":1764891590793,"env":"test","module":"user-credentials-repository","userId":"pFfBhLJ7G0SGVeOaKgeAB","msg":"User credentials created"}
{"level":30,"time":1764891590794,"env":"test","module":"auth-routes","userId":"pFfBhLJ7G0SGVeOaKgeAB","email":"test-workflows-NieyTJHqVbuSDd5IKZMN_@example.com","msg":"User registered successfully"}
{"level":30,"time":1764891590982,"env":"test","module":"auth-routes","userId":"pFfBhLJ7G0SGVeOaKgeAB","email":"test-workflows-NieyTJHqVbuSDd5IKZMN_@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764891591163,"env":"test","error":{},"workflowId":"41636827-1a0b-42f3-a0b3-9efc5192400e","userId":"bVQcBzIQPNfapGWdcH-MQ","projectId":"eb9f7bb2-7a1e-4097-9cec-c575ce22f9b1","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10386[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 724[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 655[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 871[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:39:28
[2m   Duration [22m 21.32s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/auth.ts [22m[34mx41 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764892167423,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892173573,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892176314,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892176315,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892176326,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892176326,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892176326,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892176326,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892176808,"env":"test","module":"user-credentials-repository","userId":"hltzGcOpYCt5YniAE75Gj","msg":"User credentials created"}
{"level":30,"time":1764892176811,"env":"test","module":"auth-routes","userId":"hltzGcOpYCt5YniAE75Gj","email":"test-workflows-a6qtgga_dVPTCU1Hhou_j@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0c7cc8ee-2667-4f38-83c4-827ef48548e7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"hltzGcOpYCt5YniAE75Gj","tenantId":"94a4aca8-7dc6-4c46-8aff-13430572cf8d","createdBy":"hltzGcOpYCt5YniAE75Gj","ownerId":"hltzGcOpYCt5YniAE75Gj","status":"active","archived":false,"createdAt":"2025-12-04T23:49:38.755Z","updatedAt":"2025-12-04T23:49:38.755Z"}

{"level":30,"time":1764892177497,"env":"test","module":"user-credentials-repository","userId":"3MELV1m3sQhGGCqasmZsj","msg":"User credentials created"}
{"level":30,"time":1764892177498,"env":"test","module":"auth-routes","userId":"3MELV1m3sQhGGCqasmZsj","email":"viewer-DjiZuRKBI_rrR83pJSStU@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892177604,"env":"test","module":"rbac-middleware","userId":"3MELV1m3sQhGGCqasmZsj","userRole":"viewer","permission":"workflow:create","path":"/projects/0c7cc8ee-2667-4f38-83c4-827ef48548e7/workflows","msg":"Permission denied"}
{"level":50,"time":1764892183628,"env":"test","error":{},"workflowId":"4be758f1-5049-428c-81d2-8deea704f403","userId":"hltzGcOpYCt5YniAE75Gj","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764892184086,"env":"test","error":{},"workflowId":"1115ed3b-c82c-43b8-bedc-379fb2af9de0","userId":"hltzGcOpYCt5YniAE75Gj","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892184408,"env":"test","module":"auth-middleware","path":"/api/workflows/5484891d-7810-4c7b-a81d-a70198a0a10c/move","msg":"No valid authentication found"}
{"level":50,"time":1764892184910,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(2_hB5Hg_I2azlEG1RIjlH) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"2_hB5Hg_I2azlEG1RIjlH","msg":"Failed to create user credentials"}
{"level":50,"time":1764892184910,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(2_hB5Hg_I2azlEG1RIjlH) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
{"level":40,"time":1764892184917,"env":"test","module":"auth-middleware","path":"/api/workflows/b75a987c-32af-46f5-a1b8-84d1779db898/move","msg":"No valid authentication found"}
{"level":50,"time":1764892185256,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(hltzGcOpYCt5YniAE75Gj) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"hltzGcOpYCt5YniAE75Gj","msg":"Error creating workflow"}
{"level":50,"time":1764892185443,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(hltzGcOpYCt5YniAE75Gj) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"hltzGcOpYCt5YniAE75Gj","msg":"Error creating workflow"}
{"level":50,"time":1764892185640,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(hltzGcOpYCt5YniAE75Gj) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"hltzGcOpYCt5YniAE75Gj","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 9613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 302[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 1060[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 612[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 322[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 511[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 337[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 187[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 197[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:332:10
    330|         .set("Authorization", `Bearer ${authToken}`)
    331|         .send({ projectId: null })
    332|         .expect(200);
       |          ^
    333| 
    334|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:49:20
[2m   Duration [22m 22.88s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx42 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764892480798,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892485157,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892488143,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892488143,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892488154,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892488154,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892488155,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892488155,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892488698,"env":"test","module":"user-credentials-repository","userId":"soP_f04NNmnNQ89GKbvls","msg":"User credentials created"}
{"level":30,"time":1764892488702,"env":"test","module":"auth-routes","userId":"soP_f04NNmnNQ89GKbvls","email":"test-workflows-6RF3pqmg5uqs2G33ZC06m@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2dbd42f5-0d30-4da9-9362-66843f8e9880","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"soP_f04NNmnNQ89GKbvls","tenantId":"3ccaf01b-bf79-48b4-a3a7-4afc20cc523b","createdBy":"soP_f04NNmnNQ89GKbvls","ownerId":"soP_f04NNmnNQ89GKbvls","status":"active","archived":false,"createdAt":"2025-12-04T23:54:50.645Z","updatedAt":"2025-12-04T23:54:50.645Z"}

{"level":30,"time":1764892489425,"env":"test","module":"user-credentials-repository","userId":"oW5TZwpHgZoqPbOkgrAV1","msg":"User credentials created"}
{"level":30,"time":1764892489426,"env":"test","module":"auth-routes","userId":"oW5TZwpHgZoqPbOkgrAV1","email":"viewer-IMDsFG7lUkdtNIWeDaEK5@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892489534,"env":"test","module":"rbac-middleware","userId":"oW5TZwpHgZoqPbOkgrAV1","userRole":"viewer","permission":"workflow:create","path":"/projects/2dbd42f5-0d30-4da9-9362-66843f8e9880/workflows","msg":"Permission denied"}
{"level":50,"time":1764892496179,"env":"test","error":{},"workflowId":"07172b25-e4e5-4e74-a403-5f18d762bda9","userId":"soP_f04NNmnNQ89GKbvls","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892496535,"env":"test","module":"auth-middleware","path":"/api/workflows/16a46838-2072-4195-89fa-4a228b4f6c8f/move","msg":"No valid authentication found"}
{"level":30,"time":1764892497109,"env":"test","module":"user-credentials-repository","userId":"Fd4K-96Wa12-YKkAJPKLO","msg":"User credentials created"}
{"level":30,"time":1764892497109,"env":"test","module":"auth-routes","userId":"Fd4K-96Wa12-YKkAJPKLO","email":"test-workflows-81nj404QHKPrlHB1k5LU-@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892497204,"env":"test","error":{},"workflowId":"b68ac69e-a747-4369-a91b-3ce9665b1f0d","userId":"Fd4K-96Wa12-YKkAJPKLO","projectId":"1ae2ee2d-8222-4401-9baf-aef38e483d26","msg":"Error moving workflow"}
{"level":50,"time":1764892497599,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b463c072-befb-4ace-8c5f-19108a5c54f7","userId":"soP_f04NNmnNQ89GKbvls","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892497989,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"fa1e3049-f4d7-4957-87e5-30b60d350c0a","userId":"soP_f04NNmnNQ89GKbvls","msg":"Error moving workflow"}
{"level":50,"time":1764892498180,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(soP_f04NNmnNQ89GKbvls) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"soP_f04NNmnNQ89GKbvls","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 504[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 828[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 658[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 827[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 662[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 355[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 671[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 392[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 390[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 191[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:36
[2m   Duration [22m 20.94s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx43 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764892503004,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892504958,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892507088,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892507089,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892507100,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892507101,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892507101,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892507101,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892507540,"env":"test","module":"user-credentials-repository","userId":"dbajM-Cz9KfVsTHk4ClWx","msg":"User credentials created"}
{"level":30,"time":1764892507543,"env":"test","module":"auth-routes","userId":"dbajM-Cz9KfVsTHk4ClWx","email":"test-workflows-rIfwH5o9ONArJSXEORY7I@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d5ea3275-80b5-4948-9a77-28e617fba59c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"dbajM-Cz9KfVsTHk4ClWx","tenantId":"e39e6cba-0598-4dc2-8835-1195636affef","createdBy":"dbajM-Cz9KfVsTHk4ClWx","ownerId":"dbajM-Cz9KfVsTHk4ClWx","status":"active","archived":false,"createdAt":"2025-12-04T23:55:09.466Z","updatedAt":"2025-12-04T23:55:09.466Z"}

{"level":30,"time":1764892508187,"env":"test","module":"user-credentials-repository","userId":"_Q7zRG-sEK__GhmPUResX","msg":"User credentials created"}
{"level":30,"time":1764892508188,"env":"test","module":"auth-routes","userId":"_Q7zRG-sEK__GhmPUResX","email":"viewer-H399Dz_0XaOpvQ7a32dKD@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892508287,"env":"test","module":"rbac-middleware","userId":"_Q7zRG-sEK__GhmPUResX","userRole":"viewer","permission":"workflow:create","path":"/projects/d5ea3275-80b5-4948-9a77-28e617fba59c/workflows","msg":"Permission denied"}
{"level":50,"time":1764892514221,"env":"test","error":{},"workflowId":"14d2a580-7418-4be6-b487-5e2b247a582a","userId":"dbajM-Cz9KfVsTHk4ClWx","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892514520,"env":"test","module":"auth-middleware","path":"/api/workflows/96fa92ec-214b-46f1-ad17-b64c299fd53c/move","msg":"No valid authentication found"}
{"level":30,"time":1764892515011,"env":"test","module":"user-credentials-repository","userId":"Hule_5MEy4Vi88RK-fd3b","msg":"User credentials created"}
{"level":30,"time":1764892515012,"env":"test","module":"auth-routes","userId":"Hule_5MEy4Vi88RK-fd3b","email":"test-workflows-i2XFqpTBpFjMy5ak8A032@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892515055,"env":"test","error":{},"workflowId":"069fcec5-caef-4140-9127-3fbc087050e3","userId":"Hule_5MEy4Vi88RK-fd3b","projectId":"a5c4553c-ad54-420e-a3ca-2f3524b4c22e","msg":"Error moving workflow"}
{"level":50,"time":1764892515431,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"30f4767a-1997-4a36-8922-bb452a824318","userId":"dbajM-Cz9KfVsTHk4ClWx","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892515802,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"cf38d474-fe61-4a7e-8ca0-237fce47c4fa","userId":"dbajM-Cz9KfVsTHk4ClWx","msg":"Error moving workflow"}
{"level":30,"time":1764892516282,"env":"test","module":"user-credentials-repository","userId":"6_7tDNoDzGwrBiHGjuhy8","msg":"User credentials created"}
{"level":30,"time":1764892516283,"env":"test","module":"auth-routes","userId":"6_7tDNoDzGwrBiHGjuhy8","email":"test-workflows-wOTkJ3wylsU_kikH7K9xy@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892516462,"env":"test","module":"auth-routes","userId":"6_7tDNoDzGwrBiHGjuhy8","email":"test-workflows-wOTkJ3wylsU_kikH7K9xy@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892516641,"env":"test","error":{},"workflowId":"abff005b-c9d1-47b8-a454-2411bb053fe2","userId":"dbajM-Cz9KfVsTHk4ClWx","projectId":"e5952c61-97d4-4d47-a166-baf7ea865860","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9821[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 305[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 439[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 700[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 731[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 695[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 417[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 536[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 377[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 841[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:58
[2m   Duration [22m 17.32s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx44 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764895078443,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895081058,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895084965,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895084966,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895084975,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895084975,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895084976,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895084976,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895085701,"env":"test","module":"user-credentials-repository","userId":"y0fIaXFIaCpkNhoOZLATu","msg":"User credentials created"}
{"level":30,"time":1764895085705,"env":"test","module":"auth-routes","userId":"y0fIaXFIaCpkNhoOZLATu","email":"test-workflows-INU1qiMDo7XSxQQa4BwF7@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"48f6000c-cf75-4ed4-93e4-29c61ba9ef29","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"y0fIaXFIaCpkNhoOZLATu","tenantId":"a67e7ef5-4eff-4d30-8fac-6e6134139f2e","createdBy":"y0fIaXFIaCpkNhoOZLATu","ownerId":"y0fIaXFIaCpkNhoOZLATu","status":"active","archived":false,"createdAt":"2025-12-05T00:38:05.869Z","updatedAt":"2025-12-05T00:38:05.869Z"}

{"level":30,"time":1764895086344,"env":"test","module":"user-credentials-repository","userId":"iym06QqO7dUDAYjGylvw3","msg":"User credentials created"}
{"level":30,"time":1764895086345,"env":"test","module":"auth-routes","userId":"iym06QqO7dUDAYjGylvw3","email":"viewer-ca4sV84MxeJp2YZIjqqgM@example.com","msg":"User registered successfully"}
{"level":40,"time":1764895086432,"env":"test","module":"rbac-middleware","userId":"iym06QqO7dUDAYjGylvw3","userRole":"viewer","permission":"workflow:create","path":"/projects/48f6000c-cf75-4ed4-93e4-29c61ba9ef29/workflows","msg":"Permission denied"}
{"level":50,"time":1764895092144,"env":"test","error":{},"workflowId":"b4007bb8-c062-495f-b836-3aa069712c8e","userId":"y0fIaXFIaCpkNhoOZLATu","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764895092435,"env":"test","module":"auth-middleware","path":"/api/workflows/2c6726d1-db6e-48d3-adb8-53c0310c3739/move","msg":"No valid authentication found"}
{"level":30,"time":1764895092919,"env":"test","module":"user-credentials-repository","userId":"-Y7eEV0AqLS6JfgYcNFa7","msg":"User credentials created"}
{"level":30,"time":1764895092919,"env":"test","module":"auth-routes","userId":"-Y7eEV0AqLS6JfgYcNFa7","email":"test-workflows-gXzjhn1ygXqtVssJelK2r@example.com","msg":"User registered successfully"}
{"level":50,"time":1764895092965,"env":"test","error":{},"workflowId":"77765f52-ed19-4cc3-b0d9-31d4797c2702","userId":"-Y7eEV0AqLS6JfgYcNFa7","projectId":"834f0da3-a693-4300-aba5-8db432ca9f68","msg":"Error moving workflow"}
{"level":50,"time":1764895093289,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"e47582d8-3b95-4686-8a87-51183f836957","userId":"y0fIaXFIaCpkNhoOZLATu","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764895093644,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bcb5103a-be97-4e45-a1b8-99388c077e57","userId":"y0fIaXFIaCpkNhoOZLATu","msg":"Error moving workflow"}
{"level":30,"time":1764895094114,"env":"test","module":"user-credentials-repository","userId":"r80zIYf9KuGXZZduiZIHS","msg":"User credentials created"}
{"level":30,"time":1764895094115,"env":"test","module":"auth-routes","userId":"r80zIYf9KuGXZZduiZIHS","email":"test-workflows-IAJbFu3clEbUFwa-r9G1h@example.com","msg":"User registered successfully"}
{"level":30,"time":1764895094290,"env":"test","module":"auth-routes","userId":"r80zIYf9KuGXZZduiZIHS","email":"test-workflows-IAJbFu3clEbUFwa-r9G1h@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764895094484,"env":"test","error":{},"workflowId":"fde4ae1d-d44e-4471-9927-b8d8ea8f1479","userId":"y0fIaXFIaCpkNhoOZLATu","projectId":"65b97a06-1afd-4e6c-95bb-acf7c4710a95","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9816[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create a new draft workflow[32m 299[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 284[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 673[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 696[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 677[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 406[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 529[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 356[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 840[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 18:37:52
[2m   Duration [22m 20.38s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
