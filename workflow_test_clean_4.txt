npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764868452721,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868454090,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868455326,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868455327,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868455335,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868455335,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868455336,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868455336,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868455762,"env":"test","module":"user-credentials-repository","userId":"jronpMXi39d9uyAZUlOGX","msg":"User credentials created"}
{"level":30,"time":1764868455764,"env":"test","module":"auth-routes","userId":"jronpMXi39d9uyAZUlOGX","email":"test-workflows-KnKG_77QING3evSNdBBMH@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"72e4038f-e722-4c21-9d55-e8768429558a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"jronpMXi39d9uyAZUlOGX","tenantId":"77026238-d73b-4b87-83f7-41b92209dd10","createdBy":"jronpMXi39d9uyAZUlOGX","ownerId":"jronpMXi39d9uyAZUlOGX","status":"active","archived":false,"createdAt":"2025-12-04T17:14:17.266Z","updatedAt":"2025-12-04T17:14:17.266Z"}

{"level":30,"time":1764868456366,"env":"test","module":"user-credentials-repository","userId":"A9OoveWcZUfJqDSBJ_7m2","msg":"User credentials created"}
{"level":30,"time":1764868456367,"env":"test","module":"auth-routes","userId":"A9OoveWcZUfJqDSBJ_7m2","email":"viewer-Pcuv7EUZks2DcdUBHnmRt@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868456450,"env":"test","module":"rbac-middleware","userId":"A9OoveWcZUfJqDSBJ_7m2","userRole":"viewer","permission":"workflow:create","path":"/projects/72e4038f-e722-4c21-9d55-e8768429558a/workflows","msg":"Permission denied"}
{"level":50,"time":1764868462103,"env":"test","error":{},"workflowId":"84ce5d54-4b84-4949-972a-08a5a8568517","userId":"jronpMXi39d9uyAZUlOGX","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868462410,"env":"test","module":"auth-middleware","path":"/api/workflows/cf9c2b91-5d23-4c22-b8c6-07d973290e65/move","msg":"No valid authentication found"}
{"level":30,"time":1764868462872,"env":"test","module":"user-credentials-repository","userId":"ecifCkxTd8THoImQVVhBx","msg":"User credentials created"}
{"level":30,"time":1764868462873,"env":"test","module":"auth-routes","userId":"ecifCkxTd8THoImQVVhBx","email":"test-workflows-adk0fwsfGVdUa2lUvN1z3@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868462916,"env":"test","error":{},"workflowId":"dbb23165-9edd-4dfe-8f53-edf0c778eee7","userId":"ecifCkxTd8THoImQVVhBx","projectId":"7ce2692a-d777-4294-a920-461574150138","msg":"Error moving workflow"}
{"level":50,"time":1764868463259,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"89c7940e-6495-4d1a-9dff-6a307b4463ab","userId":"jronpMXi39d9uyAZUlOGX","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868463599,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"508b19a5-0a23-41f2-a5dc-ff510baeecc1","userId":"jronpMXi39d9uyAZUlOGX","msg":"Error moving workflow"}
{"level":30,"time":1764868464068,"env":"test","module":"user-credentials-repository","userId":"LLCAfeUUi4CjNXMAWIirw","msg":"User credentials created"}
{"level":30,"time":1764868464068,"env":"test","module":"auth-routes","userId":"LLCAfeUUi4CjNXMAWIirw","email":"test-workflows-tYxaXwkHYQ9lry_EM1Dfv@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868464246,"env":"test","module":"auth-routes","userId":"LLCAfeUUi4CjNXMAWIirw","email":"test-workflows-tYxaXwkHYQ9lry_EM1Dfv@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868464416,"env":"test","error":{},"workflowId":"de01477c-e3c7-4e54-acfa-74e417e0faed","userId":"jronpMXi39d9uyAZUlOGX","projectId":"90740a2d-afef-4036-ad96-058b6a47a6eb","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9343[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create a new draft workflow[32m 296[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 262[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 652[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 543[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 674[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 422[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 507[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 817[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:14:10
[2m   Duration [22m 14.56s[2m (transform 2.06s, setup 755ms, collect 3.81s, tests 9.34s, environment 0ms, prepare 17ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764868528646,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531219,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533452,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533452,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533464,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533464,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533465,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533465,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868533905,"env":"test","module":"user-credentials-repository","userId":"NWmPNFue8lX_esnaWdzcV","msg":"User credentials created"}
{"level":30,"time":1764868533908,"env":"test","module":"auth-routes","userId":"NWmPNFue8lX_esnaWdzcV","email":"test-workflows-Da2zk8xXcnmRprPAFsmJb@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"17d15577-601f-419d-abe0-685ecbd678b1","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"NWmPNFue8lX_esnaWdzcV","tenantId":"a6049027-e451-4225-a244-027b1aec1dba","createdBy":"NWmPNFue8lX_esnaWdzcV","ownerId":"NWmPNFue8lX_esnaWdzcV","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.427Z","updatedAt":"2025-12-04T17:15:35.427Z"}

{"level":30,"time":1764868534598,"env":"test","module":"user-credentials-repository","userId":"Ec2v3YPEifCOfS3uiy74H","msg":"User credentials created"}
{"level":30,"time":1764868534599,"env":"test","module":"auth-routes","userId":"Ec2v3YPEifCOfS3uiy74H","email":"viewer-GgPL2WgSjBjbvkMy-Ic8R@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534693,"env":"test","module":"rbac-middleware","userId":"Ec2v3YPEifCOfS3uiy74H","userRole":"viewer","permission":"workflow:create","path":"/projects/17d15577-601f-419d-abe0-685ecbd678b1/workflows","msg":"Permission denied"}
{"level":50,"time":1764868541165,"env":"test","error":{},"workflowId":"6eee7071-d663-4989-9cc6-d448af597098","userId":"NWmPNFue8lX_esnaWdzcV","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541486,"env":"test","module":"auth-middleware","path":"/api/workflows/ec1359d7-c054-48be-b276-61ef89f55a82/move","msg":"No valid authentication found"}
{"level":30,"time":1764868542006,"env":"test","module":"user-credentials-repository","userId":"pYMZQESsUUlTsjSRrwnYv","msg":"User credentials created"}
{"level":30,"time":1764868542006,"env":"test","module":"auth-routes","userId":"pYMZQESsUUlTsjSRrwnYv","email":"test-workflows-fL1bXz_KJi3-srjKCSOEu@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868542057,"env":"test","error":{},"workflowId":"1af3e187-d8a1-488e-89bc-6f6c3c14090e","userId":"pYMZQESsUUlTsjSRrwnYv","projectId":"f4464928-6d3b-482a-b751-f31de7720e53","msg":"Error moving workflow"}
{"level":50,"time":1764868542531,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"4c3a334a-37c0-4861-b82d-e307223a2873","userId":"NWmPNFue8lX_esnaWdzcV","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868543094,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"54f1523c-bba1-4018-b773-54088c81fe51","userId":"NWmPNFue8lX_esnaWdzcV","msg":"Error moving workflow"}
{"level":50,"time":1764868543642,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CmYQf5yomItQHKAydFPXF) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"CmYQf5yomItQHKAydFPXF","msg":"Failed to create user credentials"}
{"level":50,"time":1764868543642,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CmYQf5yomItQHKAydFPXF) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 819[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 564[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 549[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 18.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764868816397,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818574,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820614,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820615,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820626,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820626,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820626,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820626,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821099,"env":"test","module":"user-credentials-repository","userId":"nxvpxX8TB5uHi_C51IOCT","msg":"User credentials created"}
{"level":30,"time":1764868821102,"env":"test","module":"auth-routes","userId":"nxvpxX8TB5uHi_C51IOCT","email":"test-workflows-ZjjtvK9GoZora7FSeFGmT@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7cf3d005-bbab-49f7-a2b5-642e24d4197a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"nxvpxX8TB5uHi_C51IOCT","tenantId":"157fc869-d570-4fbc-9411-0f859cc36b76","createdBy":"nxvpxX8TB5uHi_C51IOCT","ownerId":"nxvpxX8TB5uHi_C51IOCT","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.624Z","updatedAt":"2025-12-04T17:20:22.624Z"}

{"level":30,"time":1764868821775,"env":"test","module":"user-credentials-repository","userId":"IvIQnzzwTQcIogYvA_Gt7","msg":"User credentials created"}
{"level":30,"time":1764868821775,"env":"test","module":"auth-routes","userId":"IvIQnzzwTQcIogYvA_Gt7","email":"viewer-_-vpU0z3anSvk7-y7kb1w@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821875,"env":"test","module":"rbac-middleware","userId":"IvIQnzzwTQcIogYvA_Gt7","userRole":"viewer","permission":"workflow:create","path":"/projects/7cf3d005-bbab-49f7-a2b5-642e24d4197a/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828301,"env":"test","error":{},"workflowId":"ca99dbf7-8ac0-4e75-b9c5-8a545cd03597","userId":"nxvpxX8TB5uHi_C51IOCT","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828643,"env":"test","module":"auth-middleware","path":"/api/workflows/b60390c8-6a50-4b46-a248-8f0016bb454a/move","msg":"No valid authentication found"}
{"level":30,"time":1764868829177,"env":"test","module":"user-credentials-repository","userId":"ZV_eIaBoL1ZJ2wrgAEx3f","msg":"User credentials created"}
{"level":30,"time":1764868829178,"env":"test","module":"auth-routes","userId":"ZV_eIaBoL1ZJ2wrgAEx3f","email":"test-workflows-1o-AcufDqIILJ6zvNC2S2@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868829227,"env":"test","error":{},"workflowId":"25cc836f-36a7-4a73-b2c4-52d661c8f099","userId":"ZV_eIaBoL1ZJ2wrgAEx3f","projectId":"03fd77e0-08d4-4106-ae31-8feb4fdf3469","msg":"Error moving workflow"}
{"level":50,"time":1764868829591,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"024815c3-a32b-4464-a0c9-6ebf36e8d2d0","userId":"nxvpxX8TB5uHi_C51IOCT","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868830007,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"210b0583-279f-41c2-9343-8ede30b7e2b2","userId":"nxvpxX8TB5uHi_C51IOCT","msg":"Error moving workflow"}
{"level":30,"time":1764868830518,"env":"test","module":"user-credentials-repository","userId":"l2JKtVA4PVWqVc2T9in_X","msg":"User credentials created"}
{"level":30,"time":1764868830519,"env":"test","module":"auth-routes","userId":"l2JKtVA4PVWqVc2T9in_X","email":"test-workflows-mBh6lyW5B3-7077Y3o20L@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830711,"env":"test","module":"auth-routes","userId":"l2JKtVA4PVWqVc2T9in_X","email":"test-workflows-mBh6lyW5B3-7077Y3o20L@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868830895,"env":"test","error":{},"workflowId":"df09abe6-4e85-40e0-a2f2-84e7533e9a0d","userId":"nxvpxX8TB5uHi_C51IOCT","projectId":"579efefd-b68a-4b5c-9c10-122d9e5ebbf3","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 493[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 668[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 416[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 891[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.51s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764871632896,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871636442,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871641145,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871641146,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871641160,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871641161,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871641161,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871641161,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871641786,"env":"test","module":"user-credentials-repository","userId":"ACl_QcmASYWmnI6nChmER","msg":"User credentials created"}
{"level":30,"time":1764871641789,"env":"test","module":"auth-routes","userId":"ACl_QcmASYWmnI6nChmER","email":"test-workflows-Iy6zXVrNOhvNi5z9G4ftF@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7e3fc834-cc95-4995-a71f-08f358fe005f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ACl_QcmASYWmnI6nChmER","tenantId":"2d785adc-5afb-40ed-b194-e401a167a322","createdBy":"ACl_QcmASYWmnI6nChmER","ownerId":"ACl_QcmASYWmnI6nChmER","status":"active","archived":false,"createdAt":"2025-12-04T18:07:23.377Z","updatedAt":"2025-12-04T18:07:23.377Z"}

{"level":30,"time":1764871642513,"env":"test","module":"user-credentials-repository","userId":"G8aGeV3PLerHrXMFddf41","msg":"User credentials created"}
{"level":30,"time":1764871642514,"env":"test","module":"auth-routes","userId":"G8aGeV3PLerHrXMFddf41","email":"viewer--Q3YSlCeEuw9RHBDvYIAx@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871642621,"env":"test","module":"rbac-middleware","userId":"G8aGeV3PLerHrXMFddf41","userRole":"viewer","permission":"workflow:create","path":"/projects/7e3fc834-cc95-4995-a71f-08f358fe005f/workflows","msg":"Permission denied"}
{"level":50,"time":1764871649080,"env":"test","error":{},"workflowId":"f10abbed-2d63-4083-bf89-18dd67f20986","userId":"ACl_QcmASYWmnI6nChmER","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871649411,"env":"test","module":"auth-middleware","path":"/api/workflows/407542c7-0f94-4f9d-affc-9b9dbd3506d9/move","msg":"No valid authentication found"}
{"level":30,"time":1764871649959,"env":"test","module":"user-credentials-repository","userId":"bqvfTI949urAIfZdONTl2","msg":"User credentials created"}
{"level":30,"time":1764871649960,"env":"test","module":"auth-routes","userId":"bqvfTI949urAIfZdONTl2","email":"test-workflows-i1022KNJICbHY4DSnjDxz@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871650004,"env":"test","error":{},"workflowId":"4b87b235-3b54-41d8-9e3c-3209f466c124","userId":"bqvfTI949urAIfZdONTl2","projectId":"b782767b-48fb-490b-9929-5e294ee963dd","msg":"Error moving workflow"}
{"level":50,"time":1764871650379,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"80450a1f-52ab-45f8-8145-cfb8268d5478","userId":"ACl_QcmASYWmnI6nChmER","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871650760,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"637706eb-8a37-4c6e-ba1e-797567ea91a8","userId":"ACl_QcmASYWmnI6nChmER","msg":"Error moving workflow"}
{"level":30,"time":1764871651283,"env":"test","module":"user-credentials-repository","userId":"5fo9TUWLEjfS62UCN5DRy","msg":"User credentials created"}
{"level":30,"time":1764871651283,"env":"test","module":"auth-routes","userId":"5fo9TUWLEjfS62UCN5DRy","email":"test-workflows-QLtdiN6MRumAtdeQmuq2q@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871651484,"env":"test","module":"auth-routes","userId":"5fo9TUWLEjfS62UCN5DRy","email":"test-workflows-QLtdiN6MRumAtdeQmuq2q@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871651746,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9d2437eb-7cc3-4d12-b4f0-35d045c49459","userId":"ACl_QcmASYWmnI6nChmER","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10891[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 496[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 835[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 380[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 988[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 22.39s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764871702561,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871705886,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871709579,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871709579,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871709595,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871709595,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871709595,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871709595,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710076,"env":"test","module":"user-credentials-repository","userId":"Lb1IvjMswQIaV_z_bArzC","msg":"User credentials created"}
{"level":30,"time":1764871710080,"env":"test","module":"auth-routes","userId":"Lb1IvjMswQIaV_z_bArzC","email":"test-workflows-9NURHMGhtQLZxkvt-vjwz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"00c5d42e-d910-4d2c-aaf8-e5b7d3d248b2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Lb1IvjMswQIaV_z_bArzC","tenantId":"b96f347a-de27-4c4b-ad9a-cb615bfef454","createdBy":"Lb1IvjMswQIaV_z_bArzC","ownerId":"Lb1IvjMswQIaV_z_bArzC","status":"active","archived":false,"createdAt":"2025-12-04T18:08:31.656Z","updatedAt":"2025-12-04T18:08:31.656Z"}

{"level":30,"time":1764871710759,"env":"test","module":"user-credentials-repository","userId":"POK-v7fBHxeb65qXNUneF","msg":"User credentials created"}
{"level":30,"time":1764871710760,"env":"test","module":"auth-routes","userId":"POK-v7fBHxeb65qXNUneF","email":"viewer-EGY3NLnNt5uE4o3IywHpF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871710857,"env":"test","module":"rbac-middleware","userId":"POK-v7fBHxeb65qXNUneF","userRole":"viewer","permission":"workflow:create","path":"/projects/00c5d42e-d910-4d2c-aaf8-e5b7d3d248b2/workflows","msg":"Permission denied"}
{"level":50,"time":1764871716857,"env":"test","error":{},"workflowId":"71c7f407-87d3-4b4d-a872-53c6230d2715","userId":"Lb1IvjMswQIaV_z_bArzC","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871717168,"env":"test","module":"auth-middleware","path":"/api/workflows/eb93ef25-a922-4308-a8e6-698cb2ae2f46/move","msg":"No valid authentication found"}
{"level":30,"time":1764871717679,"env":"test","module":"user-credentials-repository","userId":"wAbioq1Tatv1rhFdvg1CK","msg":"User credentials created"}
{"level":30,"time":1764871717679,"env":"test","module":"auth-routes","userId":"wAbioq1Tatv1rhFdvg1CK","email":"test-workflows-tF7d9sCqFU_QWQdA9Pw-_@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871717730,"env":"test","error":{},"workflowId":"e3bcf3a1-29ad-439a-8c5e-9ffe542e6c9c","userId":"wAbioq1Tatv1rhFdvg1CK","projectId":"c01ede62-366d-490a-a7bd-8b67cfd7f1ad","msg":"Error moving workflow"}
{"level":50,"time":1764871718106,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"e4cdc9fe-18da-4b5f-838b-64d78f2cb7f0","userId":"Lb1IvjMswQIaV_z_bArzC","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871718482,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d6dcb286-b9a5-4a4b-b032-1bd9e7d59d11","userId":"Lb1IvjMswQIaV_z_bArzC","msg":"Error moving workflow"}
{"level":30,"time":1764871718988,"env":"test","module":"user-credentials-repository","userId":"t1u-xJD4MjD4YjJIfcAhR","msg":"User credentials created"}
{"level":30,"time":1764871718989,"env":"test","module":"auth-routes","userId":"t1u-xJD4MjD4YjJIfcAhR","email":"test-workflows-JC6XIX_3b1ulLgjIaqBNh@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871719184,"env":"test","module":"auth-routes","userId":"t1u-xJD4MjD4YjJIfcAhR","email":"test-workflows-JC6XIX_3b1ulLgjIaqBNh@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871719358,"env":"test","error":{},"workflowId":"b9c70c10-1baf-44dd-af90-b1da61f25aaf","userId":"Lb1IvjMswQIaV_z_bArzC","projectId":"8a0ef240-c58c-435b-a9fe-95eaa8b03746","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10069[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 681[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 439[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 879[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 21.17s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764871753395,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871758083,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871761016,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871761016,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871761035,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871761035,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871761035,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871761035,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871761498,"env":"test","module":"user-credentials-repository","userId":"xARH86DgzQclOABHM21yJ","msg":"User credentials created"}
{"level":30,"time":1764871761502,"env":"test","module":"auth-routes","userId":"xARH86DgzQclOABHM21yJ","email":"test-workflows-ijBmeJ2VAqRkxhs4SaPs-@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c4660126-d760-4434-97b4-a1613305c85f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"xARH86DgzQclOABHM21yJ","tenantId":"953328d8-5506-43cc-a1ef-20c68640847b","createdBy":"xARH86DgzQclOABHM21yJ","ownerId":"xARH86DgzQclOABHM21yJ","status":"active","archived":false,"createdAt":"2025-12-04T18:09:23.076Z","updatedAt":"2025-12-04T18:09:23.076Z"}

{"level":30,"time":1764871762175,"env":"test","module":"user-credentials-repository","userId":"LpVYlRcvNmAKMyFP0r-SE","msg":"User credentials created"}
{"level":30,"time":1764871762176,"env":"test","module":"auth-routes","userId":"LpVYlRcvNmAKMyFP0r-SE","email":"viewer-E9pSafrK-P2kY1YKFV7LB@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871762278,"env":"test","module":"rbac-middleware","userId":"LpVYlRcvNmAKMyFP0r-SE","userRole":"viewer","permission":"workflow:create","path":"/projects/c4660126-d760-4434-97b4-a1613305c85f/workflows","msg":"Permission denied"}
{"level":50,"time":1764871768255,"env":"test","error":{},"workflowId":"c4db2d68-285d-4825-b6b5-1776c3cadc32","userId":"xARH86DgzQclOABHM21yJ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871768567,"env":"test","module":"auth-middleware","path":"/api/workflows/9f9622c8-2497-4ea2-b6f7-d966cd892cad/move","msg":"No valid authentication found"}
{"level":30,"time":1764871769088,"env":"test","module":"user-credentials-repository","userId":"i3ttRCLXkgGtvExIztvPe","msg":"User credentials created"}
{"level":30,"time":1764871769089,"env":"test","module":"auth-routes","userId":"i3ttRCLXkgGtvExIztvPe","email":"test-workflows-Yh4Ni-ov2Aw_NZyKivEg_@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871769139,"env":"test","error":{},"workflowId":"77228ff3-916f-4c5e-b4fa-9b6b3188de33","userId":"i3ttRCLXkgGtvExIztvPe","projectId":"c620ea69-0c8c-4164-a04b-941dbcc3532b","msg":"Error moving workflow"}
{"level":50,"time":1764871769493,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3b429e17-57d0-4bb0-9208-922195c1684f","userId":"xARH86DgzQclOABHM21yJ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871769839,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f5486232-46c4-4207-b864-c369be10b485","userId":"xARH86DgzQclOABHM21yJ","msg":"Error moving workflow"}
{"level":30,"time":1764871770355,"env":"test","module":"user-credentials-repository","userId":"mx38FXTfL85BMNnZsJcZ5","msg":"User credentials created"}
{"level":30,"time":1764871770356,"env":"test","module":"auth-routes","userId":"mx38FXTfL85BMNnZsJcZ5","email":"test-workflows-gXAG1s20SO6LAdFpdJgOG@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871770554,"env":"test","module":"auth-routes","userId":"mx38FXTfL85BMNnZsJcZ5","email":"test-workflows-gXAG1s20SO6LAdFpdJgOG@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871770788,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0f81fa73-962e-43b3-8423-e4bd33634d2e","userId":"xARH86DgzQclOABHM21yJ","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10055[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 720[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 951[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[2m   Duration [22m 21.42s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764873690148,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873694279,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873697764,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873697764,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873697776,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873697776,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873697776,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873697776,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873698278,"env":"test","module":"user-credentials-repository","userId":"LxKeI-y_sl_8CVTQ4aV9q","msg":"User credentials created"}
{"level":30,"time":1764873698281,"env":"test","module":"auth-routes","userId":"LxKeI-y_sl_8CVTQ4aV9q","email":"test-workflows-YRtyXLqS4ABZa3TT4i3yL@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"03806884-e042-4ca3-9f76-bbe4b021e3f0","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"LxKeI-y_sl_8CVTQ4aV9q","tenantId":"52947f65-2db2-4375-9b91-2ce10228de0a","createdBy":"LxKeI-y_sl_8CVTQ4aV9q","ownerId":"LxKeI-y_sl_8CVTQ4aV9q","status":"active","archived":false,"createdAt":"2025-12-04T18:41:39.895Z","updatedAt":"2025-12-04T18:41:39.895Z"}

{"level":30,"time":1764873698976,"env":"test","module":"user-credentials-repository","userId":"LuPf-w3AEUx4a8zaUt-XK","msg":"User credentials created"}
{"level":30,"time":1764873698977,"env":"test","module":"auth-routes","userId":"LuPf-w3AEUx4a8zaUt-XK","email":"viewer-oMDhstmpNUW-c7ZGWHyVN@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873699068,"env":"test","module":"rbac-middleware","userId":"LuPf-w3AEUx4a8zaUt-XK","userRole":"viewer","permission":"workflow:create","path":"/projects/03806884-e042-4ca3-9f76-bbe4b021e3f0/workflows","msg":"Permission denied"}
{"level":50,"time":1764873705533,"env":"test","error":{},"workflowId":"1247e617-131d-48a7-bba0-4d541d25fa6b","userId":"LxKeI-y_sl_8CVTQ4aV9q","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873705907,"env":"test","module":"auth-middleware","path":"/api/workflows/c6c2db92-4553-4ddb-a9f2-58b082b5b432/move","msg":"No valid authentication found"}
{"level":30,"time":1764873706463,"env":"test","module":"user-credentials-repository","userId":"yAuiVw0NjxvWUnXSGkatk","msg":"User credentials created"}
{"level":30,"time":1764873706464,"env":"test","module":"auth-routes","userId":"yAuiVw0NjxvWUnXSGkatk","email":"test-workflows-j_hOX8bAe0Rkyx-vCeeMc@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873706512,"env":"test","error":{},"workflowId":"84585b28-3137-4850-b21e-a6ed54b5f2c1","userId":"yAuiVw0NjxvWUnXSGkatk","projectId":"9ad1f6da-417e-4f06-87ab-2c2a0e912d04","msg":"Error moving workflow"}
{"level":50,"time":1764873706881,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"5113d183-09d5-44c2-8576-335375ccccb5","userId":"LxKeI-y_sl_8CVTQ4aV9q","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873707254,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"501288f1-fda5-4784-a807-8cd268caa539","userId":"LxKeI-y_sl_8CVTQ4aV9q","msg":"Error moving workflow"}
{"level":30,"time":1764873707913,"env":"test","module":"user-credentials-repository","userId":"AoOmtIEHIkYVLz8ShDkHM","msg":"User credentials created"}
{"level":30,"time":1764873707914,"env":"test","module":"auth-routes","userId":"AoOmtIEHIkYVLz8ShDkHM","email":"test-workflows-YkXaKEkHxwNB0RR3SlTeG@example.com","msg":"User registered successfully"}
{"level":30,"time":1764873708111,"env":"test","module":"auth-routes","userId":"AoOmtIEHIkYVLz8ShDkHM","email":"test-workflows-YkXaKEkHxwNB0RR3SlTeG@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764873708298,"env":"test","error":{},"workflowId":"01ab9c02-e755-40a1-8de5-170cf0444eba","userId":"LxKeI-y_sl_8CVTQ4aV9q","projectId":"cef3ba16-0576-4fd3-9620-81aea6f2b1e8","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 825[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 670[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 374[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1045[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 22.77s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764874578987,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874583796,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874590548,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874590548,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874590564,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874590564,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874590565,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874590565,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874591563,"env":"test","module":"user-credentials-repository","userId":"OElM8xeOehkJZNBB1hhXx","msg":"User credentials created"}
{"level":30,"time":1764874591567,"env":"test","module":"auth-routes","userId":"OElM8xeOehkJZNBB1hhXx","email":"test-workflows-BiqfevnXX_tf8LaAs8RHD@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"76b393dc-b58f-4112-ba58-6f70db254eee","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"OElM8xeOehkJZNBB1hhXx","tenantId":"d9036e1e-3557-486d-926c-bea78bc40f91","createdBy":"OElM8xeOehkJZNBB1hhXx","ownerId":"OElM8xeOehkJZNBB1hhXx","status":"active","archived":false,"createdAt":"2025-12-04T18:56:33.199Z","updatedAt":"2025-12-04T18:56:33.199Z"}

{"level":30,"time":1764874592417,"env":"test","module":"user-credentials-repository","userId":"VVpoxfqu7d1gFiQY_7Guk","msg":"User credentials created"}
{"level":30,"time":1764874592418,"env":"test","module":"auth-routes","userId":"VVpoxfqu7d1gFiQY_7Guk","email":"viewer-p3qk9wSA0qBnzwLqtIK27@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874592519,"env":"test","module":"rbac-middleware","userId":"VVpoxfqu7d1gFiQY_7Guk","userRole":"viewer","permission":"workflow:create","path":"/projects/76b393dc-b58f-4112-ba58-6f70db254eee/workflows","msg":"Permission denied"}
{"level":50,"time":1764874598994,"env":"test","error":{},"workflowId":"223ed08b-c2e6-41af-91fd-7c5f01e6c44e","userId":"OElM8xeOehkJZNBB1hhXx","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874599316,"env":"test","module":"auth-middleware","path":"/api/workflows/b0689dc0-6f61-4127-b8b5-6d321ed8899b/move","msg":"No valid authentication found"}
{"level":30,"time":1764874600094,"env":"test","module":"user-credentials-repository","userId":"igXLzR5xxMzZVkZSMEabx","msg":"User credentials created"}
{"level":30,"time":1764874600095,"env":"test","module":"auth-routes","userId":"igXLzR5xxMzZVkZSMEabx","email":"test-workflows-iPiUu_lorpZ4yWhO4OQ2f@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874600143,"env":"test","error":{},"workflowId":"72c3dfa7-32de-4815-ba94-4e950c573c91","userId":"igXLzR5xxMzZVkZSMEabx","projectId":"65e40bfe-0120-407c-b581-853c72d9a6e4","msg":"Error moving workflow"}
{"level":50,"time":1764874600525,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"16f4045b-c4b9-4f18-81f6-da3b5b9cd479","userId":"OElM8xeOehkJZNBB1hhXx","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874600915,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bf22a8aa-b827-4a5b-abd6-27e49eae43bc","userId":"OElM8xeOehkJZNBB1hhXx","msg":"Error moving workflow"}
{"level":30,"time":1764874601508,"env":"test","module":"user-credentials-repository","userId":"2C1L7Coy2UmXb6iPzCHV4","msg":"User credentials created"}
{"level":30,"time":1764874601509,"env":"test","module":"auth-routes","userId":"2C1L7Coy2UmXb6iPzCHV4","email":"test-workflows-Ujodcaju6g8S5BOx5-iUS@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874601704,"env":"test","module":"auth-routes","userId":"2C1L7Coy2UmXb6iPzCHV4","email":"test-workflows-Ujodcaju6g8S5BOx5-iUS@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874601892,"env":"test","error":{},"workflowId":"6d9b44d9-916e-453f-b29b-8c5a9bcffdfc","userId":"OElM8xeOehkJZNBB1hhXx","projectId":"359cedc5-d6df-4ac2-8d1f-7ba1e582aafc","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 805[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 673[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 755[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 826[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 391[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 979[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.54s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764874684448,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874690353,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874696571,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874696571,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874696580,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874696580,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874696581,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874696581,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874697108,"env":"test","module":"user-credentials-repository","userId":"w3sz0tvJ-pgWKuZ15FmFj","msg":"User credentials created"}
{"level":30,"time":1764874697112,"env":"test","module":"auth-routes","userId":"w3sz0tvJ-pgWKuZ15FmFj","email":"test-workflows-_rl26zfLIBzh16WIHv5F6@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3c6c6064-e63d-4761-8d5e-3dbd4d5b38ce","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"w3sz0tvJ-pgWKuZ15FmFj","tenantId":"012d9b63-099e-435e-a063-6c6c01078ded","createdBy":"w3sz0tvJ-pgWKuZ15FmFj","ownerId":"w3sz0tvJ-pgWKuZ15FmFj","status":"active","archived":false,"createdAt":"2025-12-04T18:58:18.734Z","updatedAt":"2025-12-04T18:58:18.734Z"}

{"level":30,"time":1764874697767,"env":"test","module":"user-credentials-repository","userId":"Cri_YTmUY2qi0mXuHPFql","msg":"User credentials created"}
{"level":30,"time":1764874697767,"env":"test","module":"auth-routes","userId":"Cri_YTmUY2qi0mXuHPFql","email":"viewer-CMn9oLwl-d1s__VWXY7OH@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874697858,"env":"test","module":"rbac-middleware","userId":"Cri_YTmUY2qi0mXuHPFql","userRole":"viewer","permission":"workflow:create","path":"/projects/3c6c6064-e63d-4761-8d5e-3dbd4d5b38ce/workflows","msg":"Permission denied"}
{"level":50,"time":1764874703827,"env":"test","error":{},"workflowId":"41f010c2-5041-4378-ad1f-2b8ffd80e221","userId":"w3sz0tvJ-pgWKuZ15FmFj","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874704136,"env":"test","module":"auth-middleware","path":"/api/workflows/6202e908-a7d1-44e1-af04-435cef75bc55/move","msg":"No valid authentication found"}
{"level":30,"time":1764874704623,"env":"test","module":"user-credentials-repository","userId":"SJjYjIXDkcZJ0FeNI5D4t","msg":"User credentials created"}
{"level":30,"time":1764874704624,"env":"test","module":"auth-routes","userId":"SJjYjIXDkcZJ0FeNI5D4t","email":"test-workflows-6fjLviobP9UoPSF1GVm8A@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874704668,"env":"test","error":{},"workflowId":"e5638604-d0f0-4ceb-91c4-9219c23522e6","userId":"SJjYjIXDkcZJ0FeNI5D4t","projectId":"1a19cdfb-02c6-4648-a87c-6877cd773d67","msg":"Error moving workflow"}
{"level":50,"time":1764874705032,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2d0709c3-2bd7-4657-861e-481c7c4b9db3","userId":"w3sz0tvJ-pgWKuZ15FmFj","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874705377,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"82937026-aa8a-49f9-bf28-dbb66e274be1","userId":"w3sz0tvJ-pgWKuZ15FmFj","msg":"Error moving workflow"}
{"level":30,"time":1764874705867,"env":"test","module":"user-credentials-repository","userId":"mg2vjzBMxK8pj5pYyTR_Z","msg":"User credentials created"}
{"level":30,"time":1764874705868,"env":"test","module":"auth-routes","userId":"mg2vjzBMxK8pj5pYyTR_Z","email":"test-workflows-VsTwx4nomEJs4w2sLons6@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874706056,"env":"test","module":"auth-routes","userId":"mg2vjzBMxK8pj5pYyTR_Z","email":"test-workflows-VsTwx4nomEJs4w2sLons6@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874706246,"env":"test","error":{},"workflowId":"0912aa7f-182d-4d50-8b0d-97c274c56240","userId":"w3sz0tvJ-pgWKuZ15FmFj","projectId":"e00d0568-fddc-4cb3-936d-d3482b8f276b","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10049[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 309[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 731[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 687[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 869[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 26.58s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764876564964,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876569072,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876573945,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876573946,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876573994,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876573994,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876573995,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876573995,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876574484,"env":"test","module":"user-credentials-repository","userId":"uimRG6XEd25uQNAB7nuZX","msg":"User credentials created"}
{"level":30,"time":1764876574487,"env":"test","module":"auth-routes","userId":"uimRG6XEd25uQNAB7nuZX","email":"test-workflows-508wE37p01YJ1PZ5Rbg59@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"afef03bc-e7bc-403a-9959-94b49d7f85fc","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"uimRG6XEd25uQNAB7nuZX","tenantId":"27371aac-8367-427e-ac5a-7846632830dd","createdBy":"uimRG6XEd25uQNAB7nuZX","ownerId":"uimRG6XEd25uQNAB7nuZX","status":"active","archived":false,"createdAt":"2025-12-04T19:29:36.150Z","updatedAt":"2025-12-04T19:29:36.150Z"}

{"level":30,"time":1764876575175,"env":"test","module":"user-credentials-repository","userId":"jHThU9BkojdmDdSCopreR","msg":"User credentials created"}
{"level":30,"time":1764876575175,"env":"test","module":"auth-routes","userId":"jHThU9BkojdmDdSCopreR","email":"viewer-W-phzB6pSfHOwrlC0dPp0@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876575265,"env":"test","module":"rbac-middleware","userId":"jHThU9BkojdmDdSCopreR","userRole":"viewer","permission":"workflow:create","path":"/projects/afef03bc-e7bc-403a-9959-94b49d7f85fc/workflows","msg":"Permission denied"}
{"level":50,"time":1764876581478,"env":"test","error":{},"workflowId":"a6f3a97f-fba5-4f3d-9af7-b5327fb6af9d","userId":"uimRG6XEd25uQNAB7nuZX","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876581793,"env":"test","module":"auth-middleware","path":"/api/workflows/a5ae6053-7aab-402f-b496-a896374d58db/move","msg":"No valid authentication found"}
{"level":30,"time":1764876582300,"env":"test","module":"user-credentials-repository","userId":"YQTby4R-cP1w2yF86MTuO","msg":"User credentials created"}
{"level":30,"time":1764876582301,"env":"test","module":"auth-routes","userId":"YQTby4R-cP1w2yF86MTuO","email":"test-workflows-Yu97bpBwNvi8DPKRSJEH0@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876582350,"env":"test","error":{},"workflowId":"1fe7fd0a-9935-4413-a3f4-ea4a54765b1c","userId":"YQTby4R-cP1w2yF86MTuO","projectId":"fa2332ed-ad1e-4b0a-8770-04a231b8545f","msg":"Error moving workflow"}
{"level":50,"time":1764876582731,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3385812e-01c4-4d4e-829f-c00ff49bf42b","userId":"uimRG6XEd25uQNAB7nuZX","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876583086,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0ab37291-3c29-4639-9410-2e2ecde5912a","userId":"uimRG6XEd25uQNAB7nuZX","msg":"Error moving workflow"}
{"level":30,"time":1764876583594,"env":"test","module":"user-credentials-repository","userId":"qmOblppeVyMnGFsRj0m4z","msg":"User credentials created"}
{"level":30,"time":1764876583594,"env":"test","module":"auth-routes","userId":"qmOblppeVyMnGFsRj0m4z","email":"test-workflows-Li2-hUg3xs2479PCoPaT7@example.com","msg":"User registered successfully"}
{"level":30,"time":1764876583782,"env":"test","module":"auth-routes","userId":"qmOblppeVyMnGFsRj0m4z","email":"test-workflows-Li2-hUg3xs2479PCoPaT7@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764876583969,"env":"test","error":{},"workflowId":"f99835d4-7854-4dad-9b71-ce12b7de0c4b","userId":"uimRG6XEd25uQNAB7nuZX","projectId":"9a5fb7a4-615e-40df-a9f6-aea5d60ef009","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 287[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 664[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 355[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 884[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:29:20
[2m   Duration [22m 24.14s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764876644992,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876648357,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876652389,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876652390,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876652403,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876652403,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876652404,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876652404,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876653043,"env":"test","module":"user-credentials-repository","userId":"o5eTlJORwfEyTrDbqshwq","msg":"User credentials created"}
{"level":30,"time":1764876653047,"env":"test","module":"auth-routes","userId":"o5eTlJORwfEyTrDbqshwq","email":"test-workflows-n4CocrdsziNtllHat8VCX@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2508bf61-c79a-455e-b245-65dcc6bc9611","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"o5eTlJORwfEyTrDbqshwq","tenantId":"7d5df9d1-d5aa-4161-9626-893f390e6c81","createdBy":"o5eTlJORwfEyTrDbqshwq","ownerId":"o5eTlJORwfEyTrDbqshwq","status":"active","archived":false,"createdAt":"2025-12-04T19:30:54.718Z","updatedAt":"2025-12-04T19:30:54.718Z"}

{"level":30,"time":1764876653835,"env":"test","module":"user-credentials-repository","userId":"Y7FFdcyZ2LzkStJ1A4tQ9","msg":"User credentials created"}
{"level":30,"time":1764876653836,"env":"test","module":"auth-routes","userId":"Y7FFdcyZ2LzkStJ1A4tQ9","email":"viewer-rZAQRjMrYdIZ29WDYPZNS@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876653938,"env":"test","module":"rbac-middleware","userId":"Y7FFdcyZ2LzkStJ1A4tQ9","userRole":"viewer","permission":"workflow:create","path":"/projects/2508bf61-c79a-455e-b245-65dcc6bc9611/workflows","msg":"Permission denied"}
{"level":50,"time":1764876660656,"env":"test","error":{},"workflowId":"89b40c29-c36b-491a-b832-58c0c4b9f880","userId":"o5eTlJORwfEyTrDbqshwq","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876660988,"env":"test","module":"auth-middleware","path":"/api/workflows/1af3fb4e-af76-49f9-bf21-d468567877a3/move","msg":"No valid authentication found"}
{"level":30,"time":1764876661499,"env":"test","module":"user-credentials-repository","userId":"RkDvVpI89f3rREcy-6JX-","msg":"User credentials created"}
{"level":30,"time":1764876661500,"env":"test","module":"auth-routes","userId":"RkDvVpI89f3rREcy-6JX-","email":"test-workflows-jjXclpXbK-jsx-pIb4BKj@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876661554,"env":"test","error":{},"workflowId":"68007901-3aad-442a-bc06-b31276a4ced6","userId":"RkDvVpI89f3rREcy-6JX-","projectId":"bd6c77a1-83fa-469a-8e9b-a6f7aa85b8cf","msg":"Error moving workflow"}
{"level":50,"time":1764876661927,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"4757281b-1e09-4642-9d56-14c3e52fde3d","userId":"o5eTlJORwfEyTrDbqshwq","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876662302,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"728a0450-72aa-4fd0-8ada-6cb397e3aeab","userId":"o5eTlJORwfEyTrDbqshwq","msg":"Error moving workflow"}
{"level":30,"time":1764876662832,"env":"test","module":"user-credentials-repository","userId":"ZWFyShy66svYvWqgor-r2","msg":"User credentials created"}
{"level":30,"time":1764876662832,"env":"test","module":"auth-routes","userId":"ZWFyShy66svYvWqgor-r2","email":"test-workflows-WqP6Pmm89xUxTNMTWMMrr@example.com","msg":"User registered successfully"}
{"level":30,"time":1764876663026,"env":"test","module":"auth-routes","userId":"ZWFyShy66svYvWqgor-r2","email":"test-workflows-WqP6Pmm89xUxTNMTWMMrr@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764876663213,"env":"test","error":{},"workflowId":"dec76b29-4d8f-4603-864b-e67670dd7b08","userId":"o5eTlJORwfEyTrDbqshwq","projectId":"e08725d9-ba2d-493f-a347-f52024005334","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 12158[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 495[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 518[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 586[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 911[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:30:40
[2m   Duration [22m 22.76s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764877227928,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877235308,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877237731,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877237732,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877237741,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877237741,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877237741,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877237741,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877238180,"env":"test","module":"user-credentials-repository","userId":"oKfz2b41B46sXWDyVL8_2","msg":"User credentials created"}
{"level":30,"time":1764877238183,"env":"test","module":"auth-routes","userId":"oKfz2b41B46sXWDyVL8_2","email":"test-workflows-AiC6jqIqziJNtgM3zxD4W@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"6941efe6-936e-4b26-a4d1-8df1fc66250d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"oKfz2b41B46sXWDyVL8_2","tenantId":"da407d76-57b6-42e3-bd3f-f375c70b8463","createdBy":"oKfz2b41B46sXWDyVL8_2","ownerId":"oKfz2b41B46sXWDyVL8_2","status":"active","archived":false,"createdAt":"2025-12-04T19:40:39.854Z","updatedAt":"2025-12-04T19:40:39.854Z"}

{"level":30,"time":1764877238852,"env":"test","module":"user-credentials-repository","userId":"1vXzD1nmarBfh0mxZeGXZ","msg":"User credentials created"}
{"level":30,"time":1764877238853,"env":"test","module":"auth-routes","userId":"1vXzD1nmarBfh0mxZeGXZ","email":"viewer-2dy2tRN353VdkT6HXEHUb@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877238959,"env":"test","module":"rbac-middleware","userId":"1vXzD1nmarBfh0mxZeGXZ","userRole":"viewer","permission":"workflow:create","path":"/projects/6941efe6-936e-4b26-a4d1-8df1fc66250d/workflows","msg":"Permission denied"}
{"level":50,"time":1764877245182,"env":"test","error":{},"workflowId":"3aa610ec-d602-48b8-86e9-802fa473a1be","userId":"oKfz2b41B46sXWDyVL8_2","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877245498,"env":"test","module":"auth-middleware","path":"/api/workflows/3d33aea9-cfca-46b5-942f-00d687a8e290/move","msg":"No valid authentication found"}
{"level":30,"time":1764877245990,"env":"test","module":"user-credentials-repository","userId":"cFCclW3Vzv9-4aFwLfpnz","msg":"User credentials created"}
{"level":30,"time":1764877245991,"env":"test","module":"auth-routes","userId":"cFCclW3Vzv9-4aFwLfpnz","email":"test-workflows-JDdzSoS0A9Y8vmZwY3EMd@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877246083,"env":"test","error":{},"workflowId":"2d71f506-ab48-42df-8d28-5ba80cf389b6","userId":"cFCclW3Vzv9-4aFwLfpnz","projectId":"7679e2e3-2ca1-47f8-acc8-03f83d926a75","msg":"Error moving workflow"}
{"level":50,"time":1764877246449,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"48ac74d8-fd00-4672-bf2e-4d5a55471370","userId":"oKfz2b41B46sXWDyVL8_2","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877246639,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(oKfz2b41B46sXWDyVL8_2) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"oKfz2b41B46sXWDyVL8_2","msg":"Error creating workflow"}
{"level":50,"time":1764877246809,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(oKfz2b41B46sXWDyVL8_2) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"oKfz2b41B46sXWDyVL8_2","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 9357[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 315[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 586[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 190[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 171[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/4]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:40:22
[2m   Duration [22m 23.24s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/googleAuth.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764877492824,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877495689,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877498996,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877499000,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877499018,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877499018,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877499018,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877499018,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877499538,"env":"test","module":"user-credentials-repository","userId":"R1aSBHm4GHJgcEJwUmp_3","msg":"User credentials created"}
{"level":30,"time":1764877499541,"env":"test","module":"auth-routes","userId":"R1aSBHm4GHJgcEJwUmp_3","email":"test-workflows-QDHaol4gE9Zogvyrw7eYF@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"1872c082-af51-4018-a753-ecdab540dfda","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"R1aSBHm4GHJgcEJwUmp_3","tenantId":"7f355384-8611-435a-9da7-2b819aa69c2c","createdBy":"R1aSBHm4GHJgcEJwUmp_3","ownerId":"R1aSBHm4GHJgcEJwUmp_3","status":"active","archived":false,"createdAt":"2025-12-04T19:45:01.240Z","updatedAt":"2025-12-04T19:45:01.240Z"}

{"level":30,"time":1764877500245,"env":"test","module":"user-credentials-repository","userId":"ugFQHJULvYS6KgZVztsT4","msg":"User credentials created"}
{"level":30,"time":1764877500246,"env":"test","module":"auth-routes","userId":"ugFQHJULvYS6KgZVztsT4","email":"viewer-niG74OV31--6dM57I5Tw6@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877500333,"env":"test","module":"rbac-middleware","userId":"ugFQHJULvYS6KgZVztsT4","userRole":"viewer","permission":"workflow:create","path":"/projects/1872c082-af51-4018-a753-ecdab540dfda/workflows","msg":"Permission denied"}
{"level":50,"time":1764877506591,"env":"test","error":{},"workflowId":"3ffb0887-d73c-416a-8291-82f9bb8f966c","userId":"R1aSBHm4GHJgcEJwUmp_3","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877506904,"env":"test","module":"auth-middleware","path":"/api/workflows/a97887a8-8c0c-4771-8ad6-76da5a950db4/move","msg":"No valid authentication found"}
{"level":30,"time":1764877507412,"env":"test","module":"user-credentials-repository","userId":"A5RzY0hzmysPiTa62EFki","msg":"User credentials created"}
{"level":30,"time":1764877507412,"env":"test","module":"auth-routes","userId":"A5RzY0hzmysPiTa62EFki","email":"test-workflows-_ougj5TnI9qV5nHjTyRA4@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877507508,"env":"test","error":{},"workflowId":"3a1659f5-2f8b-4384-b2d2-775b324f57bb","userId":"A5RzY0hzmysPiTa62EFki","projectId":"c304c901-badc-40e6-a31b-4d52b7a161fa","msg":"Error moving workflow"}
{"level":50,"time":1764877507687,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(R1aSBHm4GHJgcEJwUmp_3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"R1aSBHm4GHJgcEJwUmp_3","msg":"Error creating workflow"}
{"level":50,"time":1764877507875,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(R1aSBHm4GHJgcEJwUmp_3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"R1aSBHm4GHJgcEJwUmp_3","msg":"Error creating workflow"}
{"level":50,"time":1764877508047,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(R1aSBHm4GHJgcEJwUmp_3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"R1aSBHm4GHJgcEJwUmp_3","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 9316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 330[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 285[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 778[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 742[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 313[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 605[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 178[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 189[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 172[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:44:44
[2m   Duration [22m 22.98s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764877822644,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877825626,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877829651,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877829651,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877829663,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877829663,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877829664,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877829664,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877830282,"env":"test","module":"user-credentials-repository","userId":"z4uP2460vOFueKsZkILuy","msg":"User credentials created"}
{"level":30,"time":1764877830285,"env":"test","module":"auth-routes","userId":"z4uP2460vOFueKsZkILuy","email":"test-workflows-ZQor6t-qANosajANtic1T@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"055ad141-ed2b-4a22-8b73-63d8b67734cb","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"z4uP2460vOFueKsZkILuy","tenantId":"5e20ac28-13dd-4099-b9b7-7070b7bf29be","createdBy":"z4uP2460vOFueKsZkILuy","ownerId":"z4uP2460vOFueKsZkILuy","status":"active","archived":false,"createdAt":"2025-12-04T19:50:31.976Z","updatedAt":"2025-12-04T19:50:31.976Z"}

{"level":30,"time":1764877831021,"env":"test","module":"user-credentials-repository","userId":"qMcO6xgGfGbpQlRbbHfhK","msg":"User credentials created"}
{"level":30,"time":1764877831022,"env":"test","module":"auth-routes","userId":"qMcO6xgGfGbpQlRbbHfhK","email":"viewer-ljcsSQl0HSj2cSS68eS98@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877831122,"env":"test","module":"rbac-middleware","userId":"qMcO6xgGfGbpQlRbbHfhK","userRole":"viewer","permission":"workflow:create","path":"/projects/055ad141-ed2b-4a22-8b73-63d8b67734cb/workflows","msg":"Permission denied"}
{"level":50,"time":1764877837520,"env":"test","error":{},"workflowId":"dd67c387-5074-4f84-a96b-e65e14c58d16","userId":"z4uP2460vOFueKsZkILuy","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877837868,"env":"test","module":"auth-middleware","path":"/api/workflows/5279160a-67f8-41b3-b2d8-134dcf9f1520/move","msg":"No valid authentication found"}
{"level":30,"time":1764877838471,"env":"test","module":"user-credentials-repository","userId":"fQr3tQ0PvoM5Lh6jNVHUZ","msg":"User credentials created"}
{"level":30,"time":1764877838472,"env":"test","module":"auth-routes","userId":"fQr3tQ0PvoM5Lh6jNVHUZ","email":"test-workflows-UEDetbXR5V7g11QP-kuq0@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877838527,"env":"test","error":{},"workflowId":"e5d7e47e-cf88-49ba-9fdb-4b1c6c3d4593","userId":"fQr3tQ0PvoM5Lh6jNVHUZ","projectId":"976cbf81-f27a-4e97-a2c2-adfbf3ac9a3f","msg":"Error moving workflow"}
{"level":50,"time":1764877838900,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6431099a-2526-43f7-ad0d-d4374baa5210","userId":"z4uP2460vOFueKsZkILuy","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877839288,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"50b65b62-20b4-49b8-9c56-b7d496127a48","userId":"z4uP2460vOFueKsZkILuy","msg":"Error moving workflow"}
{"level":30,"time":1764877839820,"env":"test","module":"user-credentials-repository","userId":"Alyi98Cm9LQ6f3cv6N_eh","msg":"User credentials created"}
{"level":30,"time":1764877839822,"env":"test","module":"auth-routes","userId":"Alyi98Cm9LQ6f3cv6N_eh","email":"test-workflows-TEBqCaNhZEE-2QuJRf9ix@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877840036,"env":"test","module":"auth-routes","userId":"Alyi98Cm9LQ6f3cv6N_eh","email":"test-workflows-TEBqCaNhZEE-2QuJRf9ix@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877840316,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1a700a28-8ad3-4447-92e9-636712969f01","userId":"z4uP2460vOFueKsZkILuy","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10947[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 769[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 659[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 387[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1030[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:18
[2m   Duration [22m 21.84s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764877846504,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877848819,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877850972,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877850972,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877850983,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877850983,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877850983,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877850983,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877851466,"env":"test","module":"user-credentials-repository","userId":"UnnVheHHVTixgRIjrA-Sf","msg":"User credentials created"}
{"level":30,"time":1764877851469,"env":"test","module":"auth-routes","userId":"UnnVheHHVTixgRIjrA-Sf","email":"test-workflows-91r0d-JJ34bE-DofxZL88@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2f515b2c-fca0-4e01-b37c-6ed0945a78f6","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"UnnVheHHVTixgRIjrA-Sf","tenantId":"1ed4a95d-ede1-4ce0-bf70-e6d976704f66","createdBy":"UnnVheHHVTixgRIjrA-Sf","ownerId":"UnnVheHHVTixgRIjrA-Sf","status":"active","archived":false,"createdAt":"2025-12-04T19:50:53.164Z","updatedAt":"2025-12-04T19:50:53.164Z"}

{"level":30,"time":1764877852199,"env":"test","module":"user-credentials-repository","userId":"RHU82xsjsZINEzAXbWGja","msg":"User credentials created"}
{"level":30,"time":1764877852200,"env":"test","module":"auth-routes","userId":"RHU82xsjsZINEzAXbWGja","email":"viewer-xfbdRXWZVEtDrwKy1Bauo@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877852304,"env":"test","module":"rbac-middleware","userId":"RHU82xsjsZINEzAXbWGja","userRole":"viewer","permission":"workflow:create","path":"/projects/2f515b2c-fca0-4e01-b37c-6ed0945a78f6/workflows","msg":"Permission denied"}
{"level":50,"time":1764877858782,"env":"test","error":{},"workflowId":"ab4fb4f2-4ece-4f8a-aea4-b1e58794b195","userId":"UnnVheHHVTixgRIjrA-Sf","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877859313,"env":"test","module":"auth-middleware","path":"/api/workflows/1f08b29a-2bf7-4c5a-9422-ec621295d497/move","msg":"No valid authentication found"}
{"level":30,"time":1764877859864,"env":"test","module":"user-credentials-repository","userId":"7iq08PJj_rmYll10Qm89V","msg":"User credentials created"}
{"level":30,"time":1764877859865,"env":"test","module":"auth-routes","userId":"7iq08PJj_rmYll10Qm89V","email":"test-workflows-NK4EZEl91hgP_hFuw9pol@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877859921,"env":"test","error":{},"workflowId":"90f53d29-d1f9-4953-9df6-6807ab1f228b","userId":"7iq08PJj_rmYll10Qm89V","projectId":"b1f6941f-23ce-4ffb-ab67-a72a35d2c9be","msg":"Error moving workflow"}
{"level":50,"time":1764877860303,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"19d7808b-d4e3-49f1-aad8-85910d7e9876","userId":"UnnVheHHVTixgRIjrA-Sf","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877860692,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c422266f-5ea9-41dd-8de9-8e45af2e2da9","userId":"UnnVheHHVTixgRIjrA-Sf","msg":"Error moving workflow"}
{"level":30,"time":1764877861221,"env":"test","module":"user-credentials-repository","userId":"HtDkZiWZY7kBarNQ7k1k7","msg":"User credentials created"}
{"level":30,"time":1764877861222,"env":"test","module":"auth-routes","userId":"HtDkZiWZY7kBarNQ7k1k7","email":"test-workflows-OzN0Jlo9o9q93WatHaOen@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877861434,"env":"test","module":"auth-routes","userId":"HtDkZiWZY7kBarNQ7k1k7","email":"test-workflows-OzN0Jlo9o9q93WatHaOen@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877861622,"env":"test","error":{},"workflowId":"f7027a4b-38f5-4d6f-bfda-38a8b09e96ec","userId":"UnnVheHHVTixgRIjrA-Sf","projectId":"419cfe17-4f7a-4447-98c5-30b3d55bdd5c","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10948[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 848[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 664[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 811[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 390[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 932[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:40
[2m   Duration [22m 19.65s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764877867254,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877869751,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877872987,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877872988,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877872998,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877872998,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877872999,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877872999,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877873452,"env":"test","module":"user-credentials-repository","userId":"13FRpn7GSuyylUUV5rL_A","msg":"User credentials created"}
{"level":30,"time":1764877873455,"env":"test","module":"auth-routes","userId":"13FRpn7GSuyylUUV5rL_A","email":"test-workflows-5tRVeKQzTXoLuJAwLigCo@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"6c70bd0d-9286-47d8-805a-a0eca01a6a0f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"13FRpn7GSuyylUUV5rL_A","tenantId":"5219282a-d8e6-4e8f-a38c-6a341a815324","createdBy":"13FRpn7GSuyylUUV5rL_A","ownerId":"13FRpn7GSuyylUUV5rL_A","status":"active","archived":false,"createdAt":"2025-12-04T19:51:15.142Z","updatedAt":"2025-12-04T19:51:15.142Z"}

{"level":30,"time":1764877874159,"env":"test","module":"user-credentials-repository","userId":"V5f2ReKlrMi1WLTuyOoVG","msg":"User credentials created"}
{"level":30,"time":1764877874160,"env":"test","module":"auth-routes","userId":"V5f2ReKlrMi1WLTuyOoVG","email":"viewer-MJlG-7wE3zhNtW6mm9OGu@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877874260,"env":"test","module":"rbac-middleware","userId":"V5f2ReKlrMi1WLTuyOoVG","userRole":"viewer","permission":"workflow:create","path":"/projects/6c70bd0d-9286-47d8-805a-a0eca01a6a0f/workflows","msg":"Permission denied"}
{"level":50,"time":1764877880479,"env":"test","error":{},"workflowId":"ee92edb8-94e7-47dd-9b03-225f1fe951ff","userId":"13FRpn7GSuyylUUV5rL_A","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877880805,"env":"test","module":"auth-middleware","path":"/api/workflows/468f012d-a282-402e-93f5-3fb70a6b4e67/move","msg":"No valid authentication found"}
{"level":30,"time":1764877881324,"env":"test","module":"user-credentials-repository","userId":"_l2bQhUF1kLr4CnIPka_U","msg":"User credentials created"}
{"level":30,"time":1764877881325,"env":"test","module":"auth-routes","userId":"_l2bQhUF1kLr4CnIPka_U","email":"test-workflows-6WXjhQZskU-0WWo94j_wI@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877881375,"env":"test","error":{},"workflowId":"3573ded6-a263-4aa1-be2e-0d38d603f687","userId":"_l2bQhUF1kLr4CnIPka_U","projectId":"9a1410c2-b47b-4666-8c50-b950fd5bba16","msg":"Error moving workflow"}
{"level":50,"time":1764877881760,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"1bf0c8d4-3e4e-439c-bbcb-24bb746b66ba","userId":"13FRpn7GSuyylUUV5rL_A","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877882128,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9a3a847f-acfd-4661-b3b6-114204de15cb","userId":"13FRpn7GSuyylUUV5rL_A","msg":"Error moving workflow"}
{"level":50,"time":1764877882341,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(13FRpn7GSuyylUUV5rL_A) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"13FRpn7GSuyylUUV5rL_A","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 345[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 785[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 509[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 215[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
AssertionError: expected '' to have property "id" with value '38643400-7dbe-4579-8ad1-2242ab475359'

- Expected: 
"38643400-7dbe-4579-8ad1-2242ab475359"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/api.workflows.test.ts:308:29
    306|         .expect(200);
    307| 
    308|       expect(response.body).toHaveProperty("id", workflowId);
       |                             ^
    309|       expect(response.body).toHaveProperty("projectId", targetProjectIÎ“Ã‡Âª
    310| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:51:02
[2m   Duration [22m 19.42s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764879993753,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764879998518,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880001798,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880001799,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880001809,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880001809,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880001809,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880001809,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880002277,"env":"test","module":"user-credentials-repository","userId":"Vbg4DjwsZ-kSYu9tuxB7j","msg":"User credentials created"}
{"level":30,"time":1764880002281,"env":"test","module":"auth-routes","userId":"Vbg4DjwsZ-kSYu9tuxB7j","email":"test-workflows-r9v6Jzo_r04HU5eGLDg-q@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"cc8e0c96-e8a7-4147-88ff-c1a08e8f7fe4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Vbg4DjwsZ-kSYu9tuxB7j","tenantId":"a69f989b-818a-4f35-9951-e4542c75a6c9","createdBy":"Vbg4DjwsZ-kSYu9tuxB7j","ownerId":"Vbg4DjwsZ-kSYu9tuxB7j","status":"active","archived":false,"createdAt":"2025-12-04T20:26:43.998Z","updatedAt":"2025-12-04T20:26:43.998Z"}

{"level":30,"time":1764880002961,"env":"test","module":"user-credentials-repository","userId":"JRBnJ-He1CDPf265L1N_E","msg":"User credentials created"}
{"level":30,"time":1764880002962,"env":"test","module":"auth-routes","userId":"JRBnJ-He1CDPf265L1N_E","email":"viewer-gY-wmUlrOXvyVAZ54KLCW@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880003066,"env":"test","module":"rbac-middleware","userId":"JRBnJ-He1CDPf265L1N_E","userRole":"viewer","permission":"workflow:create","path":"/projects/cc8e0c96-e8a7-4147-88ff-c1a08e8f7fe4/workflows","msg":"Permission denied"}
{"level":50,"time":1764880009724,"env":"test","error":{},"workflowId":"75dd245f-a4d5-46b9-8e31-4f32e6a6c4d2","userId":"Vbg4DjwsZ-kSYu9tuxB7j","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880010052,"env":"test","module":"auth-middleware","path":"/api/workflows/49735eca-68c7-4ea5-8da0-617d4b96169c/move","msg":"No valid authentication found"}
{"level":30,"time":1764880010578,"env":"test","module":"user-credentials-repository","userId":"THyHAMRTQDxjof0frK2NW","msg":"User credentials created"}
{"level":30,"time":1764880010579,"env":"test","module":"auth-routes","userId":"THyHAMRTQDxjof0frK2NW","email":"test-workflows-VkXUhXPzigyxzlc7g9zFd@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880010624,"env":"test","error":{},"workflowId":"036abba8-00d8-406f-8cf3-949f9fa92531","userId":"THyHAMRTQDxjof0frK2NW","projectId":"378ab03b-29cf-4ebc-b1b4-1bcc9daa02bd","msg":"Error moving workflow"}
{"level":50,"time":1764880010998,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ec2c7ce0-fc42-4436-875b-37d7cba9e4c9","userId":"Vbg4DjwsZ-kSYu9tuxB7j","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880011373,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1ad64144-36f6-42fd-ba2c-90b3df79c87c","userId":"Vbg4DjwsZ-kSYu9tuxB7j","msg":"Error moving workflow"}
{"level":50,"time":1764880011569,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(Vbg4DjwsZ-kSYu9tuxB7j) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"Vbg4DjwsZ-kSYu9tuxB7j","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10047[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 497[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 826[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 670[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 841[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 678[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 196[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:29
[2m   Duration [22m 21.40s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880018068,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880022485,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880024950,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880024951,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880024961,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880024961,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880024962,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880024962,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880025425,"env":"test","module":"user-credentials-repository","userId":"Dj7LybOaxzsPe-myANw81","msg":"User credentials created"}
{"level":30,"time":1764880025428,"env":"test","module":"auth-routes","userId":"Dj7LybOaxzsPe-myANw81","email":"test-workflows-Bazr-5OPKWxYNRz_0yAgt@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"29c4942b-27dc-4ac9-b7e0-ddc12c08717f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Dj7LybOaxzsPe-myANw81","tenantId":"792272dd-4160-44f7-9c55-3b71f21e1ae7","createdBy":"Dj7LybOaxzsPe-myANw81","ownerId":"Dj7LybOaxzsPe-myANw81","status":"active","archived":false,"createdAt":"2025-12-04T20:27:07.146Z","updatedAt":"2025-12-04T20:27:07.146Z"}

{"level":30,"time":1764880026119,"env":"test","module":"user-credentials-repository","userId":"7nAKFXLDz09JlGScQc6lP","msg":"User credentials created"}
{"level":30,"time":1764880026119,"env":"test","module":"auth-routes","userId":"7nAKFXLDz09JlGScQc6lP","email":"viewer-aAqzTf8Dtw_69P2Y0Stn2@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880026219,"env":"test","module":"rbac-middleware","userId":"7nAKFXLDz09JlGScQc6lP","userRole":"viewer","permission":"workflow:create","path":"/projects/29c4942b-27dc-4ac9-b7e0-ddc12c08717f/workflows","msg":"Permission denied"}
{"level":50,"time":1764880032160,"env":"test","error":{},"workflowId":"0b665052-f433-4d52-ad99-ce4a4c6dd60e","userId":"Dj7LybOaxzsPe-myANw81","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764880032669,"env":"test","error":{},"workflowId":"6833a91e-1963-44cf-b495-f49ef4bed2c9","userId":"Dj7LybOaxzsPe-myANw81","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880033004,"env":"test","module":"auth-middleware","path":"/api/workflows/e3aa57c0-c26a-482e-94ff-da5a0a7be5a9/move","msg":"No valid authentication found"}
{"level":30,"time":1764880033526,"env":"test","module":"user-credentials-repository","userId":"DA0KALXsYThWtI3EfOK8P","msg":"User credentials created"}
{"level":30,"time":1764880033526,"env":"test","module":"auth-routes","userId":"DA0KALXsYThWtI3EfOK8P","email":"test-workflows-oghppBAKGqntjz_fVYe97@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880033627,"env":"test","error":{},"workflowId":"0387da2c-0c7a-4e20-97e5-9099b2c5afd1","userId":"DA0KALXsYThWtI3EfOK8P","projectId":"a864e57b-c357-4900-acd6-7b99f253235a","msg":"Error moving workflow"}
{"level":50,"time":1764880033999,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"cafd055f-db2d-4f21-a226-f5f04cec494e","userId":"Dj7LybOaxzsPe-myANw81","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880034370,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"fc5e1391-0d80-4cf6-8f1b-7e07d42c8faf","userId":"Dj7LybOaxzsPe-myANw81","msg":"Error moving workflow"}
{"level":50,"time":1764880034561,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(Dj7LybOaxzsPe-myANw81) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"Dj7LybOaxzsPe-myANw81","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 9890[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 495[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 801[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 696[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 801[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 631[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 678[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 508[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 334[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 371[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 191[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:332:10
    330|         .set("Authorization", `Bearer ${authToken}`)
    331|         .send({ projectId: null })
    332|         .expect(200);
       |          ^
    333| 
    334|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:51
[2m   Duration [22m 21.06s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880066678,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880069893,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880073751,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880073752,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880073763,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880073763,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880073763,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880073763,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880074342,"env":"test","module":"user-credentials-repository","userId":"Y2ltMJ6QVsKuus3HSpiMV","msg":"User credentials created"}
{"level":30,"time":1764880074346,"env":"test","module":"auth-routes","userId":"Y2ltMJ6QVsKuus3HSpiMV","email":"test-workflows-tiGIG8QV8kfLBOPqvLfIt@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"84028cc5-1b9b-467d-ad68-2fc3d9299430","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Y2ltMJ6QVsKuus3HSpiMV","tenantId":"5fa37de9-7580-4fb5-86b1-5e9598ab7064","createdBy":"Y2ltMJ6QVsKuus3HSpiMV","ownerId":"Y2ltMJ6QVsKuus3HSpiMV","status":"active","archived":false,"createdAt":"2025-12-04T20:27:56.074Z","updatedAt":"2025-12-04T20:27:56.074Z"}

{"level":30,"time":1764880075056,"env":"test","module":"user-credentials-repository","userId":"yPD30kaT4J7esCRF-37JX","msg":"User credentials created"}
{"level":30,"time":1764880075057,"env":"test","module":"auth-routes","userId":"yPD30kaT4J7esCRF-37JX","email":"viewer-u_r_1YKEkCkMTxrvW65QO@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880075147,"env":"test","module":"rbac-middleware","userId":"yPD30kaT4J7esCRF-37JX","userRole":"viewer","permission":"workflow:create","path":"/projects/84028cc5-1b9b-467d-ad68-2fc3d9299430/workflows","msg":"Permission denied"}
{"level":50,"time":1764880081486,"env":"test","error":{},"workflowId":"b8c6bbfe-dbfc-4e27-996d-f8bbb0eb1f43","userId":"Y2ltMJ6QVsKuus3HSpiMV","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880081800,"env":"test","module":"auth-middleware","path":"/api/workflows/32a73537-8261-4e24-bd2a-33997dba2bad/move","msg":"No valid authentication found"}
{"level":30,"time":1764880082329,"env":"test","module":"user-credentials-repository","userId":"B-hQVb2BYjHuCNXxLKbBs","msg":"User credentials created"}
{"level":30,"time":1764880082329,"env":"test","module":"auth-routes","userId":"B-hQVb2BYjHuCNXxLKbBs","email":"test-workflows-zmAcHXrHYiFVU2mggZZgn@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880082376,"env":"test","error":{},"workflowId":"509d3eba-9ecd-4ae3-b8e9-2f279a97cb83","userId":"B-hQVb2BYjHuCNXxLKbBs","projectId":"47d4b328-3920-442c-9e12-e84cda17adef","msg":"Error moving workflow"}
{"level":50,"time":1764880082754,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2124639a-ff1b-43c3-98d1-c569033a2a34","userId":"Y2ltMJ6QVsKuus3HSpiMV","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880083120,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ce3d14bb-a0a8-47c9-87c5-30e36de601c5","userId":"Y2ltMJ6QVsKuus3HSpiMV","msg":"Error moving workflow"}
{"level":30,"time":1764880083619,"env":"test","module":"user-credentials-repository","userId":"2r3ZCaMghS7uJqVKt1efb","msg":"User credentials created"}
{"level":30,"time":1764880083620,"env":"test","module":"auth-routes","userId":"2r3ZCaMghS7uJqVKt1efb","email":"test-workflows-rIbL8YdgM1YYaNcR9Lcko@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880083821,"env":"test","module":"auth-routes","userId":"2r3ZCaMghS7uJqVKt1efb","email":"test-workflows-rIbL8YdgM1YYaNcR9Lcko@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880084013,"env":"test","error":{},"workflowId":"b512f4f3-d5d4-4f89-bb97-1887b3e4bd1b","userId":"Y2ltMJ6QVsKuus3HSpiMV","projectId":"a3c97cde-af82-4a95-a032-195522233905","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 823[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 726[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 377[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 895[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:27:42
[2m   Duration [22m 21.26s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764880089173,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880092706,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880095585,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880095586,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880095598,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880095598,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880095600,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880095600,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880096279,"env":"test","module":"user-credentials-repository","userId":"rjsl6IVze5JVAYTsnfhJX","msg":"User credentials created"}
{"level":30,"time":1764880096283,"env":"test","module":"auth-routes","userId":"rjsl6IVze5JVAYTsnfhJX","email":"test-workflows-X-WDw11SN3mI6Jttu-ZOz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"4f92c40d-bc5e-4628-ab8d-8e7195ef7735","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"rjsl6IVze5JVAYTsnfhJX","tenantId":"608fe823-8527-47ae-93e0-336ca33a3ab0","createdBy":"rjsl6IVze5JVAYTsnfhJX","ownerId":"rjsl6IVze5JVAYTsnfhJX","status":"active","archived":false,"createdAt":"2025-12-04T20:28:18.007Z","updatedAt":"2025-12-04T20:28:18.007Z"}

{"level":30,"time":1764880096986,"env":"test","module":"user-credentials-repository","userId":"wgfZ0Qajge9brWfi7i4RJ","msg":"User credentials created"}
{"level":30,"time":1764880096987,"env":"test","module":"auth-routes","userId":"wgfZ0Qajge9brWfi7i4RJ","email":"viewer-HWD6s-cmNAlkOSRwDrqfi@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880097082,"env":"test","module":"rbac-middleware","userId":"wgfZ0Qajge9brWfi7i4RJ","userRole":"viewer","permission":"workflow:create","path":"/projects/4f92c40d-bc5e-4628-ab8d-8e7195ef7735/workflows","msg":"Permission denied"}
{"level":50,"time":1764880103412,"env":"test","error":{},"workflowId":"3635110b-469c-411e-857e-65b9fa911f75","userId":"rjsl6IVze5JVAYTsnfhJX","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880103740,"env":"test","module":"auth-middleware","path":"/api/workflows/f1850f65-7ff6-49c2-9681-7815b973edca/move","msg":"No valid authentication found"}
{"level":30,"time":1764880104286,"env":"test","module":"user-credentials-repository","userId":"Gxdyewivz1QX2gTkB_x_t","msg":"User credentials created"}
{"level":30,"time":1764880104287,"env":"test","module":"auth-routes","userId":"Gxdyewivz1QX2gTkB_x_t","email":"test-workflows-K3A585mnnqdgXJu7badyT@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880104335,"env":"test","error":{},"workflowId":"4d40e5db-61cf-4822-84ca-cd28f9862a2c","userId":"Gxdyewivz1QX2gTkB_x_t","projectId":"a567be0e-322c-4f53-b77c-30d7b3c7c183","msg":"Error moving workflow"}
{"level":50,"time":1764880104733,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"81c933bc-2f49-4cdf-a0f7-529763de6f50","userId":"rjsl6IVze5JVAYTsnfhJX","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880105321,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"36fc60f1-d176-4a93-b8cf-c67c778016a3","userId":"rjsl6IVze5JVAYTsnfhJX","msg":"Error moving workflow"}
{"level":30,"time":1764880105845,"env":"test","module":"user-credentials-repository","userId":"hDI8w-CKOsp_NLvbhkxBz","msg":"User credentials created"}
{"level":30,"time":1764880105846,"env":"test","module":"auth-routes","userId":"hDI8w-CKOsp_NLvbhkxBz","email":"test-workflows-XjMVbWWB6mzROqeXaTmUS@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880106038,"env":"test","module":"auth-routes","userId":"hDI8w-CKOsp_NLvbhkxBz","email":"test-workflows-XjMVbWWB6mzROqeXaTmUS@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880106286,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"62ebfbac-8899-471d-8cb6-d4e64b554cbd","userId":"rjsl6IVze5JVAYTsnfhJX","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10993[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 397[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 588[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 966[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:04
[2m   Duration [22m 21.34s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764880109430,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880111490,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880113829,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880113830,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880113841,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880113841,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880113841,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880113841,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880114275,"env":"test","module":"user-credentials-repository","userId":"MpSqA0ckDL7f1kIpFMUVa","msg":"User credentials created"}
{"level":30,"time":1764880114278,"env":"test","module":"auth-routes","userId":"MpSqA0ckDL7f1kIpFMUVa","email":"test-workflows-CUhWYdKwr9lME8sqrek9Z@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b7531f45-9444-44c8-acad-9f58dad95e01","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"MpSqA0ckDL7f1kIpFMUVa","tenantId":"da7b3e1c-8b40-4204-9cf7-fd2864d71bf9","createdBy":"MpSqA0ckDL7f1kIpFMUVa","ownerId":"MpSqA0ckDL7f1kIpFMUVa","status":"active","archived":false,"createdAt":"2025-12-04T20:28:35.985Z","updatedAt":"2025-12-04T20:28:35.985Z"}

{"level":30,"time":1764880114914,"env":"test","module":"user-credentials-repository","userId":"S8HIDQsCHOW3KoRBxkV89","msg":"User credentials created"}
{"level":30,"time":1764880114915,"env":"test","module":"auth-routes","userId":"S8HIDQsCHOW3KoRBxkV89","email":"viewer-a72jfyj4GDWBHpOvbw4XE@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880115017,"env":"test","module":"rbac-middleware","userId":"S8HIDQsCHOW3KoRBxkV89","userRole":"viewer","permission":"workflow:create","path":"/projects/b7531f45-9444-44c8-acad-9f58dad95e01/workflows","msg":"Permission denied"}
{"level":50,"time":1764880120967,"env":"test","error":{},"workflowId":"af9b8185-dab6-4b03-8309-2e2b9ba31b56","userId":"MpSqA0ckDL7f1kIpFMUVa","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880121272,"env":"test","module":"auth-middleware","path":"/api/workflows/8c370dce-a8c7-44bd-bda7-09459768485a/move","msg":"No valid authentication found"}
{"level":30,"time":1764880121763,"env":"test","module":"user-credentials-repository","userId":"DBvEe2NnrTFNBRcIVrdSH","msg":"User credentials created"}
{"level":30,"time":1764880121763,"env":"test","module":"auth-routes","userId":"DBvEe2NnrTFNBRcIVrdSH","email":"test-workflows-RIkPuCiHVqh9WAPE3V1TJ@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880121811,"env":"test","error":{},"workflowId":"4ddfb654-8eba-4538-ae91-a71a1a62e34b","userId":"DBvEe2NnrTFNBRcIVrdSH","projectId":"a3ab0329-9ff3-4f9b-b2fe-3364f6525736","msg":"Error moving workflow"}
{"level":50,"time":1764880122150,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"291f726e-3821-47de-bb28-bab27094ea74","userId":"MpSqA0ckDL7f1kIpFMUVa","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880122503,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bb276cf2-70fe-4c1e-be55-02fbefdf435e","userId":"MpSqA0ckDL7f1kIpFMUVa","msg":"Error moving workflow"}
{"level":30,"time":1764880122990,"env":"test","module":"user-credentials-repository","userId":"YSMCvEOVKoM7pfsCW7y1C","msg":"User credentials created"}
{"level":30,"time":1764880122991,"env":"test","module":"auth-routes","userId":"YSMCvEOVKoM7pfsCW7y1C","email":"test-workflows-f4ROUy2K6_IWSX9OStW5m@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880123170,"env":"test","module":"auth-routes","userId":"YSMCvEOVKoM7pfsCW7y1C","email":"test-workflows-f4ROUy2K6_IWSX9OStW5m@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880123356,"env":"test","error":{},"workflowId":"e948db0e-3853-497d-83b6-5ac0653b804e","userId":"MpSqA0ckDL7f1kIpFMUVa","projectId":"c9d87262-3816-4905-a57b-f6d87291feef","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9803[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 315[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 288[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 677[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 686[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 539[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 353[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 854[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:26
[2m   Duration [22m 16.47s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/sections.routes.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764880140386,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880143832,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880147990,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880147991,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880148004,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880148004,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880148005,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880148006,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880148526,"env":"test","module":"user-credentials-repository","userId":"cD9oW3a3iY62mgbUIwQEs","msg":"User credentials created"}
{"level":30,"time":1764880148529,"env":"test","module":"auth-routes","userId":"cD9oW3a3iY62mgbUIwQEs","email":"test-workflows-wvuQWif1nh2UwxpVLXUqI@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d41bf72f-a7ab-48da-b1b6-a5acfe814ba0","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"cD9oW3a3iY62mgbUIwQEs","tenantId":"e20df9a3-b24d-4da4-9290-d387b01a9cbf","createdBy":"cD9oW3a3iY62mgbUIwQEs","ownerId":"cD9oW3a3iY62mgbUIwQEs","status":"active","archived":false,"createdAt":"2025-12-04T20:29:10.246Z","updatedAt":"2025-12-04T20:29:10.246Z"}

{"level":30,"time":1764880149201,"env":"test","module":"user-credentials-repository","userId":"URRQS0OmXdmG_xVT59xsv","msg":"User credentials created"}
{"level":30,"time":1764880149202,"env":"test","module":"auth-routes","userId":"URRQS0OmXdmG_xVT59xsv","email":"viewer-GrR_gbdaKMlFQOHss1tUN@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880149288,"env":"test","module":"rbac-middleware","userId":"URRQS0OmXdmG_xVT59xsv","userRole":"viewer","permission":"workflow:create","path":"/projects/d41bf72f-a7ab-48da-b1b6-a5acfe814ba0/workflows","msg":"Permission denied"}
{"level":50,"time":1764880155345,"env":"test","error":{},"workflowId":"07a0f813-626d-43df-a62e-59e6d91b8a41","userId":"cD9oW3a3iY62mgbUIwQEs","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880155662,"env":"test","module":"auth-middleware","path":"/api/workflows/403d33bd-1a82-4ef1-9d7d-3fb32ce86f16/move","msg":"No valid authentication found"}
{"level":30,"time":1764880156171,"env":"test","module":"user-credentials-repository","userId":"lc2zMS45dMy9Ci2kjfS4T","msg":"User credentials created"}
{"level":30,"time":1764880156171,"env":"test","module":"auth-routes","userId":"lc2zMS45dMy9Ci2kjfS4T","email":"test-workflows-AUSpcOVWI4lF6unEIB9aM@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880156218,"env":"test","error":{},"workflowId":"268ce171-6f20-4bc1-b388-33102e92d005","userId":"lc2zMS45dMy9Ci2kjfS4T","projectId":"9ab1b17e-996a-4b53-ab2a-9391e93d87f3","msg":"Error moving workflow"}
{"level":50,"time":1764880156602,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b58dc4d0-a122-40e0-bfbf-c3a8254e59f9","userId":"cD9oW3a3iY62mgbUIwQEs","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880156951,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c80b2fd4-9541-4049-92bb-17a5d4db348a","userId":"cD9oW3a3iY62mgbUIwQEs","msg":"Error moving workflow"}
{"level":30,"time":1764880157437,"env":"test","module":"user-credentials-repository","userId":"y1-k3wLf_KGYWtuAqdd2W","msg":"User credentials created"}
{"level":30,"time":1764880157438,"env":"test","module":"auth-routes","userId":"y1-k3wLf_KGYWtuAqdd2W","email":"test-workflows-psvbyLnFmxHNfl76ejUzn@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880157625,"env":"test","module":"auth-routes","userId":"y1-k3wLf_KGYWtuAqdd2W","email":"test-workflows-psvbyLnFmxHNfl76ejUzn@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880157802,"env":"test","error":{},"workflowId":"b2a30e29-2fbc-4a0a-89ff-4909d123e705","userId":"cD9oW3a3iY62mgbUIwQEs","projectId":"1269d8c8-4814-40bd-990d-eae67e18c31e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10143[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 332[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 281[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 804[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 685[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 851[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:56
[2m   Duration [22m 21.28s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764880170468,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880177672,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880179616,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880179616,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880179627,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880179627,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880179627,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880179627,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880180085,"env":"test","module":"user-credentials-repository","userId":"btELX6ZWzmbc88niHfkC0","msg":"User credentials created"}
{"level":30,"time":1764880180088,"env":"test","module":"auth-routes","userId":"btELX6ZWzmbc88niHfkC0","email":"test-workflows-tK2Sbm0ulEhvvEX0JBzVz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"08715b61-1e87-44ab-abaa-16e2e9e099c9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"btELX6ZWzmbc88niHfkC0","tenantId":"43a2e2d8-80e3-44a9-9cb5-465a42529e2f","createdBy":"btELX6ZWzmbc88niHfkC0","ownerId":"btELX6ZWzmbc88niHfkC0","status":"active","archived":false,"createdAt":"2025-12-04T20:29:41.819Z","updatedAt":"2025-12-04T20:29:41.819Z"}

{"level":30,"time":1764880180806,"env":"test","module":"user-credentials-repository","userId":"9Z0TIIRrynI-BNnDrkT-i","msg":"User credentials created"}
{"level":30,"time":1764880180807,"env":"test","module":"auth-routes","userId":"9Z0TIIRrynI-BNnDrkT-i","email":"viewer-pnOpcRJmxkApFN1eDZdRp@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880180913,"env":"test","module":"rbac-middleware","userId":"9Z0TIIRrynI-BNnDrkT-i","userRole":"viewer","permission":"workflow:create","path":"/projects/08715b61-1e87-44ab-abaa-16e2e9e099c9/workflows","msg":"Permission denied"}
{"level":50,"time":1764880187397,"env":"test","error":{},"workflowId":"c3a4d383-01c3-455b-bfc4-6665789cc5fa","userId":"btELX6ZWzmbc88niHfkC0","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880187728,"env":"test","module":"auth-middleware","path":"/api/workflows/79af7576-3e94-4a4c-b48d-582a7d6cfe37/move","msg":"No valid authentication found"}
{"level":30,"time":1764880188353,"env":"test","module":"user-credentials-repository","userId":"x40l3_UCZ50y_iNoeLvhl","msg":"User credentials created"}
{"level":30,"time":1764880188353,"env":"test","module":"auth-routes","userId":"x40l3_UCZ50y_iNoeLvhl","email":"test-workflows-H8DqFBp7IBg0BoAyL6mkI@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880188451,"env":"test","error":{},"workflowId":"793869b3-9afb-465d-aca3-58f0c74b5bdd","userId":"x40l3_UCZ50y_iNoeLvhl","projectId":"ee5507a4-cf01-4f8e-8653-809275f39a75","msg":"Error moving workflow"}
{"level":50,"time":1764880188837,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"d522484f-d494-4934-92c8-9efcaf033059","userId":"btELX6ZWzmbc88niHfkC0","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880189220,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9df85545-1e14-4af2-8763-732ba619059d","userId":"btELX6ZWzmbc88niHfkC0","msg":"Error moving workflow"}
{"level":30,"time":1764880189764,"env":"test","module":"user-credentials-repository","userId":"M9Cz_Oy2Rz3o-xjt4jsok","msg":"User credentials created"}
{"level":30,"time":1764880189765,"env":"test","module":"auth-routes","userId":"M9Cz_Oy2Rz3o-xjt4jsok","email":"test-workflows-1NO5YRd-q84qm8DT8J0ve@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880189966,"env":"test","module":"auth-routes","userId":"M9Cz_Oy2Rz3o-xjt4jsok","email":"test-workflows-1NO5YRd-q84qm8DT8J0ve@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880190178,"env":"test","error":{},"workflowId":"55aa78de-836b-4204-89db-cabff9380290","userId":"btELX6ZWzmbc88niHfkC0","projectId":"0205b796-c6bb-4f8e-9701-b15e03a6660c","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10863[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 801[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 959[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:25
[2m   Duration [22m 23.93s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880193695,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880195567,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880197294,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880197294,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880197305,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880197305,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880197306,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880197306,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880197755,"env":"test","module":"user-credentials-repository","userId":"vYyGN_a8M-oDhtuiR8NUr","msg":"User credentials created"}
{"level":30,"time":1764880197758,"env":"test","module":"auth-routes","userId":"vYyGN_a8M-oDhtuiR8NUr","email":"test-workflows-hfVOE3Zko1mV_uXaRy1fA@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"45dc3c4a-27d8-449c-af53-078b74e1171b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"vYyGN_a8M-oDhtuiR8NUr","tenantId":"6fe6c954-5060-4cfc-b4e7-5db29f26e3e2","createdBy":"vYyGN_a8M-oDhtuiR8NUr","ownerId":"vYyGN_a8M-oDhtuiR8NUr","status":"active","archived":false,"createdAt":"2025-12-04T20:29:59.472Z","updatedAt":"2025-12-04T20:29:59.472Z"}

{"level":30,"time":1764880198423,"env":"test","module":"user-credentials-repository","userId":"I-TfOy8v2hyl_8fJ14utb","msg":"User credentials created"}
{"level":30,"time":1764880198423,"env":"test","module":"auth-routes","userId":"I-TfOy8v2hyl_8fJ14utb","email":"viewer-7jJ_kyIBr4oqDyK_x60Jl@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880198518,"env":"test","module":"rbac-middleware","userId":"I-TfOy8v2hyl_8fJ14utb","userRole":"viewer","permission":"workflow:create","path":"/projects/45dc3c4a-27d8-449c-af53-078b74e1171b/workflows","msg":"Permission denied"}
{"level":50,"time":1764880204978,"env":"test","error":{},"workflowId":"8c229285-f86e-4836-9757-8f54acf6f180","userId":"vYyGN_a8M-oDhtuiR8NUr","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880205306,"env":"test","module":"auth-middleware","path":"/api/workflows/c0b10b42-6c60-4785-b278-750dbec1b84d/move","msg":"No valid authentication found"}
{"level":30,"time":1764880205817,"env":"test","module":"user-credentials-repository","userId":"lHoNequpYqw1fljl8Xmdq","msg":"User credentials created"}
{"level":30,"time":1764880205818,"env":"test","module":"auth-routes","userId":"lHoNequpYqw1fljl8Xmdq","email":"test-workflows-cefzleEzOuUsFhmgflXsP@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880205909,"env":"test","error":{},"workflowId":"0d672c9d-ca42-4c6f-a31e-8d20763bf1c7","userId":"lHoNequpYqw1fljl8Xmdq","projectId":"f56d42b6-e4cb-461c-886a-3e8bdcae840b","msg":"Error moving workflow"}
{"level":50,"time":1764880206091,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(vYyGN_a8M-oDhtuiR8NUr) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"vYyGN_a8M-oDhtuiR8NUr","msg":"Error creating workflow"}
{"level":50,"time":1764880206261,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(vYyGN_a8M-oDhtuiR8NUr) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"vYyGN_a8M-oDhtuiR8NUr","msg":"Error creating workflow"}
{"level":50,"time":1764880206442,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(vYyGN_a8M-oDhtuiR8NUr) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"vYyGN_a8M-oDhtuiR8NUr","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 9414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 320[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 669[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 863[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 327[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 604[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 181[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 170[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 181[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:50
[2m   Duration [22m 15.49s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/steps.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764880218755,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880222492,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880226886,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880226887,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880226896,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880226897,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880226897,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880226897,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880227445,"env":"test","module":"user-credentials-repository","userId":"wsX7GnQc2hYaT7ddEdsNe","msg":"User credentials created"}
{"level":30,"time":1764880227448,"env":"test","module":"auth-routes","userId":"wsX7GnQc2hYaT7ddEdsNe","email":"test-workflows-K6AP5IYB2WRMtcx_oPkje@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"5918d031-42e7-474e-8305-9c229e9985fc","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"wsX7GnQc2hYaT7ddEdsNe","tenantId":"f5dc9bb7-6f5c-4c8f-ab5e-f2dc63ea6712","createdBy":"wsX7GnQc2hYaT7ddEdsNe","ownerId":"wsX7GnQc2hYaT7ddEdsNe","status":"active","archived":false,"createdAt":"2025-12-04T20:30:29.174Z","updatedAt":"2025-12-04T20:30:29.174Z"}

{"level":30,"time":1764880228143,"env":"test","module":"user-credentials-repository","userId":"Km-U5bVctrmNkWGuNIyNG","msg":"User credentials created"}
{"level":30,"time":1764880228144,"env":"test","module":"auth-routes","userId":"Km-U5bVctrmNkWGuNIyNG","email":"viewer-ko4cgKH1Wirt0x2kVyY0U@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880228241,"env":"test","module":"rbac-middleware","userId":"Km-U5bVctrmNkWGuNIyNG","userRole":"viewer","permission":"workflow:create","path":"/projects/5918d031-42e7-474e-8305-9c229e9985fc/workflows","msg":"Permission denied"}
{"level":50,"time":1764880234627,"env":"test","error":{},"workflowId":"87d515d0-e30c-433a-8aff-202043e37272","userId":"wsX7GnQc2hYaT7ddEdsNe","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880234975,"env":"test","module":"auth-middleware","path":"/api/workflows/d5f322ba-2ab8-41b8-867a-2eecba64258b/move","msg":"No valid authentication found"}
{"level":30,"time":1764880235487,"env":"test","module":"user-credentials-repository","userId":"HacJxx3RfmOX8lp0fPAdh","msg":"User credentials created"}
{"level":30,"time":1764880235487,"env":"test","module":"auth-routes","userId":"HacJxx3RfmOX8lp0fPAdh","email":"test-workflows-dIbi_8J7tqRXU8gnGm0gD@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880235589,"env":"test","error":{},"workflowId":"4c1b6792-1d02-48de-9aa9-944905ce2c4b","userId":"HacJxx3RfmOX8lp0fPAdh","projectId":"dffcf217-6cb6-4815-b246-e8d0ce76514e","msg":"Error moving workflow"}
{"level":50,"time":1764880235969,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"a1ea501f-be2b-4f39-a61e-8d0acadba6ba","userId":"wsX7GnQc2hYaT7ddEdsNe","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880236327,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"5f39879d-a107-4a45-863c-438273a779cb","userId":"wsX7GnQc2hYaT7ddEdsNe","msg":"Error moving workflow"}
{"level":30,"time":1764880236834,"env":"test","module":"user-credentials-repository","userId":"kqT8f2Yw2cvW460ntCic0","msg":"User credentials created"}
{"level":30,"time":1764880236835,"env":"test","module":"auth-routes","userId":"kqT8f2Yw2cvW460ntCic0","email":"test-workflows-8KZQuScMdKPi7eeVGTQw2@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880236974,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764880237018,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"08ed30fd-8e5a-4869-9bfc-222eaf1276d8","userId":"wsX7GnQc2hYaT7ddEdsNe","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10400[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 807[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 618[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 764[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 347[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 358[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 692[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:14
[2m   Duration [22m 21.60s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx26 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764880255969,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880260093,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880263415,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880263415,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880263431,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880263431,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880263432,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880263432,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880264026,"env":"test","module":"user-credentials-repository","userId":"AkUhCLCbqJeSV9zgZwXAa","msg":"User credentials created"}
{"level":30,"time":1764880264029,"env":"test","module":"auth-routes","userId":"AkUhCLCbqJeSV9zgZwXAa","email":"test-workflows-8YdtihUqBPFMPUKKNs4kp@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e641d6c1-cf0d-408c-989b-356b5c154a39","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"AkUhCLCbqJeSV9zgZwXAa","tenantId":"238ec3aa-43ae-4aac-af68-56e8afba3e32","createdBy":"AkUhCLCbqJeSV9zgZwXAa","ownerId":"AkUhCLCbqJeSV9zgZwXAa","status":"active","archived":false,"createdAt":"2025-12-04T20:31:05.755Z","updatedAt":"2025-12-04T20:31:05.755Z"}

{"level":30,"time":1764880264782,"env":"test","module":"user-credentials-repository","userId":"Ax-36NmUf6mc2c5ykTbao","msg":"User credentials created"}
{"level":30,"time":1764880264783,"env":"test","module":"auth-routes","userId":"Ax-36NmUf6mc2c5ykTbao","email":"viewer-XSHdgh0BNZ_3JHhnECcA6@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880264879,"env":"test","module":"rbac-middleware","userId":"Ax-36NmUf6mc2c5ykTbao","userRole":"viewer","permission":"workflow:create","path":"/projects/e641d6c1-cf0d-408c-989b-356b5c154a39/workflows","msg":"Permission denied"}
{"level":50,"time":1764880271287,"env":"test","error":{},"workflowId":"718542b2-6f0f-498b-819d-7a203aad72dd","userId":"AkUhCLCbqJeSV9zgZwXAa","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880271616,"env":"test","module":"auth-middleware","path":"/api/workflows/f460ede7-72de-47b1-a762-097964e230dc/move","msg":"No valid authentication found"}
{"level":30,"time":1764880272132,"env":"test","module":"user-credentials-repository","userId":"BehZoUOI-D0akaLxrv1qQ","msg":"User credentials created"}
{"level":30,"time":1764880272133,"env":"test","module":"auth-routes","userId":"BehZoUOI-D0akaLxrv1qQ","email":"test-workflows-Y-9lpLgd5myT7W8qOOKNI@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880272186,"env":"test","error":{},"workflowId":"f0569e94-3a2f-4191-827f-b94c55242449","userId":"BehZoUOI-D0akaLxrv1qQ","projectId":"dc0dd175-420a-4c2b-beca-dda2ba6258eb","msg":"Error moving workflow"}
{"level":50,"time":1764880272565,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"c03be69b-f399-4a43-b4fb-8f5ff646df8e","userId":"AkUhCLCbqJeSV9zgZwXAa","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880272958,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ca0b248f-da7b-4e5f-9d13-fd0e372cc561","userId":"AkUhCLCbqJeSV9zgZwXAa","msg":"Error moving workflow"}
{"level":30,"time":1764880273474,"env":"test","module":"user-credentials-repository","userId":"1_4E6h1ieEJ26BY65plq5","msg":"User credentials created"}
{"level":30,"time":1764880273475,"env":"test","module":"auth-routes","userId":"1_4E6h1ieEJ26BY65plq5","email":"test-workflows-fXX2JfQ60PcOZsagtjJHk@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880273690,"env":"test","module":"auth-routes","userId":"1_4E6h1ieEJ26BY65plq5","email":"test-workflows-fXX2JfQ60PcOZsagtjJHk@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880273874,"env":"test","error":{},"workflowId":"4bd17df2-c73c-45fd-ad35-67567288619a","userId":"AkUhCLCbqJeSV9zgZwXAa","projectId":"3974f185-6c8a-4bdb-b761-9aadd107f1a3","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10729[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 654[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 784[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 917[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:52
[2m   Duration [22m 21.35s

Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx27 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764880278202,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880281080,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880285182,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880285182,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880285205,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880285206,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880285211,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880285211,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880285764,"env":"test","module":"user-credentials-repository","userId":"ry-Tk7vqdQx8b88sw_n97","msg":"User credentials created"}
{"level":30,"time":1764880285768,"env":"test","module":"auth-routes","userId":"ry-Tk7vqdQx8b88sw_n97","email":"test-workflows-T1uts5c7GSwCDqrvPrtCO@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d9ac8fb0-6365-4c20-b0f1-c4ffc324a89c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ry-Tk7vqdQx8b88sw_n97","tenantId":"00d31347-7b82-47d4-8866-f85646366b93","createdBy":"ry-Tk7vqdQx8b88sw_n97","ownerId":"ry-Tk7vqdQx8b88sw_n97","status":"active","archived":false,"createdAt":"2025-12-04T20:31:27.494Z","updatedAt":"2025-12-04T20:31:27.494Z"}

{"level":30,"time":1764880286485,"env":"test","module":"user-credentials-repository","userId":"Pdesh48H5cf5SubEVhhuN","msg":"User credentials created"}
{"level":30,"time":1764880286485,"env":"test","module":"auth-routes","userId":"Pdesh48H5cf5SubEVhhuN","email":"viewer-BPLzZElPsg7gging459gO@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880286585,"env":"test","module":"rbac-middleware","userId":"Pdesh48H5cf5SubEVhhuN","userRole":"viewer","permission":"workflow:create","path":"/projects/d9ac8fb0-6365-4c20-b0f1-c4ffc324a89c/workflows","msg":"Permission denied"}
{"level":50,"time":1764880293160,"env":"test","error":{},"workflowId":"bcf428ee-f1df-4fb0-bd69-eb4baff35ba9","userId":"ry-Tk7vqdQx8b88sw_n97","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880293517,"env":"test","module":"auth-middleware","path":"/api/workflows/fb1a90e2-8c6d-4f0e-ba3b-d7b8e6cb04d4/move","msg":"No valid authentication found"}
{"level":30,"time":1764880294158,"env":"test","module":"user-credentials-repository","userId":"U6JciK_V0fn3cQBr8q1CB","msg":"User credentials created"}
{"level":30,"time":1764880294159,"env":"test","module":"auth-routes","userId":"U6JciK_V0fn3cQBr8q1CB","email":"test-workflows-x-vifohPf79h-FCzLNwH7@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880294266,"env":"test","error":{},"workflowId":"20bafda6-6e0f-41fd-89ca-b4d7acf219a9","userId":"U6JciK_V0fn3cQBr8q1CB","projectId":"1e4a32f7-0406-425a-a857-eeecefcc6846","msg":"Error moving workflow"}
{"level":50,"time":1764880294642,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"59bc263e-5d66-4a17-89da-851d9704c36e","userId":"ry-Tk7vqdQx8b88sw_n97","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880295042,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"737394e5-7b8e-4c52-9eeb-611569884a62","userId":"ry-Tk7vqdQx8b88sw_n97","msg":"Error moving workflow"}
{"level":30,"time":1764880295583,"env":"test","module":"user-credentials-repository","userId":"m-HV3_KSMzSJwvGQzjB28","msg":"User credentials created"}
{"level":30,"time":1764880295584,"env":"test","module":"auth-routes","userId":"m-HV3_KSMzSJwvGQzjB28","email":"test-workflows-1TkGYSkYYtj6Aj3j5KbSA@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880295788,"env":"test","module":"auth-routes","userId":"m-HV3_KSMzSJwvGQzjB28","email":"test-workflows-1TkGYSkYYtj6Aj3j5KbSA@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880295988,"env":"test","error":{},"workflowId":"9ad5075e-da73-4d7b-a5b0-d1072c3acd54","userId":"ry-Tk7vqdQx8b88sw_n97","projectId":"b1a06729-305c-4205-98b7-ce78288670ae","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11054[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 504[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 825[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 618[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 829[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 357[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 400[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 946[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:14
[2m   Duration [22m 20.90s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx28 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764880300501,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880302841,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880305608,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880305609,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880305623,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880305624,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880305624,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880305624,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880306154,"env":"test","module":"user-credentials-repository","userId":"tuxMge0G0vxSIjjW9gYvT","msg":"User credentials created"}
{"level":30,"time":1764880306160,"env":"test","module":"auth-routes","userId":"tuxMge0G0vxSIjjW9gYvT","email":"test-workflows-OT214MFjGUC-by6LqHqKc@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a2d8d91c-0e80-46f3-8575-f84f2476593b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"tuxMge0G0vxSIjjW9gYvT","tenantId":"59831ac2-8923-47f7-b4c6-2ef465414501","createdBy":"tuxMge0G0vxSIjjW9gYvT","ownerId":"tuxMge0G0vxSIjjW9gYvT","status":"active","archived":false,"createdAt":"2025-12-04T20:31:47.893Z","updatedAt":"2025-12-04T20:31:47.893Z"}

{"level":30,"time":1764880306860,"env":"test","module":"user-credentials-repository","userId":"AqI0_QMYzjUSa3BeWQvD-","msg":"User credentials created"}
{"level":30,"time":1764880306861,"env":"test","module":"auth-routes","userId":"AqI0_QMYzjUSa3BeWQvD-","email":"viewer-P0rI30ZCOTaPn7j7R2vbz@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880306951,"env":"test","module":"rbac-middleware","userId":"AqI0_QMYzjUSa3BeWQvD-","userRole":"viewer","permission":"workflow:create","path":"/projects/a2d8d91c-0e80-46f3-8575-f84f2476593b/workflows","msg":"Permission denied"}
{"level":50,"time":1764880313328,"env":"test","error":{},"workflowId":"0d9a3bd4-faa8-4cc9-8af9-35207e4456bf","userId":"tuxMge0G0vxSIjjW9gYvT","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880313670,"env":"test","module":"auth-middleware","path":"/api/workflows/b5a50624-6e75-4189-a971-58b5aa66e2e0/move","msg":"No valid authentication found"}
{"level":30,"time":1764880314209,"env":"test","module":"user-credentials-repository","userId":"z9XRJzzalKQAWionL5_LB","msg":"User credentials created"}
{"level":30,"time":1764880314210,"env":"test","module":"auth-routes","userId":"z9XRJzzalKQAWionL5_LB","email":"test-workflows-aNEMs5NnAmdYd8Rgy_tpO@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880314262,"env":"test","error":{},"workflowId":"e9477b2b-58bd-4425-a8d9-bff9215509a8","userId":"z9XRJzzalKQAWionL5_LB","projectId":"e20479e1-4500-4cef-826d-994aacf35bbc","msg":"Error moving workflow"}
{"level":50,"time":1764880314642,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"eded418e-a56d-4737-9fb5-e996c0b21cae","userId":"tuxMge0G0vxSIjjW9gYvT","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880315188,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"20362719-e511-44a8-85da-10463eb12e8b","userId":"tuxMge0G0vxSIjjW9gYvT","msg":"Error moving workflow"}
{"level":30,"time":1764880315712,"env":"test","module":"user-credentials-repository","userId":"USMHjaosMldgNgPXeZ-qX","msg":"User credentials created"}
{"level":30,"time":1764880315713,"env":"test","module":"auth-routes","userId":"USMHjaosMldgNgPXeZ-qX","email":"test-workflows-Jedb_bOr_1ZoKE3oMB_D4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880315909,"env":"test","module":"auth-routes","userId":"USMHjaosMldgNgPXeZ-qX","email":"test-workflows-Jedb_bOr_1ZoKE3oMB_D4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880316099,"env":"test","error":{},"workflowId":"7f32cbdb-d6fc-434f-b0ef-d94c26058710","userId":"tuxMge0G0vxSIjjW9gYvT","projectId":"c5a8a1bf-8eda-43e7-9fc9-50fb461c3ab4","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10850[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 297[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 547[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 913[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7
[2m   Start at [22m 14:31:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

[2m   Duration [22m 19.25s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx29 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764880320794,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880324028,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880327684,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880327685,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880327698,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880327698,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880327698,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880327698,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880328170,"env":"test","module":"user-credentials-repository","userId":"1Ok2RFGIXMxLikx6nrZaT","msg":"User credentials created"}
{"level":30,"time":1764880328174,"env":"test","module":"auth-routes","userId":"1Ok2RFGIXMxLikx6nrZaT","email":"test-workflows-Bcnel4MLco1eijJs3sZ3x@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b3e36c24-2a4a-484f-b74a-c7ae5340152b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"1Ok2RFGIXMxLikx6nrZaT","tenantId":"766eb299-18b9-4ac5-a124-df977063ea2e","createdBy":"1Ok2RFGIXMxLikx6nrZaT","ownerId":"1Ok2RFGIXMxLikx6nrZaT","status":"active","archived":false,"createdAt":"2025-12-04T20:32:09.905Z","updatedAt":"2025-12-04T20:32:09.905Z"}

{"level":30,"time":1764880328873,"env":"test","module":"user-credentials-repository","userId":"kcmNhgcSYrp57giIdeUpx","msg":"User credentials created"}
{"level":30,"time":1764880328874,"env":"test","module":"auth-routes","userId":"kcmNhgcSYrp57giIdeUpx","email":"viewer-3ZD-QM84-Z5Qxs2GU6Kbh@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880328969,"env":"test","module":"rbac-middleware","userId":"kcmNhgcSYrp57giIdeUpx","userRole":"viewer","permission":"workflow:create","path":"/projects/b3e36c24-2a4a-484f-b74a-c7ae5340152b/workflows","msg":"Permission denied"}
{"level":50,"time":1764880335226,"env":"test","error":{},"workflowId":"c77beae6-9a25-4b82-b3ea-8a66481dea3c","userId":"1Ok2RFGIXMxLikx6nrZaT","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880335537,"env":"test","module":"auth-middleware","path":"/api/workflows/cc3f27bf-d584-45af-9ade-1baa2b9f0606/move","msg":"No valid authentication found"}
{"level":30,"time":1764880336042,"env":"test","module":"user-credentials-repository","userId":"sSSQL6kyFUNhKC1OeCzQn","msg":"User credentials created"}
{"level":30,"time":1764880336042,"env":"test","module":"auth-routes","userId":"sSSQL6kyFUNhKC1OeCzQn","email":"test-workflows-wO6-0Nsvb_xgh1kKUpuPT@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880336085,"env":"test","error":{},"workflowId":"14f3eedf-7b4a-473c-8d35-302560297c5c","userId":"sSSQL6kyFUNhKC1OeCzQn","projectId":"6da56d4c-f3a2-4055-b157-06117d946db5","msg":"Error moving workflow"}
{"level":50,"time":1764880336453,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6cecc337-3363-4ef1-ae8b-870fecf28a10","userId":"1Ok2RFGIXMxLikx6nrZaT","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880336823,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bfa70241-6c87-4329-8236-4d2af8674361","userId":"1Ok2RFGIXMxLikx6nrZaT","msg":"Error moving workflow"}
{"level":30,"time":1764880337318,"env":"test","module":"user-credentials-repository","userId":"pN9FlX5uWp5WzAZygViFw","msg":"User credentials created"}
{"level":30,"time":1764880337319,"env":"test","module":"auth-routes","userId":"pN9FlX5uWp5WzAZygViFw","email":"test-workflows-nHbiz0vsknCBRBugBxG1v@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880337504,"env":"test","module":"auth-routes","userId":"pN9FlX5uWp5WzAZygViFw","email":"test-workflows-nHbiz0vsknCBRBugBxG1v@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880337711,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"3cba19b8-2141-4569-97b0-c93b91ef2d90","userId":"1Ok2RFGIXMxLikx6nrZaT","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10274[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 340[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 297[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 588[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 762[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 548[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 890[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10

    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:56
[2m   Duration [22m 20.46s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx30 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764880372246,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880374906,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880378298,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880378299,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880378311,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880378311,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880378312,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880378312,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880378835,"env":"test","module":"user-credentials-repository","userId":"0VAbfiIcUFNRjAQgjT06l","msg":"User credentials created"}
{"level":30,"time":1764880378839,"env":"test","module":"auth-routes","userId":"0VAbfiIcUFNRjAQgjT06l","email":"test-workflows-mDxb2OZ9WXZ8tonWqpJ7-@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"434c88e4-63c4-4529-ac34-d71545f1b4a3","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"0VAbfiIcUFNRjAQgjT06l","tenantId":"a3600e26-2754-4056-892b-2ae86f098f77","createdBy":"0VAbfiIcUFNRjAQgjT06l","ownerId":"0VAbfiIcUFNRjAQgjT06l","status":"active","archived":false,"createdAt":"2025-12-04T20:33:00.567Z","updatedAt":"2025-12-04T20:33:00.567Z"}

{"level":30,"time":1764880379527,"env":"test","module":"user-credentials-repository","userId":"ZjjTIGLZi4GH4_-zXdOUw","msg":"User credentials created"}
{"level":30,"time":1764880379528,"env":"test","module":"auth-routes","userId":"ZjjTIGLZi4GH4_-zXdOUw","email":"viewer-jeP-BygrrO7XjoSzmgvcK@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880379627,"env":"test","module":"rbac-middleware","userId":"ZjjTIGLZi4GH4_-zXdOUw","userRole":"viewer","permission":"workflow:create","path":"/projects/434c88e4-63c4-4529-ac34-d71545f1b4a3/workflows","msg":"Permission denied"}
{"level":50,"time":1764880385872,"env":"test","error":{},"workflowId":"e13cd6f5-aba2-4699-a80c-5b3c55e070e8","userId":"0VAbfiIcUFNRjAQgjT06l","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880386185,"env":"test","module":"auth-middleware","path":"/api/workflows/d751bc2c-b60a-4373-8e94-88b96c50812c/move","msg":"No valid authentication found"}
{"level":30,"time":1764880386761,"env":"test","module":"user-credentials-repository","userId":"0bQK33-xUDz8HWFKkWaSA","msg":"User credentials created"}
{"level":30,"time":1764880386761,"env":"test","module":"auth-routes","userId":"0bQK33-xUDz8HWFKkWaSA","email":"test-workflows-1Cc47g9gnjpB8KS_rPzT4@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880386804,"env":"test","error":{},"workflowId":"6f50c92f-b998-4c0c-8808-e4a8555417bd","userId":"0bQK33-xUDz8HWFKkWaSA","projectId":"032f8d23-833f-45ec-985c-edc09a8f5cdd","msg":"Error moving workflow"}
{"level":50,"time":1764880387176,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f0a06b67-1778-4038-b738-778b12adab2d","userId":"0VAbfiIcUFNRjAQgjT06l","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880387552,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"cf66ce73-5360-46da-92e6-f0fb7d669961","userId":"0VAbfiIcUFNRjAQgjT06l","msg":"Error moving workflow"}
{"level":30,"time":1764880388049,"env":"test","module":"user-credentials-repository","userId":"m851b9dtAGPcji1kKbbYb","msg":"User credentials created"}
{"level":30,"time":1764880388050,"env":"test","module":"auth-routes","userId":"m851b9dtAGPcji1kKbbYb","email":"test-workflows-KR03HssVrUEy9g419aAMc@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880388234,"env":"test","module":"auth-routes","userId":"m851b9dtAGPcji1kKbbYb","email":"test-workflows-KR03HssVrUEy9g419aAMc@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880388418,"env":"test","error":{},"workflowId":"19b5f8b4-0ea0-4f64-9e1b-9e1201e14fdf","userId":"0VAbfiIcUFNRjAQgjT06l","projectId":"c17a0163-2e42-4a6c-9902-9b03b2fa19c2","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 319[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 311[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 372[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 376[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 867[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:32:47
[2m   Duration [22m 19.91s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx31 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764891574100,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764891577898,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764891581838,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764891581838,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764891581848,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764891581848,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764891581849,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764891581849,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764891582605,"env":"test","module":"user-credentials-repository","userId":"XA49EvYVXbm35P7Q2lt3R","msg":"User credentials created"}
{"level":30,"time":1764891582610,"env":"test","module":"auth-routes","userId":"XA49EvYVXbm35P7Q2lt3R","email":"test-workflows-8xUmIxYAed5QGPrEOKoPA@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"aeda5e89-a783-4e29-8cf0-829e68ab2750","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"XA49EvYVXbm35P7Q2lt3R","tenantId":"c57307f0-db74-4807-99df-0d26a3a4380b","createdBy":"XA49EvYVXbm35P7Q2lt3R","ownerId":"XA49EvYVXbm35P7Q2lt3R","status":"active","archived":false,"createdAt":"2025-12-04T23:39:44.526Z","updatedAt":"2025-12-04T23:39:44.526Z"}

{"level":30,"time":1764891583319,"env":"test","module":"user-credentials-repository","userId":"KcsHEd3mglE8jCqrCTfmL","msg":"User credentials created"}
{"level":30,"time":1764891583320,"env":"test","module":"auth-routes","userId":"KcsHEd3mglE8jCqrCTfmL","email":"viewer-Lt0IpCtum49yb-eFPBvUe@example.com","msg":"User registered successfully"}
{"level":40,"time":1764891583421,"env":"test","module":"rbac-middleware","userId":"KcsHEd3mglE8jCqrCTfmL","userRole":"viewer","permission":"workflow:create","path":"/projects/aeda5e89-a783-4e29-8cf0-829e68ab2750/workflows","msg":"Permission denied"}
{"level":50,"time":1764891589627,"env":"test","error":{},"workflowId":"4bfc27c6-51a6-4a53-aee2-56380cb65bc2","userId":"XA49EvYVXbm35P7Q2lt3R","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764891589947,"env":"test","module":"auth-middleware","path":"/api/workflows/15627b49-ed3c-4e53-a293-3495e78eb2af/move","msg":"No valid authentication found"}
{"level":30,"time":1764891590457,"env":"test","module":"user-credentials-repository","userId":"bAjWB1NdrK3nTl0pSyUbl","msg":"User credentials created"}
{"level":30,"time":1764891590457,"env":"test","module":"auth-routes","userId":"bAjWB1NdrK3nTl0pSyUbl","email":"test-workflows-e72GnR8UmQshKcpgx_OMN@example.com","msg":"User registered successfully"}
{"level":50,"time":1764891590504,"env":"test","error":{},"workflowId":"73dc9e7a-796a-4378-973a-d76c28c38e87","userId":"bAjWB1NdrK3nTl0pSyUbl","projectId":"063ed38d-38b0-4edf-b0c3-b827d381299f","msg":"Error moving workflow"}
{"level":50,"time":1764891590875,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f2764f68-1768-4001-aa2b-eee101ee2cbc","userId":"XA49EvYVXbm35P7Q2lt3R","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764891591240,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"68117323-aca3-44e4-9391-c49bb79c551c","userId":"XA49EvYVXbm35P7Q2lt3R","msg":"Error moving workflow"}
{"level":30,"time":1764891591746,"env":"test","module":"user-credentials-repository","userId":"bqf6hYtm8yN386FXfxQOp","msg":"User credentials created"}
{"level":30,"time":1764891591747,"env":"test","module":"auth-routes","userId":"bqf6hYtm8yN386FXfxQOp","email":"test-workflows-zrmSJpTkwQwMn7qKMtSK0@example.com","msg":"User registered successfully"}
{"level":30,"time":1764891591943,"env":"test","module":"auth-routes","userId":"bqf6hYtm8yN386FXfxQOp","email":"test-workflows-zrmSJpTkwQwMn7qKMtSK0@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764891592192,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a5ab9489-f942-4bd8-a94e-e40fbd333a6a","userId":"XA49EvYVXbm35P7Q2lt3R","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 729[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 643[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 319[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 953[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:39:28
[2m   Duration [22m 23.03s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/auth.ts [22m[34mx32 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764892165619,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892169973,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892174345,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892174346,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892174356,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892174356,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892174356,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892174356,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892174821,"env":"test","module":"user-credentials-repository","userId":"uX-2mI0Pfc9b_kvbt5iwT","msg":"User credentials created"}
{"level":30,"time":1764892174824,"env":"test","module":"auth-routes","userId":"uX-2mI0Pfc9b_kvbt5iwT","email":"test-workflows-HTjwFWx9h3jR8c6hYJurT@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"cd38fd95-175a-4ded-987f-0fd9b735ffd7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"uX-2mI0Pfc9b_kvbt5iwT","tenantId":"07dc440b-1edd-4c94-b819-8c91c88b8bda","createdBy":"uX-2mI0Pfc9b_kvbt5iwT","ownerId":"uX-2mI0Pfc9b_kvbt5iwT","status":"active","archived":false,"createdAt":"2025-12-04T23:49:36.756Z","updatedAt":"2025-12-04T23:49:36.756Z"}

{"level":30,"time":1764892175547,"env":"test","module":"user-credentials-repository","userId":"9nOPVxmQgBOBsO9Pvng12","msg":"User credentials created"}
{"level":30,"time":1764892175548,"env":"test","module":"auth-routes","userId":"9nOPVxmQgBOBsO9Pvng12","email":"viewer-T1GmWeBl1IjCyVM6LO_wj@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892175658,"env":"test","module":"rbac-middleware","userId":"9nOPVxmQgBOBsO9Pvng12","userRole":"viewer","permission":"workflow:create","path":"/projects/cd38fd95-175a-4ded-987f-0fd9b735ffd7/workflows","msg":"Permission denied"}
{"level":50,"time":1764892182317,"env":"test","error":{},"workflowId":"73bbc3e2-0378-4c58-a593-744b3ebac5c4","userId":"uX-2mI0Pfc9b_kvbt5iwT","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892182643,"env":"test","module":"auth-middleware","path":"/api/workflows/c1229c6a-7bc3-48a7-86fb-870ff426916a/move","msg":"No valid authentication found"}
{"level":30,"time":1764892183163,"env":"test","module":"user-credentials-repository","userId":"QlJdXMJZG6ldsnnoDRA-0","msg":"User credentials created"}
{"level":30,"time":1764892183163,"env":"test","module":"auth-routes","userId":"QlJdXMJZG6ldsnnoDRA-0","email":"test-workflows-gFtV7_oeT9SHt5YBvw_un@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892183215,"env":"test","error":{},"workflowId":"8f12a693-67b8-40b3-852b-c11937bd70cc","userId":"QlJdXMJZG6ldsnnoDRA-0","projectId":"77b0eac0-bb16-428a-9f78-51db5cc47607","msg":"Error moving workflow"}
{"level":50,"time":1764892183579,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"980baf09-6ccf-4434-9215-0363048d6178","userId":"uX-2mI0Pfc9b_kvbt5iwT","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892183963,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e38d84ca-5a49-4aba-a3fb-9c45e89f2ef8","userId":"uX-2mI0Pfc9b_kvbt5iwT","msg":"Error moving workflow"}
{"level":30,"time":1764892184489,"env":"test","module":"user-credentials-repository","userId":"B4qZRlodFhUV8LPxhx_EA","msg":"User credentials created"}
{"level":30,"time":1764892184489,"env":"test","module":"auth-routes","userId":"B4qZRlodFhUV8LPxhx_EA","email":"test-workflows-TJbPdubHHQDvbwMlZq0qK@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892184681,"env":"test","module":"auth-routes","userId":"B4qZRlodFhUV8LPxhx_EA","email":"test-workflows-TJbPdubHHQDvbwMlZq0qK@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892184856,"env":"test","error":{},"workflowId":"d2d97e4c-7783-46e4-bd91-33073326db31","userId":"uX-2mI0Pfc9b_kvbt5iwT","projectId":"0da9a544-1d82-4d57-bbf3-87bd2b7e29aa","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10780[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 808[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 1033[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 384[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 893[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:49:20
[2m   Duration [22m 23.86s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx33 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764892480167,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892482838,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892486356,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892486356,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892486370,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892486370,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892486371,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892486371,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892487040,"env":"test","module":"user-credentials-repository","userId":"I6CQPN6uDbGH1KbsM2G9v","msg":"User credentials created"}
{"level":30,"time":1764892487043,"env":"test","module":"auth-routes","userId":"I6CQPN6uDbGH1KbsM2G9v","email":"test-workflows-qWndtb1TbHSSkI-JqNXNX@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"49184e85-36b8-4550-8ce4-b80ebdaea7a7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"I6CQPN6uDbGH1KbsM2G9v","tenantId":"0cedf358-61f1-48af-8626-6870e3d75b8e","createdBy":"I6CQPN6uDbGH1KbsM2G9v","ownerId":"I6CQPN6uDbGH1KbsM2G9v","status":"active","archived":false,"createdAt":"2025-12-04T23:54:48.970Z","updatedAt":"2025-12-04T23:54:48.970Z"}

{"level":30,"time":1764892487733,"env":"test","module":"user-credentials-repository","userId":"gXbL6sZd9Lq-ilZ8PSzGI","msg":"User credentials created"}
{"level":30,"time":1764892487734,"env":"test","module":"auth-routes","userId":"gXbL6sZd9Lq-ilZ8PSzGI","email":"viewer-EjbPSgaFJy9uV65mQ1TdG@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892487825,"env":"test","module":"rbac-middleware","userId":"gXbL6sZd9Lq-ilZ8PSzGI","userRole":"viewer","permission":"workflow:create","path":"/projects/49184e85-36b8-4550-8ce4-b80ebdaea7a7/workflows","msg":"Permission denied"}
{"level":50,"time":1764892494052,"env":"test","error":{},"workflowId":"7e5b44f9-53fd-47cb-9e04-d6d2ce6c1452","userId":"I6CQPN6uDbGH1KbsM2G9v","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892494391,"env":"test","module":"auth-middleware","path":"/api/workflows/deeec6dc-2496-4ce5-a902-5cc81e48ef23/move","msg":"No valid authentication found"}
{"level":30,"time":1764892494916,"env":"test","module":"user-credentials-repository","userId":"5kCGPe3xjynSJn6uwd71o","msg":"User credentials created"}
{"level":30,"time":1764892494916,"env":"test","module":"auth-routes","userId":"5kCGPe3xjynSJn6uwd71o","email":"test-workflows-3-CaTS7GHV8QqVIaP1gRJ@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892494973,"env":"test","error":{},"workflowId":"ffedbc70-711e-42ac-b280-8571581ba0ae","userId":"5kCGPe3xjynSJn6uwd71o","projectId":"47bab010-10c2-44ad-8634-d2a1e2540ef4","msg":"Error moving workflow"}
{"level":50,"time":1764892495360,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8e87f345-69c3-4f06-9b42-4d597d4fed40","userId":"I6CQPN6uDbGH1KbsM2G9v","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892495742,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2741173e-11cc-4c62-87a1-467e60a4f793","userId":"I6CQPN6uDbGH1KbsM2G9v","msg":"Error moving workflow"}
{"level":30,"time":1764892496245,"env":"test","module":"user-credentials-repository","userId":"WMdQjaBLgGNpjG5B0izyN","msg":"User credentials created"}
{"level":30,"time":1764892496245,"env":"test","module":"auth-routes","userId":"WMdQjaBLgGNpjG5B0izyN","email":"test-workflows-2SGscYwEiiYd5aX-_aPvd@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892496448,"env":"test","module":"auth-routes","userId":"WMdQjaBLgGNpjG5B0izyN","email":"test-workflows-2SGscYwEiiYd5aX-_aPvd@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892496648,"env":"test","error":{},"workflowId":"785b88b4-face-4d56-8f4a-72e5a7d4e8d8","userId":"I6CQPN6uDbGH1KbsM2G9v","projectId":"27891378-0d3c-4ad4-8fe5-107c01f373ae","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 678[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 386[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 906[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:36
[2m   Duration [22m 19.82s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx34 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764892500970,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892504060,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892506264,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892506265,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892506284,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892506285,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892506286,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892506286,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892506833,"env":"test","module":"user-credentials-repository","userId":"TVL-VcSQlrVCuzdk5SsBX","msg":"User credentials created"}
{"level":30,"time":1764892506838,"env":"test","module":"auth-routes","userId":"TVL-VcSQlrVCuzdk5SsBX","email":"test-workflows-GOhCFXC6e7MSwK-95tv2z@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9627d0b8-e8b0-4e0e-be42-5a6a76d11da2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"TVL-VcSQlrVCuzdk5SsBX","tenantId":"761cd877-1f66-4235-a76a-93808781941e","createdBy":"TVL-VcSQlrVCuzdk5SsBX","ownerId":"TVL-VcSQlrVCuzdk5SsBX","status":"active","archived":false,"createdAt":"2025-12-04T23:55:08.785Z","updatedAt":"2025-12-04T23:55:08.785Z"}

{"level":30,"time":1764892507566,"env":"test","module":"user-credentials-repository","userId":"2GzrlqugI-M-ALhRunZce","msg":"User credentials created"}
{"level":30,"time":1764892507567,"env":"test","module":"auth-routes","userId":"2GzrlqugI-M-ALhRunZce","email":"viewer-8vWkYIDKuoMx--74fEQ3i@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892507658,"env":"test","module":"rbac-middleware","userId":"2GzrlqugI-M-ALhRunZce","userRole":"viewer","permission":"workflow:create","path":"/projects/9627d0b8-e8b0-4e0e-be42-5a6a76d11da2/workflows","msg":"Permission denied"}
{"level":50,"time":1764892514264,"env":"test","error":{},"workflowId":"14b1f61f-722d-4e6b-aec8-c05b1c513ac2","userId":"TVL-VcSQlrVCuzdk5SsBX","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892514613,"env":"test","module":"auth-middleware","path":"/api/workflows/3ea50aa9-c017-41e2-a8cf-d77ffe4bd263/move","msg":"No valid authentication found"}
{"level":30,"time":1764892515164,"env":"test","module":"user-credentials-repository","userId":"10qX9HV29XGW9HVNwKVqD","msg":"User credentials created"}
{"level":30,"time":1764892515165,"env":"test","module":"auth-routes","userId":"10qX9HV29XGW9HVNwKVqD","email":"test-workflows-bPwzLUKrxeSdOjb-GvAz9@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892515212,"env":"test","error":{},"workflowId":"281e6700-03eb-4647-a04e-ab4dd4828abf","userId":"10qX9HV29XGW9HVNwKVqD","projectId":"83b2f00f-55b8-4987-ae6b-e0fb029686bd","msg":"Error moving workflow"}
{"level":50,"time":1764892515595,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7b574877-b0c9-4e3c-9f82-2ed39972fa97","userId":"TVL-VcSQlrVCuzdk5SsBX","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892515983,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d4b97840-846f-4f50-be0f-af341e827b30","userId":"TVL-VcSQlrVCuzdk5SsBX","msg":"Error moving workflow"}
{"level":30,"time":1764892516518,"env":"test","module":"user-credentials-repository","userId":"zv0emhfSztAsz6Cvd2OjA","msg":"User credentials created"}
{"level":30,"time":1764892516519,"env":"test","module":"auth-routes","userId":"zv0emhfSztAsz6Cvd2OjA","email":"test-workflows-FKuA_9uXzKRJEzOfoCoej@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892516615,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764892516663,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"14c4d2e4-1a54-4012-b250-6b89aac5ea0f","userId":"TVL-VcSQlrVCuzdk5SsBX","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10678[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 356[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 841[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 675[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 682[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:57
[2m   Duration [22m 19.37s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx35 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764895077438,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895080801,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895084773,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895084773,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895084783,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895084784,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895084784,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895084784,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895085328,"env":"test","module":"user-credentials-repository","userId":"MRtGqufbIERfUfrJ0T-Jy","msg":"User credentials created"}
{"level":30,"time":1764895085332,"env":"test","module":"auth-routes","userId":"MRtGqufbIERfUfrJ0T-Jy","email":"test-workflows-W64DhueNAk8-DYkE0WnGW@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d6dfa4d7-c6a8-4ba5-a09e-b6f6429d454d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"MRtGqufbIERfUfrJ0T-Jy","tenantId":"73de09ee-f180-4b5f-9f6e-b2117c76e729","createdBy":"MRtGqufbIERfUfrJ0T-Jy","ownerId":"MRtGqufbIERfUfrJ0T-Jy","status":"active","archived":false,"createdAt":"2025-12-05T00:38:05.503Z","updatedAt":"2025-12-05T00:38:05.503Z"}

{"level":30,"time":1764895086017,"env":"test","module":"user-credentials-repository","userId":"CeA4BgTrZkAczVQgzJfHO","msg":"User credentials created"}
{"level":30,"time":1764895086018,"env":"test","module":"auth-routes","userId":"CeA4BgTrZkAczVQgzJfHO","email":"viewer-GZVCnI0IE-5dcOqA4KEUe@example.com","msg":"User registered successfully"}
{"level":40,"time":1764895086103,"env":"test","module":"rbac-middleware","userId":"CeA4BgTrZkAczVQgzJfHO","userRole":"viewer","permission":"workflow:create","path":"/projects/d6dfa4d7-c6a8-4ba5-a09e-b6f6429d454d/workflows","msg":"Permission denied"}
{"level":50,"time":1764895092153,"env":"test","error":{},"workflowId":"34a57914-9508-449b-8004-c9b15768d8a3","userId":"MRtGqufbIERfUfrJ0T-Jy","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764895092465,"env":"test","module":"auth-middleware","path":"/api/workflows/3f304a49-0582-4817-a37d-be8a9c7bb890/move","msg":"No valid authentication found"}
{"level":30,"time":1764895092970,"env":"test","module":"user-credentials-repository","userId":"Rs4hwh4aLR0tHAb9c8CRx","msg":"User credentials created"}
{"level":30,"time":1764895092971,"env":"test","module":"auth-routes","userId":"Rs4hwh4aLR0tHAb9c8CRx","email":"test-workflows-sqyIQPNuyH85GXOYg8gTU@example.com","msg":"User registered successfully"}
{"level":50,"time":1764895093013,"env":"test","error":{},"workflowId":"0e3e6c37-eb6e-4fc5-a91f-d71266bcee39","userId":"Rs4hwh4aLR0tHAb9c8CRx","projectId":"65e5e0d2-eaa7-47c4-98ff-cf7acaef4065","msg":"Error moving workflow"}
{"level":50,"time":1764895093375,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2a12bef7-e42d-4edc-8fd7-6554e3e687dc","userId":"MRtGqufbIERfUfrJ0T-Jy","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764895093724,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b98daa37-c565-469e-a73d-8d23d67d7a0e","userId":"MRtGqufbIERfUfrJ0T-Jy","msg":"Error moving workflow"}
{"level":30,"time":1764895094307,"env":"test","module":"user-credentials-repository","userId":"H5nB3CmxcW8sFlNGKra7-","msg":"User credentials created"}
{"level":30,"time":1764895094307,"env":"test","module":"auth-routes","userId":"H5nB3CmxcW8sFlNGKra7-","email":"test-workflows-ek4VX-QFpf9eyyUUUiVDD@example.com","msg":"User registered successfully"}
{"level":30,"time":1764895094491,"env":"test","module":"auth-routes","userId":"H5nB3CmxcW8sFlNGKra7-","email":"test-workflows-ek4VX-QFpf9eyyUUUiVDD@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764895094659,"env":"test","error":{},"workflowId":"57d47103-9b85-4a5a-beee-9e8fe02e5acb","userId":"MRtGqufbIERfUfrJ0T-Jy","projectId":"afe2580c-4cdf-4b57-8f41-71430414e8a3","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10147[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 298[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 420[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 548[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 349[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 937[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 18:37:52
[2m   Duration [22m 21.18s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
