npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764868452721,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868454090,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868455326,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868455327,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868455335,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868455335,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868455336,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868455336,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868455762,"env":"test","module":"user-credentials-repository","userId":"jronpMXi39d9uyAZUlOGX","msg":"User credentials created"}
{"level":30,"time":1764868455764,"env":"test","module":"auth-routes","userId":"jronpMXi39d9uyAZUlOGX","email":"test-workflows-KnKG_77QING3evSNdBBMH@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"72e4038f-e722-4c21-9d55-e8768429558a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"jronpMXi39d9uyAZUlOGX","tenantId":"77026238-d73b-4b87-83f7-41b92209dd10","createdBy":"jronpMXi39d9uyAZUlOGX","ownerId":"jronpMXi39d9uyAZUlOGX","status":"active","archived":false,"createdAt":"2025-12-04T17:14:17.266Z","updatedAt":"2025-12-04T17:14:17.266Z"}

{"level":30,"time":1764868456366,"env":"test","module":"user-credentials-repository","userId":"A9OoveWcZUfJqDSBJ_7m2","msg":"User credentials created"}
{"level":30,"time":1764868456367,"env":"test","module":"auth-routes","userId":"A9OoveWcZUfJqDSBJ_7m2","email":"viewer-Pcuv7EUZks2DcdUBHnmRt@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868456450,"env":"test","module":"rbac-middleware","userId":"A9OoveWcZUfJqDSBJ_7m2","userRole":"viewer","permission":"workflow:create","path":"/projects/72e4038f-e722-4c21-9d55-e8768429558a/workflows","msg":"Permission denied"}
{"level":50,"time":1764868462103,"env":"test","error":{},"workflowId":"84ce5d54-4b84-4949-972a-08a5a8568517","userId":"jronpMXi39d9uyAZUlOGX","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868462410,"env":"test","module":"auth-middleware","path":"/api/workflows/cf9c2b91-5d23-4c22-b8c6-07d973290e65/move","msg":"No valid authentication found"}
{"level":30,"time":1764868462872,"env":"test","module":"user-credentials-repository","userId":"ecifCkxTd8THoImQVVhBx","msg":"User credentials created"}
{"level":30,"time":1764868462873,"env":"test","module":"auth-routes","userId":"ecifCkxTd8THoImQVVhBx","email":"test-workflows-adk0fwsfGVdUa2lUvN1z3@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868462916,"env":"test","error":{},"workflowId":"dbb23165-9edd-4dfe-8f53-edf0c778eee7","userId":"ecifCkxTd8THoImQVVhBx","projectId":"7ce2692a-d777-4294-a920-461574150138","msg":"Error moving workflow"}
{"level":50,"time":1764868463259,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"89c7940e-6495-4d1a-9dff-6a307b4463ab","userId":"jronpMXi39d9uyAZUlOGX","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868463599,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"508b19a5-0a23-41f2-a5dc-ff510baeecc1","userId":"jronpMXi39d9uyAZUlOGX","msg":"Error moving workflow"}
{"level":30,"time":1764868464068,"env":"test","module":"user-credentials-repository","userId":"LLCAfeUUi4CjNXMAWIirw","msg":"User credentials created"}
{"level":30,"time":1764868464068,"env":"test","module":"auth-routes","userId":"LLCAfeUUi4CjNXMAWIirw","email":"test-workflows-tYxaXwkHYQ9lry_EM1Dfv@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868464246,"env":"test","module":"auth-routes","userId":"LLCAfeUUi4CjNXMAWIirw","email":"test-workflows-tYxaXwkHYQ9lry_EM1Dfv@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868464416,"env":"test","error":{},"workflowId":"de01477c-e3c7-4e54-acfa-74e417e0faed","userId":"jronpMXi39d9uyAZUlOGX","projectId":"90740a2d-afef-4036-ad96-058b6a47a6eb","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9343[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create a new draft workflow[32m 296[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 262[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 652[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 543[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 674[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 422[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 507[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 817[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:14:10
[2m   Duration [22m 14.56s[2m (transform 2.06s, setup 755ms, collect 3.81s, tests 9.34s, environment 0ms, prepare 17ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764868528646,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531219,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533452,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533452,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533464,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533464,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533465,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533465,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868533905,"env":"test","module":"user-credentials-repository","userId":"NWmPNFue8lX_esnaWdzcV","msg":"User credentials created"}
{"level":30,"time":1764868533908,"env":"test","module":"auth-routes","userId":"NWmPNFue8lX_esnaWdzcV","email":"test-workflows-Da2zk8xXcnmRprPAFsmJb@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"17d15577-601f-419d-abe0-685ecbd678b1","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"NWmPNFue8lX_esnaWdzcV","tenantId":"a6049027-e451-4225-a244-027b1aec1dba","createdBy":"NWmPNFue8lX_esnaWdzcV","ownerId":"NWmPNFue8lX_esnaWdzcV","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.427Z","updatedAt":"2025-12-04T17:15:35.427Z"}

{"level":30,"time":1764868534598,"env":"test","module":"user-credentials-repository","userId":"Ec2v3YPEifCOfS3uiy74H","msg":"User credentials created"}
{"level":30,"time":1764868534599,"env":"test","module":"auth-routes","userId":"Ec2v3YPEifCOfS3uiy74H","email":"viewer-GgPL2WgSjBjbvkMy-Ic8R@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534693,"env":"test","module":"rbac-middleware","userId":"Ec2v3YPEifCOfS3uiy74H","userRole":"viewer","permission":"workflow:create","path":"/projects/17d15577-601f-419d-abe0-685ecbd678b1/workflows","msg":"Permission denied"}
{"level":50,"time":1764868541165,"env":"test","error":{},"workflowId":"6eee7071-d663-4989-9cc6-d448af597098","userId":"NWmPNFue8lX_esnaWdzcV","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541486,"env":"test","module":"auth-middleware","path":"/api/workflows/ec1359d7-c054-48be-b276-61ef89f55a82/move","msg":"No valid authentication found"}
{"level":30,"time":1764868542006,"env":"test","module":"user-credentials-repository","userId":"pYMZQESsUUlTsjSRrwnYv","msg":"User credentials created"}
{"level":30,"time":1764868542006,"env":"test","module":"auth-routes","userId":"pYMZQESsUUlTsjSRrwnYv","email":"test-workflows-fL1bXz_KJi3-srjKCSOEu@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868542057,"env":"test","error":{},"workflowId":"1af3e187-d8a1-488e-89bc-6f6c3c14090e","userId":"pYMZQESsUUlTsjSRrwnYv","projectId":"f4464928-6d3b-482a-b751-f31de7720e53","msg":"Error moving workflow"}
{"level":50,"time":1764868542531,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"4c3a334a-37c0-4861-b82d-e307223a2873","userId":"NWmPNFue8lX_esnaWdzcV","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868543094,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"54f1523c-bba1-4018-b773-54088c81fe51","userId":"NWmPNFue8lX_esnaWdzcV","msg":"Error moving workflow"}
{"level":50,"time":1764868543642,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CmYQf5yomItQHKAydFPXF) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"CmYQf5yomItQHKAydFPXF","msg":"Failed to create user credentials"}
{"level":50,"time":1764868543642,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CmYQf5yomItQHKAydFPXF) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 819[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 564[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 549[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 18.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764868816397,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818574,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820614,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820615,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820626,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820626,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820626,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820626,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821099,"env":"test","module":"user-credentials-repository","userId":"nxvpxX8TB5uHi_C51IOCT","msg":"User credentials created"}
{"level":30,"time":1764868821102,"env":"test","module":"auth-routes","userId":"nxvpxX8TB5uHi_C51IOCT","email":"test-workflows-ZjjtvK9GoZora7FSeFGmT@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7cf3d005-bbab-49f7-a2b5-642e24d4197a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"nxvpxX8TB5uHi_C51IOCT","tenantId":"157fc869-d570-4fbc-9411-0f859cc36b76","createdBy":"nxvpxX8TB5uHi_C51IOCT","ownerId":"nxvpxX8TB5uHi_C51IOCT","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.624Z","updatedAt":"2025-12-04T17:20:22.624Z"}

{"level":30,"time":1764868821775,"env":"test","module":"user-credentials-repository","userId":"IvIQnzzwTQcIogYvA_Gt7","msg":"User credentials created"}
{"level":30,"time":1764868821775,"env":"test","module":"auth-routes","userId":"IvIQnzzwTQcIogYvA_Gt7","email":"viewer-_-vpU0z3anSvk7-y7kb1w@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821875,"env":"test","module":"rbac-middleware","userId":"IvIQnzzwTQcIogYvA_Gt7","userRole":"viewer","permission":"workflow:create","path":"/projects/7cf3d005-bbab-49f7-a2b5-642e24d4197a/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828301,"env":"test","error":{},"workflowId":"ca99dbf7-8ac0-4e75-b9c5-8a545cd03597","userId":"nxvpxX8TB5uHi_C51IOCT","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828643,"env":"test","module":"auth-middleware","path":"/api/workflows/b60390c8-6a50-4b46-a248-8f0016bb454a/move","msg":"No valid authentication found"}
{"level":30,"time":1764868829177,"env":"test","module":"user-credentials-repository","userId":"ZV_eIaBoL1ZJ2wrgAEx3f","msg":"User credentials created"}
{"level":30,"time":1764868829178,"env":"test","module":"auth-routes","userId":"ZV_eIaBoL1ZJ2wrgAEx3f","email":"test-workflows-1o-AcufDqIILJ6zvNC2S2@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868829227,"env":"test","error":{},"workflowId":"25cc836f-36a7-4a73-b2c4-52d661c8f099","userId":"ZV_eIaBoL1ZJ2wrgAEx3f","projectId":"03fd77e0-08d4-4106-ae31-8feb4fdf3469","msg":"Error moving workflow"}
{"level":50,"time":1764868829591,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"024815c3-a32b-4464-a0c9-6ebf36e8d2d0","userId":"nxvpxX8TB5uHi_C51IOCT","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868830007,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"210b0583-279f-41c2-9343-8ede30b7e2b2","userId":"nxvpxX8TB5uHi_C51IOCT","msg":"Error moving workflow"}
{"level":30,"time":1764868830518,"env":"test","module":"user-credentials-repository","userId":"l2JKtVA4PVWqVc2T9in_X","msg":"User credentials created"}
{"level":30,"time":1764868830519,"env":"test","module":"auth-routes","userId":"l2JKtVA4PVWqVc2T9in_X","email":"test-workflows-mBh6lyW5B3-7077Y3o20L@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830711,"env":"test","module":"auth-routes","userId":"l2JKtVA4PVWqVc2T9in_X","email":"test-workflows-mBh6lyW5B3-7077Y3o20L@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868830895,"env":"test","error":{},"workflowId":"df09abe6-4e85-40e0-a2f2-84e7533e9a0d","userId":"nxvpxX8TB5uHi_C51IOCT","projectId":"579efefd-b68a-4b5c-9c10-122d9e5ebbf3","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 493[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 668[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 416[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 891[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.51s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764871632896,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871636442,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871641145,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871641146,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871641160,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871641161,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871641161,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871641161,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871641786,"env":"test","module":"user-credentials-repository","userId":"ACl_QcmASYWmnI6nChmER","msg":"User credentials created"}
{"level":30,"time":1764871641789,"env":"test","module":"auth-routes","userId":"ACl_QcmASYWmnI6nChmER","email":"test-workflows-Iy6zXVrNOhvNi5z9G4ftF@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7e3fc834-cc95-4995-a71f-08f358fe005f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ACl_QcmASYWmnI6nChmER","tenantId":"2d785adc-5afb-40ed-b194-e401a167a322","createdBy":"ACl_QcmASYWmnI6nChmER","ownerId":"ACl_QcmASYWmnI6nChmER","status":"active","archived":false,"createdAt":"2025-12-04T18:07:23.377Z","updatedAt":"2025-12-04T18:07:23.377Z"}

{"level":30,"time":1764871642513,"env":"test","module":"user-credentials-repository","userId":"G8aGeV3PLerHrXMFddf41","msg":"User credentials created"}
{"level":30,"time":1764871642514,"env":"test","module":"auth-routes","userId":"G8aGeV3PLerHrXMFddf41","email":"viewer--Q3YSlCeEuw9RHBDvYIAx@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871642621,"env":"test","module":"rbac-middleware","userId":"G8aGeV3PLerHrXMFddf41","userRole":"viewer","permission":"workflow:create","path":"/projects/7e3fc834-cc95-4995-a71f-08f358fe005f/workflows","msg":"Permission denied"}
{"level":50,"time":1764871649080,"env":"test","error":{},"workflowId":"f10abbed-2d63-4083-bf89-18dd67f20986","userId":"ACl_QcmASYWmnI6nChmER","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871649411,"env":"test","module":"auth-middleware","path":"/api/workflows/407542c7-0f94-4f9d-affc-9b9dbd3506d9/move","msg":"No valid authentication found"}
{"level":30,"time":1764871649959,"env":"test","module":"user-credentials-repository","userId":"bqvfTI949urAIfZdONTl2","msg":"User credentials created"}
{"level":30,"time":1764871649960,"env":"test","module":"auth-routes","userId":"bqvfTI949urAIfZdONTl2","email":"test-workflows-i1022KNJICbHY4DSnjDxz@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871650004,"env":"test","error":{},"workflowId":"4b87b235-3b54-41d8-9e3c-3209f466c124","userId":"bqvfTI949urAIfZdONTl2","projectId":"b782767b-48fb-490b-9929-5e294ee963dd","msg":"Error moving workflow"}
{"level":50,"time":1764871650379,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"80450a1f-52ab-45f8-8145-cfb8268d5478","userId":"ACl_QcmASYWmnI6nChmER","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871650760,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"637706eb-8a37-4c6e-ba1e-797567ea91a8","userId":"ACl_QcmASYWmnI6nChmER","msg":"Error moving workflow"}
{"level":30,"time":1764871651283,"env":"test","module":"user-credentials-repository","userId":"5fo9TUWLEjfS62UCN5DRy","msg":"User credentials created"}
{"level":30,"time":1764871651283,"env":"test","module":"auth-routes","userId":"5fo9TUWLEjfS62UCN5DRy","email":"test-workflows-QLtdiN6MRumAtdeQmuq2q@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871651484,"env":"test","module":"auth-routes","userId":"5fo9TUWLEjfS62UCN5DRy","email":"test-workflows-QLtdiN6MRumAtdeQmuq2q@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871651746,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9d2437eb-7cc3-4d12-b4f0-35d045c49459","userId":"ACl_QcmASYWmnI6nChmER","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10891[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 496[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 835[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 380[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 988[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 22.39s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764871702561,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871705886,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871709579,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871709579,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871709595,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871709595,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871709595,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871709595,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710076,"env":"test","module":"user-credentials-repository","userId":"Lb1IvjMswQIaV_z_bArzC","msg":"User credentials created"}
{"level":30,"time":1764871710080,"env":"test","module":"auth-routes","userId":"Lb1IvjMswQIaV_z_bArzC","email":"test-workflows-9NURHMGhtQLZxkvt-vjwz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"00c5d42e-d910-4d2c-aaf8-e5b7d3d248b2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Lb1IvjMswQIaV_z_bArzC","tenantId":"b96f347a-de27-4c4b-ad9a-cb615bfef454","createdBy":"Lb1IvjMswQIaV_z_bArzC","ownerId":"Lb1IvjMswQIaV_z_bArzC","status":"active","archived":false,"createdAt":"2025-12-04T18:08:31.656Z","updatedAt":"2025-12-04T18:08:31.656Z"}

{"level":30,"time":1764871710759,"env":"test","module":"user-credentials-repository","userId":"POK-v7fBHxeb65qXNUneF","msg":"User credentials created"}
{"level":30,"time":1764871710760,"env":"test","module":"auth-routes","userId":"POK-v7fBHxeb65qXNUneF","email":"viewer-EGY3NLnNt5uE4o3IywHpF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871710857,"env":"test","module":"rbac-middleware","userId":"POK-v7fBHxeb65qXNUneF","userRole":"viewer","permission":"workflow:create","path":"/projects/00c5d42e-d910-4d2c-aaf8-e5b7d3d248b2/workflows","msg":"Permission denied"}
{"level":50,"time":1764871716857,"env":"test","error":{},"workflowId":"71c7f407-87d3-4b4d-a872-53c6230d2715","userId":"Lb1IvjMswQIaV_z_bArzC","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871717168,"env":"test","module":"auth-middleware","path":"/api/workflows/eb93ef25-a922-4308-a8e6-698cb2ae2f46/move","msg":"No valid authentication found"}
{"level":30,"time":1764871717679,"env":"test","module":"user-credentials-repository","userId":"wAbioq1Tatv1rhFdvg1CK","msg":"User credentials created"}
{"level":30,"time":1764871717679,"env":"test","module":"auth-routes","userId":"wAbioq1Tatv1rhFdvg1CK","email":"test-workflows-tF7d9sCqFU_QWQdA9Pw-_@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871717730,"env":"test","error":{},"workflowId":"e3bcf3a1-29ad-439a-8c5e-9ffe542e6c9c","userId":"wAbioq1Tatv1rhFdvg1CK","projectId":"c01ede62-366d-490a-a7bd-8b67cfd7f1ad","msg":"Error moving workflow"}
{"level":50,"time":1764871718106,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"e4cdc9fe-18da-4b5f-838b-64d78f2cb7f0","userId":"Lb1IvjMswQIaV_z_bArzC","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871718482,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d6dcb286-b9a5-4a4b-b032-1bd9e7d59d11","userId":"Lb1IvjMswQIaV_z_bArzC","msg":"Error moving workflow"}
{"level":30,"time":1764871718988,"env":"test","module":"user-credentials-repository","userId":"t1u-xJD4MjD4YjJIfcAhR","msg":"User credentials created"}
{"level":30,"time":1764871718989,"env":"test","module":"auth-routes","userId":"t1u-xJD4MjD4YjJIfcAhR","email":"test-workflows-JC6XIX_3b1ulLgjIaqBNh@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871719184,"env":"test","module":"auth-routes","userId":"t1u-xJD4MjD4YjJIfcAhR","email":"test-workflows-JC6XIX_3b1ulLgjIaqBNh@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871719358,"env":"test","error":{},"workflowId":"b9c70c10-1baf-44dd-af90-b1da61f25aaf","userId":"Lb1IvjMswQIaV_z_bArzC","projectId":"8a0ef240-c58c-435b-a9fe-95eaa8b03746","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10069[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 681[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 439[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 879[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 21.17s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764871753395,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871758083,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871761016,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871761016,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871761035,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871761035,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871761035,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871761035,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871761498,"env":"test","module":"user-credentials-repository","userId":"xARH86DgzQclOABHM21yJ","msg":"User credentials created"}
{"level":30,"time":1764871761502,"env":"test","module":"auth-routes","userId":"xARH86DgzQclOABHM21yJ","email":"test-workflows-ijBmeJ2VAqRkxhs4SaPs-@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c4660126-d760-4434-97b4-a1613305c85f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"xARH86DgzQclOABHM21yJ","tenantId":"953328d8-5506-43cc-a1ef-20c68640847b","createdBy":"xARH86DgzQclOABHM21yJ","ownerId":"xARH86DgzQclOABHM21yJ","status":"active","archived":false,"createdAt":"2025-12-04T18:09:23.076Z","updatedAt":"2025-12-04T18:09:23.076Z"}

{"level":30,"time":1764871762175,"env":"test","module":"user-credentials-repository","userId":"LpVYlRcvNmAKMyFP0r-SE","msg":"User credentials created"}
{"level":30,"time":1764871762176,"env":"test","module":"auth-routes","userId":"LpVYlRcvNmAKMyFP0r-SE","email":"viewer-E9pSafrK-P2kY1YKFV7LB@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871762278,"env":"test","module":"rbac-middleware","userId":"LpVYlRcvNmAKMyFP0r-SE","userRole":"viewer","permission":"workflow:create","path":"/projects/c4660126-d760-4434-97b4-a1613305c85f/workflows","msg":"Permission denied"}
{"level":50,"time":1764871768255,"env":"test","error":{},"workflowId":"c4db2d68-285d-4825-b6b5-1776c3cadc32","userId":"xARH86DgzQclOABHM21yJ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871768567,"env":"test","module":"auth-middleware","path":"/api/workflows/9f9622c8-2497-4ea2-b6f7-d966cd892cad/move","msg":"No valid authentication found"}
{"level":30,"time":1764871769088,"env":"test","module":"user-credentials-repository","userId":"i3ttRCLXkgGtvExIztvPe","msg":"User credentials created"}
{"level":30,"time":1764871769089,"env":"test","module":"auth-routes","userId":"i3ttRCLXkgGtvExIztvPe","email":"test-workflows-Yh4Ni-ov2Aw_NZyKivEg_@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871769139,"env":"test","error":{},"workflowId":"77228ff3-916f-4c5e-b4fa-9b6b3188de33","userId":"i3ttRCLXkgGtvExIztvPe","projectId":"c620ea69-0c8c-4164-a04b-941dbcc3532b","msg":"Error moving workflow"}
{"level":50,"time":1764871769493,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3b429e17-57d0-4bb0-9208-922195c1684f","userId":"xARH86DgzQclOABHM21yJ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871769839,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f5486232-46c4-4207-b864-c369be10b485","userId":"xARH86DgzQclOABHM21yJ","msg":"Error moving workflow"}
{"level":30,"time":1764871770355,"env":"test","module":"user-credentials-repository","userId":"mx38FXTfL85BMNnZsJcZ5","msg":"User credentials created"}
{"level":30,"time":1764871770356,"env":"test","module":"auth-routes","userId":"mx38FXTfL85BMNnZsJcZ5","email":"test-workflows-gXAG1s20SO6LAdFpdJgOG@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871770554,"env":"test","module":"auth-routes","userId":"mx38FXTfL85BMNnZsJcZ5","email":"test-workflows-gXAG1s20SO6LAdFpdJgOG@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871770788,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0f81fa73-962e-43b3-8423-e4bd33634d2e","userId":"xARH86DgzQclOABHM21yJ","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10055[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 720[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 951[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[2m   Duration [22m 21.42s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764873690148,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873694279,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873697764,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873697764,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873697776,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873697776,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873697776,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873697776,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873698278,"env":"test","module":"user-credentials-repository","userId":"LxKeI-y_sl_8CVTQ4aV9q","msg":"User credentials created"}
{"level":30,"time":1764873698281,"env":"test","module":"auth-routes","userId":"LxKeI-y_sl_8CVTQ4aV9q","email":"test-workflows-YRtyXLqS4ABZa3TT4i3yL@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"03806884-e042-4ca3-9f76-bbe4b021e3f0","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"LxKeI-y_sl_8CVTQ4aV9q","tenantId":"52947f65-2db2-4375-9b91-2ce10228de0a","createdBy":"LxKeI-y_sl_8CVTQ4aV9q","ownerId":"LxKeI-y_sl_8CVTQ4aV9q","status":"active","archived":false,"createdAt":"2025-12-04T18:41:39.895Z","updatedAt":"2025-12-04T18:41:39.895Z"}

{"level":30,"time":1764873698976,"env":"test","module":"user-credentials-repository","userId":"LuPf-w3AEUx4a8zaUt-XK","msg":"User credentials created"}
{"level":30,"time":1764873698977,"env":"test","module":"auth-routes","userId":"LuPf-w3AEUx4a8zaUt-XK","email":"viewer-oMDhstmpNUW-c7ZGWHyVN@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873699068,"env":"test","module":"rbac-middleware","userId":"LuPf-w3AEUx4a8zaUt-XK","userRole":"viewer","permission":"workflow:create","path":"/projects/03806884-e042-4ca3-9f76-bbe4b021e3f0/workflows","msg":"Permission denied"}
{"level":50,"time":1764873705533,"env":"test","error":{},"workflowId":"1247e617-131d-48a7-bba0-4d541d25fa6b","userId":"LxKeI-y_sl_8CVTQ4aV9q","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873705907,"env":"test","module":"auth-middleware","path":"/api/workflows/c6c2db92-4553-4ddb-a9f2-58b082b5b432/move","msg":"No valid authentication found"}
{"level":30,"time":1764873706463,"env":"test","module":"user-credentials-repository","userId":"yAuiVw0NjxvWUnXSGkatk","msg":"User credentials created"}
{"level":30,"time":1764873706464,"env":"test","module":"auth-routes","userId":"yAuiVw0NjxvWUnXSGkatk","email":"test-workflows-j_hOX8bAe0Rkyx-vCeeMc@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873706512,"env":"test","error":{},"workflowId":"84585b28-3137-4850-b21e-a6ed54b5f2c1","userId":"yAuiVw0NjxvWUnXSGkatk","projectId":"9ad1f6da-417e-4f06-87ab-2c2a0e912d04","msg":"Error moving workflow"}
{"level":50,"time":1764873706881,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"5113d183-09d5-44c2-8576-335375ccccb5","userId":"LxKeI-y_sl_8CVTQ4aV9q","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873707254,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"501288f1-fda5-4784-a807-8cd268caa539","userId":"LxKeI-y_sl_8CVTQ4aV9q","msg":"Error moving workflow"}
{"level":30,"time":1764873707913,"env":"test","module":"user-credentials-repository","userId":"AoOmtIEHIkYVLz8ShDkHM","msg":"User credentials created"}
{"level":30,"time":1764873707914,"env":"test","module":"auth-routes","userId":"AoOmtIEHIkYVLz8ShDkHM","email":"test-workflows-YkXaKEkHxwNB0RR3SlTeG@example.com","msg":"User registered successfully"}
{"level":30,"time":1764873708111,"env":"test","module":"auth-routes","userId":"AoOmtIEHIkYVLz8ShDkHM","email":"test-workflows-YkXaKEkHxwNB0RR3SlTeG@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764873708298,"env":"test","error":{},"workflowId":"01ab9c02-e755-40a1-8de5-170cf0444eba","userId":"LxKeI-y_sl_8CVTQ4aV9q","projectId":"cef3ba16-0576-4fd3-9620-81aea6f2b1e8","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 825[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 670[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 374[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1045[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 22.77s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764874578987,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874583796,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874590548,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874590548,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874590564,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874590564,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874590565,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874590565,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874591563,"env":"test","module":"user-credentials-repository","userId":"OElM8xeOehkJZNBB1hhXx","msg":"User credentials created"}
{"level":30,"time":1764874591567,"env":"test","module":"auth-routes","userId":"OElM8xeOehkJZNBB1hhXx","email":"test-workflows-BiqfevnXX_tf8LaAs8RHD@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"76b393dc-b58f-4112-ba58-6f70db254eee","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"OElM8xeOehkJZNBB1hhXx","tenantId":"d9036e1e-3557-486d-926c-bea78bc40f91","createdBy":"OElM8xeOehkJZNBB1hhXx","ownerId":"OElM8xeOehkJZNBB1hhXx","status":"active","archived":false,"createdAt":"2025-12-04T18:56:33.199Z","updatedAt":"2025-12-04T18:56:33.199Z"}

{"level":30,"time":1764874592417,"env":"test","module":"user-credentials-repository","userId":"VVpoxfqu7d1gFiQY_7Guk","msg":"User credentials created"}
{"level":30,"time":1764874592418,"env":"test","module":"auth-routes","userId":"VVpoxfqu7d1gFiQY_7Guk","email":"viewer-p3qk9wSA0qBnzwLqtIK27@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874592519,"env":"test","module":"rbac-middleware","userId":"VVpoxfqu7d1gFiQY_7Guk","userRole":"viewer","permission":"workflow:create","path":"/projects/76b393dc-b58f-4112-ba58-6f70db254eee/workflows","msg":"Permission denied"}
{"level":50,"time":1764874598994,"env":"test","error":{},"workflowId":"223ed08b-c2e6-41af-91fd-7c5f01e6c44e","userId":"OElM8xeOehkJZNBB1hhXx","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874599316,"env":"test","module":"auth-middleware","path":"/api/workflows/b0689dc0-6f61-4127-b8b5-6d321ed8899b/move","msg":"No valid authentication found"}
{"level":30,"time":1764874600094,"env":"test","module":"user-credentials-repository","userId":"igXLzR5xxMzZVkZSMEabx","msg":"User credentials created"}
{"level":30,"time":1764874600095,"env":"test","module":"auth-routes","userId":"igXLzR5xxMzZVkZSMEabx","email":"test-workflows-iPiUu_lorpZ4yWhO4OQ2f@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874600143,"env":"test","error":{},"workflowId":"72c3dfa7-32de-4815-ba94-4e950c573c91","userId":"igXLzR5xxMzZVkZSMEabx","projectId":"65e40bfe-0120-407c-b581-853c72d9a6e4","msg":"Error moving workflow"}
{"level":50,"time":1764874600525,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"16f4045b-c4b9-4f18-81f6-da3b5b9cd479","userId":"OElM8xeOehkJZNBB1hhXx","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874600915,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bf22a8aa-b827-4a5b-abd6-27e49eae43bc","userId":"OElM8xeOehkJZNBB1hhXx","msg":"Error moving workflow"}
{"level":30,"time":1764874601508,"env":"test","module":"user-credentials-repository","userId":"2C1L7Coy2UmXb6iPzCHV4","msg":"User credentials created"}
{"level":30,"time":1764874601509,"env":"test","module":"auth-routes","userId":"2C1L7Coy2UmXb6iPzCHV4","email":"test-workflows-Ujodcaju6g8S5BOx5-iUS@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874601704,"env":"test","module":"auth-routes","userId":"2C1L7Coy2UmXb6iPzCHV4","email":"test-workflows-Ujodcaju6g8S5BOx5-iUS@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874601892,"env":"test","error":{},"workflowId":"6d9b44d9-916e-453f-b29b-8c5a9bcffdfc","userId":"OElM8xeOehkJZNBB1hhXx","projectId":"359cedc5-d6df-4ac2-8d1f-7ba1e582aafc","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 11701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 805[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 673[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 755[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 826[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 391[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 979[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.54s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764874684448,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874690353,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874696571,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874696571,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874696580,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874696580,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874696581,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874696581,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874697108,"env":"test","module":"user-credentials-repository","userId":"w3sz0tvJ-pgWKuZ15FmFj","msg":"User credentials created"}
{"level":30,"time":1764874697112,"env":"test","module":"auth-routes","userId":"w3sz0tvJ-pgWKuZ15FmFj","email":"test-workflows-_rl26zfLIBzh16WIHv5F6@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3c6c6064-e63d-4761-8d5e-3dbd4d5b38ce","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"w3sz0tvJ-pgWKuZ15FmFj","tenantId":"012d9b63-099e-435e-a063-6c6c01078ded","createdBy":"w3sz0tvJ-pgWKuZ15FmFj","ownerId":"w3sz0tvJ-pgWKuZ15FmFj","status":"active","archived":false,"createdAt":"2025-12-04T18:58:18.734Z","updatedAt":"2025-12-04T18:58:18.734Z"}

{"level":30,"time":1764874697767,"env":"test","module":"user-credentials-repository","userId":"Cri_YTmUY2qi0mXuHPFql","msg":"User credentials created"}
{"level":30,"time":1764874697767,"env":"test","module":"auth-routes","userId":"Cri_YTmUY2qi0mXuHPFql","email":"viewer-CMn9oLwl-d1s__VWXY7OH@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874697858,"env":"test","module":"rbac-middleware","userId":"Cri_YTmUY2qi0mXuHPFql","userRole":"viewer","permission":"workflow:create","path":"/projects/3c6c6064-e63d-4761-8d5e-3dbd4d5b38ce/workflows","msg":"Permission denied"}
{"level":50,"time":1764874703827,"env":"test","error":{},"workflowId":"41f010c2-5041-4378-ad1f-2b8ffd80e221","userId":"w3sz0tvJ-pgWKuZ15FmFj","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874704136,"env":"test","module":"auth-middleware","path":"/api/workflows/6202e908-a7d1-44e1-af04-435cef75bc55/move","msg":"No valid authentication found"}
{"level":30,"time":1764874704623,"env":"test","module":"user-credentials-repository","userId":"SJjYjIXDkcZJ0FeNI5D4t","msg":"User credentials created"}
{"level":30,"time":1764874704624,"env":"test","module":"auth-routes","userId":"SJjYjIXDkcZJ0FeNI5D4t","email":"test-workflows-6fjLviobP9UoPSF1GVm8A@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874704668,"env":"test","error":{},"workflowId":"e5638604-d0f0-4ceb-91c4-9219c23522e6","userId":"SJjYjIXDkcZJ0FeNI5D4t","projectId":"1a19cdfb-02c6-4648-a87c-6877cd773d67","msg":"Error moving workflow"}
{"level":50,"time":1764874705032,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2d0709c3-2bd7-4657-861e-481c7c4b9db3","userId":"w3sz0tvJ-pgWKuZ15FmFj","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874705377,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"82937026-aa8a-49f9-bf28-dbb66e274be1","userId":"w3sz0tvJ-pgWKuZ15FmFj","msg":"Error moving workflow"}
{"level":30,"time":1764874705867,"env":"test","module":"user-credentials-repository","userId":"mg2vjzBMxK8pj5pYyTR_Z","msg":"User credentials created"}
{"level":30,"time":1764874705868,"env":"test","module":"auth-routes","userId":"mg2vjzBMxK8pj5pYyTR_Z","email":"test-workflows-VsTwx4nomEJs4w2sLons6@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874706056,"env":"test","module":"auth-routes","userId":"mg2vjzBMxK8pj5pYyTR_Z","email":"test-workflows-VsTwx4nomEJs4w2sLons6@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874706246,"env":"test","error":{},"workflowId":"0912aa7f-182d-4d50-8b0d-97c274c56240","userId":"w3sz0tvJ-pgWKuZ15FmFj","projectId":"e00d0568-fddc-4cb3-936d-d3482b8f276b","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10049[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 309[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 731[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 687[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 869[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 26.58s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
