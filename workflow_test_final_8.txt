npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764867171290,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867172758,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867173793,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867173794,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867173799,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867173799,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867173799,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867173799,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867174803,"env":"test","module":"user-credentials-repository","userId":"QRVaDltgkE4BMLmVYDD6X","msg":"User credentials created"}
{"level":30,"time":1764867174806,"env":"test","module":"auth-routes","userId":"QRVaDltgkE4BMLmVYDD6X","email":"test-workflows-gMrwHuDV6L2FFfUFQF_qQ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0c5d7be1-75b6-45a5-97eb-6a728bf07b4b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"QRVaDltgkE4BMLmVYDD6X","tenantId":"581e5800-9ff5-4960-aa34-69f383ac35fa","createdBy":"QRVaDltgkE4BMLmVYDD6X","ownerId":"QRVaDltgkE4BMLmVYDD6X","status":"active","archived":false,"createdAt":"2025-12-04T16:52:56.312Z","updatedAt":"2025-12-04T16:52:56.312Z"}

{"level":30,"time":1764867175804,"env":"test","module":"user-credentials-repository","userId":"LcMxECash8tGoHfdR9aMD","msg":"User credentials created"}
{"level":30,"time":1764867175804,"env":"test","module":"auth-routes","userId":"LcMxECash8tGoHfdR9aMD","email":"viewer-iFoITzZ493laU1wXhEEBV@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867175898,"env":"test","module":"rbac-middleware","userId":"LcMxECash8tGoHfdR9aMD","userRole":"viewer","permission":"workflow:create","path":"/projects/0c5d7be1-75b6-45a5-97eb-6a728bf07b4b/workflows","msg":"Permission denied"}
{"level":50,"time":1764867182567,"env":"test","error":{},"workflowId":"5e7aba6f-8e2c-4571-83be-eab8ffb4312f","userId":"QRVaDltgkE4BMLmVYDD6X","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867182908,"env":"test","module":"auth-middleware","path":"/api/workflows/e9f1d90d-63ec-4808-91e9-92765ad9024c/move","msg":"No valid authentication found"}
{"level":30,"time":1764867183442,"env":"test","module":"user-credentials-repository","userId":"7K2ifj0YW3o-Ymt2OArHA","msg":"User credentials created"}
{"level":30,"time":1764867183442,"env":"test","module":"auth-routes","userId":"7K2ifj0YW3o-Ymt2OArHA","email":"test-workflows-C6JXa2R2HSMAm0pvNxkrj@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867183490,"env":"test","error":{},"workflowId":"a5bf6936-193c-4c4d-9b26-2c048491a2b5","userId":"7K2ifj0YW3o-Ymt2OArHA","projectId":"4b8f1f98-2d5a-408d-bc82-1178928c234c","msg":"Error moving workflow"}
{"level":50,"time":1764867183865,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"92ed9a94-2889-40dc-aa8e-bd6f2eceecfc","userId":"QRVaDltgkE4BMLmVYDD6X","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867184270,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bc82a17f-1272-4d6d-a60d-1a22e4479b47","userId":"QRVaDltgkE4BMLmVYDD6X","msg":"Error moving workflow"}
{"level":30,"time":1764867184836,"env":"test","module":"user-credentials-repository","userId":"KAfTylh_JhK0qewtfKBQy","msg":"User credentials created"}
{"level":30,"time":1764867184837,"env":"test","module":"auth-routes","userId":"KAfTylh_JhK0qewtfKBQy","email":"test-workflows-NJaspX5s9oKKoKv-eKKHD@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867185028,"env":"test","module":"auth-routes","userId":"KAfTylh_JhK0qewtfKBQy","email":"test-workflows-NJaspX5s9oKKoKv-eKKHD@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867185223,"env":"test","error":{},"workflowId":"8c0fc487-626b-4f45-b9c3-69abee8b836d","userId":"QRVaDltgkE4BMLmVYDD6X","projectId":"48c6efd4-f5cd-475a-bbd4-725c69319663","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 12042[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 562[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 836[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 861[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 631[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 953[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:52:49
[2m   Duration [22m 16.63s[2m (transform 1.87s, setup 588ms, collect 3.54s, tests 12.04s, environment 0ms, prepare 13ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764867267350,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867268848,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867270503,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867270504,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867270514,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867270514,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867270515,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867270515,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867270975,"env":"test","module":"user-credentials-repository","userId":"t5ebUny5Oi7NG-671sX6g","msg":"User credentials created"}
{"level":30,"time":1764867270978,"env":"test","module":"auth-routes","userId":"t5ebUny5Oi7NG-671sX6g","email":"test-workflows-i1RZWvKJ1qyPPF9VFawPK@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0d520149-d998-4c05-8d46-bb583c3b7676","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"t5ebUny5Oi7NG-671sX6g","tenantId":"c73df396-78df-41a9-b276-6840342fb946","createdBy":"t5ebUny5Oi7NG-671sX6g","ownerId":"t5ebUny5Oi7NG-671sX6g","status":"active","archived":false,"createdAt":"2025-12-04T16:54:32.477Z","updatedAt":"2025-12-04T16:54:32.477Z"}

{"level":30,"time":1764867271718,"env":"test","module":"user-credentials-repository","userId":"ZbHk2HkrVZBIhgml2NODV","msg":"User credentials created"}
{"level":30,"time":1764867271720,"env":"test","module":"auth-routes","userId":"ZbHk2HkrVZBIhgml2NODV","email":"viewer-8e8S_cPAxd5ag8vi90ANO@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867271833,"env":"test","module":"rbac-middleware","userId":"ZbHk2HkrVZBIhgml2NODV","userRole":"viewer","permission":"workflow:create","path":"/projects/0d520149-d998-4c05-8d46-bb583c3b7676/workflows","msg":"Permission denied"}
{"level":50,"time":1764867279006,"env":"test","error":{},"workflowId":"e0b20377-a90b-41a6-a107-2f02d99d4dbc","userId":"t5ebUny5Oi7NG-671sX6g","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867279360,"env":"test","module":"auth-middleware","path":"/api/workflows/06f0989b-c543-496c-b77f-a06933e32077/move","msg":"No valid authentication found"}
{"level":30,"time":1764867279898,"env":"test","module":"user-credentials-repository","userId":"uT2J8vCouwQS27d5JFVyj","msg":"User credentials created"}
{"level":30,"time":1764867279899,"env":"test","module":"auth-routes","userId":"uT2J8vCouwQS27d5JFVyj","email":"test-workflows-qYOLUtqlbXwIdpbgvH1jY@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867279964,"env":"test","error":{},"workflowId":"071a2385-b4fa-4b03-b6e1-2891fa3df6a1","userId":"uT2J8vCouwQS27d5JFVyj","projectId":"3d7acfde-2419-4022-b8b5-d36506608e5b","msg":"Error moving workflow"}
{"level":50,"time":1764867280387,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ccd61501-53e7-488a-8570-08a246bef9c0","userId":"t5ebUny5Oi7NG-671sX6g","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867280789,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9422580d-21fd-4b04-b682-9adba1684045","userId":"t5ebUny5Oi7NG-671sX6g","msg":"Error moving workflow"}
{"level":30,"time":1764867281380,"env":"test","module":"user-credentials-repository","userId":"RO7rxfrMXH__KVl-j6CY6","msg":"User credentials created"}
{"level":30,"time":1764867281380,"env":"test","module":"auth-routes","userId":"RO7rxfrMXH__KVl-j6CY6","email":"test-workflows-NDKXm9k-PeevCLo_SjnRK@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867281584,"env":"test","module":"auth-routes","userId":"RO7rxfrMXH__KVl-j6CY6","email":"test-workflows-NDKXm9k-PeevCLo_SjnRK@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867281874,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4077fcd2-4d3d-4577-88c6-babb390c8c92","userId":"t5ebUny5Oi7NG-671sX6g","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11672[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 515[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 507[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 879[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 666[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 814[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 896[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 694[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 923[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 554[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 403[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1086[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:54:25
[2m   Duration [22m 16.75s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764867556245,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867558265,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867560614,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867560614,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867560624,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867560624,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867560624,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867560624,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867561071,"env":"test","module":"user-credentials-repository","userId":"8Vu6Psgo9a2uQzFCZC7u-","msg":"User credentials created"}
{"level":30,"time":1764867561075,"env":"test","module":"auth-routes","userId":"8Vu6Psgo9a2uQzFCZC7u-","email":"test-workflows-BcAAtpKms9DZW2for925s@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c8545727-8a57-4ba6-8280-749a63ee3537","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"8Vu6Psgo9a2uQzFCZC7u-","tenantId":"f1970845-fdab-41bd-8f4c-2caa83aa4920","createdBy":"8Vu6Psgo9a2uQzFCZC7u-","ownerId":"8Vu6Psgo9a2uQzFCZC7u-","status":"active","archived":false,"createdAt":"2025-12-04T16:59:22.580Z","updatedAt":"2025-12-04T16:59:22.580Z"}

{"level":30,"time":1764867561748,"env":"test","module":"user-credentials-repository","userId":"9Yuu4YE31hT3H8iTgMt1l","msg":"User credentials created"}
{"level":30,"time":1764867561749,"env":"test","module":"auth-routes","userId":"9Yuu4YE31hT3H8iTgMt1l","email":"viewer-aiulrMTcRJ4fWqV1PgLct@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867561842,"env":"test","module":"rbac-middleware","userId":"9Yuu4YE31hT3H8iTgMt1l","userRole":"viewer","permission":"workflow:create","path":"/projects/c8545727-8a57-4ba6-8280-749a63ee3537/workflows","msg":"Permission denied"}
{"level":50,"time":1764867568051,"env":"test","error":{},"workflowId":"15170325-7673-48d8-a04e-803cbe4ebe60","userId":"8Vu6Psgo9a2uQzFCZC7u-","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867568389,"env":"test","module":"auth-middleware","path":"/api/workflows/98918751-dd95-4435-9447-914893943725/move","msg":"No valid authentication found"}
{"level":30,"time":1764867568894,"env":"test","module":"user-credentials-repository","userId":"1oNeri0lFaqthdJQk_pIe","msg":"User credentials created"}
{"level":30,"time":1764867568895,"env":"test","module":"auth-routes","userId":"1oNeri0lFaqthdJQk_pIe","email":"test-workflows-m2eejlwcpbkLWpPeXYTOd@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867568941,"env":"test","error":{},"workflowId":"b5e6ce86-3bcd-4c38-a1d2-a4cf110c9e92","userId":"1oNeri0lFaqthdJQk_pIe","projectId":"d63774cc-ce66-438d-b00b-6f5ab9a5843f","msg":"Error moving workflow"}
{"level":50,"time":1764867569320,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"25803f95-f313-4431-b7f0-159e484b4ca3","userId":"8Vu6Psgo9a2uQzFCZC7u-","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867569682,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"433fdaf8-e467-431f-b24e-3bb08f9e1258","userId":"8Vu6Psgo9a2uQzFCZC7u-","msg":"Error moving workflow"}
{"level":30,"time":1764867570265,"env":"test","module":"user-credentials-repository","userId":"qaDS7C12ACtN6NHItmbOJ","msg":"User credentials created"}
{"level":30,"time":1764867570266,"env":"test","module":"auth-routes","userId":"qaDS7C12ACtN6NHItmbOJ","email":"test-workflows-vzHPzlMsw1qT0PcDWC_BC@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867570451,"env":"test","module":"auth-routes","userId":"qaDS7C12ACtN6NHItmbOJ","email":"test-workflows-vzHPzlMsw1qT0PcDWC_BC@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867570690,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"346ac5b1-60ad-47e3-8ca5-790c8c78d2f4","userId":"8Vu6Psgo9a2uQzFCZC7u-","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 625[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 553[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 366[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1007[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:59:13
[2m   Duration [22m 17.19s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764867688978,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867690759,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867692577,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867692578,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867692588,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867692589,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867692589,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867692589,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867693006,"env":"test","module":"user-credentials-repository","userId":"7iandGx0BOy5QaWVLWxDJ","msg":"User credentials created"}
{"level":30,"time":1764867693009,"env":"test","module":"auth-routes","userId":"7iandGx0BOy5QaWVLWxDJ","email":"test-workflows-auesea4-BAMH3LLWdWbNo@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3b934d77-2c69-44e5-afe8-0ba4c7f2c929","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"7iandGx0BOy5QaWVLWxDJ","tenantId":"4a12a8d7-98b4-44d6-87f3-da906e323760","createdBy":"7iandGx0BOy5QaWVLWxDJ","ownerId":"7iandGx0BOy5QaWVLWxDJ","status":"active","archived":false,"createdAt":"2025-12-04T17:01:34.521Z","updatedAt":"2025-12-04T17:01:34.521Z"}

{"level":30,"time":1764867693671,"env":"test","module":"user-credentials-repository","userId":"mjhypaduitRK-aMKWzUi8","msg":"User credentials created"}
{"level":30,"time":1764867693671,"env":"test","module":"auth-routes","userId":"mjhypaduitRK-aMKWzUi8","email":"viewer-2apL3WumEVjtE0xwF6s_U@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867693761,"env":"test","module":"rbac-middleware","userId":"mjhypaduitRK-aMKWzUi8","userRole":"viewer","permission":"workflow:create","path":"/projects/3b934d77-2c69-44e5-afe8-0ba4c7f2c929/workflows","msg":"Permission denied"}
{"level":50,"time":1764867699739,"env":"test","error":{},"workflowId":"bf31f711-6a6a-41ff-85f5-c53b04e25d22","userId":"7iandGx0BOy5QaWVLWxDJ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867700053,"env":"test","module":"auth-middleware","path":"/api/workflows/f6923e75-e36f-4f61-8ee4-1b3947c39320/move","msg":"No valid authentication found"}
{"level":30,"time":1764867700548,"env":"test","module":"user-credentials-repository","userId":"T3pXAl5vvJo0F-swx4mbZ","msg":"User credentials created"}
{"level":30,"time":1764867700548,"env":"test","module":"auth-routes","userId":"T3pXAl5vvJo0F-swx4mbZ","email":"test-workflows-y2udYLy8P2jaDZPx-7051@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867700596,"env":"test","error":{},"workflowId":"1ebbc6a8-84b3-43d2-8447-71a6f53f13fa","userId":"T3pXAl5vvJo0F-swx4mbZ","projectId":"6050503f-b285-4eda-9da0-2c8542736a61","msg":"Error moving workflow"}
{"level":50,"time":1764867700945,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"70ee89b3-ac31-45b1-b338-65f8b11cf36b","userId":"7iandGx0BOy5QaWVLWxDJ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867701281,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e9486c6c-4d4a-4b20-931a-99dd6c4ad2ee","userId":"7iandGx0BOy5QaWVLWxDJ","msg":"Error moving workflow"}
{"level":30,"time":1764867701778,"env":"test","module":"user-credentials-repository","userId":"sfeFctBwipZAggH9zVgIn","msg":"User credentials created"}
{"level":30,"time":1764867701778,"env":"test","module":"auth-routes","userId":"sfeFctBwipZAggH9zVgIn","email":"test-workflows-XR43sRLqolExco1hbq6gU@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867701966,"env":"test","module":"auth-routes","userId":"sfeFctBwipZAggH9zVgIn","email":"test-workflows-XR43sRLqolExco1hbq6gU@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867702145,"env":"test","error":{},"workflowId":"6d547480-8f3d-4f56-9e86-198185a1388e","userId":"7iandGx0BOy5QaWVLWxDJ","projectId":"ddc8e3aa-8932-44f3-9069-657ec431ab4b","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 314[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 577[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 335[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 864[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:01:26
[2m   Duration [22m 15.84s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764868031640,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868033651,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868035717,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868035718,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868035728,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868035728,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868035728,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868035728,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868036665,"env":"test","module":"user-credentials-repository","userId":"-FLdZBWNADl49sGVNoJ4l","msg":"User credentials created"}
{"level":30,"time":1764868036667,"env":"test","module":"auth-routes","userId":"-FLdZBWNADl49sGVNoJ4l","email":"test-workflows-2EZJVNmaZOFXuZs__jDPy@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"17fa3742-fa78-4463-b522-5064dcb87893","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"-FLdZBWNADl49sGVNoJ4l","tenantId":"9b3351fe-0931-4f0d-8c60-bce5c8d8ad2d","createdBy":"-FLdZBWNADl49sGVNoJ4l","ownerId":"-FLdZBWNADl49sGVNoJ4l","status":"active","archived":false,"createdAt":"2025-12-04T17:07:18.178Z","updatedAt":"2025-12-04T17:07:18.178Z"}

{"level":30,"time":1764868037381,"env":"test","module":"user-credentials-repository","userId":"6w-M4654W2bWG_slou72j","msg":"User credentials created"}
{"level":30,"time":1764868037382,"env":"test","module":"auth-routes","userId":"6w-M4654W2bWG_slou72j","email":"viewer-dOrks2pBFKQ61unndU5_X@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868037478,"env":"test","module":"rbac-middleware","userId":"6w-M4654W2bWG_slou72j","userRole":"viewer","permission":"workflow:create","path":"/projects/17fa3742-fa78-4463-b522-5064dcb87893/workflows","msg":"Permission denied"}
{"level":50,"time":1764868043711,"env":"test","error":{},"workflowId":"013092ba-16f8-4b52-bde6-c870d9bd129e","userId":"-FLdZBWNADl49sGVNoJ4l","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868044068,"env":"test","module":"auth-middleware","path":"/api/workflows/b90c7d7f-6b73-45f4-8e5a-23808e52e485/move","msg":"No valid authentication found"}
{"level":30,"time":1764868044592,"env":"test","module":"user-credentials-repository","userId":"Th0uMfE_5jf0YTd8Euh_N","msg":"User credentials created"}
{"level":30,"time":1764868044593,"env":"test","module":"auth-routes","userId":"Th0uMfE_5jf0YTd8Euh_N","email":"test-workflows-ZPUub8EmGcGUU6HLPlEpe@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868044637,"env":"test","error":{},"workflowId":"00ec3ad1-ef3b-4a87-b8a5-bee7e395ec9b","userId":"Th0uMfE_5jf0YTd8Euh_N","projectId":"e6707bd9-8f5e-40ea-b4a9-1b5523b7d8fc","msg":"Error moving workflow"}
{"level":50,"time":1764868045014,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2171e644-236e-4759-bf06-9cf7847e41c5","userId":"-FLdZBWNADl49sGVNoJ4l","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868045477,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"574bc78b-46f4-49a5-85c9-1a1db0fc2409","userId":"-FLdZBWNADl49sGVNoJ4l","msg":"Error moving workflow"}
{"level":30,"time":1764868046096,"env":"test","module":"user-credentials-repository","userId":"pcxXtSHxIou3DfVWVCeU1","msg":"User credentials created"}
{"level":30,"time":1764868046097,"env":"test","module":"auth-routes","userId":"pcxXtSHxIou3DfVWVCeU1","email":"test-workflows-FUax8w_R-1CxEUQvcanzX@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868046293,"env":"test","module":"auth-routes","userId":"pcxXtSHxIou3DfVWVCeU1","email":"test-workflows-FUax8w_R-1CxEUQvcanzX@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868046510,"env":"test","error":{},"workflowId":"1c1379bb-163a-483b-ac1c-167cdbaff79f","userId":"-FLdZBWNADl49sGVNoJ4l","projectId":"8544d28f-4f6d-4ac8-bb8f-bc37c289fccf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11094[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 796[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 764[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 585[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 463[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1034[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:07:08
[2m   Duration [22m 17.75s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764868270520,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868272251,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868274083,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868274084,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868274102,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868274102,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868274103,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868274103,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868274589,"env":"test","module":"user-credentials-repository","userId":"O2LZs_dyMgjVvLn5xn0Za","msg":"User credentials created"}
{"level":30,"time":1764868274592,"env":"test","module":"auth-routes","userId":"O2LZs_dyMgjVvLn5xn0Za","email":"test-workflows-GSVC_Jho0qssWp8nV_-ns@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c8d0b995-b1d0-4909-8140-dcd731bfd327","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"O2LZs_dyMgjVvLn5xn0Za","tenantId":"1a2d00c9-a2ec-47bf-87c5-ea7dc23c3d48","createdBy":"O2LZs_dyMgjVvLn5xn0Za","ownerId":"O2LZs_dyMgjVvLn5xn0Za","status":"active","archived":false,"createdAt":"2025-12-04T17:11:16.112Z","updatedAt":"2025-12-04T17:11:16.112Z"}

{"level":30,"time":1764868275300,"env":"test","module":"user-credentials-repository","userId":"IiTY5f434nfxv7yW-LnPP","msg":"User credentials created"}
{"level":30,"time":1764868275300,"env":"test","module":"auth-routes","userId":"IiTY5f434nfxv7yW-LnPP","email":"viewer-iniNtGJ-FoNlKFXp-dh-o@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868275397,"env":"test","module":"rbac-middleware","userId":"IiTY5f434nfxv7yW-LnPP","userRole":"viewer","permission":"workflow:create","path":"/projects/c8d0b995-b1d0-4909-8140-dcd731bfd327/workflows","msg":"Permission denied"}
{"level":50,"time":1764868281914,"env":"test","error":{},"workflowId":"7226e001-afa9-4e6c-be9a-80d6b3285fd9","userId":"O2LZs_dyMgjVvLn5xn0Za","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868282250,"env":"test","module":"auth-middleware","path":"/api/workflows/29db1d46-bae2-46f7-9e77-9884fbce756e/move","msg":"No valid authentication found"}
{"level":30,"time":1764868282767,"env":"test","module":"user-credentials-repository","userId":"1f1VifMHRmDvmHXl_Nhrz","msg":"User credentials created"}
{"level":30,"time":1764868282767,"env":"test","module":"auth-routes","userId":"1f1VifMHRmDvmHXl_Nhrz","email":"test-workflows-SdOXCaaNSGzntEU8terF5@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868282814,"env":"test","error":{},"workflowId":"0fefe160-0f2d-491c-92ee-ea4db3dafa49","userId":"1f1VifMHRmDvmHXl_Nhrz","projectId":"50e90043-f3e5-4b19-a326-b54a4c357fb6","msg":"Error moving workflow"}
{"level":50,"time":1764868283206,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b72f4f39-1b1c-4622-aed5-1a9cec41ab07","userId":"O2LZs_dyMgjVvLn5xn0Za","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868283585,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"06dfad90-bc08-4b58-87a8-1cbffe2f76dc","userId":"O2LZs_dyMgjVvLn5xn0Za","msg":"Error moving workflow"}
{"level":50,"time":1764868284259,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(wpy4PLTkMj_oi_zNdc07k) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wpy4PLTkMj_oi_zNdc07k","msg":"Failed to create user credentials"}
{"level":50,"time":1764868284259,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(wpy4PLTkMj_oi_zNdc07k) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 612[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 649[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 867[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 632[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 392[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 379[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 674[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:11:07
[2m   Duration [22m 16.32s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764868529485,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531580,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533565,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533565,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533574,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533574,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533574,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533574,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868534012,"env":"test","module":"user-credentials-repository","userId":"R-zbAvXVbVrU8yBO4wi_G","msg":"User credentials created"}
{"level":30,"time":1764868534015,"env":"test","module":"auth-routes","userId":"R-zbAvXVbVrU8yBO4wi_G","email":"test-workflows-KmhoGGHZVAbgZdtZQhMsa@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"34986794-9bbc-4210-9013-6ad2c1a728f4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"R-zbAvXVbVrU8yBO4wi_G","tenantId":"c6e0dd26-387d-4115-a49b-73c44d7593fb","createdBy":"R-zbAvXVbVrU8yBO4wi_G","ownerId":"R-zbAvXVbVrU8yBO4wi_G","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.539Z","updatedAt":"2025-12-04T17:15:35.539Z"}

{"level":30,"time":1764868534681,"env":"test","module":"user-credentials-repository","userId":"E5J2AYbLo3nUk9-0ow9KN","msg":"User credentials created"}
{"level":30,"time":1764868534682,"env":"test","module":"auth-routes","userId":"E5J2AYbLo3nUk9-0ow9KN","email":"viewer-559QinBAHAXsCkV09YrkS@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534771,"env":"test","module":"rbac-middleware","userId":"E5J2AYbLo3nUk9-0ow9KN","userRole":"viewer","permission":"workflow:create","path":"/projects/34986794-9bbc-4210-9013-6ad2c1a728f4/workflows","msg":"Permission denied"}
{"level":50,"time":1764868541171,"env":"test","error":{},"workflowId":"cf07b88c-44fa-4cc9-aed7-6d1904e81fb5","userId":"R-zbAvXVbVrU8yBO4wi_G","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541509,"env":"test","module":"auth-middleware","path":"/api/workflows/2a10db16-40b8-44a1-8bf2-f7e3bb125c41/move","msg":"No valid authentication found"}
{"level":30,"time":1764868542018,"env":"test","module":"user-credentials-repository","userId":"cUd-XIBVQAlbd5HyzulNk","msg":"User credentials created"}
{"level":30,"time":1764868542019,"env":"test","module":"auth-routes","userId":"cUd-XIBVQAlbd5HyzulNk","email":"test-workflows-C0-HRoh2SqF-PZ4LsO6IM@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868542076,"env":"test","error":{},"workflowId":"f19f5240-0587-441d-a0f5-82734409025a","userId":"cUd-XIBVQAlbd5HyzulNk","projectId":"ca2f7c91-2654-4e38-b42b-477c178b06ee","msg":"Error moving workflow"}
{"level":50,"time":1764868542540,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"bda99b0c-ad62-4add-9762-62425ce811be","userId":"R-zbAvXVbVrU8yBO4wi_G","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868543017,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"dd412d6d-7f7e-4c59-bee0-4c9d42cc27b4","userId":"R-zbAvXVbVrU8yBO4wi_G","msg":"Error moving workflow"}
{"level":50,"time":1764868543622,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CGLiyGvzn6fAm4EgTSAK5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"CGLiyGvzn6fAm4EgTSAK5","msg":"Failed to create user credentials"}
{"level":50,"time":1764868543622,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CGLiyGvzn6fAm4EgTSAK5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 316[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 288[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 795[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 606[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 477[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 606[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 18.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764868816514,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818747,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820728,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820729,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820737,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820738,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820738,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820738,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821187,"env":"test","module":"user-credentials-repository","userId":"RLSOaKha3gfENi9V8Spn1","msg":"User credentials created"}
{"level":30,"time":1764868821190,"env":"test","module":"auth-routes","userId":"RLSOaKha3gfENi9V8Spn1","email":"test-workflows-Q8lRXeRH3hIUYOGXytcsh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"70d93213-2ff3-4940-bccb-04542d5cf4f2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"RLSOaKha3gfENi9V8Spn1","tenantId":"70c0a77b-a894-4e90-a9f8-ee1eb2a1cab3","createdBy":"RLSOaKha3gfENi9V8Spn1","ownerId":"RLSOaKha3gfENi9V8Spn1","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.712Z","updatedAt":"2025-12-04T17:20:22.712Z"}

{"level":30,"time":1764868821865,"env":"test","module":"user-credentials-repository","userId":"kQgr9aiyIEU0mjdDOb5cA","msg":"User credentials created"}
{"level":30,"time":1764868821866,"env":"test","module":"auth-routes","userId":"kQgr9aiyIEU0mjdDOb5cA","email":"viewer-PlOSfDt0byEqP9s3soVvq@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821966,"env":"test","module":"rbac-middleware","userId":"kQgr9aiyIEU0mjdDOb5cA","userRole":"viewer","permission":"workflow:create","path":"/projects/70d93213-2ff3-4940-bccb-04542d5cf4f2/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828141,"env":"test","error":{},"workflowId":"6da30f78-5dc3-4c01-84c5-389b890f00e4","userId":"RLSOaKha3gfENi9V8Spn1","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828437,"env":"test","module":"auth-middleware","path":"/api/workflows/b6f083ae-a7c5-4a5d-b58f-835a00b1b1de/move","msg":"No valid authentication found"}
{"level":30,"time":1764868828941,"env":"test","module":"user-credentials-repository","userId":"xMXbchPfMU-y9gmxfg--J","msg":"User credentials created"}
{"level":30,"time":1764868828942,"env":"test","module":"auth-routes","userId":"xMXbchPfMU-y9gmxfg--J","email":"test-workflows-APD6Jg2X2apxRHaiNMoh1@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868828989,"env":"test","error":{},"workflowId":"ff9a7e85-feb4-4bca-8a16-97dbfebeb456","userId":"xMXbchPfMU-y9gmxfg--J","projectId":"8797d49a-c718-44d4-b571-28756e7a3cb7","msg":"Error moving workflow"}
{"level":50,"time":1764868829354,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2e2e41c6-558a-4fe9-a3fa-93080908df3b","userId":"RLSOaKha3gfENi9V8Spn1","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868829733,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"913eaf8f-c29f-4d3a-9a3a-113a6200765b","userId":"RLSOaKha3gfENi9V8Spn1","msg":"Error moving workflow"}
{"level":30,"time":1764868830274,"env":"test","module":"user-credentials-repository","userId":"GG2K_-lXJPdFXBdqfa7-R","msg":"User credentials created"}
{"level":30,"time":1764868830274,"env":"test","module":"auth-routes","userId":"GG2K_-lXJPdFXBdqfa7-R","email":"test-workflows-056KJuAl-xxgf8ne3jATG@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830469,"env":"test","module":"auth-routes","userId":"GG2K_-lXJPdFXBdqfa7-R","email":"test-workflows-056KJuAl-xxgf8ne3jATG@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868830661,"env":"test","error":{},"workflowId":"0fd1f1c1-5491-4dae-94c3-4a66166da082","userId":"RLSOaKha3gfENi9V8Spn1","projectId":"f82d9ae4-c027-4ec1-b50b-f45c2107ee89","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10226[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 445[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 379[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 930[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.34s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764871633780,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871638449,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871642211,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871642212,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871642228,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871642228,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871642229,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871642229,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871642738,"env":"test","module":"user-credentials-repository","userId":"EGoN-svLBAHkDSFl28lY0","msg":"User credentials created"}
{"level":30,"time":1764871642743,"env":"test","module":"auth-routes","userId":"EGoN-svLBAHkDSFl28lY0","email":"test-workflows-LiO-OnAKnz1T2K3vvJNbI@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f32e1904-fbd6-4f7e-af48-4c60a1fa7a20","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"EGoN-svLBAHkDSFl28lY0","tenantId":"ddc177db-46d6-4eb2-b010-7418f9e8bee4","createdBy":"EGoN-svLBAHkDSFl28lY0","ownerId":"EGoN-svLBAHkDSFl28lY0","status":"active","archived":false,"createdAt":"2025-12-04T18:07:24.314Z","updatedAt":"2025-12-04T18:07:24.314Z"}

{"level":30,"time":1764871643411,"env":"test","module":"user-credentials-repository","userId":"ZJQ_aOY_1IbMUMHqC9FX5","msg":"User credentials created"}
{"level":30,"time":1764871643412,"env":"test","module":"auth-routes","userId":"ZJQ_aOY_1IbMUMHqC9FX5","email":"viewer-Qvg1-JHQolD9RP2FWnVUM@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871643512,"env":"test","module":"rbac-middleware","userId":"ZJQ_aOY_1IbMUMHqC9FX5","userRole":"viewer","permission":"workflow:create","path":"/projects/f32e1904-fbd6-4f7e-af48-4c60a1fa7a20/workflows","msg":"Permission denied"}
{"level":50,"time":1764871649363,"env":"test","error":{},"workflowId":"8deed6a6-9485-4734-8d80-3e05f3dc5fb8","userId":"EGoN-svLBAHkDSFl28lY0","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871649716,"env":"test","module":"auth-middleware","path":"/api/workflows/2d32ad6c-5554-433e-8848-94bba8793488/move","msg":"No valid authentication found"}
{"level":30,"time":1764871650209,"env":"test","module":"user-credentials-repository","userId":"y9ItDxS43ZCCpyTW0j6K_","msg":"User credentials created"}
{"level":30,"time":1764871650210,"env":"test","module":"auth-routes","userId":"y9ItDxS43ZCCpyTW0j6K_","email":"test-workflows-4kBrsIDkP5fLtsnaWdDcG@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871650253,"env":"test","error":{},"workflowId":"2c9ae6fe-4b5f-47a2-8fdb-f54713b569fa","userId":"y9ItDxS43ZCCpyTW0j6K_","projectId":"f267bdf2-1a36-409d-aa45-94a6c3aa7951","msg":"Error moving workflow"}
{"level":50,"time":1764871650602,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9400a64a-8b07-4f86-8cc7-81400b986485","userId":"EGoN-svLBAHkDSFl28lY0","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871650963,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8f80ae9a-c741-4ebc-9960-f26c1ac4b2d0","userId":"EGoN-svLBAHkDSFl28lY0","msg":"Error moving workflow"}
{"level":30,"time":1764871651431,"env":"test","module":"user-credentials-repository","userId":"GpfGYCK0tzE1cn5VH-uRD","msg":"User credentials created"}
{"level":30,"time":1764871651432,"env":"test","module":"auth-routes","userId":"GpfGYCK0tzE1cn5VH-uRD","email":"test-workflows-JVh0pjyPQ6jJlaeHmcWJP@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871651608,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764871651650,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"32975b2b-0d3d-4888-bd90-8b90605ff583","userId":"EGoN-svLBAHkDSFl28lY0","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 429[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 569[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 687[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 360[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 688[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 22.21s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764871702812,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871705534,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871709582,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871709583,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871709595,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871709595,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871709595,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871709596,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710084,"env":"test","module":"user-credentials-repository","userId":"IV4SRpJgKuF0e6cilsl1W","msg":"User credentials created"}
{"level":30,"time":1764871710087,"env":"test","module":"auth-routes","userId":"IV4SRpJgKuF0e6cilsl1W","email":"test-workflows-hCSHn0xBQCrpNZKBWIM6_@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9e404d10-e0e8-4d3d-8da8-c60eb089c6ad","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"IV4SRpJgKuF0e6cilsl1W","tenantId":"ee9f7963-69bd-41e7-9d42-c6164be2893d","createdBy":"IV4SRpJgKuF0e6cilsl1W","ownerId":"IV4SRpJgKuF0e6cilsl1W","status":"active","archived":false,"createdAt":"2025-12-04T18:08:31.663Z","updatedAt":"2025-12-04T18:08:31.663Z"}

{"level":30,"time":1764871710767,"env":"test","module":"user-credentials-repository","userId":"n9NMjYjBTMTpZp8hzjg8t","msg":"User credentials created"}
{"level":30,"time":1764871710768,"env":"test","module":"auth-routes","userId":"n9NMjYjBTMTpZp8hzjg8t","email":"viewer-fhylf2EdYMbwGwZ-iNeCV@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871710863,"env":"test","module":"rbac-middleware","userId":"n9NMjYjBTMTpZp8hzjg8t","userRole":"viewer","permission":"workflow:create","path":"/projects/9e404d10-e0e8-4d3d-8da8-c60eb089c6ad/workflows","msg":"Permission denied"}
{"level":50,"time":1764871717121,"env":"test","error":{},"workflowId":"057e4dab-49c4-4af4-a917-a6250f334e91","userId":"IV4SRpJgKuF0e6cilsl1W","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871717446,"env":"test","module":"auth-middleware","path":"/api/workflows/698a44c9-d806-4f60-a0c9-80f898799724/move","msg":"No valid authentication found"}
{"level":30,"time":1764871717957,"env":"test","module":"user-credentials-repository","userId":"eSBhVBnjZAigjcTmIfQlC","msg":"User credentials created"}
{"level":30,"time":1764871717958,"env":"test","module":"auth-routes","userId":"eSBhVBnjZAigjcTmIfQlC","email":"test-workflows-xE60Ttmu-dJwPX1V6I_GB@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871718006,"env":"test","error":{},"workflowId":"69044f1f-cd68-474c-8648-1b65986f867e","userId":"eSBhVBnjZAigjcTmIfQlC","projectId":"cc2f8321-5927-4f0a-873d-d445fc70ad68","msg":"Error moving workflow"}
{"level":50,"time":1764871718372,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7a1a9c54-ea80-4868-8888-bf72b8a38e36","userId":"IV4SRpJgKuF0e6cilsl1W","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871718745,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bc83abe2-10a7-4120-93f8-54f88b28fbce","userId":"IV4SRpJgKuF0e6cilsl1W","msg":"Error moving workflow"}
{"level":30,"time":1764871719259,"env":"test","module":"user-credentials-repository","userId":"XRjjIvwl1_QnCTb6eLX99","msg":"User credentials created"}
{"level":30,"time":1764871719259,"env":"test","module":"auth-routes","userId":"XRjjIvwl1_QnCTb6eLX99","email":"test-workflows-6Bg_4SJlLorBwLH0khx3s@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871719461,"env":"test","module":"auth-routes","userId":"XRjjIvwl1_QnCTb6eLX99","email":"test-workflows-6Bg_4SJlLorBwLH0khx3s@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871719644,"env":"test","error":{},"workflowId":"919e862f-c881-446a-998f-e156944e9782","userId":"IV4SRpJgKuF0e6cilsl1W","projectId":"59191dcd-2932-4294-b586-4d30d3f23f01","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 495[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 374[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 901[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 21.43s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764871753908,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871756423,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871759915,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871759915,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871759927,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871759928,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871759928,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871759928,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871760450,"env":"test","module":"user-credentials-repository","userId":"olhaz1BlNYXrhBVlI70on","msg":"User credentials created"}
{"level":30,"time":1764871760454,"env":"test","module":"auth-routes","userId":"olhaz1BlNYXrhBVlI70on","email":"test-workflows-Hv6XMEB0iY8_k07P96nGz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"95c7233d-e068-485b-b3fa-cf031c8b3054","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"olhaz1BlNYXrhBVlI70on","tenantId":"f46dd699-e9ef-4008-a309-c6b39342e984","createdBy":"olhaz1BlNYXrhBVlI70on","ownerId":"olhaz1BlNYXrhBVlI70on","status":"active","archived":false,"createdAt":"2025-12-04T18:09:22.038Z","updatedAt":"2025-12-04T18:09:22.038Z"}

{"level":30,"time":1764871761129,"env":"test","module":"user-credentials-repository","userId":"lWVNrZoEpsErWNEGZGXWp","msg":"User credentials created"}
{"level":30,"time":1764871761130,"env":"test","module":"auth-routes","userId":"lWVNrZoEpsErWNEGZGXWp","email":"viewer-KV4IYnEzTwKg6FUxHONfa@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871761221,"env":"test","module":"rbac-middleware","userId":"lWVNrZoEpsErWNEGZGXWp","userRole":"viewer","permission":"workflow:create","path":"/projects/95c7233d-e068-485b-b3fa-cf031c8b3054/workflows","msg":"Permission denied"}
{"level":50,"time":1764871767391,"env":"test","error":{},"workflowId":"72a4462e-c84d-42d1-abb3-41bd719b2d27","userId":"olhaz1BlNYXrhBVlI70on","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871767722,"env":"test","module":"auth-middleware","path":"/api/workflows/9a10e1fe-e725-4da2-b34f-7e5849d916ba/move","msg":"No valid authentication found"}
{"level":30,"time":1764871768231,"env":"test","module":"user-credentials-repository","userId":"Ii0Wv8TUd2Y6-LqS1x_jR","msg":"User credentials created"}
{"level":30,"time":1764871768231,"env":"test","module":"auth-routes","userId":"Ii0Wv8TUd2Y6-LqS1x_jR","email":"test-workflows-z_kx2OzQ5_pwM0W4OU_Xx@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871768281,"env":"test","error":{},"workflowId":"a6f60625-b46b-4f30-9f4c-239c2db9ccb0","userId":"Ii0Wv8TUd2Y6-LqS1x_jR","projectId":"eb03a797-d394-4a2f-b2f9-bd1aeeef19ed","msg":"Error moving workflow"}
{"level":50,"time":1764871768651,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"624951f3-d8fe-4ea2-ad0e-3c402ed3f26d","userId":"olhaz1BlNYXrhBVlI70on","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871769027,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"df3ad01c-a71d-45d6-ab2a-3493e8f45505","userId":"olhaz1BlNYXrhBVlI70on","msg":"Error moving workflow"}
{"level":30,"time":1764871769543,"env":"test","module":"user-credentials-repository","userId":"uFeDBtXXouyaQxc5Hayi1","msg":"User credentials created"}
{"level":30,"time":1764871769544,"env":"test","module":"auth-routes","userId":"uFeDBtXXouyaQxc5Hayi1","email":"test-workflows-iAH2SjdwbCSucBcVpPSe4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871769747,"env":"test","module":"auth-routes","userId":"uFeDBtXXouyaQxc5Hayi1","email":"test-workflows-iAH2SjdwbCSucBcVpPSe4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871769935,"env":"test","error":{},"workflowId":"e374ae57-c34b-4b0a-80de-ee56dabcf3ce","userId":"olhaz1BlNYXrhBVlI70on","projectId":"8e231a69-589c-49ed-9b95-fc90f29676c1","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10261[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 909[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 20.64s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764873689354,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873692984,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873696972,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873696973,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873696985,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873696985,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873696985,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873696985,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873697506,"env":"test","module":"user-credentials-repository","userId":"Bwvkq9YsSXMCj7AFbsWDP","msg":"User credentials created"}
{"level":30,"time":1764873697510,"env":"test","module":"auth-routes","userId":"Bwvkq9YsSXMCj7AFbsWDP","email":"test-workflows-kdaYc5VeK8Q2sBluV1Pea@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"04caf8d6-e4e9-4dd1-b6e3-754ea431b20d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Bwvkq9YsSXMCj7AFbsWDP","tenantId":"895c4099-0dfb-44e5-80ec-2aca2e150ee5","createdBy":"Bwvkq9YsSXMCj7AFbsWDP","ownerId":"Bwvkq9YsSXMCj7AFbsWDP","status":"active","archived":false,"createdAt":"2025-12-04T18:41:39.116Z","updatedAt":"2025-12-04T18:41:39.116Z"}

{"level":30,"time":1764873698282,"env":"test","module":"user-credentials-repository","userId":"08cqjxN7cUAxlFaMaM92R","msg":"User credentials created"}
{"level":30,"time":1764873698283,"env":"test","module":"auth-routes","userId":"08cqjxN7cUAxlFaMaM92R","email":"viewer-RqOzrKrucAoCu8DeKyWwO@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873698380,"env":"test","module":"rbac-middleware","userId":"08cqjxN7cUAxlFaMaM92R","userRole":"viewer","permission":"workflow:create","path":"/projects/04caf8d6-e4e9-4dd1-b6e3-754ea431b20d/workflows","msg":"Permission denied"}
{"level":50,"time":1764873704865,"env":"test","error":{},"workflowId":"76a8769a-ef5f-4473-bdaa-856018264e70","userId":"Bwvkq9YsSXMCj7AFbsWDP","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873705211,"env":"test","module":"auth-middleware","path":"/api/workflows/3a470c3f-4e3d-459a-ba63-50a3a429be06/move","msg":"No valid authentication found"}
{"level":30,"time":1764873705737,"env":"test","module":"user-credentials-repository","userId":"kBCgY5fNgTMK8MrfbZxP_","msg":"User credentials created"}
{"level":30,"time":1764873705738,"env":"test","module":"auth-routes","userId":"kBCgY5fNgTMK8MrfbZxP_","email":"test-workflows-DoqZoCB7E8hXn5ZcFjU85@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873705787,"env":"test","error":{},"workflowId":"73f265a1-eee4-4362-a4e0-4b3b7afdc0a9","userId":"kBCgY5fNgTMK8MrfbZxP_","projectId":"a3f1a3c0-cf35-4826-be26-27cf3731ec91","msg":"Error moving workflow"}
{"level":50,"time":1764873706179,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ff14c952-58b7-4077-a45d-450ff31e8ddc","userId":"Bwvkq9YsSXMCj7AFbsWDP","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873706589,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d7988f2f-e588-4d95-b13d-8a230e560575","userId":"Bwvkq9YsSXMCj7AFbsWDP","msg":"Error moving workflow"}
{"level":30,"time":1764873707133,"env":"test","module":"user-credentials-repository","userId":"nXJLt4miwZQe5iEBsLRaW","msg":"User credentials created"}
{"level":30,"time":1764873707133,"env":"test","module":"auth-routes","userId":"nXJLt4miwZQe5iEBsLRaW","email":"test-workflows-pXRd5w43Tb5G26-PnjXLP@example.com","msg":"User registered successfully"}
{"level":30,"time":1764873707348,"env":"test","module":"auth-routes","userId":"nXJLt4miwZQe5iEBsLRaW","email":"test-workflows-pXRd5w43Tb5G26-PnjXLP@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764873707541,"env":"test","error":{},"workflowId":"8331ae10-04e5-46c3-a2cb-bd26bd1876d8","userId":"Bwvkq9YsSXMCj7AFbsWDP","projectId":"ff6828fc-2746-4422-a6db-44a9a909a44e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10857[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 409[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 807[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 830[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 393[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 410[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 954[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 21.94s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764874580535,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874585604,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874592497,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874592498,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874592512,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874592512,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874592512,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874592512,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874593028,"env":"test","module":"user-credentials-repository","userId":"XFh3duZjbjH4M5KZZME18","msg":"User credentials created"}
{"level":30,"time":1764874593031,"env":"test","module":"auth-routes","userId":"XFh3duZjbjH4M5KZZME18","email":"test-workflows-gRmlDMZUnF9O8VYKGdRzO@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"408a1f1e-a02c-49bc-a766-9487ae68dc40","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"XFh3duZjbjH4M5KZZME18","tenantId":"d185acbd-f5ca-4b81-9d9e-52b00ebd9f9f","createdBy":"XFh3duZjbjH4M5KZZME18","ownerId":"XFh3duZjbjH4M5KZZME18","status":"active","archived":false,"createdAt":"2025-12-04T18:56:34.649Z","updatedAt":"2025-12-04T18:56:34.649Z"}

{"level":30,"time":1764874593704,"env":"test","module":"user-credentials-repository","userId":"gIf15JfcDZ7kxMNeWxlcG","msg":"User credentials created"}
{"level":30,"time":1764874593705,"env":"test","module":"auth-routes","userId":"gIf15JfcDZ7kxMNeWxlcG","email":"viewer-Yn7t7dFoSvVGwXuKYkbEu@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874593807,"env":"test","module":"rbac-middleware","userId":"gIf15JfcDZ7kxMNeWxlcG","userRole":"viewer","permission":"workflow:create","path":"/projects/408a1f1e-a02c-49bc-a766-9487ae68dc40/workflows","msg":"Permission denied"}
{"level":50,"time":1764874599932,"env":"test","error":{},"workflowId":"be860c06-bf96-48c3-8ac4-4ed3c4a8eebc","userId":"XFh3duZjbjH4M5KZZME18","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874600249,"env":"test","module":"auth-middleware","path":"/api/workflows/f8945f65-0760-4e7f-9e85-b1e6d3965a9f/move","msg":"No valid authentication found"}
{"level":30,"time":1764874600750,"env":"test","module":"user-credentials-repository","userId":"_ah153lAITkh0htn6FNLI","msg":"User credentials created"}
{"level":30,"time":1764874600750,"env":"test","module":"auth-routes","userId":"_ah153lAITkh0htn6FNLI","email":"test-workflows-MdvtJ2vO6KssKEXESskda@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874600799,"env":"test","error":{},"workflowId":"dd827951-d702-4f6b-84e8-cd8c03887546","userId":"_ah153lAITkh0htn6FNLI","projectId":"c51123c2-eedc-4af3-bbbe-416e0b124a9e","msg":"Error moving workflow"}
{"level":50,"time":1764874601251,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f7065978-84f1-41a1-a358-e4ef0f7f2078","userId":"XFh3duZjbjH4M5KZZME18","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874601601,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d3155c97-f617-4510-9f68-dda030091e26","userId":"XFh3duZjbjH4M5KZZME18","msg":"Error moving workflow"}
{"level":30,"time":1764874602110,"env":"test","module":"user-credentials-repository","userId":"fScwegJMUMb-35ZoUlJsq","msg":"User credentials created"}
{"level":30,"time":1764874602111,"env":"test","module":"auth-routes","userId":"fScwegJMUMb-35ZoUlJsq","email":"test-workflows-RQUCreQfy0cQJAhYzVHaI@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874602242,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764874602291,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2d162394-8bfd-4351-83a4-bb90bf6d5ec7","userId":"XFh3duZjbjH4M5KZZME18","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10054[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 726[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 550[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 349[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 691[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.15s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764874684645,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874689510,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874696027,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874696028,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874696160,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874696160,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874696162,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874696162,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874696659,"env":"test","module":"user-credentials-repository","userId":"6-GzQhEP6vUd7SAtvzHrg","msg":"User credentials created"}
{"level":30,"time":1764874696663,"env":"test","module":"auth-routes","userId":"6-GzQhEP6vUd7SAtvzHrg","email":"test-workflows-Egz7HHPcR4o0_IvmXaZW1@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"4e95a6a4-3863-4eb1-953a-a98428bf6c2a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"6-GzQhEP6vUd7SAtvzHrg","tenantId":"9a3d74c9-443d-4e07-bc68-12dcf04a52bc","createdBy":"6-GzQhEP6vUd7SAtvzHrg","ownerId":"6-GzQhEP6vUd7SAtvzHrg","status":"active","archived":false,"createdAt":"2025-12-04T18:58:18.283Z","updatedAt":"2025-12-04T18:58:18.283Z"}

{"level":30,"time":1764874697353,"env":"test","module":"user-credentials-repository","userId":"zJ3cj8hjRbEBDOKwBn0eL","msg":"User credentials created"}
{"level":30,"time":1764874697354,"env":"test","module":"auth-routes","userId":"zJ3cj8hjRbEBDOKwBn0eL","email":"viewer-XuuqCgzJcsMBxgiHmzS7d@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874697441,"env":"test","module":"rbac-middleware","userId":"zJ3cj8hjRbEBDOKwBn0eL","userRole":"viewer","permission":"workflow:create","path":"/projects/4e95a6a4-3863-4eb1-953a-a98428bf6c2a/workflows","msg":"Permission denied"}
{"level":50,"time":1764874703562,"env":"test","error":{},"workflowId":"e715cb74-7b3c-49b3-9827-e2f592a637df","userId":"6-GzQhEP6vUd7SAtvzHrg","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874703889,"env":"test","module":"auth-middleware","path":"/api/workflows/b3727e13-c54e-4d24-8c2b-5dd99dd3d528/move","msg":"No valid authentication found"}
{"level":30,"time":1764874704383,"env":"test","module":"user-credentials-repository","userId":"wP7T88TsKEf4qQxWwhpLE","msg":"User credentials created"}
{"level":30,"time":1764874704384,"env":"test","module":"auth-routes","userId":"wP7T88TsKEf4qQxWwhpLE","email":"test-workflows-aqFpOchIUcwPEOCb4y1dU@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874704428,"env":"test","error":{},"workflowId":"15806c3b-9645-494d-8931-4e6afd33debf","userId":"wP7T88TsKEf4qQxWwhpLE","projectId":"9c85979c-76f3-4873-bb11-aa831dc17f1a","msg":"Error moving workflow"}
{"level":50,"time":1764874704805,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"48de7826-08b6-4036-a01f-5a06551c5fc8","userId":"6-GzQhEP6vUd7SAtvzHrg","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874705173,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a89e13e0-47a8-47c3-9cf5-ce449e3ccc94","userId":"6-GzQhEP6vUd7SAtvzHrg","msg":"Error moving workflow"}
{"level":30,"time":1764874705690,"env":"test","module":"user-credentials-repository","userId":"2rO50B7Mi3h_75kmcrOIA","msg":"User credentials created"}
{"level":30,"time":1764874705691,"env":"test","module":"auth-routes","userId":"2rO50B7Mi3h_75kmcrOIA","email":"test-workflows-Z74gtNMwfheNcviCzNxWi@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874705882,"env":"test","module":"auth-routes","userId":"2rO50B7Mi3h_75kmcrOIA","email":"test-workflows-Z74gtNMwfheNcviCzNxWi@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874706050,"env":"test","error":{},"workflowId":"ec70d57d-ed9c-4a83-be7c-f2984c79fe90","userId":"6-GzQhEP6vUd7SAtvzHrg","projectId":"baa9e068-b9b0-454a-9951-f4cc20b6fe63","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 876[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 26.06s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
