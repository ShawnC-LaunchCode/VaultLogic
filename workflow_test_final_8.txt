npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764867171290,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867172758,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867173793,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867173794,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867173799,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867173799,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867173799,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867173799,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867174803,"env":"test","module":"user-credentials-repository","userId":"QRVaDltgkE4BMLmVYDD6X","msg":"User credentials created"}
{"level":30,"time":1764867174806,"env":"test","module":"auth-routes","userId":"QRVaDltgkE4BMLmVYDD6X","email":"test-workflows-gMrwHuDV6L2FFfUFQF_qQ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0c5d7be1-75b6-45a5-97eb-6a728bf07b4b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"QRVaDltgkE4BMLmVYDD6X","tenantId":"581e5800-9ff5-4960-aa34-69f383ac35fa","createdBy":"QRVaDltgkE4BMLmVYDD6X","ownerId":"QRVaDltgkE4BMLmVYDD6X","status":"active","archived":false,"createdAt":"2025-12-04T16:52:56.312Z","updatedAt":"2025-12-04T16:52:56.312Z"}

{"level":30,"time":1764867175804,"env":"test","module":"user-credentials-repository","userId":"LcMxECash8tGoHfdR9aMD","msg":"User credentials created"}
{"level":30,"time":1764867175804,"env":"test","module":"auth-routes","userId":"LcMxECash8tGoHfdR9aMD","email":"viewer-iFoITzZ493laU1wXhEEBV@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867175898,"env":"test","module":"rbac-middleware","userId":"LcMxECash8tGoHfdR9aMD","userRole":"viewer","permission":"workflow:create","path":"/projects/0c5d7be1-75b6-45a5-97eb-6a728bf07b4b/workflows","msg":"Permission denied"}
{"level":50,"time":1764867182567,"env":"test","error":{},"workflowId":"5e7aba6f-8e2c-4571-83be-eab8ffb4312f","userId":"QRVaDltgkE4BMLmVYDD6X","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867182908,"env":"test","module":"auth-middleware","path":"/api/workflows/e9f1d90d-63ec-4808-91e9-92765ad9024c/move","msg":"No valid authentication found"}
{"level":30,"time":1764867183442,"env":"test","module":"user-credentials-repository","userId":"7K2ifj0YW3o-Ymt2OArHA","msg":"User credentials created"}
{"level":30,"time":1764867183442,"env":"test","module":"auth-routes","userId":"7K2ifj0YW3o-Ymt2OArHA","email":"test-workflows-C6JXa2R2HSMAm0pvNxkrj@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867183490,"env":"test","error":{},"workflowId":"a5bf6936-193c-4c4d-9b26-2c048491a2b5","userId":"7K2ifj0YW3o-Ymt2OArHA","projectId":"4b8f1f98-2d5a-408d-bc82-1178928c234c","msg":"Error moving workflow"}
{"level":50,"time":1764867183865,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"92ed9a94-2889-40dc-aa8e-bd6f2eceecfc","userId":"QRVaDltgkE4BMLmVYDD6X","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867184270,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bc82a17f-1272-4d6d-a60d-1a22e4479b47","userId":"QRVaDltgkE4BMLmVYDD6X","msg":"Error moving workflow"}
{"level":30,"time":1764867184836,"env":"test","module":"user-credentials-repository","userId":"KAfTylh_JhK0qewtfKBQy","msg":"User credentials created"}
{"level":30,"time":1764867184837,"env":"test","module":"auth-routes","userId":"KAfTylh_JhK0qewtfKBQy","email":"test-workflows-NJaspX5s9oKKoKv-eKKHD@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867185028,"env":"test","module":"auth-routes","userId":"KAfTylh_JhK0qewtfKBQy","email":"test-workflows-NJaspX5s9oKKoKv-eKKHD@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867185223,"env":"test","error":{},"workflowId":"8c0fc487-626b-4f45-b9c3-69abee8b836d","userId":"QRVaDltgkE4BMLmVYDD6X","projectId":"48c6efd4-f5cd-475a-bbd4-725c69319663","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 12042[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 562[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 836[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 861[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 631[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 953[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:52:49
[2m   Duration [22m 16.63s[2m (transform 1.87s, setup 588ms, collect 3.54s, tests 12.04s, environment 0ms, prepare 13ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764867267350,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867268848,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867270503,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867270504,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867270514,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867270514,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867270515,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867270515,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867270975,"env":"test","module":"user-credentials-repository","userId":"t5ebUny5Oi7NG-671sX6g","msg":"User credentials created"}
{"level":30,"time":1764867270978,"env":"test","module":"auth-routes","userId":"t5ebUny5Oi7NG-671sX6g","email":"test-workflows-i1RZWvKJ1qyPPF9VFawPK@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0d520149-d998-4c05-8d46-bb583c3b7676","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"t5ebUny5Oi7NG-671sX6g","tenantId":"c73df396-78df-41a9-b276-6840342fb946","createdBy":"t5ebUny5Oi7NG-671sX6g","ownerId":"t5ebUny5Oi7NG-671sX6g","status":"active","archived":false,"createdAt":"2025-12-04T16:54:32.477Z","updatedAt":"2025-12-04T16:54:32.477Z"}

{"level":30,"time":1764867271718,"env":"test","module":"user-credentials-repository","userId":"ZbHk2HkrVZBIhgml2NODV","msg":"User credentials created"}
{"level":30,"time":1764867271720,"env":"test","module":"auth-routes","userId":"ZbHk2HkrVZBIhgml2NODV","email":"viewer-8e8S_cPAxd5ag8vi90ANO@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867271833,"env":"test","module":"rbac-middleware","userId":"ZbHk2HkrVZBIhgml2NODV","userRole":"viewer","permission":"workflow:create","path":"/projects/0d520149-d998-4c05-8d46-bb583c3b7676/workflows","msg":"Permission denied"}
{"level":50,"time":1764867279006,"env":"test","error":{},"workflowId":"e0b20377-a90b-41a6-a107-2f02d99d4dbc","userId":"t5ebUny5Oi7NG-671sX6g","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867279360,"env":"test","module":"auth-middleware","path":"/api/workflows/06f0989b-c543-496c-b77f-a06933e32077/move","msg":"No valid authentication found"}
{"level":30,"time":1764867279898,"env":"test","module":"user-credentials-repository","userId":"uT2J8vCouwQS27d5JFVyj","msg":"User credentials created"}
{"level":30,"time":1764867279899,"env":"test","module":"auth-routes","userId":"uT2J8vCouwQS27d5JFVyj","email":"test-workflows-qYOLUtqlbXwIdpbgvH1jY@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867279964,"env":"test","error":{},"workflowId":"071a2385-b4fa-4b03-b6e1-2891fa3df6a1","userId":"uT2J8vCouwQS27d5JFVyj","projectId":"3d7acfde-2419-4022-b8b5-d36506608e5b","msg":"Error moving workflow"}
{"level":50,"time":1764867280387,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ccd61501-53e7-488a-8570-08a246bef9c0","userId":"t5ebUny5Oi7NG-671sX6g","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867280789,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9422580d-21fd-4b04-b682-9adba1684045","userId":"t5ebUny5Oi7NG-671sX6g","msg":"Error moving workflow"}
{"level":30,"time":1764867281380,"env":"test","module":"user-credentials-repository","userId":"RO7rxfrMXH__KVl-j6CY6","msg":"User credentials created"}
{"level":30,"time":1764867281380,"env":"test","module":"auth-routes","userId":"RO7rxfrMXH__KVl-j6CY6","email":"test-workflows-NDKXm9k-PeevCLo_SjnRK@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867281584,"env":"test","module":"auth-routes","userId":"RO7rxfrMXH__KVl-j6CY6","email":"test-workflows-NDKXm9k-PeevCLo_SjnRK@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867281874,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4077fcd2-4d3d-4577-88c6-babb390c8c92","userId":"t5ebUny5Oi7NG-671sX6g","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11672[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 515[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 507[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 879[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 666[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 814[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 896[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 694[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 923[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 554[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 403[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1086[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:54:25
[2m   Duration [22m 16.75s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764867556245,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867558265,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867560614,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867560614,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867560624,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867560624,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867560624,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867560624,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867561071,"env":"test","module":"user-credentials-repository","userId":"8Vu6Psgo9a2uQzFCZC7u-","msg":"User credentials created"}
{"level":30,"time":1764867561075,"env":"test","module":"auth-routes","userId":"8Vu6Psgo9a2uQzFCZC7u-","email":"test-workflows-BcAAtpKms9DZW2for925s@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c8545727-8a57-4ba6-8280-749a63ee3537","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"8Vu6Psgo9a2uQzFCZC7u-","tenantId":"f1970845-fdab-41bd-8f4c-2caa83aa4920","createdBy":"8Vu6Psgo9a2uQzFCZC7u-","ownerId":"8Vu6Psgo9a2uQzFCZC7u-","status":"active","archived":false,"createdAt":"2025-12-04T16:59:22.580Z","updatedAt":"2025-12-04T16:59:22.580Z"}

{"level":30,"time":1764867561748,"env":"test","module":"user-credentials-repository","userId":"9Yuu4YE31hT3H8iTgMt1l","msg":"User credentials created"}
{"level":30,"time":1764867561749,"env":"test","module":"auth-routes","userId":"9Yuu4YE31hT3H8iTgMt1l","email":"viewer-aiulrMTcRJ4fWqV1PgLct@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867561842,"env":"test","module":"rbac-middleware","userId":"9Yuu4YE31hT3H8iTgMt1l","userRole":"viewer","permission":"workflow:create","path":"/projects/c8545727-8a57-4ba6-8280-749a63ee3537/workflows","msg":"Permission denied"}
{"level":50,"time":1764867568051,"env":"test","error":{},"workflowId":"15170325-7673-48d8-a04e-803cbe4ebe60","userId":"8Vu6Psgo9a2uQzFCZC7u-","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867568389,"env":"test","module":"auth-middleware","path":"/api/workflows/98918751-dd95-4435-9447-914893943725/move","msg":"No valid authentication found"}
{"level":30,"time":1764867568894,"env":"test","module":"user-credentials-repository","userId":"1oNeri0lFaqthdJQk_pIe","msg":"User credentials created"}
{"level":30,"time":1764867568895,"env":"test","module":"auth-routes","userId":"1oNeri0lFaqthdJQk_pIe","email":"test-workflows-m2eejlwcpbkLWpPeXYTOd@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867568941,"env":"test","error":{},"workflowId":"b5e6ce86-3bcd-4c38-a1d2-a4cf110c9e92","userId":"1oNeri0lFaqthdJQk_pIe","projectId":"d63774cc-ce66-438d-b00b-6f5ab9a5843f","msg":"Error moving workflow"}
{"level":50,"time":1764867569320,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"25803f95-f313-4431-b7f0-159e484b4ca3","userId":"8Vu6Psgo9a2uQzFCZC7u-","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867569682,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"433fdaf8-e467-431f-b24e-3bb08f9e1258","userId":"8Vu6Psgo9a2uQzFCZC7u-","msg":"Error moving workflow"}
{"level":30,"time":1764867570265,"env":"test","module":"user-credentials-repository","userId":"qaDS7C12ACtN6NHItmbOJ","msg":"User credentials created"}
{"level":30,"time":1764867570266,"env":"test","module":"auth-routes","userId":"qaDS7C12ACtN6NHItmbOJ","email":"test-workflows-vzHPzlMsw1qT0PcDWC_BC@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867570451,"env":"test","module":"auth-routes","userId":"qaDS7C12ACtN6NHItmbOJ","email":"test-workflows-vzHPzlMsw1qT0PcDWC_BC@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867570690,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"346ac5b1-60ad-47e3-8ca5-790c8c78d2f4","userId":"8Vu6Psgo9a2uQzFCZC7u-","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 625[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 553[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 366[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1007[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:59:13
[2m   Duration [22m 17.19s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764867688978,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867690759,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867692577,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867692578,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867692588,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867692589,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867692589,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867692589,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867693006,"env":"test","module":"user-credentials-repository","userId":"7iandGx0BOy5QaWVLWxDJ","msg":"User credentials created"}
{"level":30,"time":1764867693009,"env":"test","module":"auth-routes","userId":"7iandGx0BOy5QaWVLWxDJ","email":"test-workflows-auesea4-BAMH3LLWdWbNo@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3b934d77-2c69-44e5-afe8-0ba4c7f2c929","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"7iandGx0BOy5QaWVLWxDJ","tenantId":"4a12a8d7-98b4-44d6-87f3-da906e323760","createdBy":"7iandGx0BOy5QaWVLWxDJ","ownerId":"7iandGx0BOy5QaWVLWxDJ","status":"active","archived":false,"createdAt":"2025-12-04T17:01:34.521Z","updatedAt":"2025-12-04T17:01:34.521Z"}

{"level":30,"time":1764867693671,"env":"test","module":"user-credentials-repository","userId":"mjhypaduitRK-aMKWzUi8","msg":"User credentials created"}
{"level":30,"time":1764867693671,"env":"test","module":"auth-routes","userId":"mjhypaduitRK-aMKWzUi8","email":"viewer-2apL3WumEVjtE0xwF6s_U@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867693761,"env":"test","module":"rbac-middleware","userId":"mjhypaduitRK-aMKWzUi8","userRole":"viewer","permission":"workflow:create","path":"/projects/3b934d77-2c69-44e5-afe8-0ba4c7f2c929/workflows","msg":"Permission denied"}
{"level":50,"time":1764867699739,"env":"test","error":{},"workflowId":"bf31f711-6a6a-41ff-85f5-c53b04e25d22","userId":"7iandGx0BOy5QaWVLWxDJ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867700053,"env":"test","module":"auth-middleware","path":"/api/workflows/f6923e75-e36f-4f61-8ee4-1b3947c39320/move","msg":"No valid authentication found"}
{"level":30,"time":1764867700548,"env":"test","module":"user-credentials-repository","userId":"T3pXAl5vvJo0F-swx4mbZ","msg":"User credentials created"}
{"level":30,"time":1764867700548,"env":"test","module":"auth-routes","userId":"T3pXAl5vvJo0F-swx4mbZ","email":"test-workflows-y2udYLy8P2jaDZPx-7051@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867700596,"env":"test","error":{},"workflowId":"1ebbc6a8-84b3-43d2-8447-71a6f53f13fa","userId":"T3pXAl5vvJo0F-swx4mbZ","projectId":"6050503f-b285-4eda-9da0-2c8542736a61","msg":"Error moving workflow"}
{"level":50,"time":1764867700945,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"70ee89b3-ac31-45b1-b338-65f8b11cf36b","userId":"7iandGx0BOy5QaWVLWxDJ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867701281,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e9486c6c-4d4a-4b20-931a-99dd6c4ad2ee","userId":"7iandGx0BOy5QaWVLWxDJ","msg":"Error moving workflow"}
{"level":30,"time":1764867701778,"env":"test","module":"user-credentials-repository","userId":"sfeFctBwipZAggH9zVgIn","msg":"User credentials created"}
{"level":30,"time":1764867701778,"env":"test","module":"auth-routes","userId":"sfeFctBwipZAggH9zVgIn","email":"test-workflows-XR43sRLqolExco1hbq6gU@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867701966,"env":"test","module":"auth-routes","userId":"sfeFctBwipZAggH9zVgIn","email":"test-workflows-XR43sRLqolExco1hbq6gU@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867702145,"env":"test","error":{},"workflowId":"6d547480-8f3d-4f56-9e86-198185a1388e","userId":"7iandGx0BOy5QaWVLWxDJ","projectId":"ddc8e3aa-8932-44f3-9069-657ec431ab4b","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 314[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 577[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 335[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 864[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:01:26
[2m   Duration [22m 15.84s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764868031640,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868033651,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868035717,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868035718,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868035728,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868035728,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868035728,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868035728,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868036665,"env":"test","module":"user-credentials-repository","userId":"-FLdZBWNADl49sGVNoJ4l","msg":"User credentials created"}
{"level":30,"time":1764868036667,"env":"test","module":"auth-routes","userId":"-FLdZBWNADl49sGVNoJ4l","email":"test-workflows-2EZJVNmaZOFXuZs__jDPy@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"17fa3742-fa78-4463-b522-5064dcb87893","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"-FLdZBWNADl49sGVNoJ4l","tenantId":"9b3351fe-0931-4f0d-8c60-bce5c8d8ad2d","createdBy":"-FLdZBWNADl49sGVNoJ4l","ownerId":"-FLdZBWNADl49sGVNoJ4l","status":"active","archived":false,"createdAt":"2025-12-04T17:07:18.178Z","updatedAt":"2025-12-04T17:07:18.178Z"}

{"level":30,"time":1764868037381,"env":"test","module":"user-credentials-repository","userId":"6w-M4654W2bWG_slou72j","msg":"User credentials created"}
{"level":30,"time":1764868037382,"env":"test","module":"auth-routes","userId":"6w-M4654W2bWG_slou72j","email":"viewer-dOrks2pBFKQ61unndU5_X@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868037478,"env":"test","module":"rbac-middleware","userId":"6w-M4654W2bWG_slou72j","userRole":"viewer","permission":"workflow:create","path":"/projects/17fa3742-fa78-4463-b522-5064dcb87893/workflows","msg":"Permission denied"}
{"level":50,"time":1764868043711,"env":"test","error":{},"workflowId":"013092ba-16f8-4b52-bde6-c870d9bd129e","userId":"-FLdZBWNADl49sGVNoJ4l","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868044068,"env":"test","module":"auth-middleware","path":"/api/workflows/b90c7d7f-6b73-45f4-8e5a-23808e52e485/move","msg":"No valid authentication found"}
{"level":30,"time":1764868044592,"env":"test","module":"user-credentials-repository","userId":"Th0uMfE_5jf0YTd8Euh_N","msg":"User credentials created"}
{"level":30,"time":1764868044593,"env":"test","module":"auth-routes","userId":"Th0uMfE_5jf0YTd8Euh_N","email":"test-workflows-ZPUub8EmGcGUU6HLPlEpe@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868044637,"env":"test","error":{},"workflowId":"00ec3ad1-ef3b-4a87-b8a5-bee7e395ec9b","userId":"Th0uMfE_5jf0YTd8Euh_N","projectId":"e6707bd9-8f5e-40ea-b4a9-1b5523b7d8fc","msg":"Error moving workflow"}
{"level":50,"time":1764868045014,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2171e644-236e-4759-bf06-9cf7847e41c5","userId":"-FLdZBWNADl49sGVNoJ4l","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868045477,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"574bc78b-46f4-49a5-85c9-1a1db0fc2409","userId":"-FLdZBWNADl49sGVNoJ4l","msg":"Error moving workflow"}
{"level":30,"time":1764868046096,"env":"test","module":"user-credentials-repository","userId":"pcxXtSHxIou3DfVWVCeU1","msg":"User credentials created"}
{"level":30,"time":1764868046097,"env":"test","module":"auth-routes","userId":"pcxXtSHxIou3DfVWVCeU1","email":"test-workflows-FUax8w_R-1CxEUQvcanzX@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868046293,"env":"test","module":"auth-routes","userId":"pcxXtSHxIou3DfVWVCeU1","email":"test-workflows-FUax8w_R-1CxEUQvcanzX@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868046510,"env":"test","error":{},"workflowId":"1c1379bb-163a-483b-ac1c-167cdbaff79f","userId":"-FLdZBWNADl49sGVNoJ4l","projectId":"8544d28f-4f6d-4ac8-bb8f-bc37c289fccf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11094[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 796[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 764[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 585[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 463[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1034[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:07:08
[2m   Duration [22m 17.75s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764868270520,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868272251,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868274083,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868274084,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868274102,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868274102,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868274103,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868274103,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868274589,"env":"test","module":"user-credentials-repository","userId":"O2LZs_dyMgjVvLn5xn0Za","msg":"User credentials created"}
{"level":30,"time":1764868274592,"env":"test","module":"auth-routes","userId":"O2LZs_dyMgjVvLn5xn0Za","email":"test-workflows-GSVC_Jho0qssWp8nV_-ns@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c8d0b995-b1d0-4909-8140-dcd731bfd327","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"O2LZs_dyMgjVvLn5xn0Za","tenantId":"1a2d00c9-a2ec-47bf-87c5-ea7dc23c3d48","createdBy":"O2LZs_dyMgjVvLn5xn0Za","ownerId":"O2LZs_dyMgjVvLn5xn0Za","status":"active","archived":false,"createdAt":"2025-12-04T17:11:16.112Z","updatedAt":"2025-12-04T17:11:16.112Z"}

{"level":30,"time":1764868275300,"env":"test","module":"user-credentials-repository","userId":"IiTY5f434nfxv7yW-LnPP","msg":"User credentials created"}
{"level":30,"time":1764868275300,"env":"test","module":"auth-routes","userId":"IiTY5f434nfxv7yW-LnPP","email":"viewer-iniNtGJ-FoNlKFXp-dh-o@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868275397,"env":"test","module":"rbac-middleware","userId":"IiTY5f434nfxv7yW-LnPP","userRole":"viewer","permission":"workflow:create","path":"/projects/c8d0b995-b1d0-4909-8140-dcd731bfd327/workflows","msg":"Permission denied"}
{"level":50,"time":1764868281914,"env":"test","error":{},"workflowId":"7226e001-afa9-4e6c-be9a-80d6b3285fd9","userId":"O2LZs_dyMgjVvLn5xn0Za","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868282250,"env":"test","module":"auth-middleware","path":"/api/workflows/29db1d46-bae2-46f7-9e77-9884fbce756e/move","msg":"No valid authentication found"}
{"level":30,"time":1764868282767,"env":"test","module":"user-credentials-repository","userId":"1f1VifMHRmDvmHXl_Nhrz","msg":"User credentials created"}
{"level":30,"time":1764868282767,"env":"test","module":"auth-routes","userId":"1f1VifMHRmDvmHXl_Nhrz","email":"test-workflows-SdOXCaaNSGzntEU8terF5@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868282814,"env":"test","error":{},"workflowId":"0fefe160-0f2d-491c-92ee-ea4db3dafa49","userId":"1f1VifMHRmDvmHXl_Nhrz","projectId":"50e90043-f3e5-4b19-a326-b54a4c357fb6","msg":"Error moving workflow"}
{"level":50,"time":1764868283206,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b72f4f39-1b1c-4622-aed5-1a9cec41ab07","userId":"O2LZs_dyMgjVvLn5xn0Za","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868283585,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"06dfad90-bc08-4b58-87a8-1cbffe2f76dc","userId":"O2LZs_dyMgjVvLn5xn0Za","msg":"Error moving workflow"}
{"level":50,"time":1764868284259,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(wpy4PLTkMj_oi_zNdc07k) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wpy4PLTkMj_oi_zNdc07k","msg":"Failed to create user credentials"}
{"level":50,"time":1764868284259,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(wpy4PLTkMj_oi_zNdc07k) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 612[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 649[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 867[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 632[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 392[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 379[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 674[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:11:07
[2m   Duration [22m 16.32s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764868529485,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531580,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533565,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533565,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533574,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533574,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533574,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533574,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868534012,"env":"test","module":"user-credentials-repository","userId":"R-zbAvXVbVrU8yBO4wi_G","msg":"User credentials created"}
{"level":30,"time":1764868534015,"env":"test","module":"auth-routes","userId":"R-zbAvXVbVrU8yBO4wi_G","email":"test-workflows-KmhoGGHZVAbgZdtZQhMsa@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"34986794-9bbc-4210-9013-6ad2c1a728f4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"R-zbAvXVbVrU8yBO4wi_G","tenantId":"c6e0dd26-387d-4115-a49b-73c44d7593fb","createdBy":"R-zbAvXVbVrU8yBO4wi_G","ownerId":"R-zbAvXVbVrU8yBO4wi_G","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.539Z","updatedAt":"2025-12-04T17:15:35.539Z"}

{"level":30,"time":1764868534681,"env":"test","module":"user-credentials-repository","userId":"E5J2AYbLo3nUk9-0ow9KN","msg":"User credentials created"}
{"level":30,"time":1764868534682,"env":"test","module":"auth-routes","userId":"E5J2AYbLo3nUk9-0ow9KN","email":"viewer-559QinBAHAXsCkV09YrkS@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534771,"env":"test","module":"rbac-middleware","userId":"E5J2AYbLo3nUk9-0ow9KN","userRole":"viewer","permission":"workflow:create","path":"/projects/34986794-9bbc-4210-9013-6ad2c1a728f4/workflows","msg":"Permission denied"}
{"level":50,"time":1764868541171,"env":"test","error":{},"workflowId":"cf07b88c-44fa-4cc9-aed7-6d1904e81fb5","userId":"R-zbAvXVbVrU8yBO4wi_G","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541509,"env":"test","module":"auth-middleware","path":"/api/workflows/2a10db16-40b8-44a1-8bf2-f7e3bb125c41/move","msg":"No valid authentication found"}
{"level":30,"time":1764868542018,"env":"test","module":"user-credentials-repository","userId":"cUd-XIBVQAlbd5HyzulNk","msg":"User credentials created"}
{"level":30,"time":1764868542019,"env":"test","module":"auth-routes","userId":"cUd-XIBVQAlbd5HyzulNk","email":"test-workflows-C0-HRoh2SqF-PZ4LsO6IM@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868542076,"env":"test","error":{},"workflowId":"f19f5240-0587-441d-a0f5-82734409025a","userId":"cUd-XIBVQAlbd5HyzulNk","projectId":"ca2f7c91-2654-4e38-b42b-477c178b06ee","msg":"Error moving workflow"}
{"level":50,"time":1764868542540,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"bda99b0c-ad62-4add-9762-62425ce811be","userId":"R-zbAvXVbVrU8yBO4wi_G","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868543017,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"dd412d6d-7f7e-4c59-bee0-4c9d42cc27b4","userId":"R-zbAvXVbVrU8yBO4wi_G","msg":"Error moving workflow"}
{"level":50,"time":1764868543622,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CGLiyGvzn6fAm4EgTSAK5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"CGLiyGvzn6fAm4EgTSAK5","msg":"Failed to create user credentials"}
{"level":50,"time":1764868543622,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CGLiyGvzn6fAm4EgTSAK5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 316[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 288[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 795[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 606[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 477[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 606[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 18.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764868816514,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818747,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820728,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820729,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820737,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820738,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820738,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820738,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821187,"env":"test","module":"user-credentials-repository","userId":"RLSOaKha3gfENi9V8Spn1","msg":"User credentials created"}
{"level":30,"time":1764868821190,"env":"test","module":"auth-routes","userId":"RLSOaKha3gfENi9V8Spn1","email":"test-workflows-Q8lRXeRH3hIUYOGXytcsh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"70d93213-2ff3-4940-bccb-04542d5cf4f2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"RLSOaKha3gfENi9V8Spn1","tenantId":"70c0a77b-a894-4e90-a9f8-ee1eb2a1cab3","createdBy":"RLSOaKha3gfENi9V8Spn1","ownerId":"RLSOaKha3gfENi9V8Spn1","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.712Z","updatedAt":"2025-12-04T17:20:22.712Z"}

{"level":30,"time":1764868821865,"env":"test","module":"user-credentials-repository","userId":"kQgr9aiyIEU0mjdDOb5cA","msg":"User credentials created"}
{"level":30,"time":1764868821866,"env":"test","module":"auth-routes","userId":"kQgr9aiyIEU0mjdDOb5cA","email":"viewer-PlOSfDt0byEqP9s3soVvq@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821966,"env":"test","module":"rbac-middleware","userId":"kQgr9aiyIEU0mjdDOb5cA","userRole":"viewer","permission":"workflow:create","path":"/projects/70d93213-2ff3-4940-bccb-04542d5cf4f2/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828141,"env":"test","error":{},"workflowId":"6da30f78-5dc3-4c01-84c5-389b890f00e4","userId":"RLSOaKha3gfENi9V8Spn1","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828437,"env":"test","module":"auth-middleware","path":"/api/workflows/b6f083ae-a7c5-4a5d-b58f-835a00b1b1de/move","msg":"No valid authentication found"}
{"level":30,"time":1764868828941,"env":"test","module":"user-credentials-repository","userId":"xMXbchPfMU-y9gmxfg--J","msg":"User credentials created"}
{"level":30,"time":1764868828942,"env":"test","module":"auth-routes","userId":"xMXbchPfMU-y9gmxfg--J","email":"test-workflows-APD6Jg2X2apxRHaiNMoh1@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868828989,"env":"test","error":{},"workflowId":"ff9a7e85-feb4-4bca-8a16-97dbfebeb456","userId":"xMXbchPfMU-y9gmxfg--J","projectId":"8797d49a-c718-44d4-b571-28756e7a3cb7","msg":"Error moving workflow"}
{"level":50,"time":1764868829354,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2e2e41c6-558a-4fe9-a3fa-93080908df3b","userId":"RLSOaKha3gfENi9V8Spn1","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868829733,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"913eaf8f-c29f-4d3a-9a3a-113a6200765b","userId":"RLSOaKha3gfENi9V8Spn1","msg":"Error moving workflow"}
{"level":30,"time":1764868830274,"env":"test","module":"user-credentials-repository","userId":"GG2K_-lXJPdFXBdqfa7-R","msg":"User credentials created"}
{"level":30,"time":1764868830274,"env":"test","module":"auth-routes","userId":"GG2K_-lXJPdFXBdqfa7-R","email":"test-workflows-056KJuAl-xxgf8ne3jATG@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830469,"env":"test","module":"auth-routes","userId":"GG2K_-lXJPdFXBdqfa7-R","email":"test-workflows-056KJuAl-xxgf8ne3jATG@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868830661,"env":"test","error":{},"workflowId":"0fd1f1c1-5491-4dae-94c3-4a66166da082","userId":"RLSOaKha3gfENi9V8Spn1","projectId":"f82d9ae4-c027-4ec1-b50b-f45c2107ee89","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10226[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 445[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 379[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 930[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.34s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764871633780,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871638449,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871642211,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871642212,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871642228,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871642228,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871642229,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871642229,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871642738,"env":"test","module":"user-credentials-repository","userId":"EGoN-svLBAHkDSFl28lY0","msg":"User credentials created"}
{"level":30,"time":1764871642743,"env":"test","module":"auth-routes","userId":"EGoN-svLBAHkDSFl28lY0","email":"test-workflows-LiO-OnAKnz1T2K3vvJNbI@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f32e1904-fbd6-4f7e-af48-4c60a1fa7a20","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"EGoN-svLBAHkDSFl28lY0","tenantId":"ddc177db-46d6-4eb2-b010-7418f9e8bee4","createdBy":"EGoN-svLBAHkDSFl28lY0","ownerId":"EGoN-svLBAHkDSFl28lY0","status":"active","archived":false,"createdAt":"2025-12-04T18:07:24.314Z","updatedAt":"2025-12-04T18:07:24.314Z"}

{"level":30,"time":1764871643411,"env":"test","module":"user-credentials-repository","userId":"ZJQ_aOY_1IbMUMHqC9FX5","msg":"User credentials created"}
{"level":30,"time":1764871643412,"env":"test","module":"auth-routes","userId":"ZJQ_aOY_1IbMUMHqC9FX5","email":"viewer-Qvg1-JHQolD9RP2FWnVUM@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871643512,"env":"test","module":"rbac-middleware","userId":"ZJQ_aOY_1IbMUMHqC9FX5","userRole":"viewer","permission":"workflow:create","path":"/projects/f32e1904-fbd6-4f7e-af48-4c60a1fa7a20/workflows","msg":"Permission denied"}
{"level":50,"time":1764871649363,"env":"test","error":{},"workflowId":"8deed6a6-9485-4734-8d80-3e05f3dc5fb8","userId":"EGoN-svLBAHkDSFl28lY0","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871649716,"env":"test","module":"auth-middleware","path":"/api/workflows/2d32ad6c-5554-433e-8848-94bba8793488/move","msg":"No valid authentication found"}
{"level":30,"time":1764871650209,"env":"test","module":"user-credentials-repository","userId":"y9ItDxS43ZCCpyTW0j6K_","msg":"User credentials created"}
{"level":30,"time":1764871650210,"env":"test","module":"auth-routes","userId":"y9ItDxS43ZCCpyTW0j6K_","email":"test-workflows-4kBrsIDkP5fLtsnaWdDcG@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871650253,"env":"test","error":{},"workflowId":"2c9ae6fe-4b5f-47a2-8fdb-f54713b569fa","userId":"y9ItDxS43ZCCpyTW0j6K_","projectId":"f267bdf2-1a36-409d-aa45-94a6c3aa7951","msg":"Error moving workflow"}
{"level":50,"time":1764871650602,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9400a64a-8b07-4f86-8cc7-81400b986485","userId":"EGoN-svLBAHkDSFl28lY0","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871650963,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8f80ae9a-c741-4ebc-9960-f26c1ac4b2d0","userId":"EGoN-svLBAHkDSFl28lY0","msg":"Error moving workflow"}
{"level":30,"time":1764871651431,"env":"test","module":"user-credentials-repository","userId":"GpfGYCK0tzE1cn5VH-uRD","msg":"User credentials created"}
{"level":30,"time":1764871651432,"env":"test","module":"auth-routes","userId":"GpfGYCK0tzE1cn5VH-uRD","email":"test-workflows-JVh0pjyPQ6jJlaeHmcWJP@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871651608,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764871651650,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"32975b2b-0d3d-4888-bd90-8b90605ff583","userId":"EGoN-svLBAHkDSFl28lY0","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 429[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 569[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 687[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 360[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 688[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 22.21s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764871702812,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871705534,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871709582,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871709583,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871709595,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871709595,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871709595,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871709596,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710084,"env":"test","module":"user-credentials-repository","userId":"IV4SRpJgKuF0e6cilsl1W","msg":"User credentials created"}
{"level":30,"time":1764871710087,"env":"test","module":"auth-routes","userId":"IV4SRpJgKuF0e6cilsl1W","email":"test-workflows-hCSHn0xBQCrpNZKBWIM6_@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9e404d10-e0e8-4d3d-8da8-c60eb089c6ad","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"IV4SRpJgKuF0e6cilsl1W","tenantId":"ee9f7963-69bd-41e7-9d42-c6164be2893d","createdBy":"IV4SRpJgKuF0e6cilsl1W","ownerId":"IV4SRpJgKuF0e6cilsl1W","status":"active","archived":false,"createdAt":"2025-12-04T18:08:31.663Z","updatedAt":"2025-12-04T18:08:31.663Z"}

{"level":30,"time":1764871710767,"env":"test","module":"user-credentials-repository","userId":"n9NMjYjBTMTpZp8hzjg8t","msg":"User credentials created"}
{"level":30,"time":1764871710768,"env":"test","module":"auth-routes","userId":"n9NMjYjBTMTpZp8hzjg8t","email":"viewer-fhylf2EdYMbwGwZ-iNeCV@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871710863,"env":"test","module":"rbac-middleware","userId":"n9NMjYjBTMTpZp8hzjg8t","userRole":"viewer","permission":"workflow:create","path":"/projects/9e404d10-e0e8-4d3d-8da8-c60eb089c6ad/workflows","msg":"Permission denied"}
{"level":50,"time":1764871717121,"env":"test","error":{},"workflowId":"057e4dab-49c4-4af4-a917-a6250f334e91","userId":"IV4SRpJgKuF0e6cilsl1W","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871717446,"env":"test","module":"auth-middleware","path":"/api/workflows/698a44c9-d806-4f60-a0c9-80f898799724/move","msg":"No valid authentication found"}
{"level":30,"time":1764871717957,"env":"test","module":"user-credentials-repository","userId":"eSBhVBnjZAigjcTmIfQlC","msg":"User credentials created"}
{"level":30,"time":1764871717958,"env":"test","module":"auth-routes","userId":"eSBhVBnjZAigjcTmIfQlC","email":"test-workflows-xE60Ttmu-dJwPX1V6I_GB@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871718006,"env":"test","error":{},"workflowId":"69044f1f-cd68-474c-8648-1b65986f867e","userId":"eSBhVBnjZAigjcTmIfQlC","projectId":"cc2f8321-5927-4f0a-873d-d445fc70ad68","msg":"Error moving workflow"}
{"level":50,"time":1764871718372,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7a1a9c54-ea80-4868-8888-bf72b8a38e36","userId":"IV4SRpJgKuF0e6cilsl1W","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871718745,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bc83abe2-10a7-4120-93f8-54f88b28fbce","userId":"IV4SRpJgKuF0e6cilsl1W","msg":"Error moving workflow"}
{"level":30,"time":1764871719259,"env":"test","module":"user-credentials-repository","userId":"XRjjIvwl1_QnCTb6eLX99","msg":"User credentials created"}
{"level":30,"time":1764871719259,"env":"test","module":"auth-routes","userId":"XRjjIvwl1_QnCTb6eLX99","email":"test-workflows-6Bg_4SJlLorBwLH0khx3s@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871719461,"env":"test","module":"auth-routes","userId":"XRjjIvwl1_QnCTb6eLX99","email":"test-workflows-6Bg_4SJlLorBwLH0khx3s@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871719644,"env":"test","error":{},"workflowId":"919e862f-c881-446a-998f-e156944e9782","userId":"IV4SRpJgKuF0e6cilsl1W","projectId":"59191dcd-2932-4294-b586-4d30d3f23f01","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 495[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 374[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 901[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 21.43s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764871753908,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871756423,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871759915,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871759915,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871759927,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871759928,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871759928,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871759928,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871760450,"env":"test","module":"user-credentials-repository","userId":"olhaz1BlNYXrhBVlI70on","msg":"User credentials created"}
{"level":30,"time":1764871760454,"env":"test","module":"auth-routes","userId":"olhaz1BlNYXrhBVlI70on","email":"test-workflows-Hv6XMEB0iY8_k07P96nGz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"95c7233d-e068-485b-b3fa-cf031c8b3054","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"olhaz1BlNYXrhBVlI70on","tenantId":"f46dd699-e9ef-4008-a309-c6b39342e984","createdBy":"olhaz1BlNYXrhBVlI70on","ownerId":"olhaz1BlNYXrhBVlI70on","status":"active","archived":false,"createdAt":"2025-12-04T18:09:22.038Z","updatedAt":"2025-12-04T18:09:22.038Z"}

{"level":30,"time":1764871761129,"env":"test","module":"user-credentials-repository","userId":"lWVNrZoEpsErWNEGZGXWp","msg":"User credentials created"}
{"level":30,"time":1764871761130,"env":"test","module":"auth-routes","userId":"lWVNrZoEpsErWNEGZGXWp","email":"viewer-KV4IYnEzTwKg6FUxHONfa@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871761221,"env":"test","module":"rbac-middleware","userId":"lWVNrZoEpsErWNEGZGXWp","userRole":"viewer","permission":"workflow:create","path":"/projects/95c7233d-e068-485b-b3fa-cf031c8b3054/workflows","msg":"Permission denied"}
{"level":50,"time":1764871767391,"env":"test","error":{},"workflowId":"72a4462e-c84d-42d1-abb3-41bd719b2d27","userId":"olhaz1BlNYXrhBVlI70on","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871767722,"env":"test","module":"auth-middleware","path":"/api/workflows/9a10e1fe-e725-4da2-b34f-7e5849d916ba/move","msg":"No valid authentication found"}
{"level":30,"time":1764871768231,"env":"test","module":"user-credentials-repository","userId":"Ii0Wv8TUd2Y6-LqS1x_jR","msg":"User credentials created"}
{"level":30,"time":1764871768231,"env":"test","module":"auth-routes","userId":"Ii0Wv8TUd2Y6-LqS1x_jR","email":"test-workflows-z_kx2OzQ5_pwM0W4OU_Xx@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871768281,"env":"test","error":{},"workflowId":"a6f60625-b46b-4f30-9f4c-239c2db9ccb0","userId":"Ii0Wv8TUd2Y6-LqS1x_jR","projectId":"eb03a797-d394-4a2f-b2f9-bd1aeeef19ed","msg":"Error moving workflow"}
{"level":50,"time":1764871768651,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"624951f3-d8fe-4ea2-ad0e-3c402ed3f26d","userId":"olhaz1BlNYXrhBVlI70on","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871769027,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"df3ad01c-a71d-45d6-ab2a-3493e8f45505","userId":"olhaz1BlNYXrhBVlI70on","msg":"Error moving workflow"}
{"level":30,"time":1764871769543,"env":"test","module":"user-credentials-repository","userId":"uFeDBtXXouyaQxc5Hayi1","msg":"User credentials created"}
{"level":30,"time":1764871769544,"env":"test","module":"auth-routes","userId":"uFeDBtXXouyaQxc5Hayi1","email":"test-workflows-iAH2SjdwbCSucBcVpPSe4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871769747,"env":"test","module":"auth-routes","userId":"uFeDBtXXouyaQxc5Hayi1","email":"test-workflows-iAH2SjdwbCSucBcVpPSe4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871769935,"env":"test","error":{},"workflowId":"e374ae57-c34b-4b0a-80de-ee56dabcf3ce","userId":"olhaz1BlNYXrhBVlI70on","projectId":"8e231a69-589c-49ed-9b95-fc90f29676c1","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10261[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 909[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 20.64s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764873689354,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873692984,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873696972,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873696973,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873696985,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873696985,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873696985,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873696985,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873697506,"env":"test","module":"user-credentials-repository","userId":"Bwvkq9YsSXMCj7AFbsWDP","msg":"User credentials created"}
{"level":30,"time":1764873697510,"env":"test","module":"auth-routes","userId":"Bwvkq9YsSXMCj7AFbsWDP","email":"test-workflows-kdaYc5VeK8Q2sBluV1Pea@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"04caf8d6-e4e9-4dd1-b6e3-754ea431b20d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Bwvkq9YsSXMCj7AFbsWDP","tenantId":"895c4099-0dfb-44e5-80ec-2aca2e150ee5","createdBy":"Bwvkq9YsSXMCj7AFbsWDP","ownerId":"Bwvkq9YsSXMCj7AFbsWDP","status":"active","archived":false,"createdAt":"2025-12-04T18:41:39.116Z","updatedAt":"2025-12-04T18:41:39.116Z"}

{"level":30,"time":1764873698282,"env":"test","module":"user-credentials-repository","userId":"08cqjxN7cUAxlFaMaM92R","msg":"User credentials created"}
{"level":30,"time":1764873698283,"env":"test","module":"auth-routes","userId":"08cqjxN7cUAxlFaMaM92R","email":"viewer-RqOzrKrucAoCu8DeKyWwO@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873698380,"env":"test","module":"rbac-middleware","userId":"08cqjxN7cUAxlFaMaM92R","userRole":"viewer","permission":"workflow:create","path":"/projects/04caf8d6-e4e9-4dd1-b6e3-754ea431b20d/workflows","msg":"Permission denied"}
{"level":50,"time":1764873704865,"env":"test","error":{},"workflowId":"76a8769a-ef5f-4473-bdaa-856018264e70","userId":"Bwvkq9YsSXMCj7AFbsWDP","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873705211,"env":"test","module":"auth-middleware","path":"/api/workflows/3a470c3f-4e3d-459a-ba63-50a3a429be06/move","msg":"No valid authentication found"}
{"level":30,"time":1764873705737,"env":"test","module":"user-credentials-repository","userId":"kBCgY5fNgTMK8MrfbZxP_","msg":"User credentials created"}
{"level":30,"time":1764873705738,"env":"test","module":"auth-routes","userId":"kBCgY5fNgTMK8MrfbZxP_","email":"test-workflows-DoqZoCB7E8hXn5ZcFjU85@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873705787,"env":"test","error":{},"workflowId":"73f265a1-eee4-4362-a4e0-4b3b7afdc0a9","userId":"kBCgY5fNgTMK8MrfbZxP_","projectId":"a3f1a3c0-cf35-4826-be26-27cf3731ec91","msg":"Error moving workflow"}
{"level":50,"time":1764873706179,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ff14c952-58b7-4077-a45d-450ff31e8ddc","userId":"Bwvkq9YsSXMCj7AFbsWDP","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873706589,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d7988f2f-e588-4d95-b13d-8a230e560575","userId":"Bwvkq9YsSXMCj7AFbsWDP","msg":"Error moving workflow"}
{"level":30,"time":1764873707133,"env":"test","module":"user-credentials-repository","userId":"nXJLt4miwZQe5iEBsLRaW","msg":"User credentials created"}
{"level":30,"time":1764873707133,"env":"test","module":"auth-routes","userId":"nXJLt4miwZQe5iEBsLRaW","email":"test-workflows-pXRd5w43Tb5G26-PnjXLP@example.com","msg":"User registered successfully"}
{"level":30,"time":1764873707348,"env":"test","module":"auth-routes","userId":"nXJLt4miwZQe5iEBsLRaW","email":"test-workflows-pXRd5w43Tb5G26-PnjXLP@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764873707541,"env":"test","error":{},"workflowId":"8331ae10-04e5-46c3-a2cb-bd26bd1876d8","userId":"Bwvkq9YsSXMCj7AFbsWDP","projectId":"ff6828fc-2746-4422-a6db-44a9a909a44e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10857[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 409[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 807[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 830[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 393[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 410[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 954[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 21.94s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764874580535,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874585604,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874592497,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874592498,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874592512,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874592512,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874592512,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874592512,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874593028,"env":"test","module":"user-credentials-repository","userId":"XFh3duZjbjH4M5KZZME18","msg":"User credentials created"}
{"level":30,"time":1764874593031,"env":"test","module":"auth-routes","userId":"XFh3duZjbjH4M5KZZME18","email":"test-workflows-gRmlDMZUnF9O8VYKGdRzO@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"408a1f1e-a02c-49bc-a766-9487ae68dc40","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"XFh3duZjbjH4M5KZZME18","tenantId":"d185acbd-f5ca-4b81-9d9e-52b00ebd9f9f","createdBy":"XFh3duZjbjH4M5KZZME18","ownerId":"XFh3duZjbjH4M5KZZME18","status":"active","archived":false,"createdAt":"2025-12-04T18:56:34.649Z","updatedAt":"2025-12-04T18:56:34.649Z"}

{"level":30,"time":1764874593704,"env":"test","module":"user-credentials-repository","userId":"gIf15JfcDZ7kxMNeWxlcG","msg":"User credentials created"}
{"level":30,"time":1764874593705,"env":"test","module":"auth-routes","userId":"gIf15JfcDZ7kxMNeWxlcG","email":"viewer-Yn7t7dFoSvVGwXuKYkbEu@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874593807,"env":"test","module":"rbac-middleware","userId":"gIf15JfcDZ7kxMNeWxlcG","userRole":"viewer","permission":"workflow:create","path":"/projects/408a1f1e-a02c-49bc-a766-9487ae68dc40/workflows","msg":"Permission denied"}
{"level":50,"time":1764874599932,"env":"test","error":{},"workflowId":"be860c06-bf96-48c3-8ac4-4ed3c4a8eebc","userId":"XFh3duZjbjH4M5KZZME18","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874600249,"env":"test","module":"auth-middleware","path":"/api/workflows/f8945f65-0760-4e7f-9e85-b1e6d3965a9f/move","msg":"No valid authentication found"}
{"level":30,"time":1764874600750,"env":"test","module":"user-credentials-repository","userId":"_ah153lAITkh0htn6FNLI","msg":"User credentials created"}
{"level":30,"time":1764874600750,"env":"test","module":"auth-routes","userId":"_ah153lAITkh0htn6FNLI","email":"test-workflows-MdvtJ2vO6KssKEXESskda@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874600799,"env":"test","error":{},"workflowId":"dd827951-d702-4f6b-84e8-cd8c03887546","userId":"_ah153lAITkh0htn6FNLI","projectId":"c51123c2-eedc-4af3-bbbe-416e0b124a9e","msg":"Error moving workflow"}
{"level":50,"time":1764874601251,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f7065978-84f1-41a1-a358-e4ef0f7f2078","userId":"XFh3duZjbjH4M5KZZME18","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874601601,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d3155c97-f617-4510-9f68-dda030091e26","userId":"XFh3duZjbjH4M5KZZME18","msg":"Error moving workflow"}
{"level":30,"time":1764874602110,"env":"test","module":"user-credentials-repository","userId":"fScwegJMUMb-35ZoUlJsq","msg":"User credentials created"}
{"level":30,"time":1764874602111,"env":"test","module":"auth-routes","userId":"fScwegJMUMb-35ZoUlJsq","email":"test-workflows-RQUCreQfy0cQJAhYzVHaI@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874602242,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764874602291,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2d162394-8bfd-4351-83a4-bb90bf6d5ec7","userId":"XFh3duZjbjH4M5KZZME18","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10054[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 726[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 550[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 349[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 691[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.15s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764874684645,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874689510,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874696027,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874696028,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874696160,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874696160,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874696162,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874696162,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874696659,"env":"test","module":"user-credentials-repository","userId":"6-GzQhEP6vUd7SAtvzHrg","msg":"User credentials created"}
{"level":30,"time":1764874696663,"env":"test","module":"auth-routes","userId":"6-GzQhEP6vUd7SAtvzHrg","email":"test-workflows-Egz7HHPcR4o0_IvmXaZW1@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"4e95a6a4-3863-4eb1-953a-a98428bf6c2a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"6-GzQhEP6vUd7SAtvzHrg","tenantId":"9a3d74c9-443d-4e07-bc68-12dcf04a52bc","createdBy":"6-GzQhEP6vUd7SAtvzHrg","ownerId":"6-GzQhEP6vUd7SAtvzHrg","status":"active","archived":false,"createdAt":"2025-12-04T18:58:18.283Z","updatedAt":"2025-12-04T18:58:18.283Z"}

{"level":30,"time":1764874697353,"env":"test","module":"user-credentials-repository","userId":"zJ3cj8hjRbEBDOKwBn0eL","msg":"User credentials created"}
{"level":30,"time":1764874697354,"env":"test","module":"auth-routes","userId":"zJ3cj8hjRbEBDOKwBn0eL","email":"viewer-XuuqCgzJcsMBxgiHmzS7d@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874697441,"env":"test","module":"rbac-middleware","userId":"zJ3cj8hjRbEBDOKwBn0eL","userRole":"viewer","permission":"workflow:create","path":"/projects/4e95a6a4-3863-4eb1-953a-a98428bf6c2a/workflows","msg":"Permission denied"}
{"level":50,"time":1764874703562,"env":"test","error":{},"workflowId":"e715cb74-7b3c-49b3-9827-e2f592a637df","userId":"6-GzQhEP6vUd7SAtvzHrg","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874703889,"env":"test","module":"auth-middleware","path":"/api/workflows/b3727e13-c54e-4d24-8c2b-5dd99dd3d528/move","msg":"No valid authentication found"}
{"level":30,"time":1764874704383,"env":"test","module":"user-credentials-repository","userId":"wP7T88TsKEf4qQxWwhpLE","msg":"User credentials created"}
{"level":30,"time":1764874704384,"env":"test","module":"auth-routes","userId":"wP7T88TsKEf4qQxWwhpLE","email":"test-workflows-aqFpOchIUcwPEOCb4y1dU@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874704428,"env":"test","error":{},"workflowId":"15806c3b-9645-494d-8931-4e6afd33debf","userId":"wP7T88TsKEf4qQxWwhpLE","projectId":"9c85979c-76f3-4873-bb11-aa831dc17f1a","msg":"Error moving workflow"}
{"level":50,"time":1764874704805,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"48de7826-08b6-4036-a01f-5a06551c5fc8","userId":"6-GzQhEP6vUd7SAtvzHrg","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874705173,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a89e13e0-47a8-47c3-9cf5-ce449e3ccc94","userId":"6-GzQhEP6vUd7SAtvzHrg","msg":"Error moving workflow"}
{"level":30,"time":1764874705690,"env":"test","module":"user-credentials-repository","userId":"2rO50B7Mi3h_75kmcrOIA","msg":"User credentials created"}
{"level":30,"time":1764874705691,"env":"test","module":"auth-routes","userId":"2rO50B7Mi3h_75kmcrOIA","email":"test-workflows-Z74gtNMwfheNcviCzNxWi@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874705882,"env":"test","module":"auth-routes","userId":"2rO50B7Mi3h_75kmcrOIA","email":"test-workflows-Z74gtNMwfheNcviCzNxWi@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874706050,"env":"test","error":{},"workflowId":"ec70d57d-ed9c-4a83-be7c-f2984c79fe90","userId":"6-GzQhEP6vUd7SAtvzHrg","projectId":"baa9e068-b9b0-454a-9951-f4cc20b6fe63","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 876[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 26.06s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764876565418,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876570412,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876574850,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876574851,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876574863,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876574863,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876574863,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876574863,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876575397,"env":"test","module":"user-credentials-repository","userId":"LaGM-Ldl4-7ncCbFtUOKG","msg":"User credentials created"}
{"level":30,"time":1764876575403,"env":"test","module":"auth-routes","userId":"LaGM-Ldl4-7ncCbFtUOKG","email":"test-workflows-YPPEpK4FH6BDLvgXQ5kOn@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c01d2aed-ee9b-46e2-9486-d994efa9cfe5","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"LaGM-Ldl4-7ncCbFtUOKG","tenantId":"5c5766c4-715b-478c-8e35-e895b1e2b3ea","createdBy":"LaGM-Ldl4-7ncCbFtUOKG","ownerId":"LaGM-Ldl4-7ncCbFtUOKG","status":"active","archived":false,"createdAt":"2025-12-04T19:29:37.073Z","updatedAt":"2025-12-04T19:29:37.073Z"}

{"level":30,"time":1764876576098,"env":"test","module":"user-credentials-repository","userId":"SgTCjys66G04cKOXcjJvX","msg":"User credentials created"}
{"level":30,"time":1764876576099,"env":"test","module":"auth-routes","userId":"SgTCjys66G04cKOXcjJvX","email":"viewer-G6yHXQAtkL6wB7Euqxwix@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876576193,"env":"test","module":"rbac-middleware","userId":"SgTCjys66G04cKOXcjJvX","userRole":"viewer","permission":"workflow:create","path":"/projects/c01d2aed-ee9b-46e2-9486-d994efa9cfe5/workflows","msg":"Permission denied"}
{"level":50,"time":1764876582448,"env":"test","error":{},"workflowId":"7d023382-1403-427a-9466-b850eeff7c96","userId":"LaGM-Ldl4-7ncCbFtUOKG","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876582784,"env":"test","module":"auth-middleware","path":"/api/workflows/0c74f3dc-dad0-44d0-898e-3ee87fe4a234/move","msg":"No valid authentication found"}
{"level":30,"time":1764876583292,"env":"test","module":"user-credentials-repository","userId":"V_u2rM0eu_yxoq86DWWIt","msg":"User credentials created"}
{"level":30,"time":1764876583292,"env":"test","module":"auth-routes","userId":"V_u2rM0eu_yxoq86DWWIt","email":"test-workflows-uH3aeBwz38tbexleGbAoQ@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876583340,"env":"test","error":{},"workflowId":"ab851591-9cab-4ebd-a7a4-2886b204c0d7","userId":"V_u2rM0eu_yxoq86DWWIt","projectId":"b5ef59fb-a439-463f-9853-1ee5812f7027","msg":"Error moving workflow"}
{"level":50,"time":1764876583711,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ad32a863-1b38-471a-878a-6c3ff15b92df","userId":"LaGM-Ldl4-7ncCbFtUOKG","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876584157,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"56bbcddf-c960-4e61-bf39-efc4ff7e269e","userId":"LaGM-Ldl4-7ncCbFtUOKG","msg":"Error moving workflow"}
{"level":50,"time":1764876585346,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(LaGM-Ldl4-7ncCbFtUOKG) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"LaGM-Ldl4-7ncCbFtUOKG","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 333[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 446[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1190[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:29:20
[2m   Duration [22m 24.07s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764876645860,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876648938,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876652970,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876652970,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876652982,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876652982,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876652982,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876652982,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876653502,"env":"test","module":"user-credentials-repository","userId":"1cmL92b88mKU1kJUlnn8x","msg":"User credentials created"}
{"level":30,"time":1764876653506,"env":"test","module":"auth-routes","userId":"1cmL92b88mKU1kJUlnn8x","email":"test-workflows-wmiBzHZ7btZpqPSsjmwv2@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"821500f4-84b3-448e-99c3-361f069ca553","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"1cmL92b88mKU1kJUlnn8x","tenantId":"eb3a6505-9831-410d-83e7-d9d96738b7e3","createdBy":"1cmL92b88mKU1kJUlnn8x","ownerId":"1cmL92b88mKU1kJUlnn8x","status":"active","archived":false,"createdAt":"2025-12-04T19:30:55.161Z","updatedAt":"2025-12-04T19:30:55.161Z"}

{"level":30,"time":1764876654165,"env":"test","module":"user-credentials-repository","userId":"LV_eeq_o33abAWgC9TZIm","msg":"User credentials created"}
{"level":30,"time":1764876654166,"env":"test","module":"auth-routes","userId":"LV_eeq_o33abAWgC9TZIm","email":"viewer-KA7uedFHVSv1lL28NaxuK@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876654259,"env":"test","module":"rbac-middleware","userId":"LV_eeq_o33abAWgC9TZIm","userRole":"viewer","permission":"workflow:create","path":"/projects/821500f4-84b3-448e-99c3-361f069ca553/workflows","msg":"Permission denied"}
{"level":50,"time":1764876660696,"env":"test","error":{},"workflowId":"6bfe495e-c84c-4f86-b914-88ef29debc68","userId":"1cmL92b88mKU1kJUlnn8x","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876661006,"env":"test","module":"auth-middleware","path":"/api/workflows/21da514a-8fc9-43f7-b1dc-491a453fef6c/move","msg":"No valid authentication found"}
{"level":30,"time":1764876661490,"env":"test","module":"user-credentials-repository","userId":"4EdAO4rf_NdV0JLrew_Vv","msg":"User credentials created"}
{"level":30,"time":1764876661490,"env":"test","module":"auth-routes","userId":"4EdAO4rf_NdV0JLrew_Vv","email":"test-workflows-mBoo9TXvAY4xsQNJ3HDjT@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876661538,"env":"test","error":{},"workflowId":"b0781826-4056-49fa-ad09-c351f5ab4d55","userId":"4EdAO4rf_NdV0JLrew_Vv","projectId":"5df7f824-edcf-4bef-a425-53b3c6649ead","msg":"Error moving workflow"}
{"level":50,"time":1764876661887,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"dd8e0daf-e8bc-46eb-b416-4e57882b7add","userId":"1cmL92b88mKU1kJUlnn8x","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876662235,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"42af4c5d-1328-489a-a81e-52396004243d","userId":"1cmL92b88mKU1kJUlnn8x","msg":"Error moving workflow"}
{"level":30,"time":1764876662723,"env":"test","module":"user-credentials-repository","userId":"WW2c9iyBS2U2Y50CXQDRL","msg":"User credentials created"}
{"level":30,"time":1764876662724,"env":"test","module":"auth-routes","userId":"WW2c9iyBS2U2Y50CXQDRL","email":"test-workflows-qj_VvfszEPZL_6lT1NTBZ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764876662901,"env":"test","module":"auth-routes","userId":"WW2c9iyBS2U2Y50CXQDRL","email":"test-workflows-qj_VvfszEPZL_6lT1NTBZ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764876663080,"env":"test","error":{},"workflowId":"48d6ed94-3774-4bb5-b45c-5e11a41f59bf","userId":"1cmL92b88mKU1kJUlnn8x","projectId":"946b48d3-6adb-4d27-828a-898580009106","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10410[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 311[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 554[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 704[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 973[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 532[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 845[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:30:40
[2m   Duration [22m 21.52s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764877226884,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877230375,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877234722,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877234722,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877234735,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877234735,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877234736,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877234736,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877235340,"env":"test","module":"user-credentials-repository","userId":"2cOIWVo1B5zLjc2DsvQUp","msg":"User credentials created"}
{"level":30,"time":1764877235344,"env":"test","module":"auth-routes","userId":"2cOIWVo1B5zLjc2DsvQUp","email":"test-workflows-eqoSIQwgHqTSxNWGq_ykt@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"33a8f2e8-ac88-48c1-bf2b-97120eea505a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"2cOIWVo1B5zLjc2DsvQUp","tenantId":"6776215d-0e7a-4015-bb44-7d3efc60ace4","createdBy":"2cOIWVo1B5zLjc2DsvQUp","ownerId":"2cOIWVo1B5zLjc2DsvQUp","status":"active","archived":false,"createdAt":"2025-12-04T19:40:37.021Z","updatedAt":"2025-12-04T19:40:37.021Z"}

{"level":30,"time":1764877236040,"env":"test","module":"user-credentials-repository","userId":"RbXI0pTh7JIE3Uu5Z0aGk","msg":"User credentials created"}
{"level":30,"time":1764877236041,"env":"test","module":"auth-routes","userId":"RbXI0pTh7JIE3Uu5Z0aGk","email":"viewer-DZLlH008b5IdKw5ku5jhq@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877236133,"env":"test","module":"rbac-middleware","userId":"RbXI0pTh7JIE3Uu5Z0aGk","userRole":"viewer","permission":"workflow:create","path":"/projects/33a8f2e8-ac88-48c1-bf2b-97120eea505a/workflows","msg":"Permission denied"}
{"level":50,"time":1764877242144,"env":"test","error":{},"workflowId":"49b893e9-2e07-40bc-a0fe-32671c90f175","userId":"2cOIWVo1B5zLjc2DsvQUp","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877242443,"env":"test","module":"auth-middleware","path":"/api/workflows/276229af-b324-4162-8e1a-8b3644ecd8c2/move","msg":"No valid authentication found"}
{"level":30,"time":1764877242939,"env":"test","module":"user-credentials-repository","userId":"Il4TsR2kK_nkT2wEQe0ff","msg":"User credentials created"}
{"level":30,"time":1764877242940,"env":"test","module":"auth-routes","userId":"Il4TsR2kK_nkT2wEQe0ff","email":"test-workflows-H-Hxi8rImP6BmoX60R7DS@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877242983,"env":"test","error":{},"workflowId":"3992845e-1841-4ac0-b7e0-2e2620defaa3","userId":"Il4TsR2kK_nkT2wEQe0ff","projectId":"61c21503-4a5b-47e9-bd12-b2c2ac624f2f","msg":"Error moving workflow"}
{"level":50,"time":1764877243308,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"cc2badaf-b2b1-44fc-b219-756a0db93b67","userId":"2cOIWVo1B5zLjc2DsvQUp","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877243674,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"944359cb-ab12-484c-8cd6-0dea7dad9980","userId":"2cOIWVo1B5zLjc2DsvQUp","msg":"Error moving workflow"}
{"level":30,"time":1764877244163,"env":"test","module":"user-credentials-repository","userId":"_1ah7mHiqZ-JF4cC-EDkn","msg":"User credentials created"}
{"level":30,"time":1764877244164,"env":"test","module":"auth-routes","userId":"_1ah7mHiqZ-JF4cC-EDkn","email":"test-workflows-RpSY2edEXlxIaGLpQaAj9@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877244346,"env":"test","module":"auth-routes","userId":"_1ah7mHiqZ-JF4cC-EDkn","email":"test-workflows-RpSY2edEXlxIaGLpQaAj9@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877244523,"env":"test","error":{},"workflowId":"9c2e6eea-5f9a-49a8-a30e-75fce1b2bb9e","userId":"2cOIWVo1B5zLjc2DsvQUp","projectId":"c34c2a15-123d-4993-bf3e-b59194773579","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10077[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 699[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 453[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 298[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 539[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 849[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:40:22
[2m   Duration [22m 21.67s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/googleAuth.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764877489167,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877492585,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877497495,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877497496,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877497510,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877497510,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877497510,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877497510,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877498194,"env":"test","module":"user-credentials-repository","userId":"CK6f-loFJchYRdvKxw5Fk","msg":"User credentials created"}
{"level":30,"time":1764877498197,"env":"test","module":"auth-routes","userId":"CK6f-loFJchYRdvKxw5Fk","email":"test-workflows-7lAOdqX6xBURwfh91hMfg@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"657a2841-12c8-43d3-8f2d-897d83f66aaa","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"CK6f-loFJchYRdvKxw5Fk","tenantId":"254bb426-0966-4528-8d38-872907ebb7b9","createdBy":"CK6f-loFJchYRdvKxw5Fk","ownerId":"CK6f-loFJchYRdvKxw5Fk","status":"active","archived":false,"createdAt":"2025-12-04T19:44:59.876Z","updatedAt":"2025-12-04T19:44:59.876Z"}

{"level":30,"time":1764877498914,"env":"test","module":"user-credentials-repository","userId":"uIo2W6zoXncm5WVvYQRlG","msg":"User credentials created"}
{"level":30,"time":1764877498915,"env":"test","module":"auth-routes","userId":"uIo2W6zoXncm5WVvYQRlG","email":"viewer-wuyRAcaSjsAZg9rXMLMDs@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877499137,"env":"test","module":"rbac-middleware","userId":"uIo2W6zoXncm5WVvYQRlG","userRole":"viewer","permission":"workflow:create","path":"/projects/657a2841-12c8-43d3-8f2d-897d83f66aaa/workflows","msg":"Permission denied"}
{"level":50,"time":1764877505121,"env":"test","error":{},"workflowId":"55f5aa02-443a-4ef4-9f26-887d83aa693e","userId":"CK6f-loFJchYRdvKxw5Fk","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877505439,"env":"test","module":"auth-middleware","path":"/api/workflows/52a57a9c-87b8-4ef5-87bd-4dbea461a55b/move","msg":"No valid authentication found"}
{"level":30,"time":1764877505934,"env":"test","module":"user-credentials-repository","userId":"IWd9xA1Bnwj3l6lDrbPHh","msg":"User credentials created"}
{"level":30,"time":1764877505935,"env":"test","module":"auth-routes","userId":"IWd9xA1Bnwj3l6lDrbPHh","email":"test-workflows-Uvt9eVQfTi-MBqfG7nvTx@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877505984,"env":"test","error":{},"workflowId":"b67d2240-ffcd-4b05-8099-701205fdf078","userId":"IWd9xA1Bnwj3l6lDrbPHh","projectId":"b4d89d85-cf2d-4ec7-96a5-a4845e852c46","msg":"Error moving workflow"}
{"level":50,"time":1764877506351,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"35c631af-2d03-4597-8a0c-7c2ff1b72de0","userId":"CK6f-loFJchYRdvKxw5Fk","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877506698,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"3fc852ab-2f4a-46df-8e4e-6d8fa04e51c1","userId":"CK6f-loFJchYRdvKxw5Fk","msg":"Error moving workflow"}
{"level":30,"time":1764877507205,"env":"test","module":"user-credentials-repository","userId":"nmzUdInMTBQP-MRnz37pZ","msg":"User credentials created"}
{"level":30,"time":1764877507206,"env":"test","module":"auth-routes","userId":"nmzUdInMTBQP-MRnz37pZ","email":"test-workflows-E_pZQyAUFFN3Y4pcX2kzj@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877507353,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764877507394,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"aa88c1cf-ce84-4950-a19b-65bb911a7e48","userId":"CK6f-loFJchYRdvKxw5Fk","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10159[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 553[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 706[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 700[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 545[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 367[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 347[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 697[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:44:44
[2m   Duration [22m 22.20s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764877821944,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877825305,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877828985,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877828986,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877828998,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877828998,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877828999,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877828999,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877829528,"env":"test","module":"user-credentials-repository","userId":"_GgYjp72TK1Uy5vuG0cT_","msg":"User credentials created"}
{"level":30,"time":1764877829531,"env":"test","module":"auth-routes","userId":"_GgYjp72TK1Uy5vuG0cT_","email":"test-workflows-waK58nc4yF9sNJG31Tc8T@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"5d4b1fd5-70f1-436a-b594-6e202947e721","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"_GgYjp72TK1Uy5vuG0cT_","tenantId":"14d0c140-1674-4b65-b1c6-1b4a66fe5d48","createdBy":"_GgYjp72TK1Uy5vuG0cT_","ownerId":"_GgYjp72TK1Uy5vuG0cT_","status":"active","archived":false,"createdAt":"2025-12-04T19:50:31.211Z","updatedAt":"2025-12-04T19:50:31.211Z"}

{"level":30,"time":1764877830230,"env":"test","module":"user-credentials-repository","userId":"qTYDdalbbfaKQOyeT46bI","msg":"User credentials created"}
{"level":30,"time":1764877830231,"env":"test","module":"auth-routes","userId":"qTYDdalbbfaKQOyeT46bI","email":"viewer-DEE41Nacic_Qb_y_XzQ90@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877830323,"env":"test","module":"rbac-middleware","userId":"qTYDdalbbfaKQOyeT46bI","userRole":"viewer","permission":"workflow:create","path":"/projects/5d4b1fd5-70f1-436a-b594-6e202947e721/workflows","msg":"Permission denied"}
{"level":50,"time":1764877836413,"env":"test","error":{},"workflowId":"bb4c6346-ce67-4725-88ca-3065953ba4eb","userId":"_GgYjp72TK1Uy5vuG0cT_","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877836746,"env":"test","module":"auth-middleware","path":"/api/workflows/8ccac544-3fe4-4210-9a49-c8444cfe4939/move","msg":"No valid authentication found"}
{"level":30,"time":1764877837269,"env":"test","module":"user-credentials-repository","userId":"vA-8ntQ8tLLrUeLcUhh9n","msg":"User credentials created"}
{"level":30,"time":1764877837269,"env":"test","module":"auth-routes","userId":"vA-8ntQ8tLLrUeLcUhh9n","email":"test-workflows-g8hSBICpWbkSCfy-2F22O@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877837321,"env":"test","error":{},"workflowId":"820e7a52-998e-46d3-922d-92e3096ef5c5","userId":"vA-8ntQ8tLLrUeLcUhh9n","projectId":"c7cfbbce-3784-4cde-bff7-79d04e51d09d","msg":"Error moving workflow"}
{"level":50,"time":1764877837689,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7bb05a92-1c01-482f-973e-760302a7918e","userId":"_GgYjp72TK1Uy5vuG0cT_","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877838062,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a49ddb55-bb52-44e8-9014-e1c129bb349b","userId":"_GgYjp72TK1Uy5vuG0cT_","msg":"Error moving workflow"}
{"level":30,"time":1764877838600,"env":"test","module":"user-credentials-repository","userId":"sFTXu8yCU_lfd9Qg-wFDN","msg":"User credentials created"}
{"level":30,"time":1764877838600,"env":"test","module":"auth-routes","userId":"sFTXu8yCU_lfd9Qg-wFDN","email":"test-workflows-g1Jn4-ATC6xQraZ0WP6-d@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877838793,"env":"test","module":"auth-routes","userId":"sFTXu8yCU_lfd9Qg-wFDN","email":"test-workflows-g1Jn4-ATC6xQraZ0WP6-d@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877838982,"env":"test","error":{},"workflowId":"60073ffb-b2ef-4613-bd79-4e7840f7a275","userId":"_GgYjp72TK1Uy5vuG0cT_","projectId":"06cbed0f-ce6c-4cd8-ac6e-60ac79902998","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 724[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 729[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 586[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 707[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 921[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:18
[2m   Duration [22m 20.64s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764877843186,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877846676,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877849518,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877849519,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877849528,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877849529,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877849529,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877849529,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877850003,"env":"test","module":"user-credentials-repository","userId":"rSKR6Zl-HQ-8owhNwmA5Y","msg":"User credentials created"}
{"level":30,"time":1764877850007,"env":"test","module":"auth-routes","userId":"rSKR6Zl-HQ-8owhNwmA5Y","email":"test-workflows-5_WNKMkv8Uc0ZZSMVSd99@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2fa0572f-e496-495d-b97e-6abd8276e2ec","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"rSKR6Zl-HQ-8owhNwmA5Y","tenantId":"82400db2-4b0c-475e-a146-952e4e086931","createdBy":"rSKR6Zl-HQ-8owhNwmA5Y","ownerId":"rSKR6Zl-HQ-8owhNwmA5Y","status":"active","archived":false,"createdAt":"2025-12-04T19:50:51.690Z","updatedAt":"2025-12-04T19:50:51.690Z"}

{"level":30,"time":1764877850663,"env":"test","module":"user-credentials-repository","userId":"meSdN9z5HuYO21EGj9i_C","msg":"User credentials created"}
{"level":30,"time":1764877850665,"env":"test","module":"auth-routes","userId":"meSdN9z5HuYO21EGj9i_C","email":"viewer-BJMGjlhxuA2cuXELyndEi@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877850753,"env":"test","module":"rbac-middleware","userId":"meSdN9z5HuYO21EGj9i_C","userRole":"viewer","permission":"workflow:create","path":"/projects/2fa0572f-e496-495d-b97e-6abd8276e2ec/workflows","msg":"Permission denied"}
{"level":50,"time":1764877856794,"env":"test","error":{},"workflowId":"bd4d680e-9287-4bdc-93a0-5d0081fb86d8","userId":"rSKR6Zl-HQ-8owhNwmA5Y","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877857102,"env":"test","module":"auth-middleware","path":"/api/workflows/6ef0d4ed-0ae7-4719-bed0-c54fd7bece1a/move","msg":"No valid authentication found"}
{"level":30,"time":1764877857608,"env":"test","module":"user-credentials-repository","userId":"hKpbv61tyimBgaZw6UsIa","msg":"User credentials created"}
{"level":30,"time":1764877857609,"env":"test","module":"auth-routes","userId":"hKpbv61tyimBgaZw6UsIa","email":"test-workflows-kOyzS0qz3uVJ3gBqdlIfd@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877857657,"env":"test","error":{},"workflowId":"54c5e471-d0b9-4268-948e-23d5fc5dac7a","userId":"hKpbv61tyimBgaZw6UsIa","projectId":"94cd7718-d6db-466e-afe1-0b627923f55a","msg":"Error moving workflow"}
{"level":50,"time":1764877858028,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"aacca213-7caf-451f-b497-5765bfce5da7","userId":"rSKR6Zl-HQ-8owhNwmA5Y","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877858367,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"856a431d-9762-4c0e-814b-244f2166a7da","userId":"rSKR6Zl-HQ-8owhNwmA5Y","msg":"Error moving workflow"}
{"level":30,"time":1764877858867,"env":"test","module":"user-credentials-repository","userId":"21DduCotmp3iTe5tA-v51","msg":"User credentials created"}
{"level":30,"time":1764877858868,"env":"test","module":"auth-routes","userId":"21DduCotmp3iTe5tA-v51","email":"test-workflows-6Ondu3KCxhdjCCtrk2-iY@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877859254,"env":"test","module":"auth-routes","userId":"21DduCotmp3iTe5tA-v51","email":"test-workflows-6Ondu3KCxhdjCCtrk2-iY@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877859430,"env":"test","error":{},"workflowId":"17814988-be6d-4f48-a9a5-b7d484fdd05c","userId":"rSKR6Zl-HQ-8owhNwmA5Y","projectId":"73b77cfc-48cd-4843-8879-9a0922f8475c","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10176[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 301[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 710[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 579[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1063[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:39
[2m   Duration [22m 19.45s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764877862047,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877864728,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877868571,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877868572,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877868585,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877868585,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877868585,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877868585,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877869265,"env":"test","module":"user-credentials-repository","userId":"htX8EoJuhDIRS_tixiT7M","msg":"User credentials created"}
{"level":30,"time":1764877869269,"env":"test","module":"auth-routes","userId":"htX8EoJuhDIRS_tixiT7M","email":"test-workflows-EDeG3CxsMOwXt0BLeC-0g@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"197387d3-1d3d-4b82-a05b-1cf2a1dd98e3","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"htX8EoJuhDIRS_tixiT7M","tenantId":"8b9f9818-9e49-40a0-b459-82580d460372","createdBy":"htX8EoJuhDIRS_tixiT7M","ownerId":"htX8EoJuhDIRS_tixiT7M","status":"active","archived":false,"createdAt":"2025-12-04T19:51:10.970Z","updatedAt":"2025-12-04T19:51:10.970Z"}

{"level":30,"time":1764877870145,"env":"test","module":"user-credentials-repository","userId":"5U1DQ7uxpQQjR6C5Vi9N0","msg":"User credentials created"}
{"level":30,"time":1764877870146,"env":"test","module":"auth-routes","userId":"5U1DQ7uxpQQjR6C5Vi9N0","email":"viewer-dxfMQhNOVMaem062OHW4i@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877870244,"env":"test","module":"rbac-middleware","userId":"5U1DQ7uxpQQjR6C5Vi9N0","userRole":"viewer","permission":"workflow:create","path":"/projects/197387d3-1d3d-4b82-a05b-1cf2a1dd98e3/workflows","msg":"Permission denied"}
{"level":50,"time":1764877876570,"env":"test","error":{},"workflowId":"36c952d8-b523-4316-936c-769d0c67ba15","userId":"htX8EoJuhDIRS_tixiT7M","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877876896,"env":"test","module":"auth-middleware","path":"/api/workflows/5bd7b473-721e-49b8-a43d-6f42891f3f1c/move","msg":"No valid authentication found"}
{"level":30,"time":1764877877408,"env":"test","module":"user-credentials-repository","userId":"LjxIAbXzxXMkHbJHZhKx9","msg":"User credentials created"}
{"level":30,"time":1764877877408,"env":"test","module":"auth-routes","userId":"LjxIAbXzxXMkHbJHZhKx9","email":"test-workflows-0c2VyPkbIkL72XbEU9JPL@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877877459,"env":"test","error":{},"workflowId":"8b51c9ff-5536-49a9-9134-d5f4e7300049","userId":"LjxIAbXzxXMkHbJHZhKx9","projectId":"e423feee-72e9-43b8-a5b8-24a82e857eff","msg":"Error moving workflow"}
{"level":50,"time":1764877877825,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"c00d4e31-f323-4b2f-a964-a5115959d1f9","userId":"htX8EoJuhDIRS_tixiT7M","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877878177,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e1961b39-468d-4aba-b8d7-5284a49ace88","userId":"htX8EoJuhDIRS_tixiT7M","msg":"Error moving workflow"}
{"level":30,"time":1764877878682,"env":"test","module":"user-credentials-repository","userId":"MNn9kChiMWm-zIxblQO6g","msg":"User credentials created"}
{"level":30,"time":1764877878683,"env":"test","module":"auth-routes","userId":"MNn9kChiMWm-zIxblQO6g","email":"test-workflows-yyzQEgBeJhb9GRTUIsmnS@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877878875,"env":"test","module":"auth-routes","userId":"MNn9kChiMWm-zIxblQO6g","email":"test-workflows-yyzQEgBeJhb9GRTUIsmnS@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877879050,"env":"test","error":{},"workflowId":"2f383405-ad8d-4b20-b9b5-c464d9eb928b","userId":"htX8EoJuhDIRS_tixiT7M","projectId":"a336c58e-2a95-45d3-a374-28a6924ca63d","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 874[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:59
[2m   Duration [22m 19.27s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764877880641,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877881521,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877882769,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877882769,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877882777,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877882777,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877882777,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877882777,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877883200,"env":"test","module":"user-credentials-repository","userId":"P2rTZr_x0ogbGKbvXwP4v","msg":"User credentials created"}
{"level":30,"time":1764877883203,"env":"test","module":"auth-routes","userId":"P2rTZr_x0ogbGKbvXwP4v","email":"test-workflows-CeG5eQIETy_E4kgLOf32R@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"cbd39cb0-0fd4-430f-98c6-6b5cc95c5e57","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"P2rTZr_x0ogbGKbvXwP4v","tenantId":"9fc79a1b-7272-44ea-8787-6a1f117f06b4","createdBy":"P2rTZr_x0ogbGKbvXwP4v","ownerId":"P2rTZr_x0ogbGKbvXwP4v","status":"active","archived":false,"createdAt":"2025-12-04T19:51:24.875Z","updatedAt":"2025-12-04T19:51:24.875Z"}

{"level":30,"time":1764877883847,"env":"test","module":"user-credentials-repository","userId":"I42YDCxuSOvQ3lyapg7H7","msg":"User credentials created"}
{"level":30,"time":1764877883847,"env":"test","module":"auth-routes","userId":"I42YDCxuSOvQ3lyapg7H7","email":"viewer-UIkmRXZ2x1O7dEnxvqM6i@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877883935,"env":"test","module":"rbac-middleware","userId":"I42YDCxuSOvQ3lyapg7H7","userRole":"viewer","permission":"workflow:create","path":"/projects/cbd39cb0-0fd4-430f-98c6-6b5cc95c5e57/workflows","msg":"Permission denied"}
{"level":50,"time":1764877889880,"env":"test","error":{},"workflowId":"2b6589a8-1c25-4fda-be21-111b4f002908","userId":"P2rTZr_x0ogbGKbvXwP4v","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877890193,"env":"test","module":"auth-middleware","path":"/api/workflows/adf7b223-a7de-43f8-906a-a443081a58b7/move","msg":"No valid authentication found"}
{"level":30,"time":1764877890666,"env":"test","module":"user-credentials-repository","userId":"-QVYbvKS6nn8BLmhdK1ZD","msg":"User credentials created"}
{"level":30,"time":1764877890667,"env":"test","module":"auth-routes","userId":"-QVYbvKS6nn8BLmhdK1ZD","email":"test-workflows-pFie37y49eT_9WlTl3drx@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877890711,"env":"test","error":{},"workflowId":"a50992a6-5952-4cbb-96a3-5d419d4ee7db","userId":"-QVYbvKS6nn8BLmhdK1ZD","projectId":"7f0ce248-f7c1-4932-9914-b47c835ed06a","msg":"Error moving workflow"}
{"level":50,"time":1764877891056,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"5fc92b13-9db2-41a5-8026-535fb927b9b4","userId":"P2rTZr_x0ogbGKbvXwP4v","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877891415,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"59240b55-d2a6-4c35-a915-ce39db5cfaa6","userId":"P2rTZr_x0ogbGKbvXwP4v","msg":"Error moving workflow"}
{"level":30,"time":1764877891899,"env":"test","module":"user-credentials-repository","userId":"q0n6K8PkSVicBW_zrYIEn","msg":"User credentials created"}
{"level":30,"time":1764877891899,"env":"test","module":"auth-routes","userId":"q0n6K8PkSVicBW_zrYIEn","email":"test-workflows-dbxEoGdh5U-TwL3RW1B9W@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877892082,"env":"test","module":"auth-routes","userId":"q0n6K8PkSVicBW_zrYIEn","email":"test-workflows-dbxEoGdh5U-TwL3RW1B9W@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877892255,"env":"test","error":{},"workflowId":"9a7935a5-7218-480b-b3dd-aeeaa23bef8f","userId":"P2rTZr_x0ogbGKbvXwP4v","projectId":"b7f9e480-acb0-47ff-8339-e526cf546552","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 430[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 719[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 729[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 579[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 428[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 519[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 345[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 840[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:51:19
[2m   Duration [22m 12.91s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764879994651,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764879997719,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880001431,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880001431,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880001441,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880001442,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880001442,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880001442,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880001962,"env":"test","module":"user-credentials-repository","userId":"z-P11j_FEr0MVJ1fmaOXx","msg":"User credentials created"}
{"level":30,"time":1764880001969,"env":"test","module":"auth-routes","userId":"z-P11j_FEr0MVJ1fmaOXx","email":"test-workflows-72Cb2zIcPLsu_q-M1HrqA@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"cfb4286d-8611-4867-88e2-cfd09d066455","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"z-P11j_FEr0MVJ1fmaOXx","tenantId":"f3bc047d-970d-492d-8710-92d5d50cdd23","createdBy":"z-P11j_FEr0MVJ1fmaOXx","ownerId":"z-P11j_FEr0MVJ1fmaOXx","status":"active","archived":false,"createdAt":"2025-12-04T20:26:43.743Z","updatedAt":"2025-12-04T20:26:43.743Z"}

{"level":30,"time":1764880002706,"env":"test","module":"user-credentials-repository","userId":"e-iuHav9FbA5l_jpU_CQV","msg":"User credentials created"}
{"level":30,"time":1764880002708,"env":"test","module":"auth-routes","userId":"e-iuHav9FbA5l_jpU_CQV","email":"viewer-O_gWcehFiwM9Z__6Q0_re@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880002804,"env":"test","module":"rbac-middleware","userId":"e-iuHav9FbA5l_jpU_CQV","userRole":"viewer","permission":"workflow:create","path":"/projects/cfb4286d-8611-4867-88e2-cfd09d066455/workflows","msg":"Permission denied"}
{"level":50,"time":1764880009381,"env":"test","error":{},"workflowId":"3b2e327a-0db2-4d75-ae76-7b380b51dccf","userId":"z-P11j_FEr0MVJ1fmaOXx","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880009718,"env":"test","module":"auth-middleware","path":"/api/workflows/7ec89f0a-05d2-443c-b553-c6e1027d123e/move","msg":"No valid authentication found"}
{"level":30,"time":1764880010291,"env":"test","module":"user-credentials-repository","userId":"C56E3xyfhH2mN8gF2pt_3","msg":"User credentials created"}
{"level":30,"time":1764880010292,"env":"test","module":"auth-routes","userId":"C56E3xyfhH2mN8gF2pt_3","email":"test-workflows-UV4WIGKfE4FSVmgw5Nf1v@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880010349,"env":"test","error":{},"workflowId":"4d031fdd-89de-470b-99b4-e8bbfe0f8897","userId":"C56E3xyfhH2mN8gF2pt_3","projectId":"85d9c29f-cda2-4fff-bfbd-32a4ba7079f5","msg":"Error moving workflow"}
{"level":50,"time":1764880010714,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"91457f71-a263-48de-98c3-89df032c358f","userId":"z-P11j_FEr0MVJ1fmaOXx","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880011099,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e26f142e-491b-4edb-aecd-ba25533d3f32","userId":"z-P11j_FEr0MVJ1fmaOXx","msg":"Error moving workflow"}
{"level":50,"time":1764880011638,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(m50CMTfsc9Zbg71k_zqMQ) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"m50CMTfsc9Zbg71k_zqMQ","msg":"Failed to create user credentials"}
{"level":50,"time":1764880011638,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(m50CMTfsc9Zbg71k_zqMQ) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10588[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 328[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 298[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 847[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 866[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 699[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 383[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 542[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:29
[2m   Duration [22m 21.25s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764880017167,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880020284,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880024033,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880024034,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880024046,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880024046,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880024047,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880024047,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880024531,"env":"test","module":"user-credentials-repository","userId":"oUbW17Yci6smBGmVEumvA","msg":"User credentials created"}
{"level":30,"time":1764880024535,"env":"test","module":"auth-routes","userId":"oUbW17Yci6smBGmVEumvA","email":"test-workflows-qAEXwDnFzvn2SmSxsaERy@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"07bae445-6cd8-4537-94f4-ea34fa72574b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"oUbW17Yci6smBGmVEumvA","tenantId":"2afb41cf-af48-4d01-b83f-95627d6075cd","createdBy":"oUbW17Yci6smBGmVEumvA","ownerId":"oUbW17Yci6smBGmVEumvA","status":"active","archived":false,"createdAt":"2025-12-04T20:27:06.274Z","updatedAt":"2025-12-04T20:27:06.274Z"}

{"level":30,"time":1764880025266,"env":"test","module":"user-credentials-repository","userId":"9HW1Kpzj8Fsu2FIEPp0iJ","msg":"User credentials created"}
{"level":30,"time":1764880025267,"env":"test","module":"auth-routes","userId":"9HW1Kpzj8Fsu2FIEPp0iJ","email":"viewer-mycBDEZ0n7lvdASLm8wj4@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880025366,"env":"test","module":"rbac-middleware","userId":"9HW1Kpzj8Fsu2FIEPp0iJ","userRole":"viewer","permission":"workflow:create","path":"/projects/07bae445-6cd8-4537-94f4-ea34fa72574b/workflows","msg":"Permission denied"}
{"level":50,"time":1764880031772,"env":"test","error":{},"workflowId":"4cdc6f5e-0ba7-4a65-946f-b93a31a8401b","userId":"oUbW17Yci6smBGmVEumvA","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880032145,"env":"test","module":"auth-middleware","path":"/api/workflows/02967b95-fdcb-4809-a550-3a8d90d738b4/move","msg":"No valid authentication found"}
{"level":30,"time":1764880032668,"env":"test","module":"user-credentials-repository","userId":"f6dAJOfZuqWpsZtoXhA4F","msg":"User credentials created"}
{"level":30,"time":1764880032668,"env":"test","module":"auth-routes","userId":"f6dAJOfZuqWpsZtoXhA4F","email":"test-workflows-YWUz8M2gpn06gDjWwEjHC@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880032715,"env":"test","error":{},"workflowId":"0ac9cd0a-7702-4358-a4c6-468d8be54f6d","userId":"f6dAJOfZuqWpsZtoXhA4F","projectId":"2282b4b4-4dec-4c5c-bf90-1bdffc1e43a5","msg":"Error moving workflow"}
{"level":50,"time":1764880033088,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"c2f50af4-b2e3-444d-bfdc-5adeada6c15e","userId":"oUbW17Yci6smBGmVEumvA","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880033543,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c2b7bf59-5d00-4218-a74a-d10f06f4f168","userId":"oUbW17Yci6smBGmVEumvA","msg":"Error moving workflow"}
{"level":30,"time":1764880034059,"env":"test","module":"user-credentials-repository","userId":"CPhZ6b9ShwzuWLwCLVfnW","msg":"User credentials created"}
{"level":30,"time":1764880034060,"env":"test","module":"auth-routes","userId":"CPhZ6b9ShwzuWLwCLVfnW","email":"test-workflows-EBfKofYDzdlG-i7iCSpol@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880034248,"env":"test","module":"auth-routes","userId":"CPhZ6b9ShwzuWLwCLVfnW","email":"test-workflows-EBfKofYDzdlG-i7iCSpol@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880034436,"env":"test","error":{},"workflowId":"c2acd180-0cbe-48e3-9ef2-d1b6a9036794","userId":"oUbW17Yci6smBGmVEumvA","projectId":"c831c0f8-e7f8-46b4-ba9d-3666b8c45d27","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10681[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 802[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 669[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 801[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 372[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 455[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 894[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:52
[2m   Duration [22m 21.64s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880067909,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880071041,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880075064,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880075065,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880075075,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880075076,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880075076,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880075076,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880075555,"env":"test","module":"user-credentials-repository","userId":"qklPIi_AlNo8oiTj6VinO","msg":"User credentials created"}
{"level":30,"time":1764880075559,"env":"test","module":"auth-routes","userId":"qklPIi_AlNo8oiTj6VinO","email":"test-workflows-1eTDhFoEVZD3sClZRgls_@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2db47948-ed35-46c1-8e58-4d5c7978a02a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"qklPIi_AlNo8oiTj6VinO","tenantId":"bc228c8b-63d0-4809-a80c-9a5fa51ce6a5","createdBy":"qklPIi_AlNo8oiTj6VinO","ownerId":"qklPIi_AlNo8oiTj6VinO","status":"active","archived":false,"createdAt":"2025-12-04T20:27:57.282Z","updatedAt":"2025-12-04T20:27:57.282Z"}

{"level":30,"time":1764880076242,"env":"test","module":"user-credentials-repository","userId":"2utwJifVDAbs7WiahAysM","msg":"User credentials created"}
{"level":30,"time":1764880076243,"env":"test","module":"auth-routes","userId":"2utwJifVDAbs7WiahAysM","email":"viewer-KCS_bO8MrpvGl0IW-BTWT@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880076335,"env":"test","module":"rbac-middleware","userId":"2utwJifVDAbs7WiahAysM","userRole":"viewer","permission":"workflow:create","path":"/projects/2db47948-ed35-46c1-8e58-4d5c7978a02a/workflows","msg":"Permission denied"}
{"level":50,"time":1764880082565,"env":"test","error":{},"workflowId":"e4c65746-81df-4657-a6d9-1ecf5e18e6f5","userId":"qklPIi_AlNo8oiTj6VinO","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880082880,"env":"test","module":"auth-middleware","path":"/api/workflows/e128d2d9-2f83-410a-bb92-77e3b40480de/move","msg":"No valid authentication found"}
{"level":30,"time":1764880083399,"env":"test","module":"user-credentials-repository","userId":"2mdswYmPHpAQcmuTx5s1r","msg":"User credentials created"}
{"level":30,"time":1764880083400,"env":"test","module":"auth-routes","userId":"2mdswYmPHpAQcmuTx5s1r","email":"test-workflows-3xjfLzUkXE0TRZGcdvCbf@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880083452,"env":"test","error":{},"workflowId":"ba024373-7903-41ff-9ae2-a9baf687685f","userId":"2mdswYmPHpAQcmuTx5s1r","projectId":"263e0a47-1589-4ef8-b95c-8825d95a6b67","msg":"Error moving workflow"}
{"level":50,"time":1764880083814,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3365c66a-d9c0-469f-b69c-f84c792f6625","userId":"qklPIi_AlNo8oiTj6VinO","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880084200,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9bfe0291-eb33-4d0c-bba7-22c5ccb6752e","userId":"qklPIi_AlNo8oiTj6VinO","msg":"Error moving workflow"}
{"level":30,"time":1764880084752,"env":"test","module":"user-credentials-repository","userId":"RVX1oEZgXWCC4nSfkIjws","msg":"User credentials created"}
{"level":30,"time":1764880084753,"env":"test","module":"auth-routes","userId":"RVX1oEZgXWCC4nSfkIjws","email":"test-workflows-DQ2vksiTAPDQ6S43xZ3yn@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880084941,"env":"test","module":"auth-routes","userId":"RVX1oEZgXWCC4nSfkIjws","email":"test-workflows-DQ2vksiTAPDQ6S43xZ3yn@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880085149,"env":"test","error":{},"workflowId":"1c42eef8-bd45-4c18-b67c-01afb8a84660","userId":"qklPIi_AlNo8oiTj6VinO","projectId":"b85ae9d6-635a-44a4-af4b-1f61c1349e4e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 755[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 386[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 951[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:27:42
[2m   Duration [22m 21.78s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx26 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764880089950,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880092883,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880096124,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880096125,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880096134,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880096134,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880096135,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880096135,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880096624,"env":"test","module":"user-credentials-repository","userId":"kr_VnhYZ1kMbaG9VP2QlO","msg":"User credentials created"}
{"level":30,"time":1764880096628,"env":"test","module":"auth-routes","userId":"kr_VnhYZ1kMbaG9VP2QlO","email":"test-workflows-sD09hk1_iqYFVQvymGe55@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c01d1549-cf39-49ae-929b-fa416e8a0e30","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"kr_VnhYZ1kMbaG9VP2QlO","tenantId":"2108ed71-c7a1-47a7-a4a9-5a52474f3db6","createdBy":"kr_VnhYZ1kMbaG9VP2QlO","ownerId":"kr_VnhYZ1kMbaG9VP2QlO","status":"active","archived":false,"createdAt":"2025-12-04T20:28:18.345Z","updatedAt":"2025-12-04T20:28:18.345Z"}

{"level":30,"time":1764880097373,"env":"test","module":"user-credentials-repository","userId":"tpXJId1s0xkyhba_vuQjq","msg":"User credentials created"}
{"level":30,"time":1764880097374,"env":"test","module":"auth-routes","userId":"tpXJId1s0xkyhba_vuQjq","email":"viewer-I22nz5AfjOF9EQhHSK1aX@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880097479,"env":"test","module":"rbac-middleware","userId":"tpXJId1s0xkyhba_vuQjq","userRole":"viewer","permission":"workflow:create","path":"/projects/c01d1549-cf39-49ae-929b-fa416e8a0e30/workflows","msg":"Permission denied"}
{"level":50,"time":1764880103960,"env":"test","error":{},"workflowId":"e4258299-49fd-4976-97b6-bfcbf710a8c7","userId":"kr_VnhYZ1kMbaG9VP2QlO","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880104287,"env":"test","module":"auth-middleware","path":"/api/workflows/2d8e0f39-1804-49fb-b0fa-f5a6695c2530/move","msg":"No valid authentication found"}
{"level":30,"time":1764880104808,"env":"test","module":"user-credentials-repository","userId":"UeA9OAM-JiOcHtYT53jSl","msg":"User credentials created"}
{"level":30,"time":1764880104808,"env":"test","module":"auth-routes","userId":"UeA9OAM-JiOcHtYT53jSl","email":"test-workflows-QSdzINU9PJkSw_BktQlfO@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880104901,"env":"test","error":{},"workflowId":"fcc3ba4e-0f4d-451f-8394-74d0309a4ce1","userId":"UeA9OAM-JiOcHtYT53jSl","projectId":"b8e222db-bc11-4db9-bb27-5b0351357712","msg":"Error moving workflow"}
{"level":50,"time":1764880105323,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7a0430d3-d9f4-40da-899e-c2f78e568a40","userId":"kr_VnhYZ1kMbaG9VP2QlO","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880105706,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ca4a5d23-7d71-4adb-939d-fe538aec506b","userId":"kr_VnhYZ1kMbaG9VP2QlO","msg":"Error moving workflow"}
{"level":30,"time":1764880106223,"env":"test","module":"user-credentials-repository","userId":"8pVBDWk-jh9HDFCz7r5oO","msg":"User credentials created"}
{"level":30,"time":1764880106223,"env":"test","module":"auth-routes","userId":"8pVBDWk-jh9HDFCz7r5oO","email":"test-workflows-g_o2F8TvN3c2KT9FzugtF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880106329,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764880106380,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9398d1fb-683c-4950-b3c0-305554d0cfc3","userId":"kr_VnhYZ1kMbaG9VP2QlO","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 360[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 505[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 651[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 326[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 420[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 383[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 675[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:05
[2m   Duration [22m 20.06s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx27 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764880109582,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880111595,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880113933,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880113934,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880113944,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880113944,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880113944,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880113944,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880114397,"env":"test","module":"user-credentials-repository","userId":"uhQXWkjSqwr8q85l8wfKJ","msg":"User credentials created"}
{"level":30,"time":1764880114401,"env":"test","module":"auth-routes","userId":"uhQXWkjSqwr8q85l8wfKJ","email":"test-workflows-q40umsguFjt9ZRtHqadNm@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9207235d-95a6-40ff-aebd-b0d94474d5d2","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"uhQXWkjSqwr8q85l8wfKJ","tenantId":"57eb7651-23b7-4564-88c7-7fcc09ec9cdf","createdBy":"uhQXWkjSqwr8q85l8wfKJ","ownerId":"uhQXWkjSqwr8q85l8wfKJ","status":"active","archived":false,"createdAt":"2025-12-04T20:28:36.134Z","updatedAt":"2025-12-04T20:28:36.134Z"}

{"level":30,"time":1764880115089,"env":"test","module":"user-credentials-repository","userId":"-JJXLBb4YIxgJia3-DnH0","msg":"User credentials created"}
{"level":30,"time":1764880115090,"env":"test","module":"auth-routes","userId":"-JJXLBb4YIxgJia3-DnH0","email":"viewer-0CpDhzAf_Wg19bw5sMzMI@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880115187,"env":"test","module":"rbac-middleware","userId":"-JJXLBb4YIxgJia3-DnH0","userRole":"viewer","permission":"workflow:create","path":"/projects/9207235d-95a6-40ff-aebd-b0d94474d5d2/workflows","msg":"Permission denied"}
{"level":50,"time":1764880121523,"env":"test","error":{},"workflowId":"e2081513-346a-4f42-b974-a83e03cbc2fb","userId":"uhQXWkjSqwr8q85l8wfKJ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880121835,"env":"test","module":"auth-middleware","path":"/api/workflows/19f6b22f-3444-4ca4-b813-f06f45f06399/move","msg":"No valid authentication found"}
{"level":30,"time":1764880122341,"env":"test","module":"user-credentials-repository","userId":"_2pswdpQXMxyovZZqSVeW","msg":"User credentials created"}
{"level":30,"time":1764880122341,"env":"test","module":"auth-routes","userId":"_2pswdpQXMxyovZZqSVeW","email":"test-workflows-BJGEx0DiBM_NES1-wdDKw@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880122389,"env":"test","error":{},"workflowId":"6d578cfa-56ab-4c82-a7d8-a2e6bc9770e7","userId":"_2pswdpQXMxyovZZqSVeW","projectId":"59f651c6-56c5-4bf6-bf7a-6d94139f5769","msg":"Error moving workflow"}
{"level":50,"time":1764880122768,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ba46a731-1a87-4b76-bf92-3a818c466d3f","userId":"uhQXWkjSqwr8q85l8wfKJ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880123105,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d7423814-ea05-484e-af4c-c7ef601cacdc","userId":"uhQXWkjSqwr8q85l8wfKJ","msg":"Error moving workflow"}
{"level":30,"time":1764880123655,"env":"test","module":"user-credentials-repository","userId":"bnUkiXJJJ6Gn9u0-eCJ65","msg":"User credentials created"}
{"level":30,"time":1764880123655,"env":"test","module":"auth-routes","userId":"bnUkiXJJJ6Gn9u0-eCJ65","email":"test-workflows-1ynoGW2SCSx-k-Bw5Tzsr@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880123850,"env":"test","module":"auth-routes","userId":"bnUkiXJJJ6Gn9u0-eCJ65","email":"test-workflows-1ynoGW2SCSx-k-Bw5Tzsr@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880124076,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"429bec0f-65ea-4752-86b7-d59446864d78","userId":"uhQXWkjSqwr8q85l8wfKJ","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10412[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 326[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 796[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 647[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 784[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 555[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 336[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 973[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:26
[2m   Duration [22m 17.09s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/sections.routes.ts [22m[34mx28 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764880140512,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880143696,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880148222,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880148223,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880148233,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880148233,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880148233,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880148234,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880148779,"env":"test","module":"user-credentials-repository","userId":"rBiUSiorDv40LcUX8Mu8v","msg":"User credentials created"}
{"level":30,"time":1764880148784,"env":"test","module":"auth-routes","userId":"rBiUSiorDv40LcUX8Mu8v","email":"test-workflows-YT-hJyV7Iuy-NBhdX6sGI@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"84877285-1458-4083-be02-e8f7365cf3af","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"rBiUSiorDv40LcUX8Mu8v","tenantId":"cdb3f6db-a8a4-4301-9445-44d9f5d9d3c5","createdBy":"rBiUSiorDv40LcUX8Mu8v","ownerId":"rBiUSiorDv40LcUX8Mu8v","status":"active","archived":false,"createdAt":"2025-12-04T20:29:10.497Z","updatedAt":"2025-12-04T20:29:10.497Z"}

{"level":30,"time":1764880149466,"env":"test","module":"user-credentials-repository","userId":"lNq1ad7wPPPtbtg6bCvPh","msg":"User credentials created"}
{"level":30,"time":1764880149466,"env":"test","module":"auth-routes","userId":"lNq1ad7wPPPtbtg6bCvPh","email":"viewer-I1Ep1o-A1aSfBukvrUTaH@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880149561,"env":"test","module":"rbac-middleware","userId":"lNq1ad7wPPPtbtg6bCvPh","userRole":"viewer","permission":"workflow:create","path":"/projects/84877285-1458-4083-be02-e8f7365cf3af/workflows","msg":"Permission denied"}
{"level":50,"time":1764880155729,"env":"test","error":{},"workflowId":"82a0dc96-b52b-46b2-a6e2-1d66fc9d7d2b","userId":"rBiUSiorDv40LcUX8Mu8v","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880156052,"env":"test","module":"auth-middleware","path":"/api/workflows/4c876b83-513a-4482-9785-7f202ee08f17/move","msg":"No valid authentication found"}
{"level":30,"time":1764880156566,"env":"test","module":"user-credentials-repository","userId":"Js4Ojdp9xdeDJqyGNpo1E","msg":"User credentials created"}
{"level":30,"time":1764880156566,"env":"test","module":"auth-routes","userId":"Js4Ojdp9xdeDJqyGNpo1E","email":"test-workflows-HcDVoichhsAqCthh5Ojqp@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880156616,"env":"test","error":{},"workflowId":"ff37e3c6-f062-4dd8-beaf-d771e2e7fdb1","userId":"Js4Ojdp9xdeDJqyGNpo1E","projectId":"7503734c-4b53-4836-9cf7-8d27dd5d5a97","msg":"Error moving workflow"}
{"level":50,"time":1764880156991,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"71486827-3454-4a4d-9925-031b27ee4fe8","userId":"rBiUSiorDv40LcUX8Mu8v","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880157342,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"14422eb4-d30d-4d8d-9ee0-aadafeaeab4a","userId":"rBiUSiorDv40LcUX8Mu8v","msg":"Error moving workflow"}
{"level":30,"time":1764880157820,"env":"test","module":"user-credentials-repository","userId":"sVwnma4Bpt2ZHgdj3oIos","msg":"User credentials created"}
{"level":30,"time":1764880157821,"env":"test","module":"auth-routes","userId":"sVwnma4Bpt2ZHgdj3oIos","email":"test-workflows-AUkmaC8q_3zkxfyUa6KqT@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880158013,"env":"test","module":"auth-routes","userId":"sVwnma4Bpt2ZHgdj3oIos","email":"test-workflows-AUkmaC8q_3zkxfyUa6KqT@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880158189,"env":"test","error":{},"workflowId":"02847eab-93d9-4abb-8e61-7e2dd5527338","userId":"rBiUSiorDv40LcUX8Mu8v","projectId":"20ba9ce1-6ae5-4773-ab2d-9c7af08d2ffb","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10285[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 301[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 352[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 848[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:56
[2m   Duration [22m 21.60s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx29 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880169955,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880173365,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880177278,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880177279,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880177293,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880177293,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880177294,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880177294,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880177797,"env":"test","module":"user-credentials-repository","userId":"lXbp15r1Dm9DrIKirjOTm","msg":"User credentials created"}
{"level":30,"time":1764880177800,"env":"test","module":"auth-routes","userId":"lXbp15r1Dm9DrIKirjOTm","email":"test-workflows-R70N4TVminyYYWsy3XIMp@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"44f6d706-793e-4dc5-8376-a702fffdd6ac","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"lXbp15r1Dm9DrIKirjOTm","tenantId":"9ac061c4-e4a9-4430-a256-c9c6f27a5ddd","createdBy":"lXbp15r1Dm9DrIKirjOTm","ownerId":"lXbp15r1Dm9DrIKirjOTm","status":"active","archived":false,"createdAt":"2025-12-04T20:29:39.518Z","updatedAt":"2025-12-04T20:29:39.518Z"}

{"level":30,"time":1764880178535,"env":"test","module":"user-credentials-repository","userId":"Rll44yPuyseX3IjiL4gPz","msg":"User credentials created"}
{"level":30,"time":1764880178535,"env":"test","module":"auth-routes","userId":"Rll44yPuyseX3IjiL4gPz","email":"viewer-yzt8MQBiHJ935x8hhs_Ht@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880178632,"env":"test","module":"rbac-middleware","userId":"Rll44yPuyseX3IjiL4gPz","userRole":"viewer","permission":"workflow:create","path":"/projects/44f6d706-793e-4dc5-8376-a702fffdd6ac/workflows","msg":"Permission denied"}
{"level":50,"time":1764880185110,"env":"test","error":{},"workflowId":"0b7d37ff-1d2f-4723-b1c7-3e356abb26ec","userId":"lXbp15r1Dm9DrIKirjOTm","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880185448,"env":"test","module":"auth-middleware","path":"/api/workflows/70aa5f99-3b8a-42be-86d0-68ec87efa102/move","msg":"No valid authentication found"}
{"level":30,"time":1764880185986,"env":"test","module":"user-credentials-repository","userId":"15uKuqIzlWt0RKT4FO82R","msg":"User credentials created"}
{"level":30,"time":1764880185986,"env":"test","module":"auth-routes","userId":"15uKuqIzlWt0RKT4FO82R","email":"test-workflows-W7fmN66fMO8pyJlraQifu@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880186037,"env":"test","error":{},"workflowId":"cf266f8e-9384-492d-8609-ec23940a3d39","userId":"15uKuqIzlWt0RKT4FO82R","projectId":"b4519e9d-b792-485e-8e15-54cdded89dc7","msg":"Error moving workflow"}
{"level":50,"time":1764880186426,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"c498ca57-70a7-4659-b152-dd94f25ddb90","userId":"lXbp15r1Dm9DrIKirjOTm","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880186817,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4890fa69-2548-432f-83d4-e54289903cf2","userId":"lXbp15r1Dm9DrIKirjOTm","msg":"Error moving workflow"}
{"level":30,"time":1764880187373,"env":"test","module":"user-credentials-repository","userId":"JaQpg3VGmrA8X87YjrgBd","msg":"User credentials created"}
{"level":30,"time":1764880187374,"env":"test","module":"auth-routes","userId":"JaQpg3VGmrA8X87YjrgBd","email":"test-workflows-LDg4Dj74nJJvssTzkdOHx@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880187579,"env":"test","module":"auth-routes","userId":"JaQpg3VGmrA8X87YjrgBd","email":"test-workflows-LDg4Dj74nJJvssTzkdOHx@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880187777,"env":"test","error":{},"workflowId":"37363344-006d-4af9-8da2-700baa02666b","userId":"lXbp15r1Dm9DrIKirjOTm","projectId":"f24566cb-6672-4051-b5da-bb44328a749b","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10850[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 618[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 658[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 826[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 389[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 390[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 962[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:25
[2m   Duration [22m 21.91s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx30 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764880190918,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880192897,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880195250,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880195251,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880195263,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880195263,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880195264,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880195264,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880195776,"env":"test","module":"user-credentials-repository","userId":"gO8zD3kZZcD4hpfQFgIyj","msg":"User credentials created"}
{"level":30,"time":1764880195780,"env":"test","module":"auth-routes","userId":"gO8zD3kZZcD4hpfQFgIyj","email":"test-workflows-q0wjZ3CcPy8QMT-ttX-LZ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"12c94416-e6ad-41fa-8098-580d8e3ef3df","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"gO8zD3kZZcD4hpfQFgIyj","tenantId":"96eef04a-edbc-41b2-92f0-a59465d8bbe9","createdBy":"gO8zD3kZZcD4hpfQFgIyj","ownerId":"gO8zD3kZZcD4hpfQFgIyj","status":"active","archived":false,"createdAt":"2025-12-04T20:29:57.510Z","updatedAt":"2025-12-04T20:29:57.510Z"}

{"level":30,"time":1764880196470,"env":"test","module":"user-credentials-repository","userId":"3PpEPJb-p0eg-mo2IP1Az","msg":"User credentials created"}
{"level":30,"time":1764880196470,"env":"test","module":"auth-routes","userId":"3PpEPJb-p0eg-mo2IP1Az","email":"viewer-qFHwquWCiJBaUOLbuJ3P6@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880196568,"env":"test","module":"rbac-middleware","userId":"3PpEPJb-p0eg-mo2IP1Az","userRole":"viewer","permission":"workflow:create","path":"/projects/12c94416-e6ad-41fa-8098-580d8e3ef3df/workflows","msg":"Permission denied"}
{"level":50,"time":1764880203178,"env":"test","error":{},"workflowId":"a320126e-0703-4906-8156-0ee12580e1c5","userId":"gO8zD3kZZcD4hpfQFgIyj","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880203517,"env":"test","module":"auth-middleware","path":"/api/workflows/ac9ae888-39f5-4358-9c73-9286e78579b5/move","msg":"No valid authentication found"}
{"level":30,"time":1764880204058,"env":"test","module":"user-credentials-repository","userId":"uNorbWdrYPqhePKXqwj0h","msg":"User credentials created"}
{"level":30,"time":1764880204058,"env":"test","module":"auth-routes","userId":"uNorbWdrYPqhePKXqwj0h","email":"test-workflows-HcQEwOJ87jMWB-VxEUYkG@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880204106,"env":"test","error":{},"workflowId":"cfe095bd-cac1-40a7-86ce-f820b5121855","userId":"uNorbWdrYPqhePKXqwj0h","projectId":"4352dad8-b0f1-42c5-ab62-d2dc11eca3f7","msg":"Error moving workflow"}
{"level":50,"time":1764880204501,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"0fb240a8-02be-419e-8f73-d7ee0c0c1e85","userId":"gO8zD3kZZcD4hpfQFgIyj","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880204987,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9485634a-88da-4bde-aae5-e4988a0855f9","userId":"gO8zD3kZZcD4hpfQFgIyj","msg":"Error moving workflow"}
{"level":30,"time":1764880205518,"env":"test","module":"user-credentials-repository","userId":"Q3ZTX5EthHDRHkCrvvgVc","msg":"User credentials created"}
{"level":30,"time":1764880205518,"env":"test","module":"auth-routes","userId":"Q3ZTX5EthHDRHkCrvvgVc","email":"test-workflows-4WTpN1n97BGZTQzbWoUfE@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880205720,"env":"test","module":"auth-routes","userId":"Q3ZTX5EthHDRHkCrvvgVc","email":"test-workflows-4WTpN1n97BGZTQzbWoUfE@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880205913,"env":"test","error":{},"workflowId":"3b91b15a-4d18-4c63-9641-df9421f9f49a","userId":"gO8zD3kZZcD4hpfQFgIyj","projectId":"aac8cfd7-de16-442a-b897-f320d9bc0ed6","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10933[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 816[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 672[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 539[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 395[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 486[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 927[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:48
[2m   Duration [22m 17.45s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/steps.routes.ts [22m[34mx31 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764880218613,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880222113,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880226494,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880226495,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880226513,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880226514,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880226514,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880226514,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880227058,"env":"test","module":"user-credentials-repository","userId":"bKh6GvnUebk5sUHqP4reO","msg":"User credentials created"}
{"level":30,"time":1764880227062,"env":"test","module":"auth-routes","userId":"bKh6GvnUebk5sUHqP4reO","email":"test-workflows-favW6JqsEArl2VjEaIJFR@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"ab90be97-b712-495c-a643-33347aadeb4a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"bKh6GvnUebk5sUHqP4reO","tenantId":"40ce42b2-5286-4c16-87fb-497277cdb3c4","createdBy":"bKh6GvnUebk5sUHqP4reO","ownerId":"bKh6GvnUebk5sUHqP4reO","status":"active","archived":false,"createdAt":"2025-12-04T20:30:28.785Z","updatedAt":"2025-12-04T20:30:28.785Z"}

{"level":30,"time":1764880227790,"env":"test","module":"user-credentials-repository","userId":"XW3UIzB75FzDov1wt_cP4","msg":"User credentials created"}
{"level":30,"time":1764880227790,"env":"test","module":"auth-routes","userId":"XW3UIzB75FzDov1wt_cP4","email":"viewer-ay4olJifQ_X0eTNS8bQbV@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880227893,"env":"test","module":"rbac-middleware","userId":"XW3UIzB75FzDov1wt_cP4","userRole":"viewer","permission":"workflow:create","path":"/projects/ab90be97-b712-495c-a643-33347aadeb4a/workflows","msg":"Permission denied"}
{"level":50,"time":1764880234199,"env":"test","error":{},"workflowId":"6ed5d84a-2937-48b8-97a9-f54d22dc746e","userId":"bKh6GvnUebk5sUHqP4reO","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880234536,"env":"test","module":"auth-middleware","path":"/api/workflows/c82a0a01-b81d-438f-b9eb-bcb0339fbb8b/move","msg":"No valid authentication found"}
{"level":30,"time":1764880235050,"env":"test","module":"user-credentials-repository","userId":"Damy3FJBtl0ZIS9CjlsI3","msg":"User credentials created"}
{"level":30,"time":1764880235050,"env":"test","module":"auth-routes","userId":"Damy3FJBtl0ZIS9CjlsI3","email":"test-workflows-T3SUn0aTyg3_nHgVzzm9I@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880235100,"env":"test","error":{},"workflowId":"754415ae-fb14-40eb-9c0c-db4645fe3a95","userId":"Damy3FJBtl0ZIS9CjlsI3","projectId":"cac49d0c-ec4a-428c-baf4-2cf5add4d50f","msg":"Error moving workflow"}
{"level":50,"time":1764880235467,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"86b2add9-ca4f-48d4-8a24-a6bd5e42e141","userId":"bKh6GvnUebk5sUHqP4reO","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880235878,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"459ef92a-f740-4cf4-8360-3201cfe245c3","userId":"bKh6GvnUebk5sUHqP4reO","msg":"Error moving workflow"}
{"level":30,"time":1764880236379,"env":"test","module":"user-credentials-repository","userId":"ctsgvvKKft8mHu0Di_iM5","msg":"User credentials created"}
{"level":30,"time":1764880236380,"env":"test","module":"auth-routes","userId":"ctsgvvKKft8mHu0Di_iM5","email":"test-workflows-roqYbDhFL6ox8rFKV71F6@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880236574,"env":"test","module":"auth-routes","userId":"ctsgvvKKft8mHu0Di_iM5","email":"test-workflows-roqYbDhFL6ox8rFKV71F6@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880236756,"env":"test","error":{},"workflowId":"3aa2612b-7eff-465a-b074-637e75dd6608","userId":"bKh6GvnUebk5sUHqP4reO","projectId":"0a6d3e24-c274-4c56-99da-d6c449f6fa9e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10533[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 412[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 878[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:14
[2m   Duration [22m 21.20s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx32 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880255505,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880258802,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880262593,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880262594,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880262605,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880262606,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880262606,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880262606,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880263141,"env":"test","module":"user-credentials-repository","userId":"vi9iAb76g276J4VWj5zsF","msg":"User credentials created"}
{"level":30,"time":1764880263144,"env":"test","module":"auth-routes","userId":"vi9iAb76g276J4VWj5zsF","email":"test-workflows-U6d65I01KqIjEMt-V1npY@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c3509628-8e10-408f-ad5c-22ac14c48ec5","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"vi9iAb76g276J4VWj5zsF","tenantId":"dadb9aae-e4d8-430f-8dca-2c6b1eaffc02","createdBy":"vi9iAb76g276J4VWj5zsF","ownerId":"vi9iAb76g276J4VWj5zsF","status":"active","archived":false,"createdAt":"2025-12-04T20:31:04.856Z","updatedAt":"2025-12-04T20:31:04.856Z"}

{"level":30,"time":1764880263826,"env":"test","module":"user-credentials-repository","userId":"4Ec5xB6JOmAJ-3hfpbKIe","msg":"User credentials created"}
{"level":30,"time":1764880263827,"env":"test","module":"auth-routes","userId":"4Ec5xB6JOmAJ-3hfpbKIe","email":"viewer-jqOQ7sxiu8067bg4vZuTI@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880263926,"env":"test","module":"rbac-middleware","userId":"4Ec5xB6JOmAJ-3hfpbKIe","userRole":"viewer","permission":"workflow:create","path":"/projects/c3509628-8e10-408f-ad5c-22ac14c48ec5/workflows","msg":"Permission denied"}
{"level":50,"time":1764880269994,"env":"test","error":{},"workflowId":"d984add8-b99a-4b51-9f52-6c6545c7c36a","userId":"vi9iAb76g276J4VWj5zsF","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880270311,"env":"test","module":"auth-middleware","path":"/api/workflows/e382d397-800e-4d99-bd30-e1b541d1fac3/move","msg":"No valid authentication found"}
{"level":30,"time":1764880270799,"env":"test","module":"user-credentials-repository","userId":"mgfdTCI1L-TLtTZsRMohl","msg":"User credentials created"}
{"level":30,"time":1764880270800,"env":"test","module":"auth-routes","userId":"mgfdTCI1L-TLtTZsRMohl","email":"test-workflows-ejnFi2dUC1zImSDiMDvfy@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880270866,"env":"test","error":{},"workflowId":"82097dda-cce0-47de-9280-f62e5942d4eb","userId":"mgfdTCI1L-TLtTZsRMohl","projectId":"951acb9f-31dc-47c4-b1a4-098afa75fb97","msg":"Error moving workflow"}
{"level":50,"time":1764880271249,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"c95f19ea-7b1f-490a-b577-03e4dafa8916","userId":"vi9iAb76g276J4VWj5zsF","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880271607,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"242d7803-5d87-4963-8741-ee7c0d891391","userId":"vi9iAb76g276J4VWj5zsF","msg":"Error moving workflow"}
{"level":30,"time":1764880272103,"env":"test","module":"user-credentials-repository","userId":"QRgXaNzL_uIXJ8rznJFam","msg":"User credentials created"}
{"level":30,"time":1764880272103,"env":"test","module":"auth-routes","userId":"QRgXaNzL_uIXJ8rznJFam","email":"test-workflows-3TIdcUXNQjZLeDwex-Eyi@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880272296,"env":"test","module":"auth-routes","userId":"QRgXaNzL_uIXJ8rznJFam","email":"test-workflows-3TIdcUXNQjZLeDwex-Eyi@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880272489,"env":"test","error":{},"workflowId":"07f37a8c-303b-42b4-bc6c-fa6766e7820b","userId":"vi9iAb76g276J4VWj5zsF","projectId":"c0c3c00d-ee95-4cca-ada6-05427148be14","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10297[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 499[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 720[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 883[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:52
[2m   Duration [22m 20.07s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx33 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764880276497,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880279687,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880283574,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880283575,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880283586,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880283586,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880283586,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880283586,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880284254,"env":"test","module":"user-credentials-repository","userId":"fSyYm6iDiifHh8HA686k2","msg":"User credentials created"}
{"level":30,"time":1764880284257,"env":"test","module":"auth-routes","userId":"fSyYm6iDiifHh8HA686k2","email":"test-workflows-w934JFWD8MJQx2UrGeCLy@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3b5feef8-5690-4a0d-b5b3-cc1d54a6b775","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"fSyYm6iDiifHh8HA686k2","tenantId":"002dcc44-8f52-475a-8cc8-2ff56f2e5872","createdBy":"fSyYm6iDiifHh8HA686k2","ownerId":"fSyYm6iDiifHh8HA686k2","status":"active","archived":false,"createdAt":"2025-12-04T20:31:25.964Z","updatedAt":"2025-12-04T20:31:25.964Z"}

{"level":30,"time":1764880284937,"env":"test","module":"user-credentials-repository","userId":"nLDDbUdEQVLEvo3zIm5AH","msg":"User credentials created"}
{"level":30,"time":1764880284938,"env":"test","module":"auth-routes","userId":"nLDDbUdEQVLEvo3zIm5AH","email":"viewer-bp6Rkm3p5-JpJqfTfx2db@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880285031,"env":"test","module":"rbac-middleware","userId":"nLDDbUdEQVLEvo3zIm5AH","userRole":"viewer","permission":"workflow:create","path":"/projects/3b5feef8-5690-4a0d-b5b3-cc1d54a6b775/workflows","msg":"Permission denied"}
{"level":50,"time":1764880290997,"env":"test","error":{},"workflowId":"d15a9281-da49-428f-a0cb-2631435493df","userId":"fSyYm6iDiifHh8HA686k2","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880291326,"env":"test","module":"auth-middleware","path":"/api/workflows/4fc78b35-f541-4a9e-a381-3b0b544c1542/move","msg":"No valid authentication found"}
{"level":30,"time":1764880291848,"env":"test","module":"user-credentials-repository","userId":"uLp8BYfUmkT-FbMGARyBK","msg":"User credentials created"}
{"level":30,"time":1764880291849,"env":"test","module":"auth-routes","userId":"uLp8BYfUmkT-FbMGARyBK","email":"test-workflows-pL6Y91QIpewAB9AI5zpcW@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880291906,"env":"test","error":{},"workflowId":"d2b719e8-6147-4d96-ae45-9b18f81bcedb","userId":"uLp8BYfUmkT-FbMGARyBK","projectId":"798ccede-9de2-4b46-aab0-927acb9217ca","msg":"Error moving workflow"}
{"level":50,"time":1764880292478,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"4319991d-6416-42ab-b74b-3e88d45f3569","userId":"fSyYm6iDiifHh8HA686k2","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880292875,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"5a430ae9-2064-477a-94ab-564d8e749114","userId":"fSyYm6iDiifHh8HA686k2","msg":"Error moving workflow"}
{"level":30,"time":1764880293376,"env":"test","module":"user-credentials-repository","userId":"u9Tp0FZAQrd-E1Sk98zgG","msg":"User credentials created"}
{"level":30,"time":1764880293377,"env":"test","module":"auth-routes","userId":"u9Tp0FZAQrd-E1Sk98zgG","email":"test-workflows-LZHDrx-zlIpk-KUWNqdU3@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880293582,"env":"test","module":"auth-routes","userId":"u9Tp0FZAQrd-E1Sk98zgG","email":"test-workflows-LZHDrx-zlIpk-KUWNqdU3@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880293769,"env":"test","error":{},"workflowId":"9cd0eee9-7f3f-4805-b326-d51538961efe","userId":"fSyYm6iDiifHh8HA686k2","projectId":"cff6112b-dab1-4558-b286-f8ea3a6706cf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 397[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 894[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:12
[2m   Duration [22m 20.52s

 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx34 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764880298215,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880301283,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880304121,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880304121,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880304133,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880304133,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880304133,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880304133,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880304682,"env":"test","module":"user-credentials-repository","userId":"YBVC4JzDgiP5Lrcz_f-UI","msg":"User credentials created"}
{"level":30,"time":1764880304685,"env":"test","module":"auth-routes","userId":"YBVC4JzDgiP5Lrcz_f-UI","email":"test-workflows-Yc09iSVWSpg6I6vSHau4K@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"43c1f1c8-30fa-4cac-b756-e450e96e8e07","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"YBVC4JzDgiP5Lrcz_f-UI","tenantId":"6412f16e-d547-4c14-8a72-5671be0b775a","createdBy":"YBVC4JzDgiP5Lrcz_f-UI","ownerId":"YBVC4JzDgiP5Lrcz_f-UI","status":"active","archived":false,"createdAt":"2025-12-04T20:31:46.408Z","updatedAt":"2025-12-04T20:31:46.408Z"}

{"level":30,"time":1764880305391,"env":"test","module":"user-credentials-repository","userId":"SKaZkNDTdSnSmML69jlK2","msg":"User credentials created"}
{"level":30,"time":1764880305392,"env":"test","module":"auth-routes","userId":"SKaZkNDTdSnSmML69jlK2","email":"viewer-yHDlXxvjsKpdNUi9y8e6U@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880305487,"env":"test","module":"rbac-middleware","userId":"SKaZkNDTdSnSmML69jlK2","userRole":"viewer","permission":"workflow:create","path":"/projects/43c1f1c8-30fa-4cac-b756-e450e96e8e07/workflows","msg":"Permission denied"}
{"level":50,"time":1764880311837,"env":"test","error":{},"workflowId":"cfbbdbb8-75a5-4480-a253-0c1458b02278","userId":"YBVC4JzDgiP5Lrcz_f-UI","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880312172,"env":"test","module":"auth-middleware","path":"/api/workflows/f4fac01f-a550-4019-ab83-f9be660c75b5/move","msg":"No valid authentication found"}
{"level":30,"time":1764880312703,"env":"test","module":"user-credentials-repository","userId":"Vu3XAp0DdyOWbBiLXsdCw","msg":"User credentials created"}
{"level":30,"time":1764880312704,"env":"test","module":"auth-routes","userId":"Vu3XAp0DdyOWbBiLXsdCw","email":"test-workflows-FQPe2OrrQQ6OerWnoRMTc@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880312753,"env":"test","error":{},"workflowId":"31859744-b6bb-4425-afb9-df00b129cf90","userId":"Vu3XAp0DdyOWbBiLXsdCw","projectId":"a4557997-fd7e-4d4e-86e1-c2293f2e01be","msg":"Error moving workflow"}
{"level":50,"time":1764880313135,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"46a2ef0a-98b3-4f39-a4a0-7e3d66cc198c","userId":"YBVC4JzDgiP5Lrcz_f-UI","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880313528,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"936145b6-011d-4d15-979b-ceb78a4b23ff","userId":"YBVC4JzDgiP5Lrcz_f-UI","msg":"Error moving workflow"}
{"level":30,"time":1764880314060,"env":"test","module":"user-credentials-repository","userId":"E2DeERz3MlMKTHbwxgzLM","msg":"User credentials created"}
{"level":30,"time":1764880314061,"env":"test","module":"auth-routes","userId":"E2DeERz3MlMKTHbwxgzLM","email":"test-workflows-5y8OFeg1zqKPeDdRuLgiX@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880314278,"env":"test","module":"auth-routes","userId":"E2DeERz3MlMKTHbwxgzLM","email":"test-workflows-5y8OFeg1zqKPeDdRuLgiX@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880314467,"env":"test","error":{},"workflowId":"b45ac300-15d6-45a8-b587-39ce849bc93f","userId":"YBVC4JzDgiP5Lrcz_f-UI","projectId":"dd6dc028-952d-4d7c-8065-dafb6faf7e6b","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10843[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 589[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 808[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 393[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 941[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:34
[2m   Duration [22m 19.90s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx35 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764880318554,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880321991,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880325602,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880325603,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880325614,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880325614,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880325641,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880325656,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880326110,"env":"test","module":"user-credentials-repository","userId":"V-agjeg5fA8W_1WvQHeUJ","msg":"User credentials created"}
{"level":30,"time":1764880326114,"env":"test","module":"auth-routes","userId":"V-agjeg5fA8W_1WvQHeUJ","email":"test-workflows-kKmZqSiNn6hiwCtl01Qid@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2ac59569-8f31-458c-a07e-d92bd430512f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"V-agjeg5fA8W_1WvQHeUJ","tenantId":"7a456b52-a09f-4729-b9da-5a66669a566c","createdBy":"V-agjeg5fA8W_1WvQHeUJ","ownerId":"V-agjeg5fA8W_1WvQHeUJ","status":"active","archived":false,"createdAt":"2025-12-04T20:32:07.836Z","updatedAt":"2025-12-04T20:32:07.836Z"}

{"level":30,"time":1764880326758,"env":"test","module":"user-credentials-repository","userId":"MLEdqcUUP3sG8KiHvYDl7","msg":"User credentials created"}
{"level":30,"time":1764880326759,"env":"test","module":"auth-routes","userId":"MLEdqcUUP3sG8KiHvYDl7","email":"viewer-h8pxJdL9YYtgnRkT3OUqE@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880326842,"env":"test","module":"rbac-middleware","userId":"MLEdqcUUP3sG8KiHvYDl7","userRole":"viewer","permission":"workflow:create","path":"/projects/2ac59569-8f31-458c-a07e-d92bd430512f/workflows","msg":"Permission denied"}
{"level":50,"time":1764880332724,"env":"test","error":{},"workflowId":"3593f7d5-c192-470b-9178-095b062bf169","userId":"V-agjeg5fA8W_1WvQHeUJ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880333021,"env":"test","module":"auth-middleware","path":"/api/workflows/3190742d-aea6-48f8-8b10-ea4db408f739/move","msg":"No valid authentication found"}
{"level":30,"time":1764880333484,"env":"test","module":"user-credentials-repository","userId":"V1VCj3H9JC_unnaWZR9kE","msg":"User credentials created"}
{"level":30,"time":1764880333484,"env":"test","module":"auth-routes","userId":"V1VCj3H9JC_unnaWZR9kE","email":"test-workflows-F0aP_WQyOdHrnhu91IUgT@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880333533,"env":"test","error":{},"workflowId":"9b6c2883-9dc5-4ea7-999f-09d9c86ad118","userId":"V1VCj3H9JC_unnaWZR9kE","projectId":"0e5526da-df2d-4fea-bd9f-63f6b32fda1b","msg":"Error moving workflow"}
{"level":50,"time":1764880333873,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2edf2b50-2b32-4bc6-91c0-ce34d54114e0","userId":"V-agjeg5fA8W_1WvQHeUJ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880334224,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f43dee70-475f-4d53-88dc-0c62db81c77e","userId":"V-agjeg5fA8W_1WvQHeUJ","msg":"Error moving workflow"}
{"level":30,"time":1764880334731,"env":"test","module":"user-credentials-repository","userId":"9Y9-dx7c9a4TwckpHJt3p","msg":"User credentials created"}
{"level":30,"time":1764880334732,"env":"test","module":"auth-routes","userId":"9Y9-dx7c9a4TwckpHJt3p","email":"test-workflows-NwP6BXx0Fj7NSWJPwfB3Y@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880334915,"env":"test","module":"auth-routes","userId":"9Y9-dx7c9a4TwckpHJt3p","email":"test-workflows-NwP6BXx0Fj7NSWJPwfB3Y@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880335093,"env":"test","error":{},"workflowId":"46f84600-4c51-4d8d-a22b-ddb8e95a77e4","userId":"V-agjeg5fA8W_1WvQHeUJ","projectId":"8aa26503-7803-4fbd-bc74-ac44d5ec98a0","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9914[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create a new draft workflow[32m 293[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 289[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 493[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 545[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 703[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 658[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 427[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 297[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 512[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 869[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:55
[2m   Duration [22m 19.81s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx36 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764880372036,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880374799,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880378645,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880378645,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880378658,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880378658,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880378658,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880378658,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880379219,"env":"test","module":"user-credentials-repository","userId":"d_hlKPtafJWSCm3JkfR_U","msg":"User credentials created"}
{"level":30,"time":1764880379223,"env":"test","module":"auth-routes","userId":"d_hlKPtafJWSCm3JkfR_U","email":"test-workflows-3SsBmtfEnGMd5mEIi0oEs@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f7b693e7-4e35-4075-a977-3251dcea2cbf","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"d_hlKPtafJWSCm3JkfR_U","tenantId":"30e78060-5ddd-456a-a77d-b12079f5d4e3","createdBy":"d_hlKPtafJWSCm3JkfR_U","ownerId":"d_hlKPtafJWSCm3JkfR_U","status":"active","archived":false,"createdAt":"2025-12-04T20:33:00.946Z","updatedAt":"2025-12-04T20:33:00.946Z"}

{"level":30,"time":1764880379908,"env":"test","module":"user-credentials-repository","userId":"Uih4xGg9jjWFNYWmTQWe2","msg":"User credentials created"}
{"level":30,"time":1764880379909,"env":"test","module":"auth-routes","userId":"Uih4xGg9jjWFNYWmTQWe2","email":"viewer-3OYYfgA2zFd9PUXv9TtXP@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880380006,"env":"test","module":"rbac-middleware","userId":"Uih4xGg9jjWFNYWmTQWe2","userRole":"viewer","permission":"workflow:create","path":"/projects/f7b693e7-4e35-4075-a977-3251dcea2cbf/workflows","msg":"Permission denied"}
{"level":50,"time":1764880385945,"env":"test","error":{},"workflowId":"f1c83f48-a63c-4ccb-9bd3-47c4897303d0","userId":"d_hlKPtafJWSCm3JkfR_U","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880386237,"env":"test","module":"auth-middleware","path":"/api/workflows/5cab0f45-a6d7-48b7-8142-3fe6f515d7f2/move","msg":"No valid authentication found"}
{"level":30,"time":1764880386784,"env":"test","module":"user-credentials-repository","userId":"jvtnQNKVOaQ9-qWyEo44d","msg":"User credentials created"}
{"level":30,"time":1764880386784,"env":"test","module":"auth-routes","userId":"jvtnQNKVOaQ9-qWyEo44d","email":"test-workflows-tAiIgakU0aCRrsD9h151h@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880386831,"env":"test","error":{},"workflowId":"fb303d43-e69d-496c-9678-441a14321fe8","userId":"jvtnQNKVOaQ9-qWyEo44d","projectId":"dc46feb8-1b03-4bbe-995b-6d97b45e8e19","msg":"Error moving workflow"}
{"level":50,"time":1764880387172,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3bd97ead-2966-439e-b65d-790c851e9f34","userId":"d_hlKPtafJWSCm3JkfR_U","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880387515,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d4d7fc9d-ffcf-494f-877b-94019ffa3228","userId":"d_hlKPtafJWSCm3JkfR_U","msg":"Error moving workflow"}
{"level":30,"time":1764880388007,"env":"test","module":"user-credentials-repository","userId":"M6qjJYespAXygvf5u965R","msg":"User credentials created"}
{"level":30,"time":1764880388007,"env":"test","module":"auth-routes","userId":"M6qjJYespAXygvf5u965R","email":"test-workflows-MENmlommHfL5ElXAqaHXb@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880388187,"env":"test","module":"auth-routes","userId":"M6qjJYespAXygvf5u965R","email":"test-workflows-MENmlommHfL5ElXAqaHXb@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880388358,"env":"test","error":{},"workflowId":"c4a06c85-59a8-449f-845b-7e6b6c45fa5f","userId":"d_hlKPtafJWSCm3JkfR_U","projectId":"04211e9f-cb12-4040-995f-7fae737e19da","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9947[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 441[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 445[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 719[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 439[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 343[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 844[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:32:47
[2m   Duration [22m 20.13s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx37 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764891573694,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764891576901,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764891581589,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764891581590,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764891581599,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764891581600,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764891581600,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764891581600,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764891582110,"env":"test","module":"user-credentials-repository","userId":"hAlJJiTafLx5QGxAm1jZm","msg":"User credentials created"}
{"level":30,"time":1764891582114,"env":"test","module":"auth-routes","userId":"hAlJJiTafLx5QGxAm1jZm","email":"test-workflows-stJP10ZAx1t9SjsHKcx0c@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"10904465-603a-49b8-a243-5f244d8d5917","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"hAlJJiTafLx5QGxAm1jZm","tenantId":"5f6319ef-21d2-4752-ac02-959683a3acba","createdBy":"hAlJJiTafLx5QGxAm1jZm","ownerId":"hAlJJiTafLx5QGxAm1jZm","status":"active","archived":false,"createdAt":"2025-12-04T23:39:44.026Z","updatedAt":"2025-12-04T23:39:44.026Z"}

{"level":30,"time":1764891582773,"env":"test","module":"user-credentials-repository","userId":"27c_Nr1c6uXJHtb5VFpdA","msg":"User credentials created"}
{"level":30,"time":1764891582774,"env":"test","module":"auth-routes","userId":"27c_Nr1c6uXJHtb5VFpdA","email":"viewer-adItlwXPIiY0pUHObNKCJ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764891582867,"env":"test","module":"rbac-middleware","userId":"27c_Nr1c6uXJHtb5VFpdA","userRole":"viewer","permission":"workflow:create","path":"/projects/10904465-603a-49b8-a243-5f244d8d5917/workflows","msg":"Permission denied"}
{"level":50,"time":1764891588883,"env":"test","error":{},"workflowId":"7d840361-2a74-48d9-8741-41f968f397cf","userId":"hAlJJiTafLx5QGxAm1jZm","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764891589213,"env":"test","module":"auth-middleware","path":"/api/workflows/7bf535cb-0947-4ab6-a62b-f63d19f70b76/move","msg":"No valid authentication found"}
{"level":30,"time":1764891589712,"env":"test","module":"user-credentials-repository","userId":"g9nqEk0Zhx7S7pyTFByoR","msg":"User credentials created"}
{"level":30,"time":1764891589712,"env":"test","module":"auth-routes","userId":"g9nqEk0Zhx7S7pyTFByoR","email":"test-workflows-kMtn3f_O8AOquBjWbIP1w@example.com","msg":"User registered successfully"}
{"level":50,"time":1764891589756,"env":"test","error":{},"workflowId":"eec83e3b-ba0d-459d-8be8-d048c36ad513","userId":"g9nqEk0Zhx7S7pyTFByoR","projectId":"5d0a2a42-0908-4037-8278-916ecfea33f2","msg":"Error moving workflow"}
{"level":50,"time":1764891590103,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3b6da4db-7ff3-4a50-929e-b991a7645287","userId":"hAlJJiTafLx5QGxAm1jZm","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764891590455,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c9bf1a26-6a39-4b43-aaec-11c0d339449f","userId":"hAlJJiTafLx5QGxAm1jZm","msg":"Error moving workflow"}
{"level":30,"time":1764891590934,"env":"test","module":"user-credentials-repository","userId":"ULj6efuJkVFReGQpZ25sZ","msg":"User credentials created"}
{"level":30,"time":1764891590934,"env":"test","module":"auth-routes","userId":"ULj6efuJkVFReGQpZ25sZ","email":"test-workflows-U6r4jzMw6PZJOz47IgtMm@example.com","msg":"User registered successfully"}
{"level":30,"time":1764891591121,"env":"test","module":"auth-routes","userId":"ULj6efuJkVFReGQpZ25sZ","email":"test-workflows-U6r4jzMw6PZJOz47IgtMm@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764891591302,"env":"test","error":{},"workflowId":"90b5fc1d-cd3c-457d-9c92-6879daaf5f27","userId":"hAlJJiTafLx5QGxAm1jZm","projectId":"2f03813d-58ca-4abe-b96d-423d70b69f4e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9950[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 316[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 289[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 698[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 351[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 849[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:39:28
[2m   Duration [22m 21.65s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/auth.ts [22m[34mx38 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764892165157,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892169059,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892173278,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892173278,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892173291,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892173291,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892173291,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892173291,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892173823,"env":"test","module":"user-credentials-repository","userId":"3fa6ll7-m9lbuwAKG8XpZ","msg":"User credentials created"}
{"level":30,"time":1764892173826,"env":"test","module":"auth-routes","userId":"3fa6ll7-m9lbuwAKG8XpZ","email":"test-workflows-Cf7mDkmVlK_-VWomQOKIc@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"cc04348a-6edb-4b71-9192-6025ddcb23ef","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"3fa6ll7-m9lbuwAKG8XpZ","tenantId":"45599e04-4569-4e36-8ad4-9483cd4a4119","createdBy":"3fa6ll7-m9lbuwAKG8XpZ","ownerId":"3fa6ll7-m9lbuwAKG8XpZ","status":"active","archived":false,"createdAt":"2025-12-04T23:49:35.755Z","updatedAt":"2025-12-04T23:49:35.755Z"}

{"level":30,"time":1764892174524,"env":"test","module":"user-credentials-repository","userId":"pBVccw1prz5KlvGlaRcMF","msg":"User credentials created"}
{"level":30,"time":1764892174524,"env":"test","module":"auth-routes","userId":"pBVccw1prz5KlvGlaRcMF","email":"viewer-dfF-IAnVEQPj2rhOjb1OY@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892174634,"env":"test","module":"rbac-middleware","userId":"pBVccw1prz5KlvGlaRcMF","userRole":"viewer","permission":"workflow:create","path":"/projects/cc04348a-6edb-4b71-9192-6025ddcb23ef/workflows","msg":"Permission denied"}
{"level":50,"time":1764892180840,"env":"test","error":{},"workflowId":"be592b5a-f13d-4652-b550-5862e20bc37b","userId":"3fa6ll7-m9lbuwAKG8XpZ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892181143,"env":"test","module":"auth-middleware","path":"/api/workflows/0062e54e-c13d-4cad-ba61-4b2227b81411/move","msg":"No valid authentication found"}
{"level":30,"time":1764892181946,"env":"test","module":"user-credentials-repository","userId":"PcL_k5xmqn__9C8RNP46s","msg":"User credentials created"}
{"level":30,"time":1764892181947,"env":"test","module":"auth-routes","userId":"PcL_k5xmqn__9C8RNP46s","email":"test-workflows-J7kUv6E7OHrJLR40wVra3@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892181991,"env":"test","error":{},"workflowId":"816d95a4-6c45-4966-9f5a-35cbce4141b7","userId":"PcL_k5xmqn__9C8RNP46s","projectId":"c0c426a5-d797-46eb-944d-249c6619883d","msg":"Error moving workflow"}
{"level":50,"time":1764892182364,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9fc4790f-6bbe-432d-a53f-a648cee40b15","userId":"3fa6ll7-m9lbuwAKG8XpZ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892182730,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c92747fa-a24e-416e-9e7b-6db54d0550e8","userId":"3fa6ll7-m9lbuwAKG8XpZ","msg":"Error moving workflow"}
{"level":30,"time":1764892183253,"env":"test","module":"user-credentials-repository","userId":"vG9GSCfUWpzUC_qhYLIwE","msg":"User credentials created"}
{"level":30,"time":1764892183254,"env":"test","module":"auth-routes","userId":"vG9GSCfUWpzUC_qhYLIwE","email":"test-workflows-wFuImnu2GpFuCztFT0Oc_@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892183444,"env":"test","module":"auth-routes","userId":"vG9GSCfUWpzUC_qhYLIwE","email":"test-workflows-wFuImnu2GpFuCztFT0Oc_@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892183627,"env":"test","error":{},"workflowId":"2c3340fe-ecc3-4c13-ba43-0cb4cbbd29cb","userId":"3fa6ll7-m9lbuwAKG8XpZ","projectId":"12abec89-b9f6-4a87-877e-dbb03704b277","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 764[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 302[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 848[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 899[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:49:20
[2m   Duration [22m 22.61s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx39 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764892481380,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892484652,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892487786,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892487787,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892487798,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892487799,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892487799,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892487799,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892488299,"env":"test","module":"user-credentials-repository","userId":"R59BhLCLDecgGBKrxgy5m","msg":"User credentials created"}
{"level":30,"time":1764892488302,"env":"test","module":"auth-routes","userId":"R59BhLCLDecgGBKrxgy5m","email":"test-workflows-1wKWOKsrjBVDiUQQk3QfI@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a407e838-1eb6-4994-b3da-41a5002f7efc","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"R59BhLCLDecgGBKrxgy5m","tenantId":"e6f08a43-1758-4f32-a2a8-d7e71b1420b9","createdBy":"R59BhLCLDecgGBKrxgy5m","ownerId":"R59BhLCLDecgGBKrxgy5m","status":"active","archived":false,"createdAt":"2025-12-04T23:54:50.232Z","updatedAt":"2025-12-04T23:54:50.232Z"}

{"level":30,"time":1764892488993,"env":"test","module":"user-credentials-repository","userId":"DfV0cQRK1oHFEorVL__w7","msg":"User credentials created"}
{"level":30,"time":1764892488994,"env":"test","module":"auth-routes","userId":"DfV0cQRK1oHFEorVL__w7","email":"viewer-MS_r3ynfdDptBJEeGvuRc@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892489086,"env":"test","module":"rbac-middleware","userId":"DfV0cQRK1oHFEorVL__w7","userRole":"viewer","permission":"workflow:create","path":"/projects/a407e838-1eb6-4994-b3da-41a5002f7efc/workflows","msg":"Permission denied"}
{"level":50,"time":1764892495341,"env":"test","error":{},"workflowId":"6f4d75fe-db58-4f09-a723-3da91d39c998","userId":"R59BhLCLDecgGBKrxgy5m","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892495664,"env":"test","module":"auth-middleware","path":"/api/workflows/de081a88-0966-4511-b96d-7e9748f5760e/move","msg":"No valid authentication found"}
{"level":30,"time":1764892496189,"env":"test","module":"user-credentials-repository","userId":"JDATcZkn5mXRSxfsqChi-","msg":"User credentials created"}
{"level":30,"time":1764892496190,"env":"test","module":"auth-routes","userId":"JDATcZkn5mXRSxfsqChi-","email":"test-workflows-flWvSuYbp5iGnyMMnu10p@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892496239,"env":"test","error":{},"workflowId":"0c71367a-4cf4-43eb-84e3-53dc1bca1c39","userId":"JDATcZkn5mXRSxfsqChi-","projectId":"9e779779-4dfb-4e18-abbd-d3f118609876","msg":"Error moving workflow"}
{"level":50,"time":1764892496604,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"789b9800-62bf-4171-897b-38bc51c705da","userId":"R59BhLCLDecgGBKrxgy5m","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892496969,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9d4126e2-c247-474d-b123-7439c36b802d","userId":"R59BhLCLDecgGBKrxgy5m","msg":"Error moving workflow"}
{"level":30,"time":1764892497473,"env":"test","module":"user-credentials-repository","userId":"PkVGuKinRWKqP9Q7_q6f9","msg":"User credentials created"}
{"level":30,"time":1764892497474,"env":"test","module":"auth-routes","userId":"PkVGuKinRWKqP9Q7_q6f9","email":"test-workflows-M8TJ9L8KRsF91QsMnwJyE@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892497661,"env":"test","module":"auth-routes","userId":"PkVGuKinRWKqP9Q7_q6f9","email":"test-workflows-M8TJ9L8KRsF91QsMnwJyE@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892497838,"env":"test","error":{},"workflowId":"dc526abb-5e13-4c76-8cb7-3bd4122add69","userId":"R59BhLCLDecgGBKrxgy5m","projectId":"ddee6eb4-b7d0-4dde-9617-4fc9d735bc8d","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10367[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 337[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 586[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 366[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 871[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:36
[2m   Duration [22m 20.34s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx40 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764892502641,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892504739,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892507162,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892507163,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892507175,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892507175,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892507175,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892507175,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892507626,"env":"test","module":"user-credentials-repository","userId":"aHY1BWBmk72lYgBkmiuXH","msg":"User credentials created"}
{"level":30,"time":1764892507629,"env":"test","module":"auth-routes","userId":"aHY1BWBmk72lYgBkmiuXH","email":"test-workflows-YnLo5Qpwo2UNw8etdljZ4@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"402160d9-8855-4506-8894-5dd175b5df9b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"aHY1BWBmk72lYgBkmiuXH","tenantId":"adf8b5d4-fea4-4493-a119-84bcb3a5fdbe","createdBy":"aHY1BWBmk72lYgBkmiuXH","ownerId":"aHY1BWBmk72lYgBkmiuXH","status":"active","archived":false,"createdAt":"2025-12-04T23:55:09.565Z","updatedAt":"2025-12-04T23:55:09.565Z"}

{"level":30,"time":1764892508319,"env":"test","module":"user-credentials-repository","userId":"tfq9tKLtlBKQprsbaaSMX","msg":"User credentials created"}
{"level":30,"time":1764892508320,"env":"test","module":"auth-routes","userId":"tfq9tKLtlBKQprsbaaSMX","email":"viewer-oxRyCbPMWJJyikpJBmeFp@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892508416,"env":"test","module":"rbac-middleware","userId":"tfq9tKLtlBKQprsbaaSMX","userRole":"viewer","permission":"workflow:create","path":"/projects/402160d9-8855-4506-8894-5dd175b5df9b/workflows","msg":"Permission denied"}
{"level":50,"time":1764892514760,"env":"test","error":{},"workflowId":"9cf4f6c1-e531-43b7-a7a6-d763e7f5c41b","userId":"aHY1BWBmk72lYgBkmiuXH","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892515088,"env":"test","module":"auth-middleware","path":"/api/workflows/1c23cfac-e84f-498d-8f76-9aed4998f129/move","msg":"No valid authentication found"}
{"level":30,"time":1764892515659,"env":"test","module":"user-credentials-repository","userId":"WrU8iPMxsCDoPLfXEnvzw","msg":"User credentials created"}
{"level":30,"time":1764892515660,"env":"test","module":"auth-routes","userId":"WrU8iPMxsCDoPLfXEnvzw","email":"test-workflows-rZATvjBSg-Y-GLkgE5gGe@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892515760,"env":"test","error":{},"workflowId":"a42234d1-81c2-4177-800c-b0da6a8ac6ce","userId":"WrU8iPMxsCDoPLfXEnvzw","projectId":"063b23f3-609d-45e1-a823-a5bf2cc6c927","msg":"Error moving workflow"}
{"level":50,"time":1764892516140,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"318b674e-b130-4ee4-8125-a163cd7f2f49","userId":"aHY1BWBmk72lYgBkmiuXH","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892516510,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"99e95ff4-d3de-41f6-9188-d1b5acdde6de","userId":"aHY1BWBmk72lYgBkmiuXH","msg":"Error moving workflow"}
{"level":50,"time":1764892516693,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(aHY1BWBmk72lYgBkmiuXH) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"aHY1BWBmk72lYgBkmiuXH","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9812[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 854[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 327[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 674[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 183[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15

    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;
[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:58
[2m   Duration [22m 17.62s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx41 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764895078217,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895081945,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895086102,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895086102,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895086113,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895086113,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895086113,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895086113,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895086624,"env":"test","module":"user-credentials-repository","userId":"lisD9e0ATuIM5LRyOFYaR","msg":"User credentials created"}
{"level":30,"time":1764895086628,"env":"test","module":"auth-routes","userId":"lisD9e0ATuIM5LRyOFYaR","email":"test-workflows-RWh7FYUVEWvXIwV_ACA72@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c47d0f65-77a2-46aa-a75e-919c77e8f84b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"lisD9e0ATuIM5LRyOFYaR","tenantId":"c4124c22-27db-4601-9592-366562d97ddd","createdBy":"lisD9e0ATuIM5LRyOFYaR","ownerId":"lisD9e0ATuIM5LRyOFYaR","status":"active","archived":false,"createdAt":"2025-12-05T00:38:06.800Z","updatedAt":"2025-12-05T00:38:06.800Z"}

{"level":30,"time":1764895087331,"env":"test","module":"user-credentials-repository","userId":"MP2AJzH9EXtu3unUYYeKW","msg":"User credentials created"}
{"level":30,"time":1764895087331,"env":"test","module":"auth-routes","userId":"MP2AJzH9EXtu3unUYYeKW","email":"viewer-uAFepCXuwSxl7z8pRujpz@example.com","msg":"User registered successfully"}
{"level":40,"time":1764895087436,"env":"test","module":"rbac-middleware","userId":"MP2AJzH9EXtu3unUYYeKW","userRole":"viewer","permission":"workflow:create","path":"/projects/c47d0f65-77a2-46aa-a75e-919c77e8f84b/workflows","msg":"Permission denied"}
{"level":50,"time":1764895093808,"env":"test","error":{},"workflowId":"22577a64-911b-4056-be52-63e9b3c41ddb","userId":"lisD9e0ATuIM5LRyOFYaR","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764895094129,"env":"test","module":"auth-middleware","path":"/api/workflows/f40aaee6-1399-470e-a356-50ab888f37a5/move","msg":"No valid authentication found"}
{"level":30,"time":1764895094649,"env":"test","module":"user-credentials-repository","userId":"b91eqno7Jc7vqPYU5WE2D","msg":"User credentials created"}
{"level":30,"time":1764895094649,"env":"test","module":"auth-routes","userId":"b91eqno7Jc7vqPYU5WE2D","email":"test-workflows-YwB2o1OS4VL1y7ZxKnBE9@example.com","msg":"User registered successfully"}
{"level":50,"time":1764895094747,"env":"test","error":{},"workflowId":"ab7156b8-04ef-4e90-b40a-3f331f291d41","userId":"b91eqno7Jc7vqPYU5WE2D","projectId":"079b6375-a211-4b21-aca2-30f74f391e0c","msg":"Error moving workflow"}
{"level":50,"time":1764895094932,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(lisD9e0ATuIM5LRyOFYaR) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"lisD9e0ATuIM5LRyOFYaR","msg":"Error creating workflow"}
{"level":50,"time":1764895095096,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(lisD9e0ATuIM5LRyOFYaR) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"lisD9e0ATuIM5LRyOFYaR","msg":"Error creating workflow"}
{"level":50,"time":1764895095270,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(lisD9e0ATuIM5LRyOFYaR) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"lisD9e0ATuIM5LRyOFYaR","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 9430[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 490[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 649[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 321[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 619[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 184[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 164[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 174[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 18:37:52
[2m   Duration [22m 21.24s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
