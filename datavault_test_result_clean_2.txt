npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764869817070,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764869818476,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764869819767,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764869819768,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764869819775,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764869819775,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764869819775,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764869819775,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764869820148,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764869820149,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764869820191,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764869820279,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjcyYmE3MzNkLTJhNTUtNDM3MS1iYjRkLTVjMjdkYzFmMWMwMCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg2OTgyMCwiZXhwIjoxNzY1NDc0NjIwfQ.ISnQBWCksafMyjK3wKNLSxc0ezOXxuhj4PnoX730fNM",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "72ba733d-2a55-4371-bb4d-5c27dc1f1c00",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764869820294,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764869820294,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764869820335,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764869820417,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764869822262,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 0f9c0863-c212-4fd1-a857-e357a0e117d6 tenantId: 72ba733d-2a55-4371-bb4d-5c27dc1f1c00 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 243ba221-5eaa-47b7-899c-1304d08f8d76 tenantId: 72ba733d-2a55-4371-bb4d-5c27dc1f1c00 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 2f552e1d-22c8-4fe4-b853-daf2e086f8e4 tenantId: 72ba733d-2a55-4371-bb4d-5c27dc1f1c00 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 811c822a-8add-4e0a-b167-a049f1f9c4e2 tenantId: 72ba733d-2a55-4371-bb4d-5c27dc1f1c00 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: c2d30ab4-6a4d-426e-99a7-60b3a589e6eb tenantId: 72ba733d-2a55-4371-bb4d-5c27dc1f1c00 userId: google-user-id

{"level":50,"time":1764869826821,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764869827936,"env":"test","module":"auth-middleware","path":"/datavault/databases/a0ef0f61-48d5-4371-87f7-40107451b616/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"47253b8d-f313-40c3-b291-bcf6c0c55aa2","tableId":"299d475c-1f9b-45e2-b999-c19568f95808","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:37:09.607Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"47253b8d-f313-40c3-b291-bcf6c0c55aa2","tableId":"299d475c-1f9b-45e2-b999-c19568f95808","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:37:09.607Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"d83b5e82-73c1-4b51-afe8-3a107b46785d","tableId":"606adfaf-87c3-47e2-8829-b2897ce523f5","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:37:10.142Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"d83b5e82-73c1-4b51-afe8-3a107b46785d","tableId":"606adfaf-87c3-47e2-8829-b2897ce523f5","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:37:10.142Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"d83b5e82-73c1-4b51-afe8-3a107b46785d","tableId":"606adfaf-87c3-47e2-8829-b2897ce523f5","userId":"other-user-id","role":"write","createdAt":"2025-12-04T17:37:10.142Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"d83b5e82-73c1-4b51-afe8-3a107b46785d","tableId":"606adfaf-87c3-47e2-8829-b2897ce523f5","userId":"other-user-id","role":"write","createdAt":"2025-12-04T17:37:10.142Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'd83b5e82-73c1-4b51-afe8-3a107b46785d'[39m,
  tableId: [32m'606adfaf-87c3-47e2-8829-b2897ce523f5'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2025-12-04T17:37:10.142Z'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mupsert result: {"id":"384f6b01-edea-4eec-88a0-cc7df326bf02","tableId":"83d8dd2d-66bb-4bf7-9e9d-d6f741f02700","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:37:10.631Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"384f6b01-edea-4eec-88a0-cc7df326bf02","tableId":"83d8dd2d-66bb-4bf7-9e9d-d6f741f02700","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:37:10.631Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: 384f6b01-edea-4eec-88a0-cc7df326bf02

{"level":50,"time":1764869829770,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764869830968,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
{"level":50,"time":1764869831641,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Required column 'Required Field' is missing

{"level":50,"time":1764869831851,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 12133[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 396[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1079[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 372[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 811[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 658[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 536[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 490[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should paginate rows efficiently [33m 996[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return user-friendly error for missing required fields [33m 672[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m23 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 11:36:54
[2m   Duration [22m 17.50s[2m (transform 2.06s, setup 670ms, collect 4.09s, tests 12.13s, environment 0ms, prepare 18ms)[22m

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764871633076,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871636615,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871640544,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871640545,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871640562,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871640562,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871640562,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871640562,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871641133,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871641134,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871641185,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871641286,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjMyZWFiMDEzLTM3ZDYtNDhlZi04ZDk5LWRmNjRkNGY1OTNiNSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3MTY0MSwiZXhwIjoxNzY1NDc2NDQxfQ.zXlHn_81y1kh-PkOus9KwiYG8DILMTlXTDBvosYKurs",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "32eab013-37d6-48ef-8d99-df64d4f593b5",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764871641305,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871641305,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871641347,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871641445,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764871641735,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871641986,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871642233,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871642378,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871642637,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871642785,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871643020,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871643253,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871643393,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871643736,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871644094,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871644276,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871644463,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764871644799,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871644944,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764871645406,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871645549,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764871645940,"env":"test","error":{},"databaseId":"808930e5-af49-4650-a4b6-bebeb871fd37","msg":"Error creating API token"}
{"level":50,"time":1764871646366,"env":"test","error":{},"databaseId":"6ed70b19-d5ea-40a4-8c24-337f365813be","msg":"Error creating API token"}
{"level":40,"time":1764871646521,"env":"test","module":"auth-middleware","path":"/datavault/databases/4d855ca9-03be-4935-ad26-bde2a89ce2d9/tables","msg":"No valid authentication found"}
{"level":50,"time":1764871646753,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871646992,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764871647218,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871647355,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764871647582,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764871647716,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764871647954,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871648801,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764871649041,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871649282,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871649418,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871649670,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 9194[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 298[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 392[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 406[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 342[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 727[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 484[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 603[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 390[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 191[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 235[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 154[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 364[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 360[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 847[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 240[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 377[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 252[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 19.82s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764871701141,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871704930,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871708738,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871708739,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871708750,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871708751,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871708751,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871708751,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871709246,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871709250,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871709308,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871709404,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImQwODRiZWRjLTE0NjItNGU2Ni1iOGU0LTNiODZkMzM5ZWMxMCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3MTcwOSwiZXhwIjoxNzY1NDc2NTA5fQ.iCbn1Fr4MiPo3SyUsQwwJfkVic43cHBd330tC10uQVA",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "d084bedc-1462-4e66-b8e4-3b86d339ec10",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764871709419,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871709419,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871709470,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871709569,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764871709824,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871710085,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871710341,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871710490,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871710738,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871710885,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871711126,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871711357,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871711510,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871711841,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871712183,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871712373,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871712556,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764871712884,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871713024,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764871713485,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871713621,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764871713949,"env":"test","error":{},"databaseId":"49472f16-96e2-4068-acd2-468e4987bb93","msg":"Error creating API token"}
{"level":50,"time":1764871714338,"env":"test","error":{},"databaseId":"8fa608b1-88f8-4471-8c7b-fa301909a210","msg":"Error creating API token"}
{"level":40,"time":1764871714476,"env":"test","module":"auth-middleware","path":"/datavault/databases/90b9e39b-59f3-4c5f-bca7-b25f6324bbdd/tables","msg":"No valid authentication found"}
{"level":50,"time":1764871714693,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871714898,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764871715116,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871715246,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764871715471,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764871715613,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764871715820,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871716693,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764871716931,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871717230,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871717365,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871717592,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8918[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 261[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 257[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 405[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 240[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 384[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 331[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 715[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 469[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 596[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 327[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 176[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 214[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 137[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 218[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 206[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 348[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 364[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 208[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 874[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 433[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 230[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields

AssertionError: expected 403 to be 400 // Object.is equality
[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:08:17

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»

[2m   Duration [22m 19.16s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764871754009,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871756804,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871760175,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871760176,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871760189,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871760189,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871760189,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871760189,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871760637,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871760638,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871760683,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871760778,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImNlZDI4Mzc1LTU0ODUtNDc4NC05ZTQyLWU1Y2JmMGNlMWIyYiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3MTc2MCwiZXhwIjoxNzY1NDc2NTYwfQ.iBgiTH_2zWzlfyFxR8HjcIJNvdR-XUDDM6G3pRFPua0",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "ced28375-5485-4784-9e42-e5cbf0ce1b2b",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764871760796,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871760797,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871760847,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871760935,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764871761172,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871761401,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871761619,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871761760,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871761987,"env":"test","error":{},"msg":"Error creating DataVault column"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871762121,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":50,"time":1764871762389,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871762610,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871762736,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871763044,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871763365,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871763535,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871763709,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764871764015,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871764137,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764871764583,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871764717,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764871765118,"env":"test","error":{},"databaseId":"3fd8c8ec-afe1-4727-857d-fbad63797542","msg":"Error creating API token"}
{"level":50,"time":1764871765547,"env":"test","error":{},"databaseId":"334685b3-3b46-4475-b953-b2dd170ab63c","msg":"Error creating API token"}
{"level":40,"time":1764871765703,"env":"test","module":"auth-middleware","path":"/datavault/databases/e9d242f6-ded8-493b-88a7-93550f530dd2/tables","msg":"No valid authentication found"}
{"level":50,"time":1764871765945,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871766198,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764871766443,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871766582,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764871766834,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764871766985,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764871767212,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871768086,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764871768322,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871768564,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871768707,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871768946,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8823[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 246[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 357[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 360[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 267[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 308[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 667[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 427[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 579[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 400[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 193[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 236[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 156[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 253[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 385[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 401[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 873[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 387[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 238[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 19.08s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764873688620,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873691784,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873696895,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873696896,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873696909,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873696909,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873696910,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873696910,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873697517,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764873697518,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764873697568,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764873697683,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjdiMzIzNmQyLTdiYWYtNGNkZS1iZTJkLWI2NmNjODk2NTA1YyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3MzY5NywiZXhwIjoxNzY1NDc4NDk3fQ.ePn_M_AbIliNUE-j9kdIPNi5-XCvV_LyHw4X6nIoJTk",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "7b3236d2-7baf-4cde-be2d-b66cc896505c",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764873697698,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764873697699,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764873697744,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764873697854,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764873698154,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873698423,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873698672,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873698820,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764873699068,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873699218,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764873699460,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873699710,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873699863,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764873700258,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873700605,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873700788,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873700984,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764873701319,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873701456,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764873701908,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873702058,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764873702431,"env":"test","error":{},"databaseId":"a4583ada-3c95-41d8-82b4-b8334031fa77","msg":"Error creating API token"}
{"level":50,"time":1764873702844,"env":"test","error":{},"databaseId":"817d7dc0-cd2e-4762-b917-6fa23bd5cf8f","msg":"Error creating API token"}
{"level":40,"time":1764873702997,"env":"test","module":"auth-middleware","path":"/datavault/databases/203e43a9-260a-4812-8f5c-71a1e032d756/tables","msg":"No valid authentication found"}
{"level":50,"time":1764873703230,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764873703466,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764873703713,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764873703862,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764873704124,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764873704287,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764873704530,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764873705403,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764873705641,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873705893,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873706038,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764873706300,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 9466[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[33m 309[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 263[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 394[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 398[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 402[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 396[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 724[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 473[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 603[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 371[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 174[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 239[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 152[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 398[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 424[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 242[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 873[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 397[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 261[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 20.86s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts [ tests/integration/datavault-v4-regression.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/datavault-v4-regression.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764874580407,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874585182,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874591677,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874591677,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874591695,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874591695,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874591695,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874591695,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874592253,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764874592254,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764874592344,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764874592443,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjY4MmU4MGYyLWE2NzktNDI1ZC1iMGUzLWEzNTY4MTgxOGFmMCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NDU5MiwiZXhwIjoxNzY1NDc5MzkyfQ.8OgZd9QcwJ_nCHbneVGy3sDIM9SF-FpKc2di5z6czbU",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "682e80f2-a679-425d-b0e3-a35681818af0",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764874592461,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764874592462,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764874592505,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764874592606,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764874594866,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 1ec013c3-3b30-4ca3-af75-29124ee1c618 tenantId: 682e80f2-a679-425d-b0e3-a35681818af0 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 3a4b6934-dd32-4bc7-b0dd-58b3530a5ce9 tenantId: 682e80f2-a679-425d-b0e3-a35681818af0 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 428bca93-6215-480a-bd6d-a17c9b269662 tenantId: 682e80f2-a679-425d-b0e3-a35681818af0 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 0d73c1b5-259c-4727-a0f5-4c53e366e037 tenantId: 682e80f2-a679-425d-b0e3-a35681818af0 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: daf44354-39eb-4e18-ba17-845da0fd143d tenantId: 682e80f2-a679-425d-b0e3-a35681818af0 userId: google-user-id

{"level":50,"time":1764874599803,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764874601210,"env":"test","module":"auth-middleware","path":"/datavault/databases/f6ceefc0-2255-45de-bbd9-5fce000ef490/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"1245c434-fcbd-4c6b-a8ca-e45cd55bea80","tableId":"a2a7bb16-c191-49be-b5bb-f1f8473bd627","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:56:43.007Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"1245c434-fcbd-4c6b-a8ca-e45cd55bea80","tableId":"a2a7bb16-c191-49be-b5bb-f1f8473bd627","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:56:43.007Z"}

{"level":50,"time":1764874602198,"env":"test","error":{"length":415,"name":"error","severity":"ERROR","code":"23503","detail":"Key (table_id)=(7d558998-987a-494f-bee3-e4d505c75465) is not present in table \"datavault_tables\".","schema":"public","table":"datavault_table_permissions","constraint":"datavault_table_permissions_table_id_datavault_tables_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered error: insert or update on table "datavault_table_permissions" violates foreign key constraint "datavault_table_permissions_table_id_datavault_tables_id_fk"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at NeonPreparedQuery.execute [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mdrizzle-orm[24m/neon-serverless/session.js:76:20[90m)[39m
    at DatavaultTablePermissionsRepository.upsert (C:/Users/scoot/poll/VaultLogic/server/repositories/DatavaultTablePermissionsRepository.ts:76:26)
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:151:20)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26 {
  length: [33m415[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (table_id)=(7d558998-987a-494f-bee3-e4d505c75465) is not present in table "datavault_tables".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'datavault_table_permissions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'datavault_table_permissions_table_id_datavault_tables_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2599'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

{"level":50,"time":1764874602419,"env":"test","userId":"google-user-id","path":"/api/datavault/tables/7d558998-987a-494f-bee3-e4d505c75465/permissions","msg":"User session missing tenantId - user may need to log out and log back in"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Your account is not properly configured. Please log out and log back in to fix this issue.
    at getTenantId (C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:50:13)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1137:24
    at Layer.handle [as handle_request] [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mexpress[24m\lib\router\layer.js:95:5[90m)[39m
    at next [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mexpress[24m\lib\router\route.js:149:13[90m)[39m
    at hybridAuth (C:/Users/scoot/poll/VaultLogic/server/middleware/auth.ts:187:7)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m

{"level":50,"time":1764874602421,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  message: [32m'Your account is not properly configured. Please log out and log back in to fix this issue.'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 12157[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 503[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 429[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 886[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 965[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 840[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 706[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 676[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 358[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 188[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 684[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 175[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 332[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 281[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 603[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 85[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 211[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 238[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 500 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21

    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/7]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 28.42s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764874686697,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874692405,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874698120,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874698120,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874698132,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874698132,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874698132,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874698132,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874698593,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764874698594,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764874698640,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764874698736,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImYxZWFiNjJlLWYyYmQtNGQwNy1hOGVhLTI2NzU5NDMyMThhNCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NDY5OCwiZXhwIjoxNzY1NDc5NDk4fQ.cC2ekRHezNpXSZc4pZIa8D-2yu5AqDFArFCup8cHHFA",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "f1eab62e-f2bd-4d07-a8ea-2675943218a4",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764874698755,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764874698756,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764874698805,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764874698888,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764874700867,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 0bcf73c2-3bf5-46a7-8029-f424f4fd5cf2 tenantId: f1eab62e-f2bd-4d07-a8ea-2675943218a4 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 49fb2d48-af2e-49a5-a7a8-a8c84e815d35 tenantId: f1eab62e-f2bd-4d07-a8ea-2675943218a4 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 62a9e21e-1b42-4ac8-a1e4-6ad674de744b tenantId: f1eab62e-f2bd-4d07-a8ea-2675943218a4 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: f81bdaa2-046f-41ee-968c-c47aabdfdb79 tenantId: f1eab62e-f2bd-4d07-a8ea-2675943218a4 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: c72aaf2b-a7f7-4005-a96e-4a31ab6cb816 tenantId: f1eab62e-f2bd-4d07-a8ea-2675943218a4 userId: google-user-id

{"level":50,"time":1764874705539,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764874706719,"env":"test","module":"auth-middleware","path":"/datavault/databases/a94acbc7-01a6-4bc2-ac72-35b3e2bce849/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"88ed7690-a237-4cc7-9818-bbc444a8db80","tableId":"35296948-26a3-4746-8785-4589bf85d38a","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:58:28.499Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"88ed7690-a237-4cc7-9818-bbc444a8db80","tableId":"35296948-26a3-4746-8785-4589bf85d38a","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:58:28.499Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"599abf24-b874-468e-a5df-b0327b83edc1","tableId":"6ec6b82e-8d3f-4131-a1d8-8683e701af67","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:58:29.064Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"599abf24-b874-468e-a5df-b0327b83edc1","tableId":"6ec6b82e-8d3f-4131-a1d8-8683e701af67","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:58:29.064Z"}

{"level":50,"time":1764874707817,"env":"test","error":{"length":415,"name":"error","severity":"ERROR","code":"23503","detail":"Key (table_id)=(6ec6b82e-8d3f-4131-a1d8-8683e701af67) is not present in table \"datavault_tables\".","schema":"public","table":"datavault_table_permissions","constraint":"datavault_table_permissions_table_id_datavault_tables_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered error: insert or update on table "datavault_table_permissions" violates foreign key constraint "datavault_table_permissions_table_id_datavault_tables_id_fk"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at NeonPreparedQuery.execute [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mdrizzle-orm[24m/neon-serverless/session.js:76:20[90m)[39m
    at DatavaultTablePermissionsRepository.upsert (C:/Users/scoot/poll/VaultLogic/server/repositories/DatavaultTablePermissionsRepository.ts:76:26)
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:151:20)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26 {
  length: [33m415[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (table_id)=(6ec6b82e-8d3f-4131-a1d8-8683e701af67) is not present in table "datavault_tables".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'datavault_table_permissions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'datavault_table_permissions_table_id_datavault_tables_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2599'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  message: [32m'insert or update on table "datavault_table_permissions" violates foreign key constraint "datavault_table_permissions_table_id_datavault_tables_id_fk"'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 11211[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 419[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 406[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1154[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 826[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 397[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 935[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 363[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 822[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 301[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 183[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 562[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 132[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 301[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 257[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 544[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 216[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 202[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 239[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 500 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/7]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 28.94s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764876565135,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876569371,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876574210,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876574211,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876574223,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876574223,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876574223,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876574224,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876574742,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764876574743,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764876574784,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764876574871,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjU4NmJhYjJlLTg5M2ItNDkwZi04ZTg5LWJjNGFlYWVlYTMzOCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NjU3NCwiZXhwIjoxNzY1NDgxMzc0fQ.hVh6Sj7J2GpstT9ESNucrLkNMyaRIvGUhCWgwey947Q",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "586bab2e-893b-490f-8e89-bc4aeaeea338",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764876574892,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764876574892,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764876574939,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764876575025,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764876575252,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876575480,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876575703,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876575838,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876576053,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876576183,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876576402,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876576622,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876576753,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876577063,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876577364,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876577548,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876577718,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764876578031,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876578156,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764876578601,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876578733,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764876579083,"env":"test","error":{},"databaseId":"1543a42c-3d06-4642-85a5-6ff0de2c7bb5","msg":"Error creating API token"}
{"level":50,"time":1764876579484,"env":"test","error":{},"databaseId":"96aa3139-6bdc-47cb-a594-0552f7995ea9","msg":"Error creating API token"}
{"level":40,"time":1764876579622,"env":"test","module":"auth-middleware","path":"/datavault/databases/639617a0-eed3-482e-84df-d17e44eaddf0/tables","msg":"No valid authentication found"}
{"level":50,"time":1764876579840,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876580048,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764876580263,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876580392,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764876580608,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764876580746,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764876580976,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876581775,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764876581983,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876582193,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876582317,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876582523,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 358[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 218[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 350[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 310[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 657[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 436[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 578[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 349[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 176[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 225[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 138[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 217[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 209[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 344[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 356[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 800[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 207[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 206[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:29:20
[2m   Duration [22m 21.03s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764876645635,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876648641,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876653041,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876653042,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876653054,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876653054,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876653055,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876653055,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876653564,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764876653565,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764876653657,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764876653751,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImVhYTRmMjVhLWVkZmMtNGI2ZS04M2FhLTQ4NTdhMmVhZGE5ZiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NjY1MywiZXhwIjoxNzY1NDgxNDUzfQ.YPZGsdvu8oEgj_YHuQeAdeDYfKNYEDNTTKA7YtBPklA",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "eaa4f25a-edfc-4b6e-83aa-4857a2eada9f",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764876653769,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764876653769,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764876653812,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764876653906,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764876654153,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876654394,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876654655,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876655068,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876655301,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876655446,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876655670,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876655901,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876656040,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876656369,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876656685,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876656876,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876657058,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764876657381,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876657515,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764876657977,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876658122,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764876658504,"env":"test","error":{},"databaseId":"64a27724-b060-40ef-8483-89aff1b635db","msg":"Error creating API token"}
{"level":50,"time":1764876658907,"env":"test","error":{},"databaseId":"8aee8c87-59d7-4eb2-a727-73cf78d334ba","msg":"Error creating API token"}
{"level":40,"time":1764876659050,"env":"test","module":"auth-middleware","path":"/datavault/databases/afeac1d5-4ab5-4418-b5b6-d465b1f29d32/tables","msg":"No valid authentication found"}
{"level":50,"time":1764876659274,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876659513,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764876659737,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876659877,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764876660105,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764876660252,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764876660482,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876661320,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764876661553,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876661772,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876661901,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876662121,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 9135[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 253[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 674[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 328[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 688[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 458[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 608[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 380[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 178[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 224[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 143[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 225[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 366[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 373[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 838[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 349[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 219[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:30:40
[2m   Duration [22m 19.89s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764877227650,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877232521,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877236305,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877236306,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877236315,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877236315,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877236316,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877236316,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877236785,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877236786,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877236846,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877236942,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjRiMTNkNzIyLTFlNGQtNDUyMS04YTA2LTlmYmIzODdiNGMxMyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NzIzNiwiZXhwIjoxNzY1NDgyMDM2fQ.xkr9CoP-Bs6pJAhW9na-QQiVD-wSh-cxf0WfgdQKsgs",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "4b13d722-1e4d-4521-8a06-9fbb387b4c13",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877236962,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877236962,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877237008,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877237099,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877239206,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: c23e4782-1068-4aae-8839-3cd724996eb0 tenantId: 4b13d722-1e4d-4521-8a06-9fbb387b4c13 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 0fe04db3-7f99-4340-a9ff-0a6c73e87fd2 tenantId: 4b13d722-1e4d-4521-8a06-9fbb387b4c13 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: bf2a56e3-9d52-43be-91b4-2a47f39818e9 tenantId: 4b13d722-1e4d-4521-8a06-9fbb387b4c13 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 7c39d503-fa0f-42f2-bcb1-0284e2df6d0a tenantId: 4b13d722-1e4d-4521-8a06-9fbb387b4c13 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 0057f68a-c826-4d49-af16-85a709211e9f tenantId: 4b13d722-1e4d-4521-8a06-9fbb387b4c13 userId: google-user-id

{"level":50,"time":1764877244060,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764877245337,"env":"test","module":"auth-middleware","path":"/datavault/databases/b03ff73f-e701-43fd-b635-490421eeb46f/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"ca82004f-9c2e-40fd-8458-ac5cff09c37d","tableId":"41b1c48c-dcbd-4b84-bd26-8c6d38f4323e","userId":"other-user-id","role":"read","createdAt":"2025-12-04T19:40:47.161Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"ca82004f-9c2e-40fd-8458-ac5cff09c37d","tableId":"41b1c48c-dcbd-4b84-bd26-8c6d38f4323e","userId":"other-user-id","role":"read","createdAt":"2025-12-04T19:40:47.161Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"a81a29d4-1827-4307-8dad-be2938234e40","tableId":"23ace298-824d-4847-8b2a-c77449d44ab1","userId":"other-user-id","role":"read","createdAt":"2025-12-04T19:40:47.776Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"a81a29d4-1827-4307-8dad-be2938234e40","tableId":"23ace298-824d-4847-8b2a-c77449d44ab1","userId":"other-user-id","role":"read","createdAt":"2025-12-04T19:40:47.776Z"}

{"level":50,"time":1764877246480,"env":"test","error":{"length":415,"name":"error","severity":"ERROR","code":"23503","detail":"Key (table_id)=(23ace298-824d-4847-8b2a-c77449d44ab1) is not present in table \"datavault_tables\".","schema":"public","table":"datavault_table_permissions","constraint":"datavault_table_permissions_table_id_datavault_tables_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered error: insert or update on table "datavault_table_permissions" violates foreign key constraint "datavault_table_permissions_table_id_datavault_tables_id_fk"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at NeonPreparedQuery.execute [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mdrizzle-orm[24m/neon-serverless/session.js:76:20[90m)[39m
    at DatavaultTablePermissionsRepository.upsert (C:/Users/scoot/poll/VaultLogic/server/repositories/DatavaultTablePermissionsRepository.ts:76:26)
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:151:20)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26 {
  length: [33m415[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (table_id)=(23ace298-824d-4847-8b2a-c77449d44ab1) is not present in table "datavault_tables".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'datavault_table_permissions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'datavault_table_permissions_table_id_datavault_tables_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2599'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  message: [32m'insert or update on table "datavault_table_permissions" violates foreign key constraint "datavault_table_permissions_table_id_datavault_tables_id_fk"'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 11814[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 444[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1248[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 945[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 424[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 905[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 832[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 662[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 322[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 198[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 607[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 148[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 306[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 280[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 565[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 212[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 213[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 206[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 229[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 500 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/7]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:40:22
[2m   Duration [22m 24.16s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/googleAuth.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764877494893,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877497553,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877499690,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877499691,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877499700,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877499700,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877499701,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877499701,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877500148,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877500148,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877500197,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877500292,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjIyMmU2ZjNlLWQ2ODctNDg5NC1hMjIzLWQ4M2Y5ZjkzYmQ1YyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NzUwMCwiZXhwIjoxNzY1NDgyMzAwfQ.MuFa3Bxkh_BZRwhGnYvQSzI0WxX89arJzSoj4_BRzNk",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "222e6f3e-d687-4894-a223-d83f9f93bd5c",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877500306,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877500307,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877500359,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877500449,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877502609,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 65184a41-ee8b-40d1-ab26-2c2035380810 tenantId: 222e6f3e-d687-4894-a223-d83f9f93bd5c userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 73f9d3e9-55e7-4f72-b398-caf1918ec9dd tenantId: 222e6f3e-d687-4894-a223-d83f9f93bd5c userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 4748ab7c-ee10-4240-b991-2417b15a7737 tenantId: 222e6f3e-d687-4894-a223-d83f9f93bd5c userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: a073d93a-47bd-4608-a6dd-157267f2e644 tenantId: 222e6f3e-d687-4894-a223-d83f9f93bd5c userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 749c8fa8-d391-4c4c-bbfd-d710a21d2c8e tenantId: 222e6f3e-d687-4894-a223-d83f9f93bd5c userId: google-user-id

{"level":50,"time":1764877507320,"env":"test","error":{},"msg":"Error deleting row note"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[33m 10590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 439[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 839[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 422[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 921[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 824[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 741[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 595[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[32m 93[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate API token scopes[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny access with expired token[39m[32m 208[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 203[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 220[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 230[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 229[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 14 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 404 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 404

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should validate API token scopes
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should deny access with expired token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/14]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m14 failed[39m[22m[2m | [22m[1m[32m9 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:44:44
[2m   Duration [22m 24.54s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764877821928,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877828565,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877831139,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877831139,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877831152,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877831152,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877831153,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877831153,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877831578,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877831579,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877831623,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877831715,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImVjODZiNjNkLTQxMzktNGY4ZC04MTBlLWZhYjNmY2FmMmFmMyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NzgzMSwiZXhwIjoxNzY1NDgyNjMxfQ.Bgnr0gpHudCqHjmk9rX_kfgfxOD53McYu65cqcKt0w0",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "ec86b63d-4139-4f8d-810e-fab3fcaf2af3",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877831726,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877831726,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877831778,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877831869,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877833932,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: e414b8dc-18d1-4e6a-8665-82dd2a3b9ab2 tenantId: ec86b63d-4139-4f8d-810e-fab3fcaf2af3 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: afca3a0f-dce3-4132-bab1-8ec3a62f40ed tenantId: ec86b63d-4139-4f8d-810e-fab3fcaf2af3 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 1d4cc9f3-3735-4b9c-af6e-29a2174853da tenantId: ec86b63d-4139-4f8d-810e-fab3fcaf2af3 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 201f01b6-3d0b-4821-b957-890fe4a968c2 tenantId: ec86b63d-4139-4f8d-810e-fab3fcaf2af3 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: e49c9b36-7f0a-4192-8161-285dc222958d tenantId: ec86b63d-4139-4f8d-810e-fab3fcaf2af3 userId: google-user-id

{"level":50,"time":1764877838721,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764877839981,"env":"test","module":"auth-middleware","path":"/datavault/databases/274452a7-2673-478d-a07b-26daaaac09a2/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 10960[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 429[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 417[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1215[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 846[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 408[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 895[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 860[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 724[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 685[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 332[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 188[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 598[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 141[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 95[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 241[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 208[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 223[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 9 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/9]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m9 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:50:18
[2m   Duration [22m 23.23s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764877847792,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877849832,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877851951,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877851951,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877851966,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877851966,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877851966,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877851966,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877852474,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877852476,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877852527,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877852624,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImM3OGM0YTE4LTg4YjktNDY2Yy04MDk5LWZkOGQ3Y2Y1NWUyYiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3Nzg1MiwiZXhwIjoxNzY1NDgyNjUyfQ.wUgzXWQyTghjqWTAy9O5veOSqrEM8MfO-osHr7GAiPM",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "c78c4a18-88b9-466c-8099-fd8d7cf55e2b",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877852640,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877852641,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877852689,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877852778,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877854927,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 0ae9d782-9c77-4c20-a5fe-17b111dd721d tenantId: c78c4a18-88b9-466c-8099-fd8d7cf55e2b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 06e7197b-cbe3-4ace-88ab-d8c6ddfb5607 tenantId: c78c4a18-88b9-466c-8099-fd8d7cf55e2b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: f8cfdaaa-df2b-4f62-8739-832ee40ba657 tenantId: c78c4a18-88b9-466c-8099-fd8d7cf55e2b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: ea122f25-a48a-4f09-9df0-0db634f178c3 tenantId: c78c4a18-88b9-466c-8099-fd8d7cf55e2b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: ff6ad6ee-6e64-4c32-b3ab-02cbf8216173 tenantId: c78c4a18-88b9-466c-8099-fd8d7cf55e2b userId: google-user-id

{"level":50,"time":1764877860024,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764877861290,"env":"test","module":"auth-middleware","path":"/datavault/databases/ddeff858-e46a-490c-915f-317814ac5701/tables","msg":"No valid authentication found"}
{"level":50,"time":1764877861533,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 11426[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 430[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1288[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 916[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 931[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 842[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 940[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 322[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 195[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 593[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 155[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 250[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 91[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 225[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 203[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 209[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 217[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 9 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/9]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/9]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m9 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:50:42
[2m   Duration [22m 19.16s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764877868358,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877871000,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877873466,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877873466,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877873476,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877873476,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877873476,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877873476,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877873926,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877873927,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877873977,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877874070,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjM4ODk3ZmUzLWJmMDYtNDU1Yy1iNTI4LWVkMDlmNjI3MWFiOCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3Nzg3NCwiZXhwIjoxNzY1NDgyNjc0fQ.vGjrzQGWAmPu5C4f78TzUstSZ_-cJy7rynirvYf0_UE",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "38897fe3-bf06-455c-b528-ed09f6271ab8",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877874086,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877874086,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877874129,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877874215,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877876211,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: bdca1285-24ed-4d23-9661-0d096ba47404 tenantId: 38897fe3-bf06-455c-b528-ed09f6271ab8 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 03f47262-2079-4116-8feb-9633df84a1f0 tenantId: 38897fe3-bf06-455c-b528-ed09f6271ab8 userId: google-user-id

{"level":50,"time":1764877879133,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877879299,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764877879600,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877879729,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877880175,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877880305,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877880664,"env":"test","error":{},"databaseId":"231e28d6-ac96-44d5-bdb8-a54bce0213ba","msg":"Error creating API token"}
{"level":50,"time":1764877881063,"env":"test","error":{},"databaseId":"fa7bff89-baa0-439b-a412-907b8961c61f","msg":"Error creating API token"}
{"level":40,"time":1764877881215,"env":"test","module":"auth-middleware","path":"/datavault/databases/2a91c0f2-e842-49eb-a6d0-7539233b0d9c/tables","msg":"No valid authentication found"}
{"level":50,"time":1764877881448,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877881672,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764877881899,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877882033,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764877882257,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877882345,"env":"test","userId":"google-user-id","path":"/api/datavault/permissions/undefined","msg":"User session missing tenantId - user may need to log out and log back in"}
{"level":50,"time":1764877882345,"env":"test","error":{},"msg":"Error revoking table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[33m 10029[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 411[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 396[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1188[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 821[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 837[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 359[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 683[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 427[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 576[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 358[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 175[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 224[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 151[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 360[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 312[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 84[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 215[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 214[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 210[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 14 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/14]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/14]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m14 failed[39m[22m[2m | [22m[1m[32m9 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:51:03
[2m   Duration [22m 18.32s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764879993693,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764879996451,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880001032,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880001033,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880001046,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880001046,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880001046,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880001046,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880001509,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880001510,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880001558,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880001658,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjMzNjQ2MzY1LWM1ZjUtNDYzZC1iYWQ2LWM3NTFlNGQyYmI5MCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDAwMSwiZXhwIjoxNzY1NDg0ODAxfQ.QbthlLrWu-GCf2fQmeZ-pevQfAzAUoFn7-1JXbG8D64",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "33646365-c5f5-463d-bad6-c751e4d2bb90",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880001673,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880001673,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880001714,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880001803,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880002050,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880002287,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880002518,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880002657,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880002892,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880003033,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880003267,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880003517,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880003659,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880004008,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880004339,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880004523,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880004706,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880005049,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880005198,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880005725,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880005892,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880006344,"env":"test","error":{},"databaseId":"d7b358ca-7b8d-467a-a331-f0125a592e64","msg":"Error creating API token"}
{"level":50,"time":1764880006779,"env":"test","error":{},"databaseId":"302ea818-fd52-448b-ad86-1628bcbc9437","msg":"Error creating API token"}
{"level":40,"time":1764880006931,"env":"test","module":"auth-middleware","path":"/datavault/databases/15b197f3-a1ac-45ca-a18a-1e5039594d45/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880007169,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880007412,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880007643,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880007792,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880008045,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880008181,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880008418,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880009345,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880009596,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880009821,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880009964,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880010192,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 9221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 253[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 376[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 391[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 352[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 695[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 492[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 695[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 452[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 193[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 241[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 151[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 242[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 381[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 388[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 928[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 249[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 369[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 229[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:26:29
[2m   Duration [22m 19.73s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764880012596,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880015340,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880019880,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880019881,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880019892,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880019892,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880019893,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880019893,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880020382,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880020383,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880020461,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880020554,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6Ijg1MWYzNDFlLWY2OTAtNGMyNi04N2QxLTNlYmFiOWRhMGM1YiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDAyMCwiZXhwIjoxNzY1NDg0ODIwfQ.Cw0jx2rWWJaTWBW2kVpIftIpbDLFKQDfNIa3OXWkALc",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "851f341e-f690-4c26-87d1-3ebab9da0c5b",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880020570,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880020570,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880020614,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880020702,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880022786,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

{"level":50,"time":1764880025358,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880025673,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880025855,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880026040,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880026373,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880026510,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880026981,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880027116,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880027481,"env":"test","error":{},"databaseId":"3fe81b12-b1fc-473f-8fa9-dac429ea95f6","msg":"Error creating API token"}
{"level":50,"time":1764880027876,"env":"test","error":{},"databaseId":"61c15633-299b-4a62-a363-3d04b9ddc8c6","msg":"Error creating API token"}
{"level":40,"time":1764880028018,"env":"test","module":"auth-middleware","path":"/datavault/databases/5112403e-4b92-4af2-af67-7893ae9cad7d/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880028245,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880028456,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880028677,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880028812,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880029036,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880029175,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880029396,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880030277,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880030517,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880030748,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880030881,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880031100,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 11281[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 409[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 422[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1253[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 415[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 955[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 335[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 678[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 470[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 605[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 365[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 172[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 223[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 141[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 210[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 356[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 363[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 220[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 882[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 240[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 364[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 219[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 13 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/13]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/13]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m13 failed[39m[22m[2m | [22m[1m[32m10 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:26:50
[2m   Duration [22m 20.51s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764880032585,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880033665,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880035090,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880035091,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880035102,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880035102,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880035102,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880035102,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880035499,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880035499,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880035538,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880035617,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjNlZmUyZDI0LWJhYjYtNDJmOC04MWIyLTllYTBlNDBlZGZhOSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDAzNSwiZXhwIjoxNzY1NDg0ODM1fQ.JFXwCf6byZromAUC68t_p47RHr0teNKsHpOW3EcCxn4",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "3efe2d24-bab6-42f8-81b2-9ea0e40edfa9",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880035632,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880035632,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880035674,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880035756,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880037638,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: b1dfe219-2690-4c72-abf4-2c5a9d1bef62 tenantId: 3efe2d24-bab6-42f8-81b2-9ea0e40edfa9 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 0f8da6e8-f703-4c46-b094-794a83dc3474 tenantId: 3efe2d24-bab6-42f8-81b2-9ea0e40edfa9 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: de9a1c0c-6712-455f-b8d4-be73c747b5b3 tenantId: 3efe2d24-bab6-42f8-81b2-9ea0e40edfa9 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: cc7f45cf-5b9f-4b11-a4f1-6092d958434a tenantId: 3efe2d24-bab6-42f8-81b2-9ea0e40edfa9 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 2c979b76-eec5-4d90-a095-4500bce0199d tenantId: 3efe2d24-bab6-42f8-81b2-9ea0e40edfa9 userId: google-user-id

{"level":50,"time":1764880042301,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764880043399,"env":"test","module":"auth-middleware","path":"/datavault/databases/830abd4e-b451-4800-8fea-dadd27d4cbc6/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"9e6c4cca-2aad-4ba6-9777-925f7295f8e1","tableId":"f81345d3-058b-4401-8f21-8442b0bff11e","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:27:25.242Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"9e6c4cca-2aad-4ba6-9777-925f7295f8e1","tableId":"f81345d3-058b-4401-8f21-8442b0bff11e","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:27:25.242Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"eff9fd82-c2a6-404a-88e9-c3b0f15dc111","tableId":"e34fdda0-fbf5-4a3a-b5f8-bc89403d3973","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:27:25.776Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"eff9fd82-c2a6-404a-88e9-c3b0f15dc111","tableId":"e34fdda0-fbf5-4a3a-b5f8-bc89403d3973","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:27:25.776Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"eff9fd82-c2a6-404a-88e9-c3b0f15dc111","tableId":"e34fdda0-fbf5-4a3a-b5f8-bc89403d3973","userId":"other-user-id","role":"write","createdAt":"2025-12-04T20:27:25.776Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"eff9fd82-c2a6-404a-88e9-c3b0f15dc111","tableId":"e34fdda0-fbf5-4a3a-b5f8-bc89403d3973","userId":"other-user-id","role":"write","createdAt":"2025-12-04T20:27:25.776Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'eff9fd82-c2a6-404a-88e9-c3b0f15dc111'[39m,
  tableId: [32m'e34fdda0-fbf5-4a3a-b5f8-bc89403d3973'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2025-12-04T20:27:25.776Z'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mupsert result: {"id":"69e24f9f-5276-4112-96bb-374307f98e7a","tableId":"7dd7046c-714a-42eb-b9f2-29a85e6fe707","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:27:26.286Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"69e24f9f-5276-4112-96bb-374307f98e7a","tableId":"7dd7046c-714a-42eb-b9f2-29a85e6fe707","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:27:26.286Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: 69e24f9f-5276-4112-96bb-374307f98e7a

{"level":50,"time":1764880045236,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880048082,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880048767,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Required column 'Required Field' is missing

{"level":50,"time":1764880048986,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 13953[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1113[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 948[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 502[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 853[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 655[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 580[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create an API token[32m 277[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 163[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 526[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 131[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should grant table permission[32m 272[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 247[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 586[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 1564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return user-friendly error for invalid column type [33m 1282[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return user-friendly error for missing required fields [33m 685[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 220[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
error: deadlock detected
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:778:7
    776|         );
    777|       }
    778|       await Promise.all(rowPromises);
       |       ^
    779| 
    780|       // Test pagination

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m22 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:27:11
[2m   Duration [22m 17.56s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880066548,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880069984,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880073601,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880073602,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880073613,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880073613,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880073614,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880073614,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880074126,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880074126,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880074178,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880074276,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImM1Y2YyODk1LWZhZjUtNGE5Yi05NzdmLTFjNDY5MGNiZmVkMSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDA3NCwiZXhwIjoxNzY1NDg0ODc0fQ.nbMt8ubvK086w72eQ9E_qhY8kKvKs9p3wGgW41vS07I",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "c5cf2895-faf5-4a9b-977f-1c4690cbfed1",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880074291,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880074291,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880074336,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880074425,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880074675,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880074927,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880075176,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880075318,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880075561,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880075707,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880075956,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880076197,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880076343,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880076671,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880077002,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880077183,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880077368,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880077690,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880077843,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880078306,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880078447,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880078815,"env":"test","error":{},"databaseId":"51765ad2-8f7d-4daa-9b41-9aab71005602","msg":"Error creating API token"}
{"level":50,"time":1764880079257,"env":"test","error":{},"databaseId":"d819b38f-a9c1-468a-a822-d9c01aa6db86","msg":"Error creating API token"}
{"level":40,"time":1764880079411,"env":"test","module":"auth-middleware","path":"/datavault/databases/852db004-89df-4c40-ac42-728777492488/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880079649,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880079869,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880080093,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880080221,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880080433,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880080562,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880080779,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880081619,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880081852,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880082087,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880082228,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880082456,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8914[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 257[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 392[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 389[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 249[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 386[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 327[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 698[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 475[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 604[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 368[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 182[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 259[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 154[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 350[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 340[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 218[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 839[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 377[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 227[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:27:42
[2m   Duration [22m 19.28s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764880087158,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880090985,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880094692,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880094693,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880094705,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880094705,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880094705,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880094705,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880095156,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880095157,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880095200,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880095297,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImI5MzgyYWFhLWI3NGEtNGFmZC1iNGJkLTZmMDY4MzNiNmM4OSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDA5NSwiZXhwIjoxNzY1NDg0ODk1fQ.z7YGpXqcb3zvcTYXfwPnojWzT6paxHew6uM0rlxBA44",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "b9382aaa-b74a-4afd-b4bd-6f06833b6c89",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880095311,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880095311,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880095359,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880095452,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880097554,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

{"level":50,"time":1764880097787,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880097936,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880098179,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880098411,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880098553,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880098882,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880099211,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880099412,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880099598,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880099946,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880100088,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880100563,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880100706,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880101079,"env":"test","error":{},"databaseId":"db089815-f2df-452f-9956-9ab99cd9cdb7","msg":"Error creating API token"}
{"level":50,"time":1764880101481,"env":"test","error":{},"databaseId":"a666f677-8cbc-42b3-a828-2c9bf3295e6f","msg":"Error creating API token"}
{"level":40,"time":1764880101626,"env":"test","module":"auth-middleware","path":"/datavault/databases/19c53210-fc30-4311-88bd-426fceb197bc/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880101862,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":50,"time":1764880102082,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880102315,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880102448,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880102670,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880102817,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880103043,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880103898,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880104138,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880104383,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880104529,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880104771,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m16 failed[39m[2m)[22m[33m 10135[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 422[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1256[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 386[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 374[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 329[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 717[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 489[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 618[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 373[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 178[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 224[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 144[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 219[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 367[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 858[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 391[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 240[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 16 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/16]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m16 failed[39m[22m[2m | [22m[1m[32m7 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:28:03
[2m   Duration [22m 20.57s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764880106987,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880109007,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880111666,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880111667,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880111676,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880111677,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880111677,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880111677,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880112145,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880112146,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880112193,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880112285,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjA1MTk4YTMyLWZjNjItNGJmMi05MmNkLTYxMTE1YmI2OTYzNiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDExMiwiZXhwIjoxNzY1NDg0OTEyfQ.7qhTDyNBDgfyg6IeTmu9L5-c3wkbGBLq8hk5Zx41V0o",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "05198a32-fc62-4bf2-92cd-61115bb69636",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880112302,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880112303,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880112354,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880112449,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880114516,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

{"level":50,"time":1764880115617,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880115873,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880116006,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880116319,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880116646,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880116831,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880117012,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880117327,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880117467,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880117903,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880118036,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880118410,"env":"test","error":{},"databaseId":"db791411-4a9c-4752-b76d-4b8736434419","msg":"Error creating API token"}
{"level":50,"time":1764880118845,"env":"test","error":{},"databaseId":"16a5bfe0-545f-42e5-805d-cbddc54491d2","msg":"Error creating API token"}
{"level":40,"time":1764880119005,"env":"test","module":"auth-middleware","path":"/datavault/databases/bbf3e8eb-74b5-4fec-a7d4-763ea119b62b/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880119229,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880119467,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880119700,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880119831,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880120058,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880120191,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880120426,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880121270,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880121500,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880121738,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880121880,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880122106,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 10498[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 413[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 406[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1248[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 873[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 385[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 313[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 694[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 455[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 569[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 374[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 199[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 235[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 159[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 225[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 359[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 844[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 380[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 226[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 15 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/15]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m15 failed[39m[22m[2m | [22m[1m[32m8 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:28:24
[2m   Duration [22m 16.87s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/sections.routes.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764880141491,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880146269,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880149679,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880149679,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880149689,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880149689,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880149689,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880149689,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880150122,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880150123,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880150167,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880150260,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjVkZTRlOTU0LTFhNGItNDA5NC1iOTcyLWY0NDQ3ZGM1MTVlNiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDE1MCwiZXhwIjoxNzY1NDg0OTUwfQ.cV0c-emz2Wlvkkfm85JgwzvUXQO_WTpmsqoPwoyt4hc",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "5de4e954-1a4b-4094-b972-f4447dc515e6",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880150275,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880150275,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880150314,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880150404,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880152385,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 98391d39-f7de-43d5-8261-6eff55cb908f tenantId: 5de4e954-1a4b-4094-b972-f4447dc515e6 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 7958d3d8-2f73-419d-8903-55c9987130f6 tenantId: 5de4e954-1a4b-4094-b972-f4447dc515e6 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 03ab5d08-741b-469d-893a-ff7ef4077f69 tenantId: 5de4e954-1a4b-4094-b972-f4447dc515e6 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 865abe5e-66cd-4d2a-b6d6-9682a553b7dd tenantId: 5de4e954-1a4b-4094-b972-f4447dc515e6 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 188c391d-c3a9-4aac-899a-e2d58b06b629 tenantId: 5de4e954-1a4b-4094-b972-f4447dc515e6 userId: google-user-id

{"level":50,"time":1764880156977,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764880158136,"env":"test","module":"auth-middleware","path":"/datavault/databases/607e56f9-3bd8-465d-a046-13dcc76670ad/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"384a728e-15de-4615-a0c9-2309a771a50d","tableId":"3806ae1a-68bc-47fb-b768-d19ad6d9c025","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:29:20.018Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"384a728e-15de-4615-a0c9-2309a771a50d","tableId":"3806ae1a-68bc-47fb-b768-d19ad6d9c025","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:29:20.018Z"}

{"level":50,"time":1764880158656,"env":"test","error":{},"msg":"Error fetching table permissions"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 10516[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 407[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 390[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1184[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 816[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 393[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 705[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 303[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 169[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 550[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 137[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 311[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 212[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 80[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 207[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 218[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 204[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 225[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 202[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 8 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/8]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/8]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:28:56
[2m   Duration [22m 22.48s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764880169628,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880175716,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880178606,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880178607,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880178620,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880178620,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880178620,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880178620,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880179066,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880179067,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880179117,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880179215,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjY4YjQxMmI0LTc3YmUtNDg5ZC1hZTE1LWIwNTJhN2VkNWM2ZCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDE3OSwiZXhwIjoxNzY1NDg0OTc5fQ.nrv7FKz__uHHJ8TDYcfaUKvYwtZtp0P4FMbEJOPtTUo",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "68b412b4-77be-489d-ae15-b052a7ed5c6d",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880179231,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880179232,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880179281,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880179368,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880181489,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: b74b633d-b3c7-4225-9c5f-99245ca55f61 tenantId: 68b412b4-77be-489d-ae15-b052a7ed5c6d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: c93817f0-6731-4c28-b044-a5af56b4f84e tenantId: 68b412b4-77be-489d-ae15-b052a7ed5c6d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 3e62ed42-5218-4444-b4fd-23d8344647e8 tenantId: 68b412b4-77be-489d-ae15-b052a7ed5c6d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 27ee25ad-0114-4e03-a197-ec43d67aa38b tenantId: 68b412b4-77be-489d-ae15-b052a7ed5c6d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: f6dc3006-e7a5-48ef-82ce-dc63aa4314f1 tenantId: 68b412b4-77be-489d-ae15-b052a7ed5c6d userId: google-user-id

{"level":50,"time":1764880186304,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764880187556,"env":"test","module":"auth-middleware","path":"/datavault/databases/1a6b5115-f3b1-45e4-a149-64deb3a38c42/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"85abf199-0b2f-49fd-8bad-24edb37bdd9b","tableId":"2b2837ea-356e-4d53-a980-269fedb46e9c","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:29:49.456Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"85abf199-0b2f-49fd-8bad-24edb37bdd9b","tableId":"2b2837ea-356e-4d53-a980-269fedb46e9c","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:29:49.456Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"b8603a00-d449-405f-a16a-de2092d677f1","tableId":"970e71d1-9620-4c73-a518-bda9dbe5805b","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:29:50.035Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"b8603a00-d449-405f-a16a-de2092d677f1","tableId":"970e71d1-9620-4c73-a518-bda9dbe5805b","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:29:50.035Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"b8603a00-d449-405f-a16a-de2092d677f1","tableId":"970e71d1-9620-4c73-a518-bda9dbe5805b","userId":"other-user-id","role":"write","createdAt":"2025-12-04T20:29:50.035Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"b8603a00-d449-405f-a16a-de2092d677f1","tableId":"970e71d1-9620-4c73-a518-bda9dbe5805b","userId":"other-user-id","role":"write","createdAt":"2025-12-04T20:29:50.035Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'b8603a00-d449-405f-a16a-de2092d677f1'[39m,
  tableId: [32m'970e71d1-9620-4c73-a518-bda9dbe5805b'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2025-12-04T20:29:50.035Z'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mupsert result: {"id":"8126e023-2606-46d6-bf4a-abc037a0e2c5","tableId":"338cf075-7b8a-4cf3-b74e-1ab2d74db714","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:29:50.572Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"8126e023-2606-46d6-bf4a-abc037a0e2c5","tableId":"338cf075-7b8a-4cf3-b74e-1ab2d74db714","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:29:50.572Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: 8126e023-2606-46d6-bf4a-abc037a0e2c5

{"level":50,"time":1764880189595,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880190427,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 12165[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1252[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 883[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 415[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 911[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 837[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 331[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 181[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 586[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 154[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 329[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 271[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 527[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 637[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 276[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 837[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 81[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 89[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 111[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m19 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:29:25
[2m   Duration [22m 24.27s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880193891,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880195665,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880197342,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880197342,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880197352,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880197352,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880197352,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880197352,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880197788,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880197789,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880197837,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880197932,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjJkOGMxZDNiLThkMDgtNDI2Yy04MmE4LTUxNWI5NTY0ZWVjOCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDE5NywiZXhwIjoxNzY1NDg0OTk3fQ.QXY19k2RV9F_pwBMvAaPBre5M-EEV3aMdn8PxuBZT20",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "2d8c1d3b-8d08-426c-82a8-515b9564eec8",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880197947,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880197947,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880197996,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880198090,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880200152,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: cf35d8c0-c96d-4ea7-860d-585d2d52d94f tenantId: 2d8c1d3b-8d08-426c-82a8-515b9564eec8 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 6b4d8cbe-ebbc-4c5b-be11-99938de52eeb tenantId: 2d8c1d3b-8d08-426c-82a8-515b9564eec8 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 59df038a-b14d-4b17-b699-22a0d58c627a tenantId: 2d8c1d3b-8d08-426c-82a8-515b9564eec8 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: eeb3c339-f2bc-4dd3-95fb-9db8c8b275e8 tenantId: 2d8c1d3b-8d08-426c-82a8-515b9564eec8 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 1488df42-14da-42ba-be99-19ac19a7bced tenantId: 2d8c1d3b-8d08-426c-82a8-515b9564eec8 userId: google-user-id

{"level":50,"time":1764880205011,"env":"test","error":{},"msg":"Error deleting row note"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 11055[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1215[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 863[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 943[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 882[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 647[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 312[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 186[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 599[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny access with expired token[39m[32m 97[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 210[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 217[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 213[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 231[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 10 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should deny access with expired token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/10]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m10 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:29:50
[2m   Duration [22m 16.72s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/steps.routes.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880218531,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880221953,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880225979,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880225980,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880225991,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880225991,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880225991,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880225991,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880226452,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880226453,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880226506,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880226602,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjdhOWU3Yjg3LWJjM2MtNDE5Zi05OTZiLTkxNDQwY2ViNDllNCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDIyNiwiZXhwIjoxNzY1NDg1MDI2fQ.aCLAHTcPYZlzXyMZ-XKRXQGps869iPyIaZTL6nVHH8o",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "7a9e7b87-bc3c-419f-996b-91440ceb49e4",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880226617,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880226617,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880226663,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880226753,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880227000,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880227252,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880227500,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880227645,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880227881,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880228031,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880228282,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880228511,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880228662,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880228999,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880229339,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880229527,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880229711,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880230033,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880230168,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880230631,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880230775,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880231134,"env":"test","error":{},"databaseId":"a29395e0-5f13-414c-8570-f03df462d27f","msg":"Error creating API token"}
{"level":50,"time":1764880231554,"env":"test","error":{},"databaseId":"7da0992c-192d-467d-a178-79f8c1ea757b","msg":"Error creating API token"}
{"level":40,"time":1764880231691,"env":"test","module":"auth-middleware","path":"/datavault/databases/661e3a0c-ca67-42bf-8c46-e7d1b381c53b/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880231933,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880232167,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880232385,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880232532,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880232767,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880232908,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880233141,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880233999,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880234251,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880234482,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880234626,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880234870,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8948[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 252[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 247[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 248[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 380[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 336[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 714[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 456[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 607[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 359[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 187[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 232[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 136[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 376[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 860[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 250[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 376[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 245[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:30:14
[2m   Duration [22m 19.58s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880256604,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880260062,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880263963,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880263964,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880263974,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880263974,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880263974,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880263974,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880264475,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880264475,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880264530,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880264641,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjJmM2I3MWFhLTdlZWYtNGQxNC1hMDA5LTY4OTM5OGRjOWU4ZSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDI2NCwiZXhwIjoxNzY1NDg1MDY0fQ.U-ZrJiE1n2hg3k5tGgKU_A-dnOVcSVqcrZ3wtqKzAOY",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "2f3b71aa-7eef-4d14-a009-689398dc9e8e",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880264657,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880264657,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880264700,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880264799,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880266970,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 92f6a5bd-f7e3-4234-a5db-19bc20782cd8 tenantId: 2f3b71aa-7eef-4d14-a009-689398dc9e8e userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 5470ef63-38c1-490b-b371-14f382ee3aef tenantId: 2f3b71aa-7eef-4d14-a009-689398dc9e8e userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 3b2b01a6-082f-4b03-b251-13e6b07dc3cf tenantId: 2f3b71aa-7eef-4d14-a009-689398dc9e8e userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 2f03b32d-e104-4d1d-8fc0-c9d7c2a36814 tenantId: 2f3b71aa-7eef-4d14-a009-689398dc9e8e userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 69a21ffa-6a5a-4961-b73c-320f5c481261 tenantId: 2f3b71aa-7eef-4d14-a009-689398dc9e8e userId: google-user-id

{"level":50,"time":1764880271861,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764880273148,"env":"test","module":"auth-middleware","path":"/datavault/databases/022c23ea-88fb-4914-ae2f-673a2758b736/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"b2e22ac2-9a95-49fc-a5e2-5c6fe1ccd21d","tableId":"bb49fabe-10e5-47de-9544-04eea67fd0c1","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:15.053Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"b2e22ac2-9a95-49fc-a5e2-5c6fe1ccd21d","tableId":"bb49fabe-10e5-47de-9544-04eea67fd0c1","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:15.053Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 11429[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1285[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 894[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 416[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 945[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 853[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 655[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 332[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 193[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 614[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 147[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 336[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 285[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 88[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 200[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:30:52
[2m   Duration [22m 22.44s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx26 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880281030,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880283421,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880286399,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880286400,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880286410,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880286410,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880286410,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880286411,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880286881,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880286881,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880286933,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880287036,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjllMGY0ZjkyLWZkZWUtNGY4Mi04YmFjLTQ1OGQ4ODgwNzI2ZSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDI4NywiZXhwIjoxNzY1NDg1MDg3fQ.gsr_2Iy5DvPVpJKrAy8OzINp_Z522ruZLzFoWLol1VE",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "9e0f4f92-fdee-4f82-8bac-458d8880726e",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880287051,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880287052,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880287094,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880287189,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880289302,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: dafe3151-c0a3-4159-852d-ea1394174abe tenantId: 9e0f4f92-fdee-4f82-8bac-458d8880726e userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 3a5c5d75-da64-4c20-9a7d-e205e3fa5899 tenantId: 9e0f4f92-fdee-4f82-8bac-458d8880726e userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 0dda5779-dae6-4ab0-8dd7-3fb4d92d759a tenantId: 9e0f4f92-fdee-4f82-8bac-458d8880726e userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 6d096db2-1679-4b4d-9cab-6296acc9c96e tenantId: 9e0f4f92-fdee-4f82-8bac-458d8880726e userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: eb8c02b0-8412-4cc9-a327-e936f4680c5d tenantId: 9e0f4f92-fdee-4f82-8bac-458d8880726e userId: google-user-id

{"level":50,"time":1764880294155,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764880295414,"env":"test","module":"auth-middleware","path":"/datavault/databases/c61664a6-74a0-4be5-aea4-72952c18c1b1/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"30e735eb-7651-452d-bd53-a85adb60a069","tableId":"e46b5e53-5eec-4e9a-942c-319efdfe18d3","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:37.310Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"30e735eb-7651-452d-bd53-a85adb60a069","tableId":"e46b5e53-5eec-4e9a-942c-319efdfe18d3","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:37.310Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"12ce0ed4-3853-4d23-8579-ffb4dd8d341e","tableId":"10fa0128-4233-47eb-9cb8-219a1697d16d","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:37.907Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"12ce0ed4-3853-4d23-8579-ffb4dd8d341e","tableId":"10fa0128-4233-47eb-9cb8-219a1697d16d","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:37.907Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"12ce0ed4-3853-4d23-8579-ffb4dd8d341e","tableId":"10fa0128-4233-47eb-9cb8-219a1697d16d","userId":"other-user-id","role":"write","createdAt":"2025-12-04T20:31:37.907Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"12ce0ed4-3853-4d23-8579-ffb4dd8d341e","tableId":"10fa0128-4233-47eb-9cb8-219a1697d16d","userId":"other-user-id","role":"write","createdAt":"2025-12-04T20:31:37.907Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'12ce0ed4-3853-4d23-8579-ffb4dd8d341e'[39m,
  tableId: [32m'10fa0128-4233-47eb-9cb8-219a1697d16d'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2025-12-04T20:31:37.907Z'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880296787,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":50,"time":1764880296876,"env":"test","userId":"google-user-id","path":"/api/datavault/permissions/undefined","msg":"User session missing tenantId - user may need to log out and log back in"}
{"level":50,"time":1764880296876,"env":"test","error":{},"msg":"Error revoking table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 11652[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 430[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1252[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 884[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 405[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 924[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 861[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 320[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 190[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 599[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 150[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 324[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 6 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

       [32mÎ“Â£Ã´[39m should list table permissions[32m 271[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 555[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 317[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 89[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 242[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 204[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m6 failed[39m[22m[2m | [22m[1m[32m17 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:31:15
[2m   Duration [22m 21.37s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx27 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764880302376,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880304307,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880307249,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880307250,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880307262,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880307262,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880307263,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880307263,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880307768,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880307769,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880307812,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880307901,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjIyYjlhZTM0LWVlOTgtNDNhZS05YjZhLTJjYjVhMDAwNGZkNyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDMwNywiZXhwIjoxNzY1NDg1MTA3fQ.BoJhCmsbxn8O-mbbI4YUiaLYOdeFoMNe0csDNho937M",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "22b9ae34-ee98-43ae-9b6a-2cb5a0004fd7",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880307917,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880307917,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880307965,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880308052,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880310081,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: d3991f40-3300-4724-8d69-4755de45c787 tenantId: 22b9ae34-ee98-43ae-9b6a-2cb5a0004fd7 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 794490e9-bb07-41e7-9750-65bf9c89ee94 tenantId: 22b9ae34-ee98-43ae-9b6a-2cb5a0004fd7 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 54adb6a8-4cf1-4aa4-8d2a-5a065a66db54 tenantId: 22b9ae34-ee98-43ae-9b6a-2cb5a0004fd7 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: b3cce11f-2a8b-4899-8456-657abb207a41 tenantId: 22b9ae34-ee98-43ae-9b6a-2cb5a0004fd7 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: f553baae-ed7c-4e68-bcde-8af9ea9d2f95 tenantId: 22b9ae34-ee98-43ae-9b6a-2cb5a0004fd7 userId: google-user-id

{"level":50,"time":1764880314671,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764880315892,"env":"test","module":"auth-middleware","path":"/datavault/databases/740eff26-278d-494c-9507-25839d9b42b4/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"655f8c3a-c46e-43c8-8a0d-d65ee77e7b68","tableId":"ec9f97db-5bd1-4d4e-8fa2-dea3f71be4cb","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:57.769Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"655f8c3a-c46e-43c8-8a0d-d65ee77e7b68","tableId":"ec9f97db-5bd1-4d4e-8fa2-dea3f71be4cb","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:57.769Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"244073fa-a3b7-44ab-836e-82ca3718b760","tableId":"ee89fbf2-ad47-4f53-a9fb-3ed2203b2f11","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:58.326Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"244073fa-a3b7-44ab-836e-82ca3718b760","tableId":"ee89fbf2-ad47-4f53-a9fb-3ed2203b2f11","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:58.326Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"244073fa-a3b7-44ab-836e-82ca3718b760","tableId":"ee89fbf2-ad47-4f53-a9fb-3ed2203b2f11","userId":"other-user-id","role":"write","createdAt":"2025-12-04T20:31:58.326Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"244073fa-a3b7-44ab-836e-82ca3718b760","tableId":"ee89fbf2-ad47-4f53-a9fb-3ed2203b2f11","userId":"other-user-id","role":"write","createdAt":"2025-12-04T20:31:58.326Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'244073fa-a3b7-44ab-836e-82ca3718b760'[39m,
  tableId: [32m'ee89fbf2-ad47-4f53-a9fb-3ed2203b2f11'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2025-12-04T20:31:58.326Z'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mupsert result: {"id":"b939e1e9-fbef-4db4-a28f-298f8c66366e","tableId":"3f7d1492-fea0-4552-9e88-630276ff5e2b","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:58.839Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"b939e1e9-fbef-4db4-a28f-298f8c66366e","tableId":"3f7d1492-fea0-4552-9e88-630276ff5e2b","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:31:58.839Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: b939e1e9-fbef-4db4-a28f-298f8c66366e

{"level":50,"time":1764880317824,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880318488,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880318617,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880318844,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 11776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 398[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 406[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1225[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 828[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 410[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 856[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 814[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 602[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create an API token[32m 289[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 184[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 614[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 133[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 302[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 264[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 503[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 595[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 268[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 87[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 230[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 481[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 223[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m20 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:31:38
[2m   Duration [22m 19.92s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx28 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880323952,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880326464,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880328499,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880328500,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880328512,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880328512,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880328512,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880328512,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880328948,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880328949,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880328998,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880329094,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImIzZjE4ZGMxLTViNGItNDc2Ny04NDU5LWE0Y2ZiOGY0MTlkZiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDMyOSwiZXhwIjoxNzY1NDg1MTI5fQ.kunv7qqEfIaMLIfx1ySini0Z_GFXcPvBqOnba5Ma3Aw",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "b3f18dc1-5b4b-4767-8459-a4cfb8f419df",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880329108,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880329108,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880329162,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880329264,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880331391,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

{"level":50,"time":1764880333960,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880334293,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880334489,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880334683,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880335013,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880335148,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880335598,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880335733,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880336106,"env":"test","error":{},"databaseId":"c4a49dd3-691d-4dd9-b26c-1135f3080467","msg":"Error creating API token"}
{"level":50,"time":1764880336522,"env":"test","error":{},"databaseId":"5dbfeaa9-5a85-4a50-90d1-83a3f719ad64","msg":"Error creating API token"}
{"level":40,"time":1764880336666,"env":"test","module":"auth-middleware","path":"/datavault/databases/e0cdf321-d08e-42f9-9ff7-1649303a93f4/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880336896,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880337127,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880337364,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880337507,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 10415[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 445[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 417[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1265[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 887[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 930[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 333[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 719[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 466[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 584[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 373[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 190[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 224[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 144[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 380[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 94[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 225[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 246[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 214[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 219[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 221[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 15 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/15]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/15]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m15 failed[39m[22m[2m | [22m[1m[32m8 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:31:59
[2m   Duration [22m 18.51s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx29 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880372409,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880375181,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880378973,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880378974,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880378984,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880378984,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880378985,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880378985,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880379403,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880379404,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880379456,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880379553,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjAyNWYzMzM2LWI0ZWQtNGQ0Yy04YTJkLWYzMWVmNjY1NzVjNSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDM3OSwiZXhwIjoxNzY1NDg1MTc5fQ.wZ3M4z42l7m4BOqVyh8fp2dfp0wox-JGDQp7vd0pGt8",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "025f3336-b4ed-4d4c-8a2d-f31ef66575c5",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880379570,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880379570,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880379611,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880379701,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880379921,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880380156,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880380378,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880380514,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880380719,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880380854,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880381066,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880381283,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880381433,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880381729,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880382022,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880382188,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880382362,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880382656,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880382778,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880383196,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880383332,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880383677,"env":"test","error":{},"databaseId":"73e04f8c-f13a-4791-9e72-0b4175ec886c","msg":"Error creating API token"}
{"level":50,"time":1764880384087,"env":"test","error":{},"databaseId":"ccf05b9b-a3b6-4cd5-979d-c7026216bf83","msg":"Error creating API token"}
{"level":40,"time":1764880384229,"env":"test","module":"auth-middleware","path":"/datavault/databases/57960951-01ff-40d7-8797-bec827971053/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880384459,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880384698,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880384934,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880385065,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880385290,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880385431,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880385650,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880386547,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880386829,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880387073,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880387226,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880387461,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8548[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 357[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 340[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 212[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[32m 294[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 634[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 415[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 554[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 345[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 188[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 222[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 141[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 230[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 365[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 219[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 898[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 281[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 398[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 234[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:32:47
[2m   Duration [22m 18.68s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx30 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764891574903,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764891579946,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764891582777,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764891582778,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764891582790,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764891582790,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764891582790,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764891582790,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764891583227,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764891583228,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764891583272,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764891583366,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImJkYTk5NzNmLTQyYjQtNDViNS1iMjc5LTM2ZGI1MmJhMmM0ZCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5MTU4MywiZXhwIjoxNzY1NDk2MzgzfQ.GvGRm3R1gnWRfOEtV32713m1l-Gk5eWXo9gNLO7XVKg",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "bda9973f-42b4-45b5-b279-36db52ba2c4d",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764891583382,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764891583382,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764891583426,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764891583515,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764891585485,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 0fb3281c-f42f-4dbe-aac8-c7dc44ac3ca3 tenantId: bda9973f-42b4-45b5-b279-36db52ba2c4d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 30ac376b-4b81-4b99-a547-ecf9b0bd7c82 tenantId: bda9973f-42b4-45b5-b279-36db52ba2c4d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 9d5da2d5-680f-4c52-966e-a518dfe6e998 tenantId: bda9973f-42b4-45b5-b279-36db52ba2c4d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: ccedead3-b47f-4add-93d8-3258f34e4ea0 tenantId: bda9973f-42b4-45b5-b279-36db52ba2c4d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 271ce323-87f0-46c6-b24b-fbc0f153f3db tenantId: bda9973f-42b4-45b5-b279-36db52ba2c4d userId: google-user-id

{"level":50,"time":1764891589922,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764891591058,"env":"test","module":"auth-middleware","path":"/datavault/databases/eeb7bedb-e254-4fc9-a8bd-92c6fd95cfb1/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"fc542e85-55ec-4932-9038-42c12df33f29","tableId":"01a64bcd-9582-4e16-bb04-7923acf37eb4","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:39:53.130Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"fc542e85-55ec-4932-9038-42c12df33f29","tableId":"01a64bcd-9582-4e16-bb04-7923acf37eb4","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:39:53.130Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"5d9d8714-2d13-4f26-8675-40acf1d96a0a","tableId":"fed5e86a-836f-424c-8a69-3eab4c78b41d","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:39:53.671Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"5d9d8714-2d13-4f26-8675-40acf1d96a0a","tableId":"fed5e86a-836f-424c-8a69-3eab4c78b41d","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:39:53.671Z"}

{"level":50,"time":1764891592036,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 10643[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 415[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 393[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1162[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 837[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 648[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 614[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create an API token[32m 296[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 173[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 525[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 140[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 305[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 252[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 428[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 85[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 198[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 216[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 218[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 243[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/7]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 17:39:28
[2m   Duration [22m 23.20s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/auth.ts [22m[34mx31 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764892165685,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892170525,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892174305,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892174305,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892174316,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892174316,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892174316,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892174316,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892174775,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892174776,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892174821,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892174909,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImZiYTFhMGU0LWY1NDAtNDc0Zi1hNzE4LTQ3YzAyMGNjNjc4NiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5MjE3NCwiZXhwIjoxNzY1NDk2OTc0fQ.VAaidGREUv6NaLgXJvB9iH_9OLKGnCXxw3vbNEyb6AI",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "fba1a0e4-f540-474f-a718-47c020cc6786",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764892174921,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892174922,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892174975,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892175066,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764892175300,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892175538,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892175782,"env":"test","error":{},"msg":"Error creating DataVault column"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892175930,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":50,"time":1764892176165,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892176303,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892176538,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892176771,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892176907,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892177221,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892177542,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892177718,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892177893,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764892178221,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892178370,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764892178848,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892179000,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764892179379,"env":"test","error":{},"databaseId":"e4c9d7ae-efa8-492f-b9f6-abadb328d979","msg":"Error creating API token"}
{"level":50,"time":1764892179810,"env":"test","error":{},"databaseId":"1b406327-3d33-4ae0-a06e-f519e8d120e0","msg":"Error creating API token"}
{"level":40,"time":1764892179967,"env":"test","module":"auth-middleware","path":"/datavault/databases/da271e14-21ca-4512-9d96-6dd4ce830549/tables","msg":"No valid authentication found"}
{"level":50,"time":1764892180214,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892180441,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764892180674,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892180822,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764892181064,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764892181211,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764892181451,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892182301,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764892182524,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892182732,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892182869,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892183085,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8840[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 240[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 312[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 674[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 476[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 630[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 378[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 213[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 219[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 156[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 246[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 381[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 390[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 850[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 347[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 215[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 17:49:20
[2m   Duration [22m 21.46s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx32 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764892480030,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892482805,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892486064,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892486065,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892486076,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892486076,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892486076,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892486076,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892486569,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892486569,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892486615,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892486703,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjlkYjg0N2M5LTNlZTctNDQ3YS04ZTc2LTM3YzY5NzJjZDk2MCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5MjQ4NiwiZXhwIjoxNzY1NDk3Mjg2fQ.4iFAPxaYiEkAwhTZuBT-auaJKEVBbyFkjOunxyoiNKo",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "9db847c9-3ee7-447a-8e76-37c6972cd960",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764892486718,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892486718,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892486759,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892486840,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764892487889,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892488024,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892488254,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892488395,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892488625,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892488862,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892488998,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892489321,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892489642,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892489813,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892489991,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764892490297,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892490428,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764892490894,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892491030,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764892491396,"env":"test","error":{},"databaseId":"71901582-20fe-4e29-9e7e-5a2b9790ab7a","msg":"Error creating API token"}
{"level":50,"time":1764892491830,"env":"test","error":{},"databaseId":"9882ba0c-597c-4588-aba6-4434c21b8d89","msg":"Error creating API token"}
{"level":40,"time":1764892491989,"env":"test","module":"auth-middleware","path":"/datavault/databases/d4278750-2804-437f-97fb-469672c3e854/tables","msg":"No valid authentication found"}
{"level":50,"time":1764892492241,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892492488,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764892492743,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892492897,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764892493141,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764892493297,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764892493529,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892494428,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764892494670,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892494911,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892495059,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892495297,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 9287[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 409[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 411[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 371[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 323[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 669[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 437[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 601[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 367[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 197[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 236[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 159[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 254[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 246[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 411[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 398[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 899[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 242[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 389[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 237[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 17 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/17]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m17 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 17:54:36
[2m   Duration [22m 18.29s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx33 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764892498339,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892501328,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892504036,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892504036,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892504050,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892504051,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892504051,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892504051,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892504535,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892504536,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892504590,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892504684,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImQyODc3NTQwLWI2MDEtNGE4ZC1iOTMwLTVjZGJhNDVlNTVhNCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5MjUwNCwiZXhwIjoxNzY1NDk3MzA0fQ.t96AsU5fhjEIO2ULHtHFbJ7q-3h-u7BcO24boscGX0U",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "d2877540-b601-4a8d-b930-5cdba45e55a4",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764892504699,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892504700,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892504742,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892504832,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764892505483,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892505713,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892505849,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892506099,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892506267,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892506502,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892506748,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892506876,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892507205,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892507528,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892507708,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892507891,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764892508224,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892508365,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764892508820,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764892508961,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764892509357,"env":"test","error":{},"databaseId":"450af1d5-54f7-4c4e-88ee-086dc546f61a","msg":"Error creating API token"}
{"level":50,"time":1764892509782,"env":"test","error":{},"databaseId":"379b609a-6290-4755-b15d-fb2074e95fdc","msg":"Error creating API token"}
{"level":40,"time":1764892509941,"env":"test","module":"auth-middleware","path":"/datavault/databases/9750d646-54ba-42d1-aa66-bc07762dc52e/tables","msg":"No valid authentication found"}
{"level":50,"time":1764892510184,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892510432,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764892510680,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892510823,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764892511072,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764892511223,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764892511473,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892512351,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764892512594,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892512897,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764892513037,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764892513527,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 9547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 423[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 361[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 419[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 373[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 329[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 687[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 472[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 596[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 395[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 190[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 234[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 159[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 247[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 392[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 400[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 248[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 879[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle network errors gracefully [33m 489[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 18 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/18]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m18 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 17:54:55
[2m   Duration [22m 17.72s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx34 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764895077419,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895083134,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895086302,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895086303,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895086312,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895086312,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895086312,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895086312,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895086774,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764895086774,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764895086821,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764895086929,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjM5NzYwZGQzLTljODktNGQwMi04NTczLTM5NjA5ZmJjNWM5YiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5NTA4NiwiZXhwIjoxNzY1NDk5ODg2fQ.HmjX-WTYdYCt76_f6C2iyDmzbBD8FhYNk8SJJ_-DEKk",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "39760dd3-9c89-4d02-8573-39609fbc5c9b",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764895086946,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764895086946,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764895086997,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764895087094,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764895089255,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 1c41a3ba-bb26-48b0-8265-8eca870e4f8b tenantId: 39760dd3-9c89-4d02-8573-39609fbc5c9b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 49ca6e58-3db6-4ccd-85a1-7f0b5342c97b tenantId: 39760dd3-9c89-4d02-8573-39609fbc5c9b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 0a4b7f58-c350-4af1-b209-ff4799e54c4e tenantId: 39760dd3-9c89-4d02-8573-39609fbc5c9b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: b6f582cf-36e6-4fe6-a7e9-27d26b085ce2 tenantId: 39760dd3-9c89-4d02-8573-39609fbc5c9b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 91c29065-2476-4f3b-85a8-b1ff413c942f tenantId: 39760dd3-9c89-4d02-8573-39609fbc5c9b userId: google-user-id

{"level":50,"time":1764895094071,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":50,"time":1764895095001,"env":"test","userId":"google-user-id","path":"/api/datavault/tokens/2d166688-ff5b-4a29-aeec-69db582cd32f","msg":"User session missing tenantId - user may need to log out and log back in"}
{"level":50,"time":1764895095001,"env":"test","error":{},"tokenId":"2d166688-ff5b-4a29-aeec-69db582cd32f","msg":"Error revoking API token"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 10935[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 439[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 875[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 420[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 924[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 838[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 649[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 328[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 187[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[33m 418[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny access with expired token[39m[32m 86[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 213[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 205[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 213[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 215[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 217[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 11 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:618:37
    616| 
    617|       // Revoke returns 200 with message
    618|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    619| 
    620|       // Verify token is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should deny access with expired token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/11]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m11 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 18:37:52
[2m   Duration [22m 23.54s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
