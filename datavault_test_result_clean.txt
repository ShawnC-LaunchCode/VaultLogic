npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764869610678,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764869611904,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764869612952,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764869612953,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764869612958,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764869612958,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764869612958,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764869612958,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764869613336,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764869613337,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764869613381,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764869613467,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjNiMTc1NTIzLWQwMWYtNDNjYS05OTdmLWE5NmVkNTU0MTg5ZCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg2OTYxMywiZXhwIjoxNzY1NDc0NDEzfQ._8anvKPq-nJngAHgpLVkCYQ-r2Ikplsl5omzOP8e8oY",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "3b175523-d01f-43ca-997f-a96ed554189d",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764869613478,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764869613478,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764869613516,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764869613601,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764869615444,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 7be6e95b-ad01-4765-b4ed-a664d873f737 tenantId: 3b175523-d01f-43ca-997f-a96ed554189d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 79fc486a-fc43-4676-9d9f-aa6c0280e728 tenantId: 3b175523-d01f-43ca-997f-a96ed554189d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 7a7454c5-ac8f-4879-8c21-ece9a36862bf tenantId: 3b175523-d01f-43ca-997f-a96ed554189d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: d20208c9-4cc1-464f-85aa-e9a31e83f6de tenantId: 3b175523-d01f-43ca-997f-a96ed554189d userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 8672c2ce-136d-4c96-90ed-63a8c8da1136 tenantId: 3b175523-d01f-43ca-997f-a96ed554189d userId: google-user-id

{"level":50,"time":1764869619708,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764869620841,"env":"test","module":"auth-middleware","path":"/datavault/databases/6bf07135-c118-45c1-af2c-41078c758794/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"54330981-2385-42ad-b8bf-82e9aee7393d","tableId":"99a4c502-64e5-42b1-b7f6-531eb3c4f42d","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:33:42.517Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"54330981-2385-42ad-b8bf-82e9aee7393d","tableId":"99a4c502-64e5-42b1-b7f6-531eb3c4f42d","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:33:42.517Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"d70b11f4-9aff-4b2a-914c-3d752d94a35f","tableId":"6d52abbc-87c3-491f-a70f-a47d3ea0b728","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:33:43.062Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"d70b11f4-9aff-4b2a-914c-3d752d94a35f","tableId":"6d52abbc-87c3-491f-a70f-a47d3ea0b728","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:33:43.062Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"d70b11f4-9aff-4b2a-914c-3d752d94a35f","tableId":"6d52abbc-87c3-491f-a70f-a47d3ea0b728","userId":"other-user-id","role":"write","createdAt":"2025-12-04T17:33:43.062Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"d70b11f4-9aff-4b2a-914c-3d752d94a35f","tableId":"6d52abbc-87c3-491f-a70f-a47d3ea0b728","userId":"other-user-id","role":"write","createdAt":"2025-12-04T17:33:43.062Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'd70b11f4-9aff-4b2a-914c-3d752d94a35f'[39m,
  tableId: [32m'6d52abbc-87c3-491f-a70f-a47d3ea0b728'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2025-12-04T17:33:43.062Z'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mupsert result: {"id":"edf58d6d-7344-4141-a3be-561dea19618a","tableId":"182a2450-ac48-4d47-996e-1e6cd934d22b","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:33:43.546Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"edf58d6d-7344-4141-a3be-561dea19618a","tableId":"182a2450-ac48-4d47-996e-1e6cd934d22b","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:33:43.546Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: edf58d6d-7344-4141-a3be-561dea19618a

{"level":50,"time":1764869622697,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764869623881,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
{"level":50,"time":1764869624519,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Required column 'Required Field' is missing

{"level":50,"time":1764869624717,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 11817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1090[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 815[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 687[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 325[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 160[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 522[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 125[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should grant table permission[32m 289[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 247[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 575[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 261[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should paginate rows efficiently [33m 984[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return user-friendly error for invalid column type[32m 199[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return user-friendly error for missing required fields [33m 639[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 197[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row History
Error: No test found in suite Row History
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m23 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 11:33:28
[2m   Duration [22m 16.55s[2m (transform 1.81s, setup 795ms, collect 3.35s, tests 11.82s, environment 0ms, prepare 16ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/datavault-v4-regression.test.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764869744561,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764869745670,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764869746868,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764869746869,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764869746876,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764869746877,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764869746877,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764869746877,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764869747281,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764869747282,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764869747326,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764869747418,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjAwOTk3ODViLTAyODctNGExNy1hYmZjLTEzZDY3ZTg5NDczOSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg2OTc0NywiZXhwIjoxNzY1NDc0NTQ3fQ.rNRdZqoXc-L8fqLUfcTY1-GfZGs9VeZW9Ued0K7vmzg",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "0099785b-0287-4a17-abfc-13d67e894739",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764869747427,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764869747427,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764869747472,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764869747556,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764869749431,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 84d1db8d-d3d8-4c91-9e97-cb62047037b8 tenantId: 0099785b-0287-4a17-abfc-13d67e894739 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: e8f95a9e-5470-4299-87b1-19cb4d0dd7bb tenantId: 0099785b-0287-4a17-abfc-13d67e894739 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: ad810197-691f-4354-994e-1c8c982699b7 tenantId: 0099785b-0287-4a17-abfc-13d67e894739 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 91829771-a77d-48b8-8475-3ecb1f79c5c2 tenantId: 0099785b-0287-4a17-abfc-13d67e894739 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 3b8096fe-dde9-4db8-80df-0f7d4066103a tenantId: 0099785b-0287-4a17-abfc-13d67e894739 userId: google-user-id

{"level":50,"time":1764869753747,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764869754912,"env":"test","module":"auth-middleware","path":"/datavault/databases/11e87fdd-fee2-407a-b0ea-7baf21e68c47/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"f0ba605a-3080-4316-9c70-711749b65029","tableId":"62c6f650-7337-4b7d-8b9d-6e9e8b3e7b5e","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:35:56.595Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"f0ba605a-3080-4316-9c70-711749b65029","tableId":"62c6f650-7337-4b7d-8b9d-6e9e8b3e7b5e","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:35:56.595Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"5fe6f7fa-ae69-4e95-94e8-ccdc8c9d3ead","tableId":"6676e198-753f-4df6-ac3d-33d797447daa","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:35:57.166Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"5fe6f7fa-ae69-4e95-94e8-ccdc8c9d3ead","tableId":"6676e198-753f-4df6-ac3d-33d797447daa","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:35:57.166Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"5fe6f7fa-ae69-4e95-94e8-ccdc8c9d3ead","tableId":"6676e198-753f-4df6-ac3d-33d797447daa","userId":"other-user-id","role":"write","createdAt":"2025-12-04T17:35:57.166Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"5fe6f7fa-ae69-4e95-94e8-ccdc8c9d3ead","tableId":"6676e198-753f-4df6-ac3d-33d797447daa","userId":"other-user-id","role":"write","createdAt":"2025-12-04T17:35:57.166Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'5fe6f7fa-ae69-4e95-94e8-ccdc8c9d3ead'[39m,
  tableId: [32m'6676e198-753f-4df6-ac3d-33d797447daa'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2025-12-04T17:35:57.166Z'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mupsert result: {"id":"7318c4c7-cb21-4646-8040-da9a70b87a12","tableId":"2961ecc2-a69c-4209-bd34-90ec3a34e1b8","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:35:57.645Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"7318c4c7-cb21-4646-8040-da9a70b87a12","tableId":"2961ecc2-a69c-4209-bd34-90ec3a34e1b8","userId":"other-user-id","role":"read","createdAt":"2025-12-04T17:35:57.645Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: 7318c4c7-cb21-4646-8040-da9a70b87a12

{"level":50,"time":1764869756777,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764869758039,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
{"level":50,"time":1764869758722,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Required column 'Required Field' is missing

{"level":50,"time":1764869758945,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 12127[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1112[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 795[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 839[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 651[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 555[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 523[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should paginate rows efficiently [33m 1041[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return user-friendly error for missing required fields [33m 683[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m23 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 11:35:42
[2m   Duration [22m 15.91s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764871632717,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871637270,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871641735,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871641735,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871641767,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871641767,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871641768,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871641768,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871642226,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871642227,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871642288,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871642384,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjY3MWFlM2EwLTk0YjktNDgzNC05NDczLTkwNGI0MDM5MmM1OCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3MTY0MiwiZXhwIjoxNzY1NDc2NDQyfQ.ZQEuIvibzkjVMT2644VoppEG-_jSObG2_AWT5ng-9Hc",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "671ae3a0-94b9-4834-9473-904b40392c58",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764871642398,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871642398,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871642443,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871642532,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764871644557,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 2bb6f6cf-c661-45e5-8a38-2cec61ee6922 tenantId: 671ae3a0-94b9-4834-9473-904b40392c58 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 82925bab-6af4-4fc4-ac1a-7a82562abe28 tenantId: 671ae3a0-94b9-4834-9473-904b40392c58 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 38458883-ac21-4173-a7a1-1a89591fbca5 tenantId: 671ae3a0-94b9-4834-9473-904b40392c58 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: d8022507-58c2-438c-a129-643dd6d7d61f tenantId: 671ae3a0-94b9-4834-9473-904b40392c58 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: dea036ee-ae1f-474e-82b8-721ea5242892 tenantId: 671ae3a0-94b9-4834-9473-904b40392c58 userId: google-user-id

{"level":50,"time":1764871649101,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764871650346,"env":"test","module":"auth-middleware","path":"/datavault/databases/c920f800-7ed8-496d-8510-9a8353f7c650/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"38192050-ed37-4603-980e-49e4164db3d5","tableId":"9e67fb93-51c7-4e87-8322-a464caec1ed3","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:07:32.075Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"38192050-ed37-4603-980e-49e4164db3d5","tableId":"9e67fb93-51c7-4e87-8322-a464caec1ed3","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:07:32.075Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"6a4b7431-b118-4107-9ac5-f7f9812b63d6","tableId":"3d7b7dee-e05a-44eb-8dab-0275ddb939cd","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:07:32.644Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"6a4b7431-b118-4107-9ac5-f7f9812b63d6","tableId":"3d7b7dee-e05a-44eb-8dab-0275ddb939cd","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:07:32.644Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"6a4b7431-b118-4107-9ac5-f7f9812b63d6","tableId":"3d7b7dee-e05a-44eb-8dab-0275ddb939cd","userId":"other-user-id","role":"write","createdAt":"2025-12-04T18:07:32.644Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"6a4b7431-b118-4107-9ac5-f7f9812b63d6","tableId":"3d7b7dee-e05a-44eb-8dab-0275ddb939cd","userId":"other-user-id","role":"write","createdAt":"2025-12-04T18:07:32.644Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'6a4b7431-b118-4107-9ac5-f7f9812b63d6'[39m,
  tableId: [32m'3d7b7dee-e05a-44eb-8dab-0275ddb939cd'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2025-12-04T18:07:32.644Z'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 11143[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 395[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1194[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 835[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 398[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 897[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 683[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 618[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 338[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 187[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 574[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 146[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 308[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 252[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 525[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 122[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 212[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 217[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 6 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m6 failed[39m[22m[2m | [22m[1m[32m17 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 23.23s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764871702107,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871705773,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871709713,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871709714,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871709727,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871709727,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871709727,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871709727,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710190,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871710191,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871710243,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871710344,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImZkN2UyNDAxLTZlYTItNDEzZi04NjA4LTEwYzYwMzFlMTJhNiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3MTcxMCwiZXhwIjoxNzY1NDc2NTEwfQ.6uUBpqcsB65EzhGDfILiQDKQs8O6VkayIImH7ClVjBI",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "fd7e2401-6ea2-413f-8608-10c6031e12a6",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764871710363,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871710363,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871710411,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871710509,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764871712647,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: a169b845-2e98-4304-b10f-b6abd12a1492 tenantId: fd7e2401-6ea2-413f-8608-10c6031e12a6 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: b9a511a3-bf35-48db-87ef-7aff2e6b471c tenantId: fd7e2401-6ea2-413f-8608-10c6031e12a6 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 33697652-9273-4879-904c-94931c30a4f9 tenantId: fd7e2401-6ea2-413f-8608-10c6031e12a6 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 0c9e50bd-d0f9-42e5-9c2c-3fd66edc54aa tenantId: fd7e2401-6ea2-413f-8608-10c6031e12a6 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 4ca642b6-a186-49b1-b446-92f74e51c66e tenantId: fd7e2401-6ea2-413f-8608-10c6031e12a6 userId: google-user-id

{"level":50,"time":1764871717521,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764871718936,"env":"test","module":"auth-middleware","path":"/datavault/databases/46e5bf5c-532d-422b-87b5-cb079be8f910/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"b0082cf0-f04c-43c3-9b85-88bce00d1a09","tableId":"4e431bf8-9730-4799-8477-fdb19823d465","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:08:40.695Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"b0082cf0-f04c-43c3-9b85-88bce00d1a09","tableId":"4e431bf8-9730-4799-8477-fdb19823d465","userId":"other-user-id","role":"read","createdAt":"2025-12-04T18:08:40.695Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 11468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1271[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 866[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 409[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 921[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 844[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 359[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 197[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 706[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 153[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 331[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 295[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 89[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 208[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 216[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 217[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 239[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 22.47s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764871753828,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871757003,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871760075,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871760076,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871760086,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871760086,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871760087,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871760087,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871760550,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871760551,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871760602,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871760695,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImNlZDI4Mzc1LTU0ODUtNDc4NC05ZTQyLWU1Y2JmMGNlMWIyYiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3MTc2MCwiZXhwIjoxNzY1NDc2NTYwfQ.iBgiTH_2zWzlfyFxR8HjcIJNvdR-XUDDM6G3pRFPua0",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "ced28375-5485-4784-9e42-e5cbf0ce1b2b",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764871760711,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764871760712,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764871760764,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764871760860,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764871761105,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871761358,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871761600,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871761746,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871761986,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871762138,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871762405,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871762643,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871762783,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871763109,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871763430,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871763614,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871763804,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764871764140,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871764286,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764871764763,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764871764907,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764871765267,"env":"test","error":{},"databaseId":"d9621c36-5d10-4c2f-8897-579adb83c05d","msg":"Error creating API token"}
{"level":50,"time":1764871765677,"env":"test","error":{},"databaseId":"0c1135c1-d3d3-46a8-a75e-e90bac529d53","msg":"Error creating API token"}
{"level":40,"time":1764871765826,"env":"test","module":"auth-middleware","path":"/datavault/databases/a7bcc8b9-2c37-4fde-9706-7f40ac5bfa0e/tables","msg":"No valid authentication found"}
{"level":50,"time":1764871766057,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871766286,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764871766503,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871766635,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764871766863,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764871766998,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764871767234,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764871768085,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764871768320,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871768561,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764871768699,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764871768940,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8923[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 251[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 249[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 387[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 264[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 327[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 696[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 481[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 621[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 360[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 185[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 225[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 148[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 349[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 363[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 851[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 380[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 240[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 19.52s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764873689159,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873691813,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873696727,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873696728,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873696739,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873696740,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873696740,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873696740,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873697729,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764873697730,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764873697773,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764873697871,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjdiMzIzNmQyLTdiYWYtNGNkZS1iZTJkLWI2NmNjODk2NTA1YyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3MzY5NywiZXhwIjoxNzY1NDc4NDk3fQ.ePn_M_AbIliNUE-j9kdIPNi5-XCvV_LyHw4X6nIoJTk",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "7b3236d2-7baf-4cde-be2d-b66cc896505c",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764873697888,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764873697888,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764873697931,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764873698024,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764873698728,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873698960,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873699098,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764873699340,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873699480,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764873699715,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873699950,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873700093,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764873700429,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873700766,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873700947,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873701126,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764873701449,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873701591,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764873702063,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764873702205,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764873702547,"env":"test","error":{},"databaseId":"e4d87a42-1b5e-4ea5-8213-e81eb4dce65a","msg":"Error creating API token"}
{"level":50,"time":1764873702929,"env":"test","error":{},"databaseId":"73f23971-d476-4b98-b0a6-d2fe82b91d99","msg":"Error creating API token"}
{"level":40,"time":1764873703071,"env":"test","module":"auth-middleware","path":"/datavault/databases/230da256-ad29-4e93-b60d-c5ca6c7c936b/tables","msg":"No valid authentication found"}
{"level":50,"time":1764873703309,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764873703541,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764873703760,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764873703895,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764873704134,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764873704290,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764873704555,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764873705406,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764873705646,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873705884,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764873706039,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764873706296,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 9630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 468[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 383[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 376[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 336[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 696[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 465[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 615[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 340[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 171[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 212[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 144[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 355[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 394[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 267[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 853[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 393[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 257[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 18 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/18]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m18 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 20.70s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts [ tests/integration/datavault-v4-regression.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/datavault-v4-regression.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764874579149,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874584922,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874591338,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874591338,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874591357,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874591357,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874591358,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874591358,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874592068,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764874592069,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764874592157,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764874592248,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjY4MmU4MGYyLWE2NzktNDI1ZC1iMGUzLWEzNTY4MTgxOGFmMCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NDU5MiwiZXhwIjoxNzY1NDc5MzkyfQ.8OgZd9QcwJ_nCHbneVGy3sDIM9SF-FpKc2di5z6czbU",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "682e80f2-a679-425d-b0e3-a35681818af0",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764874592267,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764874592269,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764874592316,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764874592399,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764874592650,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874592907,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874593132,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874593267,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764874593493,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874593627,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764874593856,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874594097,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874594237,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764874594568,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874594888,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874595062,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874595237,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764874595544,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874595679,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764874596142,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874596281,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764874596653,"env":"test","error":{},"databaseId":"86343915-b1cb-45d9-9ce4-4bbec68f261d","msg":"Error creating API token"}
{"level":50,"time":1764874597047,"env":"test","error":{},"databaseId":"f13163e8-405d-4ef2-b8d5-2abdec7b7103","msg":"Error creating API token"}
{"level":40,"time":1764874597194,"env":"test","module":"auth-middleware","path":"/datavault/databases/efb0e5ab-30b1-44ed-b811-3c3b16f63e2c/tables","msg":"No valid authentication found"}
{"level":50,"time":1764874597480,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764874597707,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764874597938,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764874598076,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764874598304,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764874598431,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764874598652,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764874599517,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764874599761,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874600013,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874600161,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764874600389,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 9112[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 258[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 251[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 359[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 361[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 381[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 329[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 669[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 441[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 603[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 372[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 175[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 218[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 146[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 286[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 355[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 220[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 866[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 400[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 228[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 25.38s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764874685159,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874690115,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874696686,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874696686,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874696751,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874696751,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874696751,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874696751,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874697320,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764874697321,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764874697366,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764874697462,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1764874697480,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764874697480,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImYyMmJjMDk2LTY5NjEtNDNjYS1iM2I5LTVlZjc2ZDdhZDIzNyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NDY5NywiZXhwIjoxNzY1NDc5NDk3fQ.MIGfO5SQfDUTxuqZZrTbBfhNbL1NOT1o239r54Nn-vY",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "f22bc096-6961-43ca-b3b9-5ef76d7ad237",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764874697582,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764874697677,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764874698317,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874698544,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874698687,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764874698905,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874699048,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764874699269,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874699500,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874699636,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764874699951,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874700249,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874700432,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874700607,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764874700900,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874701032,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764874701473,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764874701607,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764874701990,"env":"test","error":{},"databaseId":"fcbceb06-c491-4726-b9a3-d829812c2374","msg":"Error creating API token"}
{"level":50,"time":1764874702476,"env":"test","error":{},"databaseId":"e02193b6-f4f5-4fe4-9651-43f6a2555f05","msg":"Error creating API token"}
{"level":40,"time":1764874702617,"env":"test","module":"auth-middleware","path":"/datavault/databases/cdb8b403-4f2a-495e-89b6-d0c632d5c68a/tables","msg":"No valid authentication found"}
{"level":50,"time":1764874702855,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764874703080,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764874703310,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764874703449,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764874703686,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764874703838,"env":"test","error":{},"msg":"Error revoking table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764874704078,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":50,"time":1764874704931,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764874705151,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874705365,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764874705507,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764874705720,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 9095[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 417[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 366[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 360[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 313[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 657[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 424[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 577[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 382[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 194[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 292[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 140[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 371[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 388[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 855[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 218[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 356[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 213[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 18 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/18]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m18 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 25.10s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764876566402,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876570121,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876574209,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876574210,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876574220,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876574220,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876574221,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876574221,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876574779,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764876574780,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764876574827,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764876574931,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjU4NmJhYjJlLTg5M2ItNDkwZi04ZTg5LWJjNGFlYWVlYTMzOCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NjU3NCwiZXhwIjoxNzY1NDgxMzc0fQ.hVh6Sj7J2GpstT9ESNucrLkNMyaRIvGUhCWgwey947Q",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "586bab2e-893b-490f-8e89-bc4aeaeea338",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764876574948,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764876574949,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764876575002,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764876575101,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764876575340,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876575594,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876575830,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876575975,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876576233,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876576372,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876576612,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876576867,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876577017,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876577349,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876577676,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876577862,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876578050,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764876578378,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876578517,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764876578952,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876579083,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764876579441,"env":"test","error":{},"databaseId":"e22bda1a-de9c-469b-869c-b6cf8419ed85","msg":"Error creating API token"}
{"level":50,"time":1764876579846,"env":"test","error":{},"databaseId":"f0b8140b-2166-4451-918b-b05cfe862887","msg":"Error creating API token"}
{"level":40,"time":1764876579996,"env":"test","module":"auth-middleware","path":"/datavault/databases/bb72c1a9-9404-4648-8c2e-bc6def86b72c/tables","msg":"No valid authentication found"}
{"level":50,"time":1764876580222,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876580458,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764876580686,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876580816,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764876581050,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764876581186,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764876581420,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876582239,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764876582467,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876582699,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876582841,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876583069,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8920[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 246[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 247[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 382[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 396[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 240[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 405[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 331[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 702[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 467[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 564[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 359[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 180[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 225[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 149[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 359[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 369[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 819[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 374[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 228[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:29:20
[2m   Duration [22m 21.69s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764876645869,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876648565,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876652714,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876652715,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876652765,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876652766,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876652767,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876652767,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876653241,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764876653263,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764876653323,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764876653436,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjAxMGM0ODgxLTY2ZWQtNDBlNC05MTk2LWEwOTg4MjRjMjc5YiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NjY1MywiZXhwIjoxNzY1NDgxNDUzfQ.Oq_BlO1z6YrQfegbtH_HVwqpyJUZKdK8w3RSUJ_Ik5o",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "010c4881-66ed-40e4-9196-a098824c279b",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764876653452,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764876653452,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764876653499,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764876653593,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764876653840,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876654102,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876654352,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876654514,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876654754,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876654894,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876655142,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876655385,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876655525,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876655854,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876656185,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876656371,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876656562,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764876656885,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876657039,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764876657493,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764876657624,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764876657982,"env":"test","error":{},"databaseId":"a63378fb-28e8-4ed6-9858-8968291c1054","msg":"Error creating API token"}
{"level":50,"time":1764876658408,"env":"test","error":{},"databaseId":"7e8c6673-4975-42c6-8310-bedf8658fc88","msg":"Error creating API token"}
{"level":40,"time":1764876658548,"env":"test","module":"auth-middleware","path":"/datavault/databases/42fea59e-b36d-42ba-b484-0ddb59af4800/tables","msg":"No valid authentication found"}
{"level":50,"time":1764876658769,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876659006,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764876659236,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876659375,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764876659601,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764876659750,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764876659978,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764876660824,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764876661046,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876661262,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764876661394,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764876661619,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8955[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 254[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 255[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 411[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 381[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 247[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 383[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 329[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 707[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 477[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 586[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 358[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 185[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 240[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 139[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 375[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 846[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 348[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 225[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:30:40
[2m   Duration [22m 19.80s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764877228025,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877231517,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877235582,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877235584,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877235596,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877235596,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877235597,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877235597,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877236161,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877236165,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877236242,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877236338,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjYzMzg5MzNjLWRjYmUtNDU0Yy1hZTNiLTMwNmM5OGIxYjI4ZiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NzIzNiwiZXhwIjoxNzY1NDgyMDM2fQ.0ZYcBqwR-kbkQtIUZeXpvguGGu3q_2au7QCNNG0EmW8",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "6338933c-dcbe-454c-ae3b-306c98b1b28f",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877236352,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877236353,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877236397,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877236494,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877236734,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877236973,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877237200,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877237342,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877237573,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877237715,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877237961,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877238198,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877238333,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877238655,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877238973,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877239159,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877239337,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764877239660,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877239807,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877240284,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877240424,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877240803,"env":"test","error":{},"databaseId":"a003c581-8684-4ad4-9a91-fdf146b032c8","msg":"Error creating API token"}
{"level":50,"time":1764877241228,"env":"test","error":{},"databaseId":"197535bf-dac1-4b3a-9d8a-176233e99af6","msg":"Error creating API token"}
{"level":40,"time":1764877241372,"env":"test","module":"auth-middleware","path":"/datavault/databases/ebf5221e-668f-47c1-aa16-137501a53036/tables","msg":"No valid authentication found"}
{"level":50,"time":1764877241601,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877241825,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764877242058,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877242195,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764877242420,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764877242554,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764877242787,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877243621,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764877243848,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877244081,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877244222,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877244446,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8928[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 246[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 373[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 371[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 320[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 683[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 470[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 616[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 379[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 188[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 236[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 144[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 230[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 359[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 835[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 374[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 224[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:40:22
[2m   Duration [22m 21.03s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/googleAuth.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764877488842,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877492115,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877496941,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877496942,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877496954,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877496954,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877496955,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877496955,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877497543,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877497544,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877497587,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877497677,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImJkZTA5ODZhLTIzOTEtNDU5Zi1iYmI5LTkyODIyMDMwZjBkNCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NzQ5NywiZXhwIjoxNzY1NDgyMjk3fQ.OV-cULxeWn6aXkw0MiPC5rE7UygJydvs6ussmvRuf0Y",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "bde0986a-2391-459f-bbb9-92822030f0d4",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877497693,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877497693,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877497740,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877497829,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877498064,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877498312,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877498548,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877498690,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877499001,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877499223,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877499465,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877499708,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877499844,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877500174,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877500503,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877500697,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877500879,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764877501193,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877501330,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877501800,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877501931,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877502280,"env":"test","error":{},"databaseId":"4b5946f2-23b9-4693-9bdd-eacdf69c9055","msg":"Error creating API token"}
{"level":50,"time":1764877502683,"env":"test","error":{},"databaseId":"18900d80-2076-40cc-8685-e5cfb38b62a0","msg":"Error creating API token"}
{"level":40,"time":1764877502820,"env":"test","module":"auth-middleware","path":"/datavault/databases/80fb6e6a-d6e2-41c8-b934-068c822905b5/tables","msg":"No valid authentication found"}
{"level":50,"time":1764877503033,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877503250,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764877503477,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877503605,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764877503821,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764877503950,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764877504166,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877505007,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764877505244,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877505472,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877505608,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877505837,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8957[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 244[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 240[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 533[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 242[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 329[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 704[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 451[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 601[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 349[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 185[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 218[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 136[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 214[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 216[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 356[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 345[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 216[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 841[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 364[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 228[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:44:44
[2m   Duration [22m 20.53s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764877821918,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877825167,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877828973,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877828974,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877828984,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877828985,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877828985,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877828985,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877829495,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877829496,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877829540,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877829639,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjhlYmNiZGMyLWJlY2YtNDU4Ny04YzkwLTI4ZThhMTkwMTg2MSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3NzgyOSwiZXhwIjoxNzY1NDgyNjI5fQ.dtu_vxXoH8oYFSIfO1PTUByya17X06IhR4FF-6UWhs4",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "8ebcbdc2-becf-4587-8c90-28e8a1901861",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877829655,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877829655,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877829703,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877829795,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877830791,"env":"test","error":{},"msg":"Error creating DataVault column"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877830926,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":50,"time":1764877831163,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877831295,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877831525,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877831747,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877831883,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877832172,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877832469,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877832640,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877832811,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764877833110,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877833239,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877833686,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877833830,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877834215,"env":"test","error":{},"databaseId":"91f4dc8b-c61b-45a1-b66e-38f92fbfbd18","msg":"Error creating API token"}
{"level":50,"time":1764877834634,"env":"test","error":{},"databaseId":"38532753-c6ea-4e56-940b-7d6e56ae6d72","msg":"Error creating API token"}
{"level":40,"time":1764877834786,"env":"test","module":"auth-middleware","path":"/datavault/databases/6e0d713d-ded3-4197-b32e-700c09fed676/tables","msg":"No valid authentication found"}
{"level":50,"time":1764877835030,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877835275,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764877835519,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877835665,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764877835908,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764877836053,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764877836282,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877837157,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764877837389,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877837622,"env":"test","error":{},"msg":"Error creating DataVault column"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877837762,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":50,"time":1764877838001,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 9086[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 401[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 382[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 353[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 359[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[32m 287[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 639[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 427[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 591[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 385[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 182[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 236[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 152[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 390[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 388[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 230[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 876[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 373[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 239[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 17 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/17]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m17 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:50:18
[2m   Duration [22m 19.34s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764877841935,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877845009,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877848592,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877848593,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877848604,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877848605,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877848606,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877848606,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877849109,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877849110,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877849160,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877849260,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjUxYzk1ZWY0LWVmNjEtNGM0Zi05Y2NjLTBhYmM4ZTIzMGJmMiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3Nzg0OSwiZXhwIjoxNzY1NDgyNjQ5fQ.gOb3EK7U2dqoVa-OalAb1SCEhICLoNXcxD2ZB1Mez6I",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "51c95ef4-ef61-4c4f-9ccc-0abc8e230bf2",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877849278,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877849278,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877849328,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877849416,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877850073,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877850306,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877850443,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877850680,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877850827,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877851076,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877851321,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877851470,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877851794,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877852126,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877852323,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877852508,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764877852845,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877852986,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877853453,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764877853593,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764877853994,"env":"test","error":{},"databaseId":"092f33b5-8293-4c6f-8752-af97346c9b9f","msg":"Error creating API token"}
{"level":50,"time":1764877854419,"env":"test","error":{},"databaseId":"4080949b-7603-4b11-963c-e8ec2c2cbec3","msg":"Error creating API token"}
{"level":40,"time":1764877854577,"env":"test","module":"auth-middleware","path":"/datavault/databases/208228ce-7fea-462f-b319-817032928cf2/tables","msg":"No valid authentication found"}
{"level":50,"time":1764877854811,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877855041,"env":"test","error":{},"msg":"Error fetching table permissions"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877855279,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":50,"time":1764877855417,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764877855644,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764877855784,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764877856022,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877856846,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764877857069,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877857301,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877857441,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877857664,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 9143[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 416[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 247[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 385[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 249[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 323[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 714[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 479[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 607[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 400[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 191[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 236[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 155[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 366[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 824[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 371[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 222[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 18 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m18 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:50:38
[2m   Duration [22m 18.70s

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/18]Î“Ã„Â»

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764877859482,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877860720,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877863638,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877863639,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877863657,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877863657,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877863658,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877863658,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877864166,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877864167,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877864218,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877864306,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImNmZDM2OWY4LTE3MjEtNDA4NC04ODcyLWU4OGRhOTI0Nzg2YiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3Nzg2NCwiZXhwIjoxNzY1NDgyNjY0fQ.CrBcU6j21dODjDRqJmGM47V9udw-q_wbbl52I1Ja7dQ",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "cfd369f8-1721-4084-8872-e88da924786b",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877864325,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877864326,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877864369,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877864455,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877866395,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: f6db0798-132c-414c-99f3-79812c10efbc tenantId: cfd369f8-1721-4084-8872-e88da924786b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: e486cbc7-bf60-451a-a460-c3b975f8e3c9 tenantId: cfd369f8-1721-4084-8872-e88da924786b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: c2024936-afd0-4cbd-8f54-b625f35cbf31 tenantId: cfd369f8-1721-4084-8872-e88da924786b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 504b5df7-2c7a-43ec-bd66-9d68c61eba3f tenantId: cfd369f8-1721-4084-8872-e88da924786b userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: cba07c55-b3ea-4448-a27c-59a84e660f8f tenantId: cfd369f8-1721-4084-8872-e88da924786b userId: google-user-id

{"level":50,"time":1764877870913,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764877872100,"env":"test","module":"auth-middleware","path":"/datavault/databases/e68c3282-ee94-47e7-90c5-4aa5dd33d552/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877872320,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":50,"time":1764877872560,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764877872783,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877872913,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764877873124,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764877873263,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764877873480,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877874343,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764877874587,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877874813,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877874962,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877875202,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 11616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 395[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 400[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1143[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 390[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 842[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 828[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 605[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create an API token[32m 296[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 180[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 559[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 152[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 351[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 348[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 217[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 864[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 244[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 376[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 237[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/7]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:50:57
[2m   Duration [22m 17.13s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764877876625,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877877571,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877878655,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877878656,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877878664,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877878664,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877878664,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877878664,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877879069,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877879070,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877879116,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877879207,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjE1OWY0Y2MxLWE3NDgtNDNkMC1hYTI2LWZkYmQwN2M2M2NiNyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg3Nzg3OSwiZXhwIjoxNzY1NDgyNjc5fQ._25j2-R2-N53Wrsg2-5zHW7iU8_d3z7qpknFrHTwJ64",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "159f4cc1-a748-43d0-aa26-fdbd07c63cb7",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764877879219,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764877879220,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764877879262,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764877879350,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764877881423,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

{"level":50,"time":1764877885405,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764877885559,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764877885794,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764877886627,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764877886853,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877887081,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764877887215,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764877887444,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 8836[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 428[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 419[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1226[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 842[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 87[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[32m 221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[32m 224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[32m 210[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate API token scopes[39m[32m 224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny access with expired token[39m[32m 206[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 514[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 834[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 361[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 229[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 17 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should validate API token scopes
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should deny access with expired token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/17]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m17 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 13:51:15
[2m   Duration [22m 11.93s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764879993998,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764879999553,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880002234,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880002234,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880002243,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880002244,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880002244,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880002244,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880002660,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880002661,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880002704,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880002795,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImMzOGE3NzI2LWViYzEtNDE5OS04YTk4LTVhMjg2MzJkZTU4YyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDAwMiwiZXhwIjoxNzY1NDg0ODAyfQ.rgbHs3Iiansq9HuUGpCCEp0d0FWB3cQGItcsWULERq8",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "c38a7726-ebc1-4199-8a98-5a28632de58c",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880002809,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880002809,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880002857,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880002935,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880005008,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: e02a579f-b9d6-4a2f-ba08-ac2488f1c963 tenantId: c38a7726-ebc1-4199-8a98-5a28632de58c userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 806fb5ee-5d97-4edf-a3a6-55d5c331a4da tenantId: c38a7726-ebc1-4199-8a98-5a28632de58c userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 489808b3-86b5-4d21-94c8-6d5ca93f8feb tenantId: c38a7726-ebc1-4199-8a98-5a28632de58c userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: e02b2ab3-3ca8-4538-9cfd-9ebe13bfe4c6 tenantId: c38a7726-ebc1-4199-8a98-5a28632de58c userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 93e79219-3e09-46a3-9377-ea891e894934 tenantId: c38a7726-ebc1-4199-8a98-5a28632de58c userId: google-user-id

{"level":50,"time":1764880009792,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764880010999,"env":"test","module":"auth-middleware","path":"/datavault/databases/a6aa4565-a367-4721-9de8-253817dadfe2/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"3b3d0b56-8b6a-43dc-b6bc-b17e9b9f578b","tableId":"639c2e6b-1d74-46d0-9751-86f0bfea922f","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:26:52.882Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"3b3d0b56-8b6a-43dc-b6bc-b17e9b9f578b","tableId":"639c2e6b-1d74-46d0-9751-86f0bfea922f","userId":"other-user-id","role":"read","createdAt":"2025-12-04T20:26:52.882Z"}

{"level":50,"time":1764880011526,"env":"test","error":{},"msg":"Error fetching table permissions"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 10970[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 424[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 408[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1243[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 886[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 902[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 805[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 303[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 181[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 573[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 151[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 313[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 220[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 82[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 220[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 243[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 8 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/8]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/8]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:26:29
[2m   Duration [22m 22.80s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880019037,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880021830,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880024545,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880024545,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880024555,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880024555,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880024555,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880024555,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880025017,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880025018,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880025065,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880025158,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImVmZDQzNjQwLWVlOTQtNDNkNy04ZTYxLWVhYWQ2NDViNmQ0OSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDAyNSwiZXhwIjoxNzY1NDg0ODI1fQ.Zr8dblz2aDhQLOG697CgeDc4wOc0DwucOkujZi5seMM",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "efd43640-ee94-43d7-8e61-eaad645b6d49",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880025168,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880025168,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880025212,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880025301,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880027412,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 2d0eddf2-fb94-483b-8f0a-51113dc0f1be tenantId: efd43640-ee94-43d7-8e61-eaad645b6d49 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: f132f791-922c-44d7-ba9d-160c20086219 tenantId: efd43640-ee94-43d7-8e61-eaad645b6d49 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: cafeb29c-5a78-4416-9e4d-ae50eacd4cf3 tenantId: efd43640-ee94-43d7-8e61-eaad645b6d49 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: fbce836b-6c78-431c-8d6c-9727e117a590 tenantId: efd43640-ee94-43d7-8e61-eaad645b6d49 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: c2907e98-6783-464d-b337-d4e33e6a45b0 tenantId: efd43640-ee94-43d7-8e61-eaad645b6d49 userId: google-user-id

{"level":50,"time":1764880032122,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":50,"time":1764880032358,"env":"test","error":{},"databaseId":"9defa389-413b-4929-892c-701c6c43b8d5","msg":"Error creating API token"}
{"level":50,"time":1764880032786,"env":"test","error":{},"databaseId":"c85ca28a-d140-4d79-96b8-82e11ec0c4de","msg":"Error creating API token"}
{"level":40,"time":1764880032935,"env":"test","module":"auth-middleware","path":"/datavault/databases/3637c380-abab-4a2e-b9c5-468f332b58c2/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880033165,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880033389,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880033617,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880033761,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880033997,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880034127,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880034345,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 10714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 417[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 413[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1282[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 872[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 896[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 810[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 618[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[32m 241[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 192[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 231[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 149[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 373[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 365[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 218[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 82[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 230[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 194[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 10 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/10]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/10]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/10]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/10]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/10]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/10]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/10]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m10 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:26:53
[2m   Duration [22m 20.59s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764880066804,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880069485,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880073336,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880073337,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880073471,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880073472,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880073472,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880073473,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880073965,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880073966,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880074016,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880074111,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImM1Y2YyODk1LWZhZjUtNGE5Yi05NzdmLTFjNDY5MGNiZmVkMSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDA3NCwiZXhwIjoxNzY1NDg0ODc0fQ.nbMt8ubvK086w72eQ9E_qhY8kKvKs9p3wGgW41vS07I",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "c5cf2895-faf5-4a9b-977f-1c4690cbfed1",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880074127,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880074127,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880074170,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880074265,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880074507,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880074739,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880074977,"env":"test","error":{},"msg":"Error creating DataVault column"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880075128,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":50,"time":1764880075373,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880075522,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880075771,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880076006,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880076146,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880076475,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880076792,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880076980,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880077162,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880077490,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880077639,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880078094,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880078236,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880078614,"env":"test","error":{},"databaseId":"d9f14233-c936-4dbd-aa57-2f76f3067bb0","msg":"Error creating API token"}
{"level":50,"time":1764880079026,"env":"test","error":{},"databaseId":"53eba491-9df5-4042-b8fc-b15973bc5643","msg":"Error creating API token"}
{"level":40,"time":1764880079172,"env":"test","module":"auth-middleware","path":"/datavault/databases/14f475fa-6778-4176-aa13-f09dcd647f4e/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880079427,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880079651,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880079879,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880080024,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880080256,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880080393,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880080623,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880081451,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880081678,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880081905,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880082043,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880082270,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8993[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 249[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 225[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 394[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 250[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 326[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 687[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 477[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 598[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 377[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 179[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 233[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 145[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 255[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 225[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 373[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 368[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 230[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 828[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 365[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 225[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:27:42
[2m   Duration [22m 18.90s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764880088088,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880091017,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880094411,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880094411,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880094424,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880094424,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880094424,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880094424,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880094927,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880094928,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880094989,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880095082,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImI5MzgyYWFhLWI3NGEtNGFmZC1iNGJkLTZmMDY4MzNiNmM4OSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDA5NSwiZXhwIjoxNzY1NDg0ODk1fQ.z7YGpXqcb3zvcTYXfwPnojWzT6paxHew6uM0rlxBA44",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "b9382aaa-b74a-4afd-b4bd-6f06833b6c89",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880095098,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880095098,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880095142,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880095238,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880095501,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880095759,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880096007,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880096152,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880096403,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880096548,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880096784,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880097029,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880097172,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880097531,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880097867,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880098066,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880098265,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880098613,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880098765,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880099218,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880099361,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880099733,"env":"test","error":{},"databaseId":"06303574-3644-4a44-a952-7b63c366d6b3","msg":"Error creating API token"}
{"level":50,"time":1764880100155,"env":"test","error":{},"databaseId":"63db12b0-6a21-45d8-8791-9bb9d3ebe9d6","msg":"Error creating API token"}
{"level":40,"time":1764880100308,"env":"test","module":"auth-middleware","path":"/datavault/databases/db6394d0-996b-4a71-8db9-a37b099f8803/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880100555,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880100801,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880101039,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880101179,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880101414,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880101557,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880101794,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880102666,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880102908,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880103146,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880103289,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880103522,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 9172[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 270[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 251[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 396[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 389[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 358[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 734[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 500[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 596[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 372[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 191[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 231[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 152[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 247[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 246[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 379[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 377[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 872[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 242[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 381[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 233[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:28:03
[2m   Duration [22m 19.19s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880106012,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880107722,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880110782,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880110782,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880110796,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880110796,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880110804,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880110804,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880111317,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880111318,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880111363,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880111454,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjdhNTZkNzA5LTQzYjItNDliOC1iMDY3LWIyOGQxOWIzYmE0MCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDExMSwiZXhwIjoxNzY1NDg0OTExfQ.ps781owPNSOddpiDwEfriawkI8WQV3XLkiUZXiiAx3g",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "7a56d709-43b2-49b8-b067-b28d19b3ba40",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880111469,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880111469,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880111513,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880111603,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880112260,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880112506,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880112651,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880112883,"env":"test","error":{},"msg":"Error creating DataVault column"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880113020,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":50,"time":1764880113248,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880113481,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880113618,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880113954,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880114270,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880114454,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880114651,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880114973,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880115109,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880115588,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880115736,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880116079,"env":"test","error":{},"databaseId":"aaa91567-8705-4013-9978-492cf81aace8","msg":"Error creating API token"}
{"level":50,"time":1764880116470,"env":"test","error":{},"databaseId":"f43db5b2-7e60-4323-8d79-a598ae9a28d1","msg":"Error creating API token"}
{"level":40,"time":1764880116599,"env":"test","module":"auth-middleware","path":"/datavault/databases/28226115-7acf-47b3-8287-8a035e8cc75b/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880116809,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880117028,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880117238,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880117356,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880117559,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880117696,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880117902,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880118730,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880118956,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880119177,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880119318,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880119549,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 8824[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 428[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 389[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 335[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 697[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 458[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 628[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 342[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 171[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 219[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 129[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 210[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 219[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 328[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 340[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 205[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 828[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 362[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 231[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 18 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/18]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m18 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:28:23
[2m   Duration [22m 15.35s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/sections.routes.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764880140282,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880143299,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880148411,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880148411,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880148421,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880148421,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880148422,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880148422,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880148897,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880148899,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880148945,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880149048,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjYyNmJhMGNjLWNhNmYtNGQ0YS05NzY0LThhYWQwODEzMTM1ZCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDE0OSwiZXhwIjoxNzY1NDg0OTQ5fQ.o8jfKb2e2coUT19n36RQjSZhLjczHgF2fu7BJMRh_rE",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "626ba0cc-ca6f-4d4a-9764-8aad0813135d",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880149065,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880149065,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880149106,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880149190,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880150257,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880150398,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880150630,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880150764,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880150993,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880151214,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880151358,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880151672,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880151999,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880152186,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880152368,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880152667,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880152798,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880153283,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880153434,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880153760,"env":"test","error":{},"databaseId":"7e2c00b1-bc5a-443e-a080-905b76c621fe","msg":"Error creating API token"}
{"level":50,"time":1764880154162,"env":"test","error":{},"databaseId":"959456b8-ae72-45d8-8147-4da0fbd01730","msg":"Error creating API token"}
{"level":40,"time":1764880154301,"env":"test","module":"auth-middleware","path":"/datavault/databases/d3a75887-51c5-4def-a19a-f78352425659/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880154514,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880154733,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880154962,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880155101,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880155319,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880155442,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880155673,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880156503,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880156727,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880156961,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880157102,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880157343,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 8983[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 424[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 416[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 361[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 313[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 696[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 430[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 636[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 326[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 182[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 220[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 138[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 214[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 219[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 342[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 230[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 830[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 376[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 241[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 17 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/17]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m17 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:28:56
[2m   Duration [22m 20.12s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880169987,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880172852,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880176031,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880176032,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880176042,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880176042,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880176043,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880176043,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880176569,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880176569,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880176612,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880176702,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjI1MTg0OTI3LTMzYzAtNGM4Ni04NDkwLTdiZTNjYjI0MzRhZiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDE3NiwiZXhwIjoxNzY1NDg0OTc2fQ.rNBnLBETpSh9lcSkBpTn_OGOV5S7yGA0M0aM0WPCfBs",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "25184927-33c0-4c86-8490-7be3cb2434af",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880176718,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880176719,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880176763,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880176851,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880177488,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880177727,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880177867,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880178100,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880178247,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880178482,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880178720,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880178863,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880179192,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880179524,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880179698,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880179881,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880180190,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880180337,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880180799,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880180945,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880181330,"env":"test","error":{},"databaseId":"425a6915-cc9e-474d-a01f-574c01da5af2","msg":"Error creating API token"}
{"level":50,"time":1764880181769,"env":"test","error":{},"databaseId":"6142c516-cb53-4746-bde1-5ae58afcd65b","msg":"Error creating API token"}
{"level":40,"time":1764880181916,"env":"test","module":"auth-middleware","path":"/datavault/databases/b30519a7-b373-4c93-91d3-811c17b34c92/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880182162,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880182406,"env":"test","error":{},"msg":"Error fetching table permissions"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880182648,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":50,"time":1764880182790,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880183039,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880183181,"env":"test","error":{},"msg":"Error revoking table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880183429,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":50,"time":1764880184289,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880184507,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880184739,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880184886,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880185116,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 9138[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 407[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 379[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 381[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 328[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 691[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 455[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 609[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 384[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 204[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 233[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 146[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 247[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 244[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 384[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 390[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 248[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 860[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 217[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 381[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 228[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 18 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/18]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m18 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:29:25
[2m   Duration [22m 18.93s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880187881,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880189786,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880192324,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880192325,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880192338,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880192339,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880192339,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880192339,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880192823,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880192823,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880192870,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880192963,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjY4YzMxYTBiLTI2OWMtNDMxOC04MTQwLTFkMWY2MWYzNGFkZiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDE5MiwiZXhwIjoxNzY1NDg0OTkyfQ.3Z79hLzhRuW84buZOlWnWWA9VPNFlNF2HHoXV-hPRsQ",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "68c31a0b-269c-4318-8140-1d1f61f34adf",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880192978,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880192978,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880193022,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880193113,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880194515,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880194754,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880194889,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880195125,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880195356,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880195502,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880195820,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880196145,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880196333,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880196514,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880196849,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880196991,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880197411,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880197538,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880197903,"env":"test","error":{},"databaseId":"fac32190-8069-401f-b771-c075177cb659","msg":"Error creating API token"}
{"level":50,"time":1764880198343,"env":"test","error":{},"databaseId":"7d8a22b5-00ee-4a3d-8c1f-872df34acbca","msg":"Error creating API token"}
{"level":40,"time":1764880198495,"env":"test","module":"auth-middleware","path":"/datavault/databases/4c8f5a8b-7956-4cc7-814f-1db0c1d4f8f4/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880198736,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880198963,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880199203,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880199355,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880199601,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880199743,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880199981,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880200841,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880201066,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880201291,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880201424,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880201653,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 9387[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 410[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 434[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 566[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 366[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 235[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 317[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 695[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 476[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 547[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 365[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 193[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 246[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 151[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 391[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 388[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 859[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 358[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 229[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 17 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/17]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m17 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:29:45
[2m   Duration [22m 15.87s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/steps.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764880218586,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880222447,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880226209,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880226210,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880226223,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880226223,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880226223,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880226223,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880226695,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880226696,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880226754,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880226845,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjdhOWU3Yjg3LWJjM2MtNDE5Zi05OTZiLTkxNDQwY2ViNDllNCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDIyNiwiZXhwIjoxNzY1NDg1MDI2fQ.aCLAHTcPYZlzXyMZ-XKRXQGps869iPyIaZTL6nVHH8o",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "7a9e7b87-bc3c-419f-996b-91440ceb49e4",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880226859,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880226859,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880226897,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880226990,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880227218,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880227452,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880227681,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880227806,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880228027,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880228158,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880228368,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880228584,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880228716,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880229023,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880229318,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880229479,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880229656,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880229960,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880230088,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880230532,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880230669,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880230999,"env":"test","error":{},"databaseId":"46b698e8-815d-4761-809c-41bcf83c984a","msg":"Error creating API token"}
{"level":50,"time":1764880231404,"env":"test","error":{},"databaseId":"9f106fe7-eca0-48d0-8a33-8deda658d63d","msg":"Error creating API token"}
{"level":40,"time":1764880231538,"env":"test","module":"auth-middleware","path":"/datavault/databases/7f14542b-7043-49f1-997e-37551716826b/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880231749,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880231976,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880232191,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880232320,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880232530,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880232665,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880232885,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880233682,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880233910,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880234128,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880234268,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880234493,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 225[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 354[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 352[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 210[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 347[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 306[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 635[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 431[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 581[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 330[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 181[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 224[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 133[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 212[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 344[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 344[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 797[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 358[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 225[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:30:14
[2m   Duration [22m 19.43s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx26 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880255726,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880258665,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880262563,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880262563,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880262574,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880262574,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880262574,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880262574,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880263085,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880263086,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880263130,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880263220,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImM1M2Q1ZWEyLWVhNDMtNDA4My1hN2I2LTdhNzQwNDE0MTExMyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDI2MywiZXhwIjoxNzY1NDg1MDYzfQ.gWHYbXvkk61nOc9YzHNYUCwMS4AO6ue12bwWMfZOYqE",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "c53d5ea2-ea43-4083-a7b6-7a7404141113",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880263236,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880263236,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880263278,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880263367,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880263614,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880263852,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880264133,"env":"test","error":{},"msg":"Error creating DataVault column"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880264280,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":50,"time":1764880264545,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880264692,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880264942,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880265183,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880265323,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880265656,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880265981,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880266174,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880266352,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880266684,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880266819,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880267250,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880267385,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880267760,"env":"test","error":{},"databaseId":"5e6b4598-ee2a-4710-9994-71f6081ac036","msg":"Error creating API token"}
{"level":50,"time":1764880268172,"env":"test","error":{},"databaseId":"c903eb6c-e0a5-4719-9dfc-06df4b48419c","msg":"Error creating API token"}
{"level":40,"time":1764880268326,"env":"test","module":"auth-middleware","path":"/datavault/databases/9c3a99ad-9c16-4b50-9d60-203cc01dc349/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880268570,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880268804,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880269036,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880269184,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880269417,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880269558,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880269791,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880270661,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880270888,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880271125,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880271266,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880271495,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8985[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 253[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 430[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 409[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 251[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 380[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 332[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 696[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 468[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 566[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 374[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 185[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 226[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 154[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 381[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 373[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 871[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 378[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 229[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:30:52
[2m   Duration [22m 18.77s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx27 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764880274247,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880278555,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880282293,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880282294,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880282305,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880282305,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880282306,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880282306,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880282809,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880282810,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880282855,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880282946,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6Ijg2Njc4YTFmLTUyNjMtNGRlZS04ODQ2LTY2ZDBlYzhmZTI1MyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDI4MiwiZXhwIjoxNzY1NDg1MDgyfQ.KZQGlNGJ_1Z2YYtJfXa8tLyjaYNu3gsj7PK8grMq4GA",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "86678a1f-5263-4dee-8846-66d0ec8fe253",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880282962,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880282962,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880283000,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880283089,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880284094,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880284231,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880284463,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880284591,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880284818,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880285037,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880285174,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880285484,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880285789,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880285969,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880286155,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880286484,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880286618,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880287059,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880287191,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880287568,"env":"test","error":{},"databaseId":"5cbdf9c3-3163-4656-92fe-40e4b04559cc","msg":"Error creating API token"}
{"level":50,"time":1764880288009,"env":"test","error":{},"databaseId":"59d61bc2-e810-45f7-a1a1-fcaf255b689c","msg":"Error creating API token"}
{"level":40,"time":1764880288161,"env":"test","module":"auth-middleware","path":"/datavault/databases/79880c6c-2134-42d7-8850-22e8573667a8/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880288395,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880288632,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880288866,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880289010,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880289233,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880289377,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880289612,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880290482,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880290708,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880290942,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880291083,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880291324,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 9092[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 403[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 387[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 357[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 356[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 355[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 310[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 671[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 464[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 571[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 377[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 200[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 241[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 151[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 379[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 367[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 869[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 374[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 240[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 17 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/17]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m17 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:31:11
[2m   Duration [22m 19.31s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx28 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764880294242,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880296748,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880300596,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880300596,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880300610,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880300610,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880300610,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880300610,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880301152,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880301153,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880301207,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880301303,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjVlNWE4OTE2LTA2ZWUtNDQ2ZS04ZWVlLTZlYzdlNTQwOGY0MCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDMwMSwiZXhwIjoxNzY1NDg1MTAxfQ.84ghJ_jjkc4rbeio8WqqbFppc__4w-TNNSp_Omdbvlc",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "5e5a8916-06ee-446e-8eee-6ec7e5408f40",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880301318,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880301318,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880301369,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880301457,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880303505,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

{"level":50,"time":1764880303739,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880303872,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880304106,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880304334,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880304467,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880304792,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880305120,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880305303,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880305493,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880305829,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880305962,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880306420,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880306556,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880306919,"env":"test","error":{},"databaseId":"0c5e1ee2-7d91-410d-8c2b-13a01fa76e72","msg":"Error creating API token"}
{"level":50,"time":1764880307331,"env":"test","error":{},"databaseId":"653a305f-5c5c-4d9a-b53b-21b05fd64889","msg":"Error creating API token"}
{"level":40,"time":1764880307478,"env":"test","module":"auth-middleware","path":"/datavault/databases/4b3c15eb-e8c5-4774-a10c-29aac8e457c6/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880307714,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880307966,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880308201,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880308337,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880308571,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880308707,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880308934,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880309798,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880310028,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880310269,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880310402,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880310651,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m16 failed[39m[2m)[22m[33m 10121[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1201[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 361[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 324[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 701[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 470[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 593[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 362[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 186[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 227[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 145[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 250[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 369[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 864[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 375[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 248[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 16 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/16]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/16]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m16 failed[39m[22m[2m | [22m[1m[32m7 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:31:31
[2m   Duration [22m 18.69s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx29 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764880313265,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880315109,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880317988,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880317988,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880317999,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880317999,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880317999,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880317999,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880318495,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880318496,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880318539,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880318627,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImI0OWIwNTAwLTI2ZTgtNDFhZC05MGE5LTI5ZDE5YTM0MDJkNCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDMxOCwiZXhwIjoxNzY1NDg1MTE4fQ.SJKrisLW_AXx6jf-nFa2hDgVRIzALmMG11ARGQegJXU",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "b49b0500-26e8-41ad-90a9-29d19a3402d4",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880318642,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880318642,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880318686,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880318769,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880320766,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 3e696957-cf92-4cde-bcf3-2a08fb8d734f tenantId: b49b0500-26e8-41ad-90a9-29d19a3402d4 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 10ad189e-70a2-49dd-ae15-1cef87e87cc7 tenantId: b49b0500-26e8-41ad-90a9-29d19a3402d4 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 0cd50ec5-a659-462a-b95a-1aecf4623562 tenantId: b49b0500-26e8-41ad-90a9-29d19a3402d4 userId: google-user-id

{"level":50,"time":1764880324293,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880324427,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880324863,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880325002,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880325353,"env":"test","error":{},"databaseId":"7421e3d4-3647-44f7-8112-e7ce9e6db2b1","msg":"Error creating API token"}
{"level":50,"time":1764880325766,"env":"test","error":{},"databaseId":"128b6edf-3d6b-42a9-a49f-84f5de278de5","msg":"Error creating API token"}
{"level":40,"time":1764880325912,"env":"test","module":"auth-middleware","path":"/datavault/databases/3b68ad96-bfc9-4ac6-8dee-b90aa7547d13/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880326132,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880326365,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880326603,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880326741,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880326981,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880327124,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880327346,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880328299,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880328538,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880328772,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880328915,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880329168,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 11237[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 396[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 393[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1209[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 818[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 392[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 868[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 794[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 447[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 570[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 350[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 187[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 226[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 144[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 382[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 956[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 377[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 253[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 11 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/11]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/11]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m11 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:31:50
[2m   Duration [22m 17.91s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflowExports.routes.ts [22m[34mx30 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764880330771,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880331808,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880333052,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880333053,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880333061,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880333061,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880333061,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880333061,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880333474,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880333475,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880333521,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880333625,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjcxZWU1MjRlLWIwOTYtNDNmMy04MTg1LWEyOTBiN2EzNzRkNCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDMzMywiZXhwIjoxNzY1NDg1MTMzfQ.7aHJ-JGqgOBpsRRS4raqiVLEcfz3pU0z08QBQyUja0w",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "71ee524e-b096-43f3-8185-a290b7a374d4",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880333637,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880333637,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880333682,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880333773,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880335873,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

{"level":50,"time":1764880337545,"env":"test","error":{"length":375,"name":"error","severity":"ERROR","code":"23503","detail":"Key (table_id)=(d2d88121-b4c8-4149-beb2-87005d20fd1a) is not present in table \"datavault_tables\".","schema":"public","table":"datavault_columns","constraint":"datavault_columns_table_id_datavault_tables_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880337758,"env":"test","userId":"google-user-id","path":"/api/datavault/tables/d2d88121-b4c8-4149-beb2-87005d20fd1a/rows","msg":"User session missing tenantId - user may need to log out and log back in"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Your account is not properly configured. Please log out and log back in to fix this issue.

{"level":50,"time":1764880337758,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 8531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 439[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1238[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 844[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 421[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 621[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[32m 87[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[32m 210[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[32m 216[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[32m 217[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate API token scopes[39m[32m 215[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 212[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny access with expired token[39m[32m 219[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 212[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 220[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 238[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 213[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 18 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 500 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should validate API token scopes
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should deny access with expired token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/18]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m18 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:32:09
[2m   Duration [22m 12.03s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx31 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764880371725,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880374294,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880377505,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880377506,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880377517,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880377517,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880377518,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880377518,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880378003,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880378005,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880378050,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880378139,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6Ijc2OWY0NTI4LTRkZTItNDhhZC05NDMzLTBkZTZiMTMxODRkMiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg4MDM3OCwiZXhwIjoxNzY1NDg1MTc4fQ.UfnbTErafSFyJ5lf72P2RgsYw6bsb4Z1DsNFB8q3Eb4",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "769f4528-4de2-48ad-9433-0de6b13184d2",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764880378155,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764880378156,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764880378195,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764880378281,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764880379348,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880379491,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880379743,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880379878,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880380108,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880380342,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880380479,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880380810,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880381126,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880381313,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880381506,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764880381814,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880381959,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880382404,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764880382549,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764880382928,"env":"test","error":{},"databaseId":"9465d550-4415-4bea-9a17-78f599fc50af","msg":"Error creating API token"}
{"level":50,"time":1764880383347,"env":"test","error":{},"databaseId":"d37d12cc-7fda-402a-92d4-72cbdea6bed1","msg":"Error creating API token"}
{"level":40,"time":1764880383490,"env":"test","module":"auth-middleware","path":"/datavault/databases/a6f25e93-4208-46da-89b2-19e29b9ac330/tables","msg":"No valid authentication found"}
{"level":50,"time":1764880383713,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880383947,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764880384192,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880384330,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764880384557,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764880384704,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764880384941,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764880385758,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764880385987,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880386223,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764880386355,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764880386625,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 9183[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 407[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 381[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 330[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 697[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 452[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 591[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 378[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 188[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 231[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 143[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 384[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 374[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 817[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 368[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 269[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 17 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/17]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/17]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m17 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 14:32:47
[2m   Duration [22m 18.22s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx32 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764891573204,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764891577279,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764891580816,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764891580817,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764891580827,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764891580827,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764891580828,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764891580828,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764891581333,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764891581334,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764891581379,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764891581468,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjU3ZmQ4YThlLTU1YjItNDQwOS05MDAyLTM3NTMwYzJkMWQ3NSIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5MTU4MSwiZXhwIjoxNzY1NDk2MzgxfQ.ACixcrnS_0cvljhebDrxW1Bz1OXk0syhM1D3CFKCmIY",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "57fd8a8e-55b2-4409-9002-37530c2d1d75",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764891581482,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764891581483,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764891581526,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764891581613,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764891582245,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764891582482,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764891582621,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764891582857,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764891582992,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764891583223,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764891583451,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764891583576,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764891583896,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764891584195,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764891584366,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764891584540,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764891584854,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764891584988,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764891585445,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764891585590,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764891585978,"env":"test","error":{},"databaseId":"708c1e43-cd07-4434-821b-6fa243753e36","msg":"Error creating API token"}
{"level":50,"time":1764891586418,"env":"test","error":{},"databaseId":"2a608620-5ce9-4a1f-b2ec-50a3d8e2e9d7","msg":"Error creating API token"}
{"level":40,"time":1764891586570,"env":"test","module":"auth-middleware","path":"/datavault/databases/47bf29e0-202c-4efd-a8cc-d1561095c2a3/tables","msg":"No valid authentication found"}
{"level":50,"time":1764891586806,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764891587042,"env":"test","error":{},"msg":"Error fetching table permissions"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764891587291,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":50,"time":1764891587447,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764891587685,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764891587829,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764891588073,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764891588902,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764891589121,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764891589357,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764891589499,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764891589739,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m18 failed[39m[2m)[22m[33m 8984[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 399[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 371[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 229[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 352[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 320[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 646[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 449[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 603[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 386[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 196[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 243[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 150[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 236[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 237[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 406[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 380[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 830[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 217[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 379[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 238[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 18 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/18]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/18]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m18 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 17:39:28
[2m   Duration [22m 20.38s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/auth.ts [22m[34mx33 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764892167573,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892170981,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892174468,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892174469,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892174479,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892174479,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892174479,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892174479,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892174928,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892174929,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892174976,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892175078,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImZiYTFhMGU0LWY1NDAtNDc0Zi1hNzE4LTQ3YzAyMGNjNjc4NiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5MjE3NSwiZXhwIjoxNzY1NDk2OTc1fQ.CTMmK0U0NNC5VVfdRnqax05uaXRTCYSRSmgcGb17BU0",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "fba1a0e4-f540-474f-a718-47c020cc6786",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764892175092,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892175093,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892175142,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892175231,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764892177373,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 77453f16-74a3-4e90-b29f-c7aaa58972e8 tenantId: fba1a0e4-f540-474f-a718-47c020cc6786 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: c71a47c7-c9f3-4b9a-9de4-24c2610ff942 tenantId: fba1a0e4-f540-474f-a718-47c020cc6786 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 590c1299-daa2-46e9-8264-31a1ac40b9f0 tenantId: fba1a0e4-f540-474f-a718-47c020cc6786 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: ee78b11e-051f-4c46-a8e7-546b18040902 tenantId: fba1a0e4-f540-474f-a718-47c020cc6786 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 455151d4-cf3b-4907-ae19-542155a02bac tenantId: fba1a0e4-f540-474f-a718-47c020cc6786 userId: google-user-id

{"level":50,"time":1764892182219,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764892183519,"env":"test","module":"auth-middleware","path":"/datavault/databases/7ca3f238-1dc6-4c2b-a9c6-7200994026ab/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"8c4ad4c6-92bd-49f3-868a-5344bb692ea1","tableId":"9ed4eddc-e6d8-4c02-ba7f-ceae38620823","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:49:45.602Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"8c4ad4c6-92bd-49f3-868a-5344bb692ea1","tableId":"9ed4eddc-e6d8-4c02-ba7f-ceae38620823","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:49:45.602Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"62a2b811-b1cb-4c18-a4ea-6eac46d1cb03","tableId":"f166625b-7e27-427e-b3d7-5d0d3782bbb0","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:49:46.203Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"62a2b811-b1cb-4c18-a4ea-6eac46d1cb03","tableId":"f166625b-7e27-427e-b3d7-5d0d3782bbb0","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:49:46.203Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"62a2b811-b1cb-4c18-a4ea-6eac46d1cb03","tableId":"f166625b-7e27-427e-b3d7-5d0d3782bbb0","userId":"other-user-id","role":"write","createdAt":"2025-12-04T23:49:46.203Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"62a2b811-b1cb-4c18-a4ea-6eac46d1cb03","tableId":"f166625b-7e27-427e-b3d7-5d0d3782bbb0","userId":"other-user-id","role":"write","createdAt":"2025-12-04T23:49:46.203Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'62a2b811-b1cb-4c18-a4ea-6eac46d1cb03'[39m,
  tableId: [32m'f166625b-7e27-427e-b3d7-5d0d3782bbb0'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2025-12-04T23:49:46.203Z'[39m
}

{"level":50,"time":1764892184891,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892184990,"env":"test","userId":"google-user-id","path":"/api/datavault/permissions/undefined","msg":"User session missing tenantId - user may need to log out and log back in"}
{"level":50,"time":1764892184990,"env":"test","error":{},"msg":"Error revoking table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 11890[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 428[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1266[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 904[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 421[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 930[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 832[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 648[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 327[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 210[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 613[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 150[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 311[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 276[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 558[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 332[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 86[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 233[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 219[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 444[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 208[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 6 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m6 failed[39m[22m[2m | [22m[1m[32m17 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 17:49:20
[2m   Duration [22m 24.50s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx34 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764892480177,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892483682,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892487785,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892487786,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892487796,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892487796,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892487797,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892487798,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892488297,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892488298,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892488353,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892488454,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6Ijk2YWJmOTBlLWQ4NWEtNGQ4OC1hYzg5LTYzODkwMTQxZGE4NiIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5MjQ4OCwiZXhwIjoxNzY1NDk3Mjg4fQ.OgOtYlgfrji4JpxKH1PBDM3BRoeCx1fC5D_uIJSOPcw",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "96abf90e-d85a-4d88-ac89-63890141da86",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764892488468,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892488469,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892488518,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892488620,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764892490852,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: e897b3c1-5151-4bdc-884a-ff67a6a92d0b tenantId: 96abf90e-d85a-4d88-ac89-63890141da86 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 1213547e-884d-48ee-8a35-685b2cff25c7 tenantId: 96abf90e-d85a-4d88-ac89-63890141da86 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 65bb60fd-0c69-453c-8045-dc9b0581ef4f tenantId: 96abf90e-d85a-4d88-ac89-63890141da86 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 0e1a3702-2e1b-485b-80bb-244c2e9573c5 tenantId: 96abf90e-d85a-4d88-ac89-63890141da86 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 64dead6d-5bce-48b5-9e1e-eda521eab12f tenantId: 96abf90e-d85a-4d88-ac89-63890141da86 userId: google-user-id

{"level":50,"time":1764892495929,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":40,"time":1764892497305,"env":"test","module":"auth-middleware","path":"/datavault/databases/5951ed07-4e72-463d-b22e-754c786e7562/tables","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"ece2bfc2-71e1-43c3-80d4-ffa8e2b27786","tableId":"92df8eeb-b9b8-44d2-b75b-d290a7228185","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:54:59.416Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"ece2bfc2-71e1-43c3-80d4-ffa8e2b27786","tableId":"92df8eeb-b9b8-44d2-b75b-d290a7228185","userId":"other-user-id","role":"read","createdAt":"2025-12-04T23:54:59.416Z"}

{"level":50,"time":1764892498181,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764892498276,"env":"test","userId":"google-user-id","path":"/api/datavault/tables/8f5ce700-61c0-43d0-94f7-0dc9a627c31b/permissions","msg":"User session missing tenantId - user may need to log out and log back in"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Your account is not properly configured. Please log out and log back in to fix this issue.
    at getTenantId (C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:50:13)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1137:24
    at Layer.handle [as handle_request] [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mexpress[24m\lib\router\layer.js:95:5[90m)[39m
    at next [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mexpress[24m\lib\router\route.js:149:13[90m)[39m
    at hybridAuth (C:/Users/scoot/poll/VaultLogic/server/middleware/auth.ts:187:7)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m

{"level":50,"time":1764892498277,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  message: [32m'Your account is not properly configured. Please log out and log back in to fix this issue.'[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 11913[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 911[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 971[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 888[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 695[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 338[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 196[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 630[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 213[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 334[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 292[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 350[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 93[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 242[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 228[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 220[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 207[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 500 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/7]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 17:54:36
[2m   Duration [22m 22.62s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx35 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764892503936,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892505804,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892507807,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892507808,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892507817,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892507817,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892507817,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892507817,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892508257,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892508258,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892508309,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892508406,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImMwOTcwYTY1LWIzYTUtNGQxYi05OGQ5LTc1MzIyM2QwY2U5MCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5MjUwOCwiZXhwIjoxNzY1NDk3MzA4fQ.yH0_pdOuaPc_g4kh6ww9tyrIRnCaLcVHrfh0Kkcx21g",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "c0970a65-b3a5-4d1b-98d9-753223d0ce90",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764892508421,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764892508421,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764892508465,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764892508552,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764892510685,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Column 'Status' value must be one of: active, inactive

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 4a019472-0799-40c3-b6ad-8c9ed9b2792e tenantId: c0970a65-b3a5-4d1b-98d9-753223d0ce90 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 3e82f8c4-8cd0-496b-9c98-28df1a28857e tenantId: c0970a65-b3a5-4d1b-98d9-753223d0ce90 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 2cfa1adf-e1e7-4c8a-8697-0baf969391af tenantId: c0970a65-b3a5-4d1b-98d9-753223d0ce90 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: e609dc74-760d-4d90-b447-b26878651132 tenantId: c0970a65-b3a5-4d1b-98d9-753223d0ce90 userId: google-user-id

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: b9fe0a7e-44c3-49a0-9ef7-5a84d0e946b4 tenantId: c0970a65-b3a5-4d1b-98d9-753223d0ce90 userId: google-user-id

{"level":50,"time":1764892515618,"env":"test","error":{},"msg":"Error deleting row note"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 11258[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 420[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1280[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 887[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 983[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 829[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 672[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 189[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 605[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny access with expired token[39m[32m 88[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 219[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[32m 224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[32m 240[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce RBAC - only owners can manage permissions[39m[32m 216[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[32m 227[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[32m 216[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle network errors gracefully[39m[32m 219[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 10 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should deny access with expired token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should enforce RBAC - only owners can manage permissions
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should handle network errors gracefully
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:271:21
    269|     testDatabaseId = database.id;
    270| 
    271|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    272|       name: 'Test Table',
    273|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/10]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m10 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 17:54:59
[2m   Duration [22m 17.51s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx36 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/datavault-v4-regression.test.ts[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764895077269,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895081553,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895085721,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895085721,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895085734,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895085734,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895085735,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895085735,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895086209,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764895086210,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764895086262,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764895086367,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjJjMDJlOTQ2LTk5YjQtNGQwNy05NGMzLTVkMzhiNTc1NDFiNCIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDg5NTA4NiwiZXhwIjoxNzY1NDk5ODg2fQ.xd8jq6qtrARN1a2OHwl9ArfPcJeok90cvoue-vLt4Ls",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "2c02e946-99b4-4d07-94c3-5d38b57541b4",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764895086382,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764895086382,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764895086437,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764895086535,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1764895086783,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764895087055,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764895087294,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764895087435,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate select value against options
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764895087669,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764895087816,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mSelect/Multiselect Columns[2m > [22m[2mshould validate multiselect values as array
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764895088073,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764895088323,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764895088486,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mAutonumber Columns[2m > [22m[2mshould format autonumber with prefix
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764895088821,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764895089158,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764895089347,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764895089543,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":50,"time":1764895089888,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764895090028,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764895090479,"env":"test","error":{},"msg":"Error creating row note"}
{"level":50,"time":1764895090623,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":50,"time":1764895090994,"env":"test","error":{},"databaseId":"3487f75a-f328-4172-894c-8ba97217fc71","msg":"Error creating API token"}
{"level":50,"time":1764895091402,"env":"test","error":{},"databaseId":"f65289c4-2349-4ce6-a1f0-53fe303b031e","msg":"Error creating API token"}
{"level":40,"time":1764895091541,"env":"test","module":"auth-middleware","path":"/datavault/databases/a47ff130-103d-4d2c-abc2-6c4570075585/tables","msg":"No valid authentication found"}
{"level":50,"time":1764895091773,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764895091996,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":50,"time":1764895092216,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764895092348,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

{"level":50,"time":1764895092582,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: undefined

{"level":50,"time":1764895092727,"env":"test","error":{},"msg":"Error revoking table permission"}
{"level":50,"time":1764895092966,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:138:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1155:26

{"level":50,"time":1764895093787,"env":"test","error":{},"msg":"Error fetching DataVault rows"}
{"level":50,"time":1764895094032,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764895094263,"env":"test","error":{},"msg":"Error creating DataVault column"}
{"level":50,"time":1764895094403,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return user-friendly error for missing required fields
[22m[39mRow creation error message: Access denied - write permission required

{"level":50,"time":1764895094642,"env":"test","error":{"length":144,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching DataVault rows"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 8981[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a select column with options[39m[32m 256[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a multiselect column with options[39m[32m 264[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate select value against options[39m[33m 382[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate multiselect values as array[39m[33m 380[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an autonumber column with sequence[39m[32m 258[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format autonumber with prefix[39m[33m 411[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a note for a row[39m[33m 334[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 722[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should delete a note[39m[33m 485[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow deleting notes by other users[39m[33m 594[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create an API token[39m[33m 370[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 184[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke (delete) an API token[39m[32m 224[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 138[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should grant table permission[39m[32m 232[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list table permissions[39m[32m 223[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 354[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 378[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 821[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[32m 245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 371[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 238[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 19 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a select column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:298:31
    296|         });
    297| 
    298|       expect(response.status).toBe(201);
       |                               ^
    299|       expect(response.body).toBeDefined();
    300|       expect(response.body.type).toBe('select');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should create a multiselect column with options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:321:31
    319|         });
    320| 
    321|       expect(response.status).toBe(201);
       |                               ^
    322|       expect(response.body).toBeDefined();
    323|       expect(response.body.type).toBe('multiselect');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate select value against options
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:356:36
    354|         });
    355| 
    356|       expect(validResponse.status).toBe(201);
       |                                    ^
    357| 
    358|       // Create row with invalid value should fail

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Select/Multiselect Columns > should validate multiselect values as array
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:401:36
    399|         });
    400| 
    401|       expect(validResponse.status).toBe(201);
       |                                    ^
    402|       expect(validResponse.body.values[testColumnId]).toEqual(['urgentÎ“Ã‡Âª
    403|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should create an autonumber column with sequence
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:421:31
    419|         });
    420| 
    421|       expect(response.status).toBe(201);
       |                               ^
    422|       expect(response.body).toBeDefined();
    423|       expect(response.body.type).toBe('autonumber');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Autonumber Columns > should format autonumber with prefix
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:455:34
    453|         .send({ values: {} });
    454| 
    455|       expect(rowResponse.status).toBe(201);
       |                                  ^
    456|       // Check if formatted value is stored or displayed
    457|       // This depends on implementation - adjust as needed

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:481:31
    479|         });
    480| 
    481|       expect(response.status).toBe(201);
       |                               ^
    482|       expect(response.body).toBeDefined();
    483|       expect(response.body.text).toBe('This is a test note');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:507:31
    505|         .set('Cookie', authCookie);
    506| 
    507|       expect(response.status).toBe(200);
       |                               ^
    508|       expect(response.body).toHaveLength(2);
    509|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:527:37
    525|         .set('Cookie', authCookie);
    526| 
    527|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    528| 
    529|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:554:37
    552|         .set('Cookie', otherUserCookie);
    553| 
    554|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    555|     });
    556|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should create an API token
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:574:31
    572|       // Assuming DB exists (created in beforeAll).
    573|       // If 404 persists, we might need to debug route registration.
    574|       expect(response.status).toBe(201);
       |                               ^
    575|       expect(response.body).toBeDefined();
    576|       // plainToken is not returned in the object, it might be separatÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:608:49
    606|         });
    607| 
    608|       const tokenId = createResponse.body.token.id;
       |                                                 ^
    609| 
    610|       // Revoke token

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:668:31
    666|         });
    667| 
    668|       expect(response.status).toBe(201);
       |                               ^
    669|       expect(response.body).toBeDefined();
    670|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:680:31
    678|         .set('Cookie', authCookie);
    679| 
    680|       expect(response.status).toBe(200);
       |                               ^
    681|       expect(response.body).toBeDefined();
    682|       expect(Array.isArray(response.body)).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:37
    711|         console.log('Update permission failed:', updateResponse.body);
    712|       }
    713|       expect(updateResponse.status).toBe(201);
       |                                     ^
    714|       expect(updateResponse.body.role).toBe('write');
    715|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:739:37
    737| 
    738|       // Revoke returns 200 with message
    739|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    740| 
    741|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected 403 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:787:31
    785|         .set('Cookie', authCookie);
    786| 
    787|       expect(response.status).toBe(200);
       |                               ^
    788|       expect(response.body.rows).toHaveLength(25);
    789|       expect(response.body.pagination.total).toBe(100);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:807:31
    805|         });
    806| 
    807|       expect(response.status).toBe(400);
       |                               ^
    808|       expect(response.body.errors).toBeDefined();
    809|       // expect(response.body.error).toContain('Invalid column type');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/19]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:834:31
    832| 
    833|       // Improved error handling returns 400
    834|       expect(response.status).toBe(400);
       |                               ^
    835|       expect(response.body.message).toBeDefined();
    836|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/19]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m19 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (23)[39m
[2m   Start at [22m 18:37:52
[2m   Duration [22m 20.87s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
