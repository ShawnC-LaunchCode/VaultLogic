npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764869078264,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764869079669,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764869080957,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764869080957,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764869080965,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764869080965,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764869080965,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764869080965,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764869081354,"env":"test","module":"user-credentials-repository","userId":"xKwR1cL14KFNtH1nJnNKG","msg":"User credentials created"}
{"level":30,"time":1764869081356,"env":"test","module":"auth-routes","userId":"xKwR1cL14KFNtH1nJnNKG","email":"test-workflows-i9hq3-JxJrhBTHDWdfppL@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"6fa8584d-d082-4c98-bd42-db54ce7fb777","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"xKwR1cL14KFNtH1nJnNKG","tenantId":"72a43d39-c8ba-4a5b-a31b-56671ccdd238","createdBy":"xKwR1cL14KFNtH1nJnNKG","ownerId":"xKwR1cL14KFNtH1nJnNKG","status":"active","archived":false,"createdAt":"2025-12-04T17:24:42.869Z","updatedAt":"2025-12-04T17:24:42.869Z"}

{"level":30,"time":1764869081951,"env":"test","module":"user-credentials-repository","userId":"X4qm6QpXfYWSOryiqdQpC","msg":"User credentials created"}
{"level":30,"time":1764869081951,"env":"test","module":"auth-routes","userId":"X4qm6QpXfYWSOryiqdQpC","email":"viewer-SmdjgUy2JLJrliA9yDW_F@example.com","msg":"User registered successfully"}
{"level":40,"time":1764869082035,"env":"test","module":"rbac-middleware","userId":"X4qm6QpXfYWSOryiqdQpC","userRole":"viewer","permission":"workflow:create","path":"/projects/6fa8584d-d082-4c98-bd42-db54ce7fb777/workflows","msg":"Permission denied"}
{"level":50,"time":1764869087729,"env":"test","error":{},"workflowId":"8640e26b-7437-459d-b6cc-576876362040","userId":"xKwR1cL14KFNtH1nJnNKG","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764869088019,"env":"test","module":"auth-middleware","path":"/api/workflows/978823a1-4d0a-47b3-a18f-3f1a5c81fd0a/move","msg":"No valid authentication found"}
{"level":30,"time":1764869088471,"env":"test","module":"user-credentials-repository","userId":"UZIMftoyIy9k3C1MV0mLW","msg":"User credentials created"}
{"level":30,"time":1764869088471,"env":"test","module":"auth-routes","userId":"UZIMftoyIy9k3C1MV0mLW","email":"test-workflows-Wd6q9f5i931KNtKnzh9Sg@example.com","msg":"User registered successfully"}
{"level":50,"time":1764869088512,"env":"test","error":{},"workflowId":"d5465fc4-d5d8-4c96-af30-5d19df862431","userId":"UZIMftoyIy9k3C1MV0mLW","projectId":"19e0e705-0aca-41bf-9875-3b1f79218b5f","msg":"Error moving workflow"}
{"level":50,"time":1764869088835,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"02763f70-2916-442b-8796-34d645b0e77a","userId":"xKwR1cL14KFNtH1nJnNKG","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764869089169,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b00ce944-241f-494e-a5b0-991408f2ea6e","userId":"xKwR1cL14KFNtH1nJnNKG","msg":"Error moving workflow"}
{"level":30,"time":1764869089645,"env":"test","module":"user-credentials-repository","userId":"XnZp5gu2o0iFBTR1KmDCt","msg":"User credentials created"}
{"level":30,"time":1764869089646,"env":"test","module":"auth-routes","userId":"XnZp5gu2o0iFBTR1KmDCt","email":"test-workflows-m9mFspKRF8LqmCXJLXlWJ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764869089827,"env":"test","module":"auth-routes","userId":"XnZp5gu2o0iFBTR1KmDCt","email":"test-workflows-m9mFspKRF8LqmCXJLXlWJ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764869090004,"env":"test","error":{},"workflowId":"8f261bfe-64de-44c1-bffa-ef594e11c331","userId":"xKwR1cL14KFNtH1nJnNKG","projectId":"66d40d55-e886-42d3-9b28-f0f21971cfec","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9298[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 426[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 417[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 548[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 674[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 668[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 419[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 493[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 835[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:24:35
[2m   Duration [22m 14.63s[2m (transform 2.04s, setup 692ms, collect 4.03s, tests 9.30s, environment 0ms, prepare 16ms)[22m

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764871633378,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871636546,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871640796,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871640796,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871640812,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871640812,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871640813,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871640813,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871641371,"env":"test","module":"user-credentials-repository","userId":"Esi1Mny-YcttefIUKGW8b","msg":"User credentials created"}
{"level":30,"time":1764871641374,"env":"test","module":"auth-routes","userId":"Esi1Mny-YcttefIUKGW8b","email":"test-workflows-TLx-kyresBvKR43pMCT9v@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"98ad0c42-e0ef-487a-a208-b3a65ec5f407","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Esi1Mny-YcttefIUKGW8b","tenantId":"6d6e9086-6f54-4224-83d1-f13d55b0d546","createdBy":"Esi1Mny-YcttefIUKGW8b","ownerId":"Esi1Mny-YcttefIUKGW8b","status":"active","archived":false,"createdAt":"2025-12-04T18:07:22.965Z","updatedAt":"2025-12-04T18:07:22.965Z"}

{"level":30,"time":1764871642173,"env":"test","module":"user-credentials-repository","userId":"nUiIJpKITAv0pk2vXqKIz","msg":"User credentials created"}
{"level":30,"time":1764871642174,"env":"test","module":"auth-routes","userId":"nUiIJpKITAv0pk2vXqKIz","email":"viewer-gr70PGSPxxeg_-xj77O4B@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871642270,"env":"test","module":"rbac-middleware","userId":"nUiIJpKITAv0pk2vXqKIz","userRole":"viewer","permission":"workflow:create","path":"/projects/98ad0c42-e0ef-487a-a208-b3a65ec5f407/workflows","msg":"Permission denied"}
{"level":50,"time":1764871648548,"env":"test","error":{},"workflowId":"2de28a53-3cb1-47f8-aefc-bb964434ce20","userId":"Esi1Mny-YcttefIUKGW8b","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871648880,"env":"test","module":"auth-middleware","path":"/api/workflows/63e79723-e11d-4593-b656-2d38d8cc002a/move","msg":"No valid authentication found"}
{"level":30,"time":1764871649398,"env":"test","module":"user-credentials-repository","userId":"bLaUgt4uez0Edr072NzXr","msg":"User credentials created"}
{"level":30,"time":1764871649399,"env":"test","module":"auth-routes","userId":"bLaUgt4uez0Edr072NzXr","email":"test-workflows-iGiGsHDPsKbL-thb2xFGy@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871649451,"env":"test","error":{},"workflowId":"c97e6339-7b4f-4f0c-b9a0-bbeda69fd90f","userId":"bLaUgt4uez0Edr072NzXr","projectId":"a356b639-496d-4ac7-947f-2cb943d0d79f","msg":"Error moving workflow"}
{"level":50,"time":1764871649860,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9ff165d6-b18f-4b2e-94ec-a8e97a8cd3d6","userId":"Esi1Mny-YcttefIUKGW8b","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871650226,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"dc50e141-1355-49c6-a006-49938fa82d27","userId":"Esi1Mny-YcttefIUKGW8b","msg":"Error moving workflow"}
{"level":30,"time":1764871650751,"env":"test","module":"user-credentials-repository","userId":"pn6VU-iy14bkRLmR3ZmcS","msg":"User credentials created"}
{"level":30,"time":1764871650752,"env":"test","module":"auth-routes","userId":"pn6VU-iy14bkRLmR3ZmcS","email":"test-workflows-uO14RcK9cGbQ34F7cXwHy@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871650946,"env":"test","module":"auth-routes","userId":"pn6VU-iy14bkRLmR3ZmcS","email":"test-workflows-uO14RcK9cGbQ34F7cXwHy@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871651132,"env":"test","error":{},"workflowId":"217b6330-ce28-4646-be20-6e1112e63eb3","userId":"Esi1Mny-YcttefIUKGW8b","projectId":"0cf9fc16-0a81-4cdd-8d33-acc00bcab2f6","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10841[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 409[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 907[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 21.75s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764871701682,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871707494,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871710188,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871710189,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871710203,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871710203,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871710204,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871710204,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871710678,"env":"test","module":"user-credentials-repository","userId":"_fJEk7MQqfZE87dlj1rDm","msg":"User credentials created"}
{"level":30,"time":1764871710683,"env":"test","module":"auth-routes","userId":"_fJEk7MQqfZE87dlj1rDm","email":"test-workflows-lDr9Yth4jFyCawyyvdgGx@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"5aafc976-c6be-49eb-b3c6-bb4ca740eb25","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"_fJEk7MQqfZE87dlj1rDm","tenantId":"68f41578-b90d-490e-b155-df14d91e67ee","createdBy":"_fJEk7MQqfZE87dlj1rDm","ownerId":"_fJEk7MQqfZE87dlj1rDm","status":"active","archived":false,"createdAt":"2025-12-04T18:08:32.274Z","updatedAt":"2025-12-04T18:08:32.274Z"}

{"level":30,"time":1764871711383,"env":"test","module":"user-credentials-repository","userId":"l2SeDFmz4m0SaY_D82mNo","msg":"User credentials created"}
{"level":30,"time":1764871711384,"env":"test","module":"auth-routes","userId":"l2SeDFmz4m0SaY_D82mNo","email":"viewer-kNKJvunhH6LV3xuh7avXv@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871711481,"env":"test","module":"rbac-middleware","userId":"l2SeDFmz4m0SaY_D82mNo","userRole":"viewer","permission":"workflow:create","path":"/projects/5aafc976-c6be-49eb-b3c6-bb4ca740eb25/workflows","msg":"Permission denied"}
{"level":50,"time":1764871717892,"env":"test","error":{},"workflowId":"028c3142-ff94-4ebf-9b9b-30b9cf67f312","userId":"_fJEk7MQqfZE87dlj1rDm","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871718244,"env":"test","module":"auth-middleware","path":"/api/workflows/d3b69987-e3ee-4bdc-a3c3-f86b1eef194f/move","msg":"No valid authentication found"}
{"level":30,"time":1764871718767,"env":"test","module":"user-credentials-repository","userId":"KfThYukTaeetMGlbbE3Ov","msg":"User credentials created"}
{"level":30,"time":1764871718768,"env":"test","module":"auth-routes","userId":"KfThYukTaeetMGlbbE3Ov","email":"test-workflows-8EkxMNgyfLn3q7Rhkf7Kd@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871718821,"env":"test","error":{},"workflowId":"7832d04f-c192-4788-8322-29b1ebd7ffd9","userId":"KfThYukTaeetMGlbbE3Ov","projectId":"518e52d8-3b31-4caf-841d-498adf4a4f86","msg":"Error moving workflow"}
{"level":50,"time":1764871719204,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"529f9542-0d9c-4212-b52d-6e5b1eec5874","userId":"_fJEk7MQqfZE87dlj1rDm","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871719582,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"db17a756-e3ca-409a-9493-09e672ca13de","userId":"_fJEk7MQqfZE87dlj1rDm","msg":"Error moving workflow"}
{"level":50,"time":1764871719772,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_fJEk7MQqfZE87dlj1rDm) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_fJEk7MQqfZE87dlj1rDm","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9864[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 663[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 807[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 191[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 21.56s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764871754240,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871756751,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871759987,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871759987,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871759999,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871759999,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871759999,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871759999,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871760471,"env":"test","module":"user-credentials-repository","userId":"0DAbnDjIRV8fpFVZf0Hvq","msg":"User credentials created"}
{"level":30,"time":1764871760475,"env":"test","module":"auth-routes","userId":"0DAbnDjIRV8fpFVZf0Hvq","email":"test-workflows-Y1U3wzPN5CJxKO7jOigkC@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"49a29598-f13d-4215-b4bc-50a35313540f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"0DAbnDjIRV8fpFVZf0Hvq","tenantId":"cf526f25-9a41-4772-acc4-dd849f70a884","createdBy":"0DAbnDjIRV8fpFVZf0Hvq","ownerId":"0DAbnDjIRV8fpFVZf0Hvq","status":"active","archived":false,"createdAt":"2025-12-04T18:09:22.070Z","updatedAt":"2025-12-04T18:09:22.070Z"}

{"level":30,"time":1764871761188,"env":"test","module":"user-credentials-repository","userId":"12Q5OwGb0NI1LoWeLtXub","msg":"User credentials created"}
{"level":30,"time":1764871761188,"env":"test","module":"auth-routes","userId":"12Q5OwGb0NI1LoWeLtXub","email":"viewer-91T7y5v_bB8Ut9SiyPs4Z@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871761290,"env":"test","module":"rbac-middleware","userId":"12Q5OwGb0NI1LoWeLtXub","userRole":"viewer","permission":"workflow:create","path":"/projects/49a29598-f13d-4215-b4bc-50a35313540f/workflows","msg":"Permission denied"}
{"level":50,"time":1764871767711,"env":"test","error":{},"workflowId":"fcdcf30e-c9f4-46bb-a531-574c670a86ac","userId":"0DAbnDjIRV8fpFVZf0Hvq","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871768049,"env":"test","module":"auth-middleware","path":"/api/workflows/13b0a740-5a3a-4780-96ab-30a9a25f1474/move","msg":"No valid authentication found"}
{"level":30,"time":1764871768563,"env":"test","module":"user-credentials-repository","userId":"mxAZl8ZMD_jaxj5qGOKxq","msg":"User credentials created"}
{"level":30,"time":1764871768564,"env":"test","module":"auth-routes","userId":"mxAZl8ZMD_jaxj5qGOKxq","email":"test-workflows-6CmP329RGvDuu1sJfB7Bh@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871768614,"env":"test","error":{},"workflowId":"d133265a-6451-4f90-8938-3bf0f893b9ea","userId":"mxAZl8ZMD_jaxj5qGOKxq","projectId":"2d3b5901-eda2-406f-b7b1-0e882865bcee","msg":"Error moving workflow"}
{"level":50,"time":1764871768991,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"794b2f21-816b-4909-99e1-702aa6efb638","userId":"0DAbnDjIRV8fpFVZf0Hvq","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871769361,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b8277225-3849-4225-8a40-b16144d73e41","userId":"0DAbnDjIRV8fpFVZf0Hvq","msg":"Error moving workflow"}
{"level":30,"time":1764871769895,"env":"test","module":"user-credentials-repository","userId":"Yf1p78rUVlXRGKa_6As5T","msg":"User credentials created"}
{"level":30,"time":1764871769896,"env":"test","module":"auth-routes","userId":"Yf1p78rUVlXRGKa_6As5T","email":"test-workflows-7sWsKH28bx2rXFih3z3ZY@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871770106,"env":"test","module":"auth-routes","userId":"Yf1p78rUVlXRGKa_6As5T","email":"test-workflows-7sWsKH28bx2rXFih3z3ZY@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871770309,"env":"test","error":{},"workflowId":"468d53f2-bb48-43a8-b388-e06e070c7df8","userId":"0DAbnDjIRV8fpFVZf0Hvq","projectId":"b7969b36-da76-4db7-bbbb-f365a22b04b5","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 491[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 810[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 762[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 659[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 565[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 377[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 950[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 21.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764873690265,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873693762,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873697284,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873697285,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873697296,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873697296,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873697296,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873697296,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873697790,"env":"test","module":"user-credentials-repository","userId":"dBBfaq2lAeFLML94cDO_r","msg":"User credentials created"}
{"level":30,"time":1764873697795,"env":"test","module":"auth-routes","userId":"dBBfaq2lAeFLML94cDO_r","email":"test-workflows-p5QWCHTYT8qp-mkT7nQ0u@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"28582e1e-6bbf-4b07-a1bf-79658cc2ff8b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"dBBfaq2lAeFLML94cDO_r","tenantId":"bd85a55a-6432-4b4f-81e3-097c8f305de9","createdBy":"dBBfaq2lAeFLML94cDO_r","ownerId":"dBBfaq2lAeFLML94cDO_r","status":"active","archived":false,"createdAt":"2025-12-04T18:41:39.419Z","updatedAt":"2025-12-04T18:41:39.419Z"}

{"level":30,"time":1764873698498,"env":"test","module":"user-credentials-repository","userId":"8W9EoopgnrbLHJNN8EsO9","msg":"User credentials created"}
{"level":30,"time":1764873698499,"env":"test","module":"auth-routes","userId":"8W9EoopgnrbLHJNN8EsO9","email":"viewer-QniSKD2Y5i0vJaPFD3Z0z@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873698596,"env":"test","module":"rbac-middleware","userId":"8W9EoopgnrbLHJNN8EsO9","userRole":"viewer","permission":"workflow:create","path":"/projects/28582e1e-6bbf-4b07-a1bf-79658cc2ff8b/workflows","msg":"Permission denied"}
{"level":50,"time":1764873704944,"env":"test","error":{},"workflowId":"b12ba3ef-a8e2-4213-8d6c-a268477929ba","userId":"dBBfaq2lAeFLML94cDO_r","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873705269,"env":"test","module":"auth-middleware","path":"/api/workflows/9fefe311-092c-445b-98af-8065a7d3b87f/move","msg":"No valid authentication found"}
{"level":30,"time":1764873705779,"env":"test","module":"user-credentials-repository","userId":"VK9ZCzj0Q7OwvCXYUIiuq","msg":"User credentials created"}
{"level":30,"time":1764873705780,"env":"test","module":"auth-routes","userId":"VK9ZCzj0Q7OwvCXYUIiuq","email":"test-workflows-zkfs34cOupCYge1gnEabm@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873705827,"env":"test","error":{},"workflowId":"2277adbc-e879-4f42-b6d3-b71169d64ce0","userId":"VK9ZCzj0Q7OwvCXYUIiuq","projectId":"545c73b7-1d5d-4dc7-9748-50784f1adba5","msg":"Error moving workflow"}
{"level":50,"time":1764873706195,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"62257180-7aed-4562-a83f-d80035f39596","userId":"dBBfaq2lAeFLML94cDO_r","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873706568,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"cf8d4405-e88e-4822-9012-d422d14fa65d","userId":"dBBfaq2lAeFLML94cDO_r","msg":"Error moving workflow"}
{"level":30,"time":1764873707077,"env":"test","module":"user-credentials-repository","userId":"CWwwWsjIkaUw4ZD491QOr","msg":"User credentials created"}
{"level":30,"time":1764873707078,"env":"test","module":"auth-routes","userId":"CWwwWsjIkaUw4ZD491QOr","email":"test-workflows-Zqx7hJ_wPKIM1Ri-n4iM6@example.com","msg":"User registered successfully"}
{"level":30,"time":1764873707292,"env":"test","module":"auth-routes","userId":"CWwwWsjIkaUw4ZD491QOr","email":"test-workflows-Zqx7hJ_wPKIM1Ri-n4iM6@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764873707499,"env":"test","error":{},"workflowId":"4d8316e9-b15d-4779-a5f3-f6134b11f914","userId":"dBBfaq2lAeFLML94cDO_r","projectId":"2c7f394c-dca1-4f96-ac56-51c78c571870","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 649[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 612[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 823[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 373[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 933[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 21.95s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764874580006,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874585487,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874591750,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874591750,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874591765,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874591765,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874591766,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874591766,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874592312,"env":"test","module":"user-credentials-repository","userId":"mhFBFme67WBG2zexhPfVX","msg":"User credentials created"}
{"level":30,"time":1764874592315,"env":"test","module":"auth-routes","userId":"mhFBFme67WBG2zexhPfVX","email":"test-workflows-KlP6wu-NbdCuJZULEBO99@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e249ca32-31b5-4302-9f00-9ec3a3d77d3e","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"mhFBFme67WBG2zexhPfVX","tenantId":"f90e1061-e817-4092-8621-e6aa16092c4a","createdBy":"mhFBFme67WBG2zexhPfVX","ownerId":"mhFBFme67WBG2zexhPfVX","status":"active","archived":false,"createdAt":"2025-12-04T18:56:33.944Z","updatedAt":"2025-12-04T18:56:33.944Z"}

{"level":30,"time":1764874593042,"env":"test","module":"user-credentials-repository","userId":"GkBZe6q6BCmQ0D_BWc3qZ","msg":"User credentials created"}
{"level":30,"time":1764874593043,"env":"test","module":"auth-routes","userId":"GkBZe6q6BCmQ0D_BWc3qZ","email":"viewer-XBebuKRQlqSIbW13kxFnQ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874593142,"env":"test","module":"rbac-middleware","userId":"GkBZe6q6BCmQ0D_BWc3qZ","userRole":"viewer","permission":"workflow:create","path":"/projects/e249ca32-31b5-4302-9f00-9ec3a3d77d3e/workflows","msg":"Permission denied"}
{"level":50,"time":1764874599697,"env":"test","error":{},"workflowId":"e3de385e-d4db-4a45-8112-1f714958ba41","userId":"mhFBFme67WBG2zexhPfVX","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874600046,"env":"test","module":"auth-middleware","path":"/api/workflows/9f30a8a0-1f78-4866-82a3-ada139ae6373/move","msg":"No valid authentication found"}
{"level":30,"time":1764874600588,"env":"test","module":"user-credentials-repository","userId":"UFcJAwrnSySOfxFoN3AMT","msg":"User credentials created"}
{"level":30,"time":1764874600589,"env":"test","module":"auth-routes","userId":"UFcJAwrnSySOfxFoN3AMT","email":"test-workflows-FWlvDVd7eItaRzOO5O5do@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874600637,"env":"test","error":{},"workflowId":"958ba27d-f22f-4e3b-95f0-99b38355baf2","userId":"UFcJAwrnSySOfxFoN3AMT","projectId":"9407ff6e-24b1-4c1e-9365-7d6be915a03a","msg":"Error moving workflow"}
{"level":50,"time":1764874601036,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"a87795c7-1a69-492e-b527-6cdb45e9f50a","userId":"mhFBFme67WBG2zexhPfVX","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874601440,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9b0c2924-e01d-4705-921f-9366d1574832","userId":"mhFBFme67WBG2zexhPfVX","msg":"Error moving workflow"}
{"level":30,"time":1764874601957,"env":"test","module":"user-credentials-repository","userId":"6zS2jFRQpSYz3Ds-vvz9l","msg":"User credentials created"}
{"level":30,"time":1764874601958,"env":"test","module":"auth-routes","userId":"6zS2jFRQpSYz3Ds-vvz9l","email":"test-workflows-U7xG2gWa7gdam6TQi4Bf0@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874602157,"env":"test","module":"auth-routes","userId":"6zS2jFRQpSYz3Ds-vvz9l","email":"test-workflows-U7xG2gWa7gdam6TQi4Bf0@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874602391,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a3db0e48-6ff2-40dd-be6a-dc7284a75d94","userId":"mhFBFme67WBG2zexhPfVX","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10923[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 848[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 764[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 399[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 403[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 952[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.16s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764874687612,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874692903,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874698233,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874698233,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874698245,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874698245,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874698246,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874698246,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874698722,"env":"test","module":"user-credentials-repository","userId":"PaRSm6h16uWjmHt2kjY2I","msg":"User credentials created"}
{"level":30,"time":1764874698726,"env":"test","module":"auth-routes","userId":"PaRSm6h16uWjmHt2kjY2I","email":"test-workflows-vKkJNlm95PHOvj4pfnCWB@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e218b90d-fbaf-45ef-a9fb-3cea01929a5a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"PaRSm6h16uWjmHt2kjY2I","tenantId":"46c02828-9f27-4607-8f03-9100b2d4e424","createdBy":"PaRSm6h16uWjmHt2kjY2I","ownerId":"PaRSm6h16uWjmHt2kjY2I","status":"active","archived":false,"createdAt":"2025-12-04T18:58:20.355Z","updatedAt":"2025-12-04T18:58:20.355Z"}

{"level":30,"time":1764874699420,"env":"test","module":"user-credentials-repository","userId":"jHgmcIn8hykR7Ma_95BKa","msg":"User credentials created"}
{"level":30,"time":1764874699421,"env":"test","module":"auth-routes","userId":"jHgmcIn8hykR7Ma_95BKa","email":"viewer-wKBURgizU90m0uOI5xX5d@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874699523,"env":"test","module":"rbac-middleware","userId":"jHgmcIn8hykR7Ma_95BKa","userRole":"viewer","permission":"workflow:create","path":"/projects/e218b90d-fbaf-45ef-a9fb-3cea01929a5a/workflows","msg":"Permission denied"}
{"level":50,"time":1764874705989,"env":"test","error":{},"workflowId":"261016e9-b86d-45ac-9139-748863586011","userId":"PaRSm6h16uWjmHt2kjY2I","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874706322,"env":"test","module":"auth-middleware","path":"/api/workflows/0383340e-961a-4c77-aaa0-1c5c5e3f6a7c/move","msg":"No valid authentication found"}
{"level":30,"time":1764874706873,"env":"test","module":"user-credentials-repository","userId":"KzfMrO3J5HQ0txjq0aJ2f","msg":"User credentials created"}
{"level":30,"time":1764874706875,"env":"test","module":"auth-routes","userId":"KzfMrO3J5HQ0txjq0aJ2f","email":"test-workflows-QxkbwubF7v7r1HTfZQWty@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874706931,"env":"test","error":{},"workflowId":"0f9932ca-69e9-41ca-9ebf-01f208809cfb","userId":"KzfMrO3J5HQ0txjq0aJ2f","projectId":"ca7e76c2-0131-4adc-823b-2c02ad11e984","msg":"Error moving workflow"}
{"level":50,"time":1764874707315,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6a8dea8b-f8f5-4f64-afed-af608fab0709","userId":"PaRSm6h16uWjmHt2kjY2I","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874707676,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"51fbc268-5b48-4fb5-bb3f-24e530f79354","userId":"PaRSm6h16uWjmHt2kjY2I","msg":"Error moving workflow"}
{"level":50,"time":1764874707870,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(PaRSm6h16uWjmHt2kjY2I) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"PaRSm6h16uWjmHt2kjY2I","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9913[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 804[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 361[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 195[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 27.26s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764876565136,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876570213,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876575090,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876575091,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876575105,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876575105,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876575105,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876575105,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876575630,"env":"test","module":"user-credentials-repository","userId":"ey15yXBW-9G8zyzz0auJI","msg":"User credentials created"}
{"level":30,"time":1764876575634,"env":"test","module":"auth-routes","userId":"ey15yXBW-9G8zyzz0auJI","email":"test-workflows-91IuICX5_ODxNTPQxL7YB@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"26a0b501-facd-4804-b257-dbdc7a9edb33","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ey15yXBW-9G8zyzz0auJI","tenantId":"4c7f180d-b02f-4401-b7f7-ee2f782dbe73","createdBy":"ey15yXBW-9G8zyzz0auJI","ownerId":"ey15yXBW-9G8zyzz0auJI","status":"active","archived":false,"createdAt":"2025-12-04T19:29:37.292Z","updatedAt":"2025-12-04T19:29:37.292Z"}

{"level":30,"time":1764876576300,"env":"test","module":"user-credentials-repository","userId":"B7ecMNoSilgEUMGhjO7wf","msg":"User credentials created"}
{"level":30,"time":1764876576301,"env":"test","module":"auth-routes","userId":"B7ecMNoSilgEUMGhjO7wf","email":"viewer-MGUERzF6LfgEJ00Db5H14@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876576392,"env":"test","module":"rbac-middleware","userId":"B7ecMNoSilgEUMGhjO7wf","userRole":"viewer","permission":"workflow:create","path":"/projects/26a0b501-facd-4804-b257-dbdc7a9edb33/workflows","msg":"Permission denied"}
{"level":50,"time":1764876582466,"env":"test","error":{},"workflowId":"79ba0fab-ca73-4c8a-b77a-7b92b0b36676","userId":"ey15yXBW-9G8zyzz0auJI","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876582787,"env":"test","module":"auth-middleware","path":"/api/workflows/cdf4a424-5c0a-45b0-a972-863aaad50a59/move","msg":"No valid authentication found"}
{"level":30,"time":1764876583280,"env":"test","module":"user-credentials-repository","userId":"FXh_pGpI6D5OPXbAqHYx2","msg":"User credentials created"}
{"level":30,"time":1764876583281,"env":"test","module":"auth-routes","userId":"FXh_pGpI6D5OPXbAqHYx2","email":"test-workflows-DTtR9swGp_ftCznlbrB7t@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876583325,"env":"test","error":{},"workflowId":"83c519f9-d697-46cf-9367-f0a4ed88aa8c","userId":"FXh_pGpI6D5OPXbAqHYx2","projectId":"5b71dc5b-4382-42d8-b542-d326041ff606","msg":"Error moving workflow"}
{"level":50,"time":1764876583673,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"226a1f97-be4e-41c6-8a3c-a0ab5ff75f56","userId":"ey15yXBW-9G8zyzz0auJI","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876584025,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"837d35ac-7b14-4a25-8e20-119db86f292c","userId":"ey15yXBW-9G8zyzz0auJI","msg":"Error moving workflow"}
{"level":50,"time":1764876585628,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(VM3vELxVqWDX8rmgQglsV) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"VM3vELxVqWDX8rmgQglsV","msg":"Failed to create user credentials"}
{"level":50,"time":1764876585629,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(VM3vELxVqWDX8rmgQglsV) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10925[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 279[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 726[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 719[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 352[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1605[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:29:20
[2m   Duration [22m 24.52s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764876645298,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876649270,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876653585,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876653586,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876653597,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876653597,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876653597,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876653597,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876654112,"env":"test","module":"user-credentials-repository","userId":"fdNwPqZKVursYJ3lVSYcr","msg":"User credentials created"}
{"level":30,"time":1764876654116,"env":"test","module":"auth-routes","userId":"fdNwPqZKVursYJ3lVSYcr","email":"test-workflows-TYLrX2um1b4bCqPqQuGAK@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"ab6c3483-176c-40bd-a48c-f3a86fb01486","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"fdNwPqZKVursYJ3lVSYcr","tenantId":"f3ee4908-7c16-48d5-88a3-ea475c468480","createdBy":"fdNwPqZKVursYJ3lVSYcr","ownerId":"fdNwPqZKVursYJ3lVSYcr","status":"active","archived":false,"createdAt":"2025-12-04T19:30:55.786Z","updatedAt":"2025-12-04T19:30:55.786Z"}

{"level":30,"time":1764876655083,"env":"test","module":"user-credentials-repository","userId":"PMtCPW3DTglcH1V0YUGfX","msg":"User credentials created"}
{"level":30,"time":1764876655084,"env":"test","module":"auth-routes","userId":"PMtCPW3DTglcH1V0YUGfX","email":"viewer-sO25yXNRHPrjXCLkAMN-Q@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876655172,"env":"test","module":"rbac-middleware","userId":"PMtCPW3DTglcH1V0YUGfX","userRole":"viewer","permission":"workflow:create","path":"/projects/ab6c3483-176c-40bd-a48c-f3a86fb01486/workflows","msg":"Permission denied"}
{"level":50,"time":1764876661497,"env":"test","error":{},"workflowId":"b96c2ded-2f00-4e18-b178-43595ff16f2e","userId":"fdNwPqZKVursYJ3lVSYcr","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876661807,"env":"test","module":"auth-middleware","path":"/api/workflows/8d1948e8-44d4-4ceb-9a29-376767414e96/move","msg":"No valid authentication found"}
{"level":30,"time":1764876662298,"env":"test","module":"user-credentials-repository","userId":"e17c1qDf1JB_1bKdo4J4-","msg":"User credentials created"}
{"level":30,"time":1764876662299,"env":"test","module":"auth-routes","userId":"e17c1qDf1JB_1bKdo4J4-","email":"test-workflows-ArBiKD6qmE1OgYCiwHAdb@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876662349,"env":"test","error":{},"workflowId":"bfd55391-1199-435e-911b-cd062310e37b","userId":"e17c1qDf1JB_1bKdo4J4-","projectId":"0957ea29-0555-4d13-99ff-c9cd3499233e","msg":"Error moving workflow"}
{"level":50,"time":1764876662705,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8f379320-427c-4d42-86ed-c98676b98409","userId":"fdNwPqZKVursYJ3lVSYcr","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876663071,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bac69397-5536-4d0b-89bd-007b104e6bee","userId":"fdNwPqZKVursYJ3lVSYcr","msg":"Error moving workflow"}
{"level":30,"time":1764876663553,"env":"test","module":"user-credentials-repository","userId":"67AimbT-n9OAiqik9PBqj","msg":"User credentials created"}
{"level":30,"time":1764876663553,"env":"test","module":"auth-routes","userId":"67AimbT-n9OAiqik9PBqj","email":"test-workflows-TfpRYQ1F0qCIi0RN2QQ9H@example.com","msg":"User registered successfully"}
{"level":30,"time":1764876663732,"env":"test","module":"auth-routes","userId":"67AimbT-n9OAiqik9PBqj","email":"test-workflows-TfpRYQ1F0qCIi0RN2QQ9H@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764876663911,"env":"test","error":{},"workflowId":"1cf94629-3d09-465e-bdb9-f6c6fab5e163","userId":"fdNwPqZKVursYJ3lVSYcr","projectId":"64f42220-4722-4424-8db9-1695fecffbdf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10959[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 422[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 835[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 542[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 842[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:30:40
[2m   Duration [22m 22.58s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764877227532,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877230533,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877235381,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877235382,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877235395,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877235395,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877235396,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877235396,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877236000,"env":"test","module":"user-credentials-repository","userId":"p2B8uTbJN9CX5PePCtckk","msg":"User credentials created"}
{"level":30,"time":1764877236003,"env":"test","module":"auth-routes","userId":"p2B8uTbJN9CX5PePCtckk","email":"test-workflows-A-z_-VZ6_B1ESI1PBnyWJ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"29066827-c6b0-42a4-80d6-b3efca131e46","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"p2B8uTbJN9CX5PePCtckk","tenantId":"9dc0dc8e-90f7-468f-93d2-8c3815367222","createdBy":"p2B8uTbJN9CX5PePCtckk","ownerId":"p2B8uTbJN9CX5PePCtckk","status":"active","archived":false,"createdAt":"2025-12-04T19:40:37.670Z","updatedAt":"2025-12-04T19:40:37.670Z"}

{"level":30,"time":1764877236743,"env":"test","module":"user-credentials-repository","userId":"j1N3qW7swgUXG2r8CC8H-","msg":"User credentials created"}
{"level":30,"time":1764877236744,"env":"test","module":"auth-routes","userId":"j1N3qW7swgUXG2r8CC8H-","email":"viewer-KBfUQcsvfwxnI_bOgYgHk@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877236831,"env":"test","module":"rbac-middleware","userId":"j1N3qW7swgUXG2r8CC8H-","userRole":"viewer","permission":"workflow:create","path":"/projects/29066827-c6b0-42a4-80d6-b3efca131e46/workflows","msg":"Permission denied"}
{"level":50,"time":1764877242933,"env":"test","error":{},"workflowId":"b2fa1840-a588-4bcd-9434-4cdeaddc4eb4","userId":"p2B8uTbJN9CX5PePCtckk","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877243242,"env":"test","module":"auth-middleware","path":"/api/workflows/fd591ed7-4b2d-438d-b7ad-db501ccd0990/move","msg":"No valid authentication found"}
{"level":30,"time":1764877243740,"env":"test","module":"user-credentials-repository","userId":"HGEA288dVUjtnFRLmeVym","msg":"User credentials created"}
{"level":30,"time":1764877243740,"env":"test","module":"auth-routes","userId":"HGEA288dVUjtnFRLmeVym","email":"test-workflows-aNhXC8XoWTKbU8jJAEeUW@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877243794,"env":"test","error":{},"workflowId":"2601e7cc-5f68-4978-b8ae-96b550aae726","userId":"HGEA288dVUjtnFRLmeVym","projectId":"f2ec4a8d-bcf1-4d33-9f15-be6f0a6a1ffd","msg":"Error moving workflow"}
{"level":50,"time":1764877244150,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"107f07e8-afdc-4a6b-a123-40729c1809b8","userId":"p2B8uTbJN9CX5PePCtckk","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877244504,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8fa408e8-9ea8-4134-94da-0d0e3cc080b0","userId":"p2B8uTbJN9CX5PePCtckk","msg":"Error moving workflow"}
{"level":30,"time":1764877245009,"env":"test","module":"user-credentials-repository","userId":"MmX4ebgPVj-RJtiHijK-f","msg":"User credentials created"}
{"level":30,"time":1764877245010,"env":"test","module":"auth-routes","userId":"MmX4ebgPVj-RJtiHijK-f","email":"test-workflows-k-0LKVvlbaZUaBXIuVe-f@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877245210,"env":"test","module":"auth-routes","userId":"MmX4ebgPVj-RJtiHijK-f","email":"test-workflows-k-0LKVvlbaZUaBXIuVe-f@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877245382,"env":"test","error":{},"workflowId":"2ef34160-d3cd-4042-8b21-2c14520bda1f","userId":"p2B8uTbJN9CX5PePCtckk","projectId":"80271960-45ec-4934-a1db-0ba9962a42e7","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10260[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 659[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 357[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 353[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 880[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:40:22
[2m   Duration [22m 22.33s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/googleAuth.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764877488887,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877492218,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877497179,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877497180,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877497197,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877497197,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877497198,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877497198,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877497829,"env":"test","module":"user-credentials-repository","userId":"fPeAGJpoP0SH-DEE-i0t4","msg":"User credentials created"}
{"level":30,"time":1764877497832,"env":"test","module":"auth-routes","userId":"fPeAGJpoP0SH-DEE-i0t4","email":"test-workflows-ClOUyleaOmqUNEZvGoGdZ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"28097743-5ec3-4861-90a4-01b48d2d0e52","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"fPeAGJpoP0SH-DEE-i0t4","tenantId":"6894c132-9e83-4a42-95ff-eccae6f52a3e","createdBy":"fPeAGJpoP0SH-DEE-i0t4","ownerId":"fPeAGJpoP0SH-DEE-i0t4","status":"active","archived":false,"createdAt":"2025-12-04T19:44:59.510Z","updatedAt":"2025-12-04T19:44:59.510Z"}

{"level":30,"time":1764877498564,"env":"test","module":"user-credentials-repository","userId":"sGTTJt0de61_EB_0SM00g","msg":"User credentials created"}
{"level":30,"time":1764877498564,"env":"test","module":"auth-routes","userId":"sGTTJt0de61_EB_0SM00g","email":"viewer-cEOUGrTKryUjzDPqsISQ6@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877498660,"env":"test","module":"rbac-middleware","userId":"sGTTJt0de61_EB_0SM00g","userRole":"viewer","permission":"workflow:create","path":"/projects/28097743-5ec3-4861-90a4-01b48d2d0e52/workflows","msg":"Permission denied"}
{"level":50,"time":1764877505103,"env":"test","error":{},"workflowId":"c8c18fe0-7845-4993-88ce-dc0f5b95e3ee","userId":"fPeAGJpoP0SH-DEE-i0t4","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877505430,"env":"test","module":"auth-middleware","path":"/api/workflows/b3589b95-5f96-4823-bf3b-fa3788c91de6/move","msg":"No valid authentication found"}
{"level":30,"time":1764877505949,"env":"test","module":"user-credentials-repository","userId":"deB26fWGCJwX9DnqGfRMm","msg":"User credentials created"}
{"level":30,"time":1764877505949,"env":"test","module":"auth-routes","userId":"deB26fWGCJwX9DnqGfRMm","email":"test-workflows-8WUyuQr17X-y5JN-SYs0C@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877506000,"env":"test","error":{},"workflowId":"246ecd14-7f7c-4755-b70e-7c90bb84c6f9","userId":"deB26fWGCJwX9DnqGfRMm","projectId":"38e1649f-4969-4713-b637-d29ae98be549","msg":"Error moving workflow"}
{"level":50,"time":1764877506371,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"05daa438-ba6f-4048-af38-99e8066d57e2","userId":"fPeAGJpoP0SH-DEE-i0t4","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877506741,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d97ac2d8-4758-4343-95f4-f01af40940d7","userId":"fPeAGJpoP0SH-DEE-i0t4","msg":"Error moving workflow"}
{"level":30,"time":1764877507260,"env":"test","module":"user-credentials-repository","userId":"X3Hn-OK9rByB50I95EiC3","msg":"User credentials created"}
{"level":30,"time":1764877507260,"env":"test","module":"auth-routes","userId":"X3Hn-OK9rByB50I95EiC3","email":"test-workflows-wkJtE2M4nFNpbliwM9DpF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877507363,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764877507410,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"500b09b1-f848-4072-8ff9-eb381ef000cc","userId":"fPeAGJpoP0SH-DEE-i0t4","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10520[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 668[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 807[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 588[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 784[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 569[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 372[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 671[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:44:44
[2m   Duration [22m 22.28s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764877822521,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877826154,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877830166,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877830166,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877830198,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877830198,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877830198,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877830199,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877830683,"env":"test","module":"user-credentials-repository","userId":"PtS2KEhwi9WbknygyNvo4","msg":"User credentials created"}
{"level":30,"time":1764877830686,"env":"test","module":"auth-routes","userId":"PtS2KEhwi9WbknygyNvo4","email":"test-workflows-ZgkRjWJEDbrYNFurtyPEm@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"44931d76-b312-447e-8622-7937b2cd776d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"PtS2KEhwi9WbknygyNvo4","tenantId":"11455be8-6cae-4ae2-86d0-665921d081fa","createdBy":"PtS2KEhwi9WbknygyNvo4","ownerId":"PtS2KEhwi9WbknygyNvo4","status":"active","archived":false,"createdAt":"2025-12-04T19:50:32.370Z","updatedAt":"2025-12-04T19:50:32.370Z"}

{"level":30,"time":1764877831354,"env":"test","module":"user-credentials-repository","userId":"dof1lvmSa4OEGJfO6jB1P","msg":"User credentials created"}
{"level":30,"time":1764877831355,"env":"test","module":"auth-routes","userId":"dof1lvmSa4OEGJfO6jB1P","email":"viewer-Wn3on_2Fr5DHHm-v-yrOl@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877831442,"env":"test","module":"rbac-middleware","userId":"dof1lvmSa4OEGJfO6jB1P","userRole":"viewer","permission":"workflow:create","path":"/projects/44931d76-b312-447e-8622-7937b2cd776d/workflows","msg":"Permission denied"}
{"level":50,"time":1764877837276,"env":"test","error":{},"workflowId":"37bf0585-5b32-4d0e-97b6-d3a06489b568","userId":"PtS2KEhwi9WbknygyNvo4","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877837606,"env":"test","module":"auth-middleware","path":"/api/workflows/a5fa5851-ec76-4ad6-8ec5-bf3449090a9c/move","msg":"No valid authentication found"}
{"level":30,"time":1764877838131,"env":"test","module":"user-credentials-repository","userId":"h1Phs2xn9DTMKr2bz-cST","msg":"User credentials created"}
{"level":30,"time":1764877838132,"env":"test","module":"auth-routes","userId":"h1Phs2xn9DTMKr2bz-cST","email":"test-workflows-vPJZ4TUbyCVwzMizW6adf@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877838181,"env":"test","error":{},"workflowId":"44b86155-daee-4c52-8b78-ea69b8678c39","userId":"h1Phs2xn9DTMKr2bz-cST","projectId":"5e3e34d8-903e-46f8-a08d-5c181dde59aa","msg":"Error moving workflow"}
{"level":50,"time":1764877838552,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b4d897e6-ecd5-43b0-8117-7b65d837f371","userId":"PtS2KEhwi9WbknygyNvo4","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877838904,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e1853532-7c76-4bcd-b3a7-ba2d787cf0e1","userId":"PtS2KEhwi9WbknygyNvo4","msg":"Error moving workflow"}
{"level":30,"time":1764877839412,"env":"test","module":"user-credentials-repository","userId":"oFrfgMeHSfQEit2ihlL_Q","msg":"User credentials created"}
{"level":30,"time":1764877839413,"env":"test","module":"auth-routes","userId":"oFrfgMeHSfQEit2ihlL_Q","email":"test-workflows-tnHYggWThr553IVYyR4yE@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877839608,"env":"test","module":"auth-routes","userId":"oFrfgMeHSfQEit2ihlL_Q","email":"test-workflows-tnHYggWThr553IVYyR4yE@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877839800,"env":"test","error":{},"workflowId":"fc3a079d-249e-4e42-aa4b-4e591a7a2d7a","userId":"PtS2KEhwi9WbknygyNvo4","projectId":"cb357aca-88db-40fb-af1c-c0ef64ff6553","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9932[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 276[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 530[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 679[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 545[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 444[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 352[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 898[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:18
[2m   Duration [22m 21.17s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764877845571,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877848274,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877850650,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877850650,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877850661,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877850662,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877850663,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877850663,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877851157,"env":"test","module":"user-credentials-repository","userId":"vIlhi2JQiFJj7azEO885l","msg":"User credentials created"}
{"level":30,"time":1764877851160,"env":"test","module":"auth-routes","userId":"vIlhi2JQiFJj7azEO885l","email":"test-workflows-DONOUIUVgSGf5aK0bzPsG@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"da58f37a-a0c5-41f4-8c3c-70072ee80bc3","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"vIlhi2JQiFJj7azEO885l","tenantId":"d08ddf5c-68c2-430a-abbd-6db155c3e300","createdBy":"vIlhi2JQiFJj7azEO885l","ownerId":"vIlhi2JQiFJj7azEO885l","status":"active","archived":false,"createdAt":"2025-12-04T19:50:52.852Z","updatedAt":"2025-12-04T19:50:52.852Z"}

{"level":30,"time":1764877851906,"env":"test","module":"user-credentials-repository","userId":"wb0j68BtUJM6kse1SBMxY","msg":"User credentials created"}
{"level":30,"time":1764877851907,"env":"test","module":"auth-routes","userId":"wb0j68BtUJM6kse1SBMxY","email":"viewer-qpYmjzRYSUwV-lrt-_ZCx@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877852005,"env":"test","module":"rbac-middleware","userId":"wb0j68BtUJM6kse1SBMxY","userRole":"viewer","permission":"workflow:create","path":"/projects/da58f37a-a0c5-41f4-8c3c-70072ee80bc3/workflows","msg":"Permission denied"}
{"level":50,"time":1764877858608,"env":"test","error":{},"workflowId":"0ef4e91c-5fc3-4798-8f58-a9753bb2145c","userId":"vIlhi2JQiFJj7azEO885l","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877859086,"env":"test","module":"auth-middleware","path":"/api/workflows/8215be0b-dafd-4e97-b119-de55b3061496/move","msg":"No valid authentication found"}
{"level":30,"time":1764877859732,"env":"test","module":"user-credentials-repository","userId":"4xtJjhNQIgdDc7W1ux0ct","msg":"User credentials created"}
{"level":30,"time":1764877859733,"env":"test","module":"auth-routes","userId":"4xtJjhNQIgdDc7W1ux0ct","email":"test-workflows-JSWOY158vykPO8BxoeJD8@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877859826,"env":"test","error":{},"workflowId":"63f479a8-5063-4005-a0c9-f2c4b2db37d4","userId":"4xtJjhNQIgdDc7W1ux0ct","projectId":"e2435679-9c35-4c8a-b159-91e2bc29637c","msg":"Error moving workflow"}
{"level":50,"time":1764877860229,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"bc341f72-b7ab-4511-918b-d4b10ffd8941","userId":"vIlhi2JQiFJj7azEO885l","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877860693,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ae196db7-f67d-4c64-97e0-df971c74212b","userId":"vIlhi2JQiFJj7azEO885l","msg":"Error moving workflow"}
{"level":30,"time":1764877861235,"env":"test","module":"user-credentials-repository","userId":"n-lfcqP-3muVdpPKzrj8L","msg":"User credentials created"}
{"level":30,"time":1764877861235,"env":"test","module":"auth-routes","userId":"n-lfcqP-3muVdpPKzrj8L","email":"test-workflows-4LPstnHEC12qG0H3nCStB@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877861447,"env":"test","module":"auth-routes","userId":"n-lfcqP-3muVdpPKzrj8L","email":"test-workflows-4LPstnHEC12qG0H3nCStB@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877861706,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"6f4884c6-a038-43ed-aacc-01ab1a27b1f3","userId":"vIlhi2JQiFJj7azEO885l","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 360[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 495[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 498[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 827[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 842[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 477[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 402[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 464[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1013[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:40
[2m   Duration [22m 20.77s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764877865847,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877868835,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877872436,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877872439,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877872451,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877872451,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877872451,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877872451,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877872987,"env":"test","module":"user-credentials-repository","userId":"ChJEZu38ajYT-bvn1c1pM","msg":"User credentials created"}
{"level":30,"time":1764877872990,"env":"test","module":"auth-routes","userId":"ChJEZu38ajYT-bvn1c1pM","email":"test-workflows-JpZCHPkDK9Gvj7AnDPz37@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e8753cfb-44bc-4d42-b6bb-50c1b0d6257b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ChJEZu38ajYT-bvn1c1pM","tenantId":"aa951d9f-8076-4c77-b836-b1697d00e1d2","createdBy":"ChJEZu38ajYT-bvn1c1pM","ownerId":"ChJEZu38ajYT-bvn1c1pM","status":"active","archived":false,"createdAt":"2025-12-04T19:51:14.678Z","updatedAt":"2025-12-04T19:51:14.678Z"}

{"level":30,"time":1764877873702,"env":"test","module":"user-credentials-repository","userId":"cuvXyWucnZfBENqTy-KPV","msg":"User credentials created"}
{"level":30,"time":1764877873703,"env":"test","module":"auth-routes","userId":"cuvXyWucnZfBENqTy-KPV","email":"viewer-HMwxiw8EaEmeUQI2LnZjE@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877873805,"env":"test","module":"rbac-middleware","userId":"cuvXyWucnZfBENqTy-KPV","userRole":"viewer","permission":"workflow:create","path":"/projects/e8753cfb-44bc-4d42-b6bb-50c1b0d6257b/workflows","msg":"Permission denied"}
{"level":50,"time":1764877879362,"env":"test","error":{},"workflowId":"463e208b-118c-4aa2-a8f0-783b502c08fa","userId":"ChJEZu38ajYT-bvn1c1pM","projectId":"df0b657e-85da-4ddb-a668-b0ecf505763f","msg":"Error moving workflow"}
{"level":50,"time":1764877879491,"env":"test","error":{},"workflowId":"463e208b-118c-4aa2-a8f0-783b502c08fa","userId":"ChJEZu38ajYT-bvn1c1pM","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764877879969,"env":"test","error":{},"workflowId":"876df0bf-f966-40e4-a5cc-63b860f7b9ca","userId":"ChJEZu38ajYT-bvn1c1pM","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877880298,"env":"test","module":"auth-middleware","path":"/api/workflows/ea99a070-4512-4165-80c2-36b6627a7370/move","msg":"No valid authentication found"}
{"level":30,"time":1764877880816,"env":"test","module":"user-credentials-repository","userId":"Ede8CqTCuwrgjyZNtXhn4","msg":"User credentials created"}
{"level":30,"time":1764877880817,"env":"test","module":"auth-routes","userId":"Ede8CqTCuwrgjyZNtXhn4","email":"test-workflows-30K37q7moTAB3V3MGmIzb@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877880865,"env":"test","error":{},"workflowId":"91f54bc9-99a2-4f77-a980-f81e245921d3","userId":"Ede8CqTCuwrgjyZNtXhn4","projectId":"22640afe-d516-4080-bb81-4957a32d6431","msg":"Error moving workflow"}
{"level":50,"time":1764877881246,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3e7e20cf-eef3-439e-9912-ffb9e3729613","userId":"ChJEZu38ajYT-bvn1c1pM","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877881627,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"917e296c-08aa-4828-a46f-66dd5569e3e6","userId":"ChJEZu38ajYT-bvn1c1pM","msg":"Error moving workflow"}
{"level":30,"time":1764877882142,"env":"test","module":"user-credentials-repository","userId":"fsI3t_xEu_tDtm_6tx6ry","msg":"User credentials created"}
{"level":30,"time":1764877882143,"env":"test","module":"auth-routes","userId":"fsI3t_xEu_tDtm_6tx6ry","email":"test-workflows-4kX1N673Y7I60XkJ6LzZt@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877882340,"env":"test","module":"auth-routes","userId":"fsI3t_xEu_tDtm_6tx6ry","email":"test-workflows-4kX1N673Y7I60XkJ6LzZt@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877882573,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"425d049c-15fa-4f09-b2ff-3019f3bb7ee5","userId":"ChJEZu38ajYT-bvn1c1pM","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10417[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 319[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 608[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 380[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 947[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:332:10
    330|         .set("Authorization", `Bearer ${authToken}`)
    331|         .send({ projectId: null })
    332|         .expect(200);
       |          ^
    333| 
    334|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:51:02
[2m   Duration [22m 19.89s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764879993529,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764879996802,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880000896,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880000896,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880000909,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880000909,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880000909,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880000910,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880001399,"env":"test","module":"user-credentials-repository","userId":"SBSHtuFKwpeuUiZrDkOT2","msg":"User credentials created"}
{"level":30,"time":1764880001403,"env":"test","module":"auth-routes","userId":"SBSHtuFKwpeuUiZrDkOT2","email":"test-workflows-kLVrld_cqW-5oWETYzvc5@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"987841b5-1738-4694-b195-9c74ad076743","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"SBSHtuFKwpeuUiZrDkOT2","tenantId":"01bab488-3346-4f63-9923-1356f7fd199c","createdBy":"SBSHtuFKwpeuUiZrDkOT2","ownerId":"SBSHtuFKwpeuUiZrDkOT2","status":"active","archived":false,"createdAt":"2025-12-04T20:26:43.103Z","updatedAt":"2025-12-04T20:26:43.103Z"}

{"level":30,"time":1764880002091,"env":"test","module":"user-credentials-repository","userId":"3dgwU1V_mLoUcMEUp6cj2","msg":"User credentials created"}
{"level":30,"time":1764880002092,"env":"test","module":"auth-routes","userId":"3dgwU1V_mLoUcMEUp6cj2","email":"viewer-uZwpiRD4jIEmm2PmBlDz8@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880002188,"env":"test","module":"rbac-middleware","userId":"3dgwU1V_mLoUcMEUp6cj2","userRole":"viewer","permission":"workflow:create","path":"/projects/987841b5-1738-4694-b195-9c74ad076743/workflows","msg":"Permission denied"}
{"level":50,"time":1764880008685,"env":"test","error":{},"workflowId":"32e147fa-b951-449d-9370-f9a0d6528530","userId":"SBSHtuFKwpeuUiZrDkOT2","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880009019,"env":"test","module":"auth-middleware","path":"/api/workflows/9f111d5b-ce6a-4d50-be0a-ebac9b355d54/move","msg":"No valid authentication found"}
{"level":30,"time":1764880009575,"env":"test","module":"user-credentials-repository","userId":"upfF3RZmNSj7KZiN2zaUy","msg":"User credentials created"}
{"level":30,"time":1764880009576,"env":"test","module":"auth-routes","userId":"upfF3RZmNSj7KZiN2zaUy","email":"test-workflows-kcGq90TiCST3e43b2HZ4f@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880009624,"env":"test","error":{},"workflowId":"527344e0-1a77-4d93-8ffc-57263d9c6382","userId":"upfF3RZmNSj7KZiN2zaUy","projectId":"74f86314-9758-4abf-bd86-96d45d0d9299","msg":"Error moving workflow"}
{"level":50,"time":1764880010002,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"d40aa280-e6ef-4062-b469-6f78ccdb35c6","userId":"SBSHtuFKwpeuUiZrDkOT2","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880010375,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ecb671a6-d6de-4188-a1b2-074def8cd857","userId":"SBSHtuFKwpeuUiZrDkOT2","msg":"Error moving workflow"}
{"level":30,"time":1764880010885,"env":"test","module":"user-credentials-repository","userId":"Rio3k-LlJiAIcg_gl1sJm","msg":"User credentials created"}
{"level":30,"time":1764880010885,"env":"test","module":"auth-routes","userId":"Rio3k-LlJiAIcg_gl1sJm","email":"test-workflows-HrYGTY2hRyX12g8bdlEw0@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880011077,"env":"test","module":"auth-routes","userId":"Rio3k-LlJiAIcg_gl1sJm","email":"test-workflows-HrYGTY2hRyX12g8bdlEw0@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880011264,"env":"test","error":{},"workflowId":"0ac25272-e303-45f0-a844-9da2b38b65d1","userId":"SBSHtuFKwpeuUiZrDkOT2","projectId":"9e18490c-2b0d-4d64-8392-e19f338dc153","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10683[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 849[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 892[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:29
[2m   Duration [22m 21.13s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764880015783,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880018432,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880022590,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880022590,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880022600,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880022601,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880022601,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880022601,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880023179,"env":"test","module":"user-credentials-repository","userId":"RpzdoBHBZGdcSVnmbmmXs","msg":"User credentials created"}
{"level":30,"time":1764880023183,"env":"test","module":"auth-routes","userId":"RpzdoBHBZGdcSVnmbmmXs","email":"test-workflows-Ej7OLsDCpltMSRupNhtpy@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0eb2eb64-87d7-44a9-8986-c12f567bced9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"RpzdoBHBZGdcSVnmbmmXs","tenantId":"48d924ba-8204-4321-b014-a823795855ef","createdBy":"RpzdoBHBZGdcSVnmbmmXs","ownerId":"RpzdoBHBZGdcSVnmbmmXs","status":"active","archived":false,"createdAt":"2025-12-04T20:27:04.900Z","updatedAt":"2025-12-04T20:27:04.900Z"}

{"level":30,"time":1764880023931,"env":"test","module":"user-credentials-repository","userId":"iz47fLbRCfxG3t8XDhpMK","msg":"User credentials created"}
{"level":30,"time":1764880023932,"env":"test","module":"auth-routes","userId":"iz47fLbRCfxG3t8XDhpMK","email":"viewer-4lOAqWEAWXYhjnRA7c8Gv@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880024034,"env":"test","module":"rbac-middleware","userId":"iz47fLbRCfxG3t8XDhpMK","userRole":"viewer","permission":"workflow:create","path":"/projects/0eb2eb64-87d7-44a9-8986-c12f567bced9/workflows","msg":"Permission denied"}
{"level":50,"time":1764880030423,"env":"test","error":{},"workflowId":"132ef8fa-e04b-4040-aeff-7a362e0392f3","userId":"RpzdoBHBZGdcSVnmbmmXs","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880030766,"env":"test","module":"auth-middleware","path":"/api/workflows/b3f7f091-1653-469f-bd2d-d01677fda288/move","msg":"No valid authentication found"}
{"level":30,"time":1764880031293,"env":"test","module":"user-credentials-repository","userId":"A3hPMr7Wxasbi_YOgyJQT","msg":"User credentials created"}
{"level":30,"time":1764880031293,"env":"test","module":"auth-routes","userId":"A3hPMr7Wxasbi_YOgyJQT","email":"test-workflows-wJcrH2C_YFuY0wbxcKZtN@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880031343,"env":"test","error":{},"workflowId":"98985aa3-dbc4-4484-be72-3f2a43442059","userId":"A3hPMr7Wxasbi_YOgyJQT","projectId":"85ad9d45-7cef-4881-b69e-97945f1176ed","msg":"Error moving workflow"}
{"level":50,"time":1764880031740,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"1284d9bd-cf56-4e58-bbab-a4bc78241396","userId":"RpzdoBHBZGdcSVnmbmmXs","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880032191,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8fda2b35-86c2-4672-ad8a-9ee069fa2a71","userId":"RpzdoBHBZGdcSVnmbmmXs","msg":"Error moving workflow"}
{"level":30,"time":1764880032810,"env":"test","module":"user-credentials-repository","userId":"P9tL-Q-PYPP5APnRj9mC7","msg":"User credentials created"}
{"level":30,"time":1764880032810,"env":"test","module":"auth-routes","userId":"P9tL-Q-PYPP5APnRj9mC7","email":"test-workflows-ADdKsz_-5VVKSREpjPng4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880032997,"env":"test","module":"auth-routes","userId":"P9tL-Q-PYPP5APnRj9mC7","email":"test-workflows-ADdKsz_-5VVKSREpjPng4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880033203,"env":"test","error":{},"workflowId":"17969228-9795-4631-bb0c-4dcfc42fb90f","userId":"RpzdoBHBZGdcSVnmbmmXs","projectId":"4013da1a-e4db-4b26-807b-9db05c150f56","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10918[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 779[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 667[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 397[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1012[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:51
[2m   Duration [22m 20.93s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764880066406,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880069785,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880073953,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880073953,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880073964,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880073964,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880073965,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880073965,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880074536,"env":"test","module":"user-credentials-repository","userId":"bPeZE6uypV0z7BJ2NX-8Y","msg":"User credentials created"}
{"level":30,"time":1764880074540,"env":"test","module":"auth-routes","userId":"bPeZE6uypV0z7BJ2NX-8Y","email":"test-workflows-Q1ZkWO_2SttRovPGqOpxN@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f35419e5-1371-4ebb-8b31-f7c507f329db","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"bPeZE6uypV0z7BJ2NX-8Y","tenantId":"c7ad20c9-7a46-4b01-8786-42d3e10f2be0","createdBy":"bPeZE6uypV0z7BJ2NX-8Y","ownerId":"bPeZE6uypV0z7BJ2NX-8Y","status":"active","archived":false,"createdAt":"2025-12-04T20:27:56.262Z","updatedAt":"2025-12-04T20:27:56.262Z"}

{"level":30,"time":1764880075236,"env":"test","module":"user-credentials-repository","userId":"JIW7wZvq3_dW9TI_K_hkc","msg":"User credentials created"}
{"level":30,"time":1764880075237,"env":"test","module":"auth-routes","userId":"JIW7wZvq3_dW9TI_K_hkc","email":"viewer-M6P0Pbvpny401lwiERKyb@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880075334,"env":"test","module":"rbac-middleware","userId":"JIW7wZvq3_dW9TI_K_hkc","userRole":"viewer","permission":"workflow:create","path":"/projects/f35419e5-1371-4ebb-8b31-f7c507f329db/workflows","msg":"Permission denied"}
{"level":50,"time":1764880081463,"env":"test","error":{},"workflowId":"a90e38da-96a7-40e3-b177-c5a06e9cd669","userId":"bPeZE6uypV0z7BJ2NX-8Y","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880081800,"env":"test","module":"auth-middleware","path":"/api/workflows/55f0abd2-a1f7-4367-877e-8946fcbf26ea/move","msg":"No valid authentication found"}
{"level":30,"time":1764880082289,"env":"test","module":"user-credentials-repository","userId":"XMX64ki0pXGf9ff4f2IDz","msg":"User credentials created"}
{"level":30,"time":1764880082289,"env":"test","module":"auth-routes","userId":"XMX64ki0pXGf9ff4f2IDz","email":"test-workflows-o--V9uKIqw6a3vta_pu29@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880082333,"env":"test","error":{},"workflowId":"472586c6-af88-452d-83f0-c509d79ead88","userId":"XMX64ki0pXGf9ff4f2IDz","projectId":"fe0a145a-e2b7-43bc-8631-9ee183425276","msg":"Error moving workflow"}
{"level":50,"time":1764880082697,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"4812bec4-ff1a-41e2-84ff-f1e15b528abc","userId":"bPeZE6uypV0z7BJ2NX-8Y","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880083065,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"df5b3651-e25e-4027-9ead-df9f686f7c51","userId":"bPeZE6uypV0z7BJ2NX-8Y","msg":"Error moving workflow"}
{"level":30,"time":1764880083552,"env":"test","module":"user-credentials-repository","userId":"GtS5Pm-G0GxGrW0516h_v","msg":"User credentials created"}
{"level":30,"time":1764880083553,"env":"test","module":"auth-routes","userId":"GtS5Pm-G0GxGrW0516h_v","email":"test-workflows-zMZ69fVR_OogalMMi2PZA@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880083757,"env":"test","module":"auth-routes","userId":"GtS5Pm-G0GxGrW0516h_v","email":"test-workflows-zMZ69fVR_OogalMMi2PZA@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880083944,"env":"test","error":{},"workflowId":"4e81f675-617b-4954-9d89-eff639e08eaf","userId":"bPeZE6uypV0z7BJ2NX-8Y","projectId":"5e66267d-a2e6-4655-adb9-278b6da6fe00","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 807[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 695[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 533[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 880[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:27:42
[2m   Duration [22m 20.87s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764880087964,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880091255,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880094699,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880094700,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880094711,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880094711,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880094711,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880094711,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880095191,"env":"test","module":"user-credentials-repository","userId":"zlOJbSWJt21ny-I-BK9E3","msg":"User credentials created"}
{"level":30,"time":1764880095195,"env":"test","module":"auth-routes","userId":"zlOJbSWJt21ny-I-BK9E3","email":"test-workflows-lOuz2iNh1d_RXnUTog00Q@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3be7b50c-4efa-47dc-a7de-7698605fa876","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"zlOJbSWJt21ny-I-BK9E3","tenantId":"1e8fcb19-deda-4793-af21-9ad8cd653d01","createdBy":"zlOJbSWJt21ny-I-BK9E3","ownerId":"zlOJbSWJt21ny-I-BK9E3","status":"active","archived":false,"createdAt":"2025-12-04T20:28:16.920Z","updatedAt":"2025-12-04T20:28:16.920Z"}

{"level":30,"time":1764880095864,"env":"test","module":"user-credentials-repository","userId":"3kRnAavhThl2eyzcNjGar","msg":"User credentials created"}
{"level":30,"time":1764880095865,"env":"test","module":"auth-routes","userId":"3kRnAavhThl2eyzcNjGar","email":"viewer-0VpmzKJriJJQc7yRe8Mvs@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880095965,"env":"test","module":"rbac-middleware","userId":"3kRnAavhThl2eyzcNjGar","userRole":"viewer","permission":"workflow:create","path":"/projects/3be7b50c-4efa-47dc-a7de-7698605fa876/workflows","msg":"Permission denied"}
{"level":50,"time":1764880102110,"env":"test","error":{},"workflowId":"225d90e0-945b-455b-9e21-b1f32d829143","userId":"zlOJbSWJt21ny-I-BK9E3","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880102435,"env":"test","module":"auth-middleware","path":"/api/workflows/653397a9-449f-4904-8a71-44bd6ee39624/move","msg":"No valid authentication found"}
{"level":30,"time":1764880102980,"env":"test","module":"user-credentials-repository","userId":"WHLh8-S5le3M77FtV1Pr4","msg":"User credentials created"}
{"level":30,"time":1764880102982,"env":"test","module":"auth-routes","userId":"WHLh8-S5le3M77FtV1Pr4","email":"test-workflows-9WrkvWEn_Ugx8-TBkmzcr@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880103031,"env":"test","error":{},"workflowId":"cf425337-7632-4a44-9436-62ba8401f45b","userId":"WHLh8-S5le3M77FtV1Pr4","projectId":"b1dd66c2-9eb9-47e7-bab4-545b25650706","msg":"Error moving workflow"}
{"level":50,"time":1764880103396,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"45cc27ea-f8a4-447f-8fed-8573f0e776fa","userId":"zlOJbSWJt21ny-I-BK9E3","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880103766,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f2ccaed6-867c-466a-89d5-b34c9942a030","userId":"zlOJbSWJt21ny-I-BK9E3","msg":"Error moving workflow"}
{"level":30,"time":1764880104286,"env":"test","module":"user-credentials-repository","userId":"zrgmxOw7PrncDe8zNav5P","msg":"User credentials created"}
{"level":30,"time":1764880104286,"env":"test","module":"auth-routes","userId":"zrgmxOw7PrncDe8zNav5P","email":"test-workflows-syQXRB8gi68eQuct2oYlX@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880104480,"env":"test","module":"auth-routes","userId":"zrgmxOw7PrncDe8zNav5P","email":"test-workflows-syQXRB8gi68eQuct2oYlX@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880104673,"env":"test","error":{},"workflowId":"63b592c9-e83e-4128-869f-3867bdc04f34","userId":"zlOJbSWJt21ny-I-BK9E3","projectId":"8473aad4-a75a-422f-99e0-01dd500810e2","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 769[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 906[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:04
[2m   Duration [22m 20.26s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764880107608,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880109669,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880112218,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880112218,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880112229,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880112230,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880112230,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880112230,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880112756,"env":"test","module":"user-credentials-repository","userId":"8Kyksz2ylzSMPNXx2hVFL","msg":"User credentials created"}
{"level":30,"time":1764880112760,"env":"test","module":"auth-routes","userId":"8Kyksz2ylzSMPNXx2hVFL","email":"test-workflows-ZZF9ombUWdgubi87PSMCE@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"307e19ea-8f63-47aa-b413-6f1593100dde","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"8Kyksz2ylzSMPNXx2hVFL","tenantId":"07879a2c-f112-4cab-b8fc-31216ec0749a","createdBy":"8Kyksz2ylzSMPNXx2hVFL","ownerId":"8Kyksz2ylzSMPNXx2hVFL","status":"active","archived":false,"createdAt":"2025-12-04T20:28:34.486Z","updatedAt":"2025-12-04T20:28:34.486Z"}

{"level":30,"time":1764880113466,"env":"test","module":"user-credentials-repository","userId":"GcEo9jVIhUSGEZEOXNHGk","msg":"User credentials created"}
{"level":30,"time":1764880113467,"env":"test","module":"auth-routes","userId":"GcEo9jVIhUSGEZEOXNHGk","email":"viewer-tneuppV6UtEBtXoOOhl1j@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880113561,"env":"test","module":"rbac-middleware","userId":"GcEo9jVIhUSGEZEOXNHGk","userRole":"viewer","permission":"workflow:create","path":"/projects/307e19ea-8f63-47aa-b413-6f1593100dde/workflows","msg":"Permission denied"}
{"level":50,"time":1764880120084,"env":"test","error":{},"workflowId":"a5f9e9cb-c13c-458b-9ff1-36ff4867f181","userId":"8Kyksz2ylzSMPNXx2hVFL","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880120421,"env":"test","module":"auth-middleware","path":"/api/workflows/3a8158d5-c0b6-4c75-909e-2aba3b9663df/move","msg":"No valid authentication found"}
{"level":30,"time":1764880120943,"env":"test","module":"user-credentials-repository","userId":"jF9y2YJF3uGGd4-5NQx6l","msg":"User credentials created"}
{"level":30,"time":1764880120944,"env":"test","module":"auth-routes","userId":"jF9y2YJF3uGGd4-5NQx6l","email":"test-workflows-5DLuBCzP4hyiWW5p84Jo1@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880120991,"env":"test","error":{},"workflowId":"bb1f46a9-d75c-48a2-abeb-6b7f07e6eca9","userId":"jF9y2YJF3uGGd4-5NQx6l","projectId":"c93e2c23-c61b-4f52-8cc8-e1ab0d60f0db","msg":"Error moving workflow"}
{"level":50,"time":1764880121369,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"d3312778-0891-40f0-b5fe-48e0e1d2c34c","userId":"8Kyksz2ylzSMPNXx2hVFL","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880121740,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"96454189-64e5-415b-add7-f3786fde1b48","userId":"8Kyksz2ylzSMPNXx2hVFL","msg":"Error moving workflow"}
{"level":30,"time":1764880122292,"env":"test","module":"user-credentials-repository","userId":"YhJkhloUP8lrBm3DQZ2Ml","msg":"User credentials created"}
{"level":30,"time":1764880122292,"env":"test","module":"auth-routes","userId":"YhJkhloUP8lrBm3DQZ2Ml","email":"test-workflows-v58T2hgu0tofb8R9uAnjA@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880122492,"env":"test","module":"auth-routes","userId":"YhJkhloUP8lrBm3DQZ2Ml","email":"test-workflows-v58T2hgu0tofb8R9uAnjA@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880122685,"env":"test","error":{},"workflowId":"00a612a3-2fa1-4399-9486-363b983a1d05","userId":"8Kyksz2ylzSMPNXx2hVFL","projectId":"b8e56697-4e6b-44fa-a1b9-e9f956c22b85","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 828[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 947[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:25
[2m   Duration [22m 17.23s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/sections.routes.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880140227,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880143223,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880147922,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880147923,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880147933,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880147933,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880147933,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880147933,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880148589,"env":"test","module":"user-credentials-repository","userId":"0bK3-AKUEzCW36b9uH_IO","msg":"User credentials created"}
{"level":30,"time":1764880148592,"env":"test","module":"auth-routes","userId":"0bK3-AKUEzCW36b9uH_IO","email":"test-workflows-l5rJqYe5WrtDBICqLdyBi@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d7bff0b8-a566-4913-a569-afb78e9e3e29","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"0bK3-AKUEzCW36b9uH_IO","tenantId":"dca35e73-2571-46c9-aaf4-ece52a813316","createdBy":"0bK3-AKUEzCW36b9uH_IO","ownerId":"0bK3-AKUEzCW36b9uH_IO","status":"active","archived":false,"createdAt":"2025-12-04T20:29:10.310Z","updatedAt":"2025-12-04T20:29:10.310Z"}

{"level":30,"time":1764880149238,"env":"test","module":"user-credentials-repository","userId":"-AAVeFq0kTGI7XOH2HDiy","msg":"User credentials created"}
{"level":30,"time":1764880149239,"env":"test","module":"auth-routes","userId":"-AAVeFq0kTGI7XOH2HDiy","email":"viewer-4B-uZL3FozgnKF9EABQ7s@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880149330,"env":"test","module":"rbac-middleware","userId":"-AAVeFq0kTGI7XOH2HDiy","userRole":"viewer","permission":"workflow:create","path":"/projects/d7bff0b8-a566-4913-a569-afb78e9e3e29/workflows","msg":"Permission denied"}
{"level":50,"time":1764880155210,"env":"test","error":{},"workflowId":"53224aba-a593-4603-80f2-942dbf8cb2ea","userId":"0bK3-AKUEzCW36b9uH_IO","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880155530,"env":"test","module":"auth-middleware","path":"/api/workflows/1fa36476-24d4-488a-a45f-da8cbd8aba89/move","msg":"No valid authentication found"}
{"level":30,"time":1764880156016,"env":"test","module":"user-credentials-repository","userId":"6Q00zeNJxwqn8qBOPCrY4","msg":"User credentials created"}
{"level":30,"time":1764880156016,"env":"test","module":"auth-routes","userId":"6Q00zeNJxwqn8qBOPCrY4","email":"test-workflows-0GqcKnd9MKaz2w5DQ2-4v@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880156067,"env":"test","error":{},"workflowId":"60182551-3aef-44a6-90d5-7c8ac84efe9a","userId":"6Q00zeNJxwqn8qBOPCrY4","projectId":"3d455735-387f-4a30-9624-b027489b23d1","msg":"Error moving workflow"}
{"level":50,"time":1764880156415,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"27a324db-9d91-40ff-9725-0eaf3440296b","userId":"0bK3-AKUEzCW36b9uH_IO","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880156763,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"873c7dc5-de7c-4568-b3f5-bfd3b398ee39","userId":"0bK3-AKUEzCW36b9uH_IO","msg":"Error moving workflow"}
{"level":30,"time":1764880157244,"env":"test","module":"user-credentials-repository","userId":"PuAVgB42YlDoIt0APwPEb","msg":"User credentials created"}
{"level":30,"time":1764880157245,"env":"test","module":"auth-routes","userId":"PuAVgB42YlDoIt0APwPEb","email":"test-workflows-gkIPgYsxm6g4Sw8WicRX9@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880157433,"env":"test","module":"auth-routes","userId":"PuAVgB42YlDoIt0APwPEb","email":"test-workflows-gkIPgYsxm6g4Sw8WicRX9@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880157603,"env":"test","error":{},"workflowId":"0d328dbe-9291-4a05-bd8c-8862e893b8ed","userId":"0bK3-AKUEzCW36b9uH_IO","projectId":"c9e9bdbf-3c93-4320-8be8-c673366efb3d","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9971[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 307[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 284[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 441[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 691[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 685[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 439[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 537[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 840[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:56
[2m   Duration [22m 21.04s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764880170168,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880175134,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880178209,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880178210,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880178219,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880178219,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880178219,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880178219,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880178693,"env":"test","module":"user-credentials-repository","userId":"AtZj7vYHODy8_QOxYKTto","msg":"User credentials created"}
{"level":30,"time":1764880178696,"env":"test","module":"auth-routes","userId":"AtZj7vYHODy8_QOxYKTto","email":"test-workflows-PrOtKqMSxJONJiZIGl9Vl@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"54054a12-2dc8-4d6c-b583-7fec178ae648","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"AtZj7vYHODy8_QOxYKTto","tenantId":"a75f2702-e427-40c5-8e7d-fb5862300730","createdBy":"AtZj7vYHODy8_QOxYKTto","ownerId":"AtZj7vYHODy8_QOxYKTto","status":"active","archived":false,"createdAt":"2025-12-04T20:29:40.421Z","updatedAt":"2025-12-04T20:29:40.421Z"}

{"level":30,"time":1764880179371,"env":"test","module":"user-credentials-repository","userId":"9bwHyLHjNdR-MydpF_4N2","msg":"User credentials created"}
{"level":30,"time":1764880179372,"env":"test","module":"auth-routes","userId":"9bwHyLHjNdR-MydpF_4N2","email":"viewer-dkmSPj4SybJg8al-WSDDM@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880179470,"env":"test","module":"rbac-middleware","userId":"9bwHyLHjNdR-MydpF_4N2","userRole":"viewer","permission":"workflow:create","path":"/projects/54054a12-2dc8-4d6c-b583-7fec178ae648/workflows","msg":"Permission denied"}
{"level":50,"time":1764880185579,"env":"test","error":{},"workflowId":"beb2bf82-9408-4de2-bde9-974b4539a495","userId":"AtZj7vYHODy8_QOxYKTto","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880185898,"env":"test","module":"auth-middleware","path":"/api/workflows/f31f6105-1007-4cb5-9da3-0834d90b0894/move","msg":"No valid authentication found"}
{"level":30,"time":1764880186404,"env":"test","module":"user-credentials-repository","userId":"3rIje1aLLG-Kfak9qfcrA","msg":"User credentials created"}
{"level":30,"time":1764880186404,"env":"test","module":"auth-routes","userId":"3rIje1aLLG-Kfak9qfcrA","email":"test-workflows-nAf2fLjurAqbzJxPnpklZ@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880186496,"env":"test","error":{},"workflowId":"e1aae517-a1d7-4e60-93be-715acc41cc50","userId":"3rIje1aLLG-Kfak9qfcrA","projectId":"7405c12d-a6c9-445a-9065-fbc7d61c478e","msg":"Error moving workflow"}
{"level":50,"time":1764880186864,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"af42ba5a-d2ea-48ae-a0fe-3069bc9e3436","userId":"AtZj7vYHODy8_QOxYKTto","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880187220,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"08f995ed-d3e9-4eb5-bf40-f99fe450e84b","userId":"AtZj7vYHODy8_QOxYKTto","msg":"Error moving workflow"}
{"level":30,"time":1764880187720,"env":"test","module":"user-credentials-repository","userId":"YhYev4MABiCygV9rvTnnq","msg":"User credentials created"}
{"level":30,"time":1764880187720,"env":"test","module":"auth-routes","userId":"YhYev4MABiCygV9rvTnnq","email":"test-workflows-G6Me-cpTUukOVse1F2YAZ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880187919,"env":"test","module":"auth-routes","userId":"YhYev4MABiCygV9rvTnnq","email":"test-workflows-G6Me-cpTUukOVse1F2YAZ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880188111,"env":"test","error":{},"workflowId":"5833b6f7-276d-44e2-9f8a-b3817c697212","userId":"AtZj7vYHODy8_QOxYKTto","projectId":"4431bbdd-7e80-40ce-bbff-93162875cab6","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10154[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 302[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 444[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 565[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 318[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 357[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 891[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:25
[2m   Duration [22m 21.63s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764880191320,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880193503,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880195812,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880195813,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880195825,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880195825,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880195825,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880195825,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880196308,"env":"test","module":"user-credentials-repository","userId":"Qi5ebITcua4PZIokdV_wp","msg":"User credentials created"}
{"level":30,"time":1764880196311,"env":"test","module":"auth-routes","userId":"Qi5ebITcua4PZIokdV_wp","email":"test-workflows-JM12jF-BP4XRhAp-yC5B1@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"001843f1-0883-4126-a202-f1c990c84b5c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Qi5ebITcua4PZIokdV_wp","tenantId":"378ffa94-f534-441d-956c-ef1aa3d21ab7","createdBy":"Qi5ebITcua4PZIokdV_wp","ownerId":"Qi5ebITcua4PZIokdV_wp","status":"active","archived":false,"createdAt":"2025-12-04T20:29:58.025Z","updatedAt":"2025-12-04T20:29:58.025Z"}

{"level":30,"time":1764880196978,"env":"test","module":"user-credentials-repository","userId":"o7mkuSbJk1NRxKwtAPLWX","msg":"User credentials created"}
{"level":30,"time":1764880196978,"env":"test","module":"auth-routes","userId":"o7mkuSbJk1NRxKwtAPLWX","email":"viewer-VOxCbnpc6T0FBXp2iqZPB@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880197067,"env":"test","module":"rbac-middleware","userId":"o7mkuSbJk1NRxKwtAPLWX","userRole":"viewer","permission":"workflow:create","path":"/projects/001843f1-0883-4126-a202-f1c990c84b5c/workflows","msg":"Permission denied"}
{"level":50,"time":1764880203421,"env":"test","error":{},"workflowId":"599ba1ed-f366-452e-9f3d-d84bdf49b1e9","userId":"Qi5ebITcua4PZIokdV_wp","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880203750,"env":"test","module":"auth-middleware","path":"/api/workflows/a0cc423c-b9ac-4ec4-b07c-430ef5aa510b/move","msg":"No valid authentication found"}
{"level":30,"time":1764880204277,"env":"test","module":"user-credentials-repository","userId":"Rhuen4xEl7y6au_EQ9W63","msg":"User credentials created"}
{"level":30,"time":1764880204278,"env":"test","module":"auth-routes","userId":"Rhuen4xEl7y6au_EQ9W63","email":"test-workflows-n8tXi2k50dNKhMc7uynQM@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880204327,"env":"test","error":{},"workflowId":"71132776-981d-4d3c-b5fe-637a376b9b99","userId":"Rhuen4xEl7y6au_EQ9W63","projectId":"a174389b-64ad-4016-b3f4-57a68c93611b","msg":"Error moving workflow"}
{"level":50,"time":1764880204785,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"a1965ec7-6166-41bd-9702-fefeb208c69a","userId":"Qi5ebITcua4PZIokdV_wp","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880205145,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"221583be-d0db-4393-a14c-29c0ef74ba03","userId":"Qi5ebITcua4PZIokdV_wp","msg":"Error moving workflow"}
{"level":30,"time":1764880205657,"env":"test","module":"user-credentials-repository","userId":"1FIUj9fqsvZbtyXjrsv05","msg":"User credentials created"}
{"level":30,"time":1764880205658,"env":"test","module":"auth-routes","userId":"1FIUj9fqsvZbtyXjrsv05","email":"test-workflows-gkGdl9XU4nYltOM6I9Xph@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880205844,"env":"test","module":"auth-routes","userId":"1FIUj9fqsvZbtyXjrsv05","email":"test-workflows-gkGdl9XU4nYltOM6I9Xph@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880206071,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8ba85a51-1707-4127-bb03-973d59522dd2","userId":"Qi5ebITcua4PZIokdV_wp","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 286[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 589[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 518[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 360[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 927[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:48
[2m   Duration [22m 17.30s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/steps.routes.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764880219321,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880222817,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880227153,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880227154,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880227172,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880227172,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880227172,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880227172,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880227690,"env":"test","module":"user-credentials-repository","userId":"UtKDU3Cnj-ZZAaeidu7j9","msg":"User credentials created"}
{"level":30,"time":1764880227694,"env":"test","module":"auth-routes","userId":"UtKDU3Cnj-ZZAaeidu7j9","email":"test-workflows-aTIFwrR3Y2TakXpLjKNVn@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a5b0d1db-5a1c-4a24-8073-d24ed9c3644b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"UtKDU3Cnj-ZZAaeidu7j9","tenantId":"bd1fff51-f286-4d26-bea7-0f6035882e92","createdBy":"UtKDU3Cnj-ZZAaeidu7j9","ownerId":"UtKDU3Cnj-ZZAaeidu7j9","status":"active","archived":false,"createdAt":"2025-12-04T20:30:29.421Z","updatedAt":"2025-12-04T20:30:29.421Z"}

{"level":30,"time":1764880228353,"env":"test","module":"user-credentials-repository","userId":"vCHWGD0L1xhW7b5rxowGx","msg":"User credentials created"}
{"level":30,"time":1764880228354,"env":"test","module":"auth-routes","userId":"vCHWGD0L1xhW7b5rxowGx","email":"viewer-eSnrol0D_YHggO4Qe1KeT@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880228445,"env":"test","module":"rbac-middleware","userId":"vCHWGD0L1xhW7b5rxowGx","userRole":"viewer","permission":"workflow:create","path":"/projects/a5b0d1db-5a1c-4a24-8073-d24ed9c3644b/workflows","msg":"Permission denied"}
{"level":50,"time":1764880234580,"env":"test","error":{},"workflowId":"d35f87bb-084f-4ba3-a6ea-785fe90bbc83","userId":"UtKDU3Cnj-ZZAaeidu7j9","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880234903,"env":"test","module":"auth-middleware","path":"/api/workflows/707dab92-3e04-4843-8ed2-28b2e7d2f002/move","msg":"No valid authentication found"}
{"level":30,"time":1764880235430,"env":"test","module":"user-credentials-repository","userId":"QjS4S9YeBtX-jxSSQ0_ou","msg":"User credentials created"}
{"level":30,"time":1764880235430,"env":"test","module":"auth-routes","userId":"QjS4S9YeBtX-jxSSQ0_ou","email":"test-workflows-EP0qedr7GN31lEQC_fSCd@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880235477,"env":"test","error":{},"workflowId":"4ded88d0-5b26-4592-8896-0daafffab705","userId":"QjS4S9YeBtX-jxSSQ0_ou","projectId":"03c78b73-011b-4b38-b463-bd32d7bb6b61","msg":"Error moving workflow"}
{"level":50,"time":1764880235832,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"d281fa68-d947-4bed-9351-471c7f8f18a4","userId":"UtKDU3Cnj-ZZAaeidu7j9","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880236203,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"559f57f9-5428-4efc-aece-5b6567b436f6","userId":"UtKDU3Cnj-ZZAaeidu7j9","msg":"Error moving workflow"}
{"level":30,"time":1764880236694,"env":"test","module":"user-credentials-repository","userId":"eDi_JysSTf1WaYC1W66mB","msg":"User credentials created"}
{"level":30,"time":1764880236695,"env":"test","module":"auth-routes","userId":"eDi_JysSTf1WaYC1W66mB","email":"test-workflows-cfHvsQij9YlQERe_cIW02@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880236873,"env":"test","module":"auth-routes","userId":"eDi_JysSTf1WaYC1W66mB","email":"test-workflows-cfHvsQij9YlQERe_cIW02@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880237044,"env":"test","error":{},"workflowId":"092339ef-0d76-4063-b6af-33b7ef851b29","userId":"UtKDU3Cnj-ZZAaeidu7j9","projectId":"10916ad3-0ae3-4045-8b10-0da26d453d09","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10160[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 274[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 707[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 762[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 588[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 843[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:14
[2m   Duration [22m 21.89s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764880256849,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880259769,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880263429,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880263430,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880263440,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880263440,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880263441,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880263441,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880263990,"env":"test","module":"user-credentials-repository","userId":"y2sAjlCQsk1qhHhbiBaWP","msg":"User credentials created"}
{"level":30,"time":1764880263994,"env":"test","module":"auth-routes","userId":"y2sAjlCQsk1qhHhbiBaWP","email":"test-workflows-Ylixf0SOkqSdILQL3JxQH@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b5fb9d38-dee6-4c62-b753-988a56a1975f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"y2sAjlCQsk1qhHhbiBaWP","tenantId":"904f6e9d-c7de-4a89-9ec4-cf00ee7c5524","createdBy":"y2sAjlCQsk1qhHhbiBaWP","ownerId":"y2sAjlCQsk1qhHhbiBaWP","status":"active","archived":false,"createdAt":"2025-12-04T20:31:05.723Z","updatedAt":"2025-12-04T20:31:05.723Z"}

{"level":30,"time":1764880264714,"env":"test","module":"user-credentials-repository","userId":"YVHTbA37DgR7NCxAq-Hnv","msg":"User credentials created"}
{"level":30,"time":1764880264715,"env":"test","module":"auth-routes","userId":"YVHTbA37DgR7NCxAq-Hnv","email":"viewer-Y4YQaswJbieenaJKHp967@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880264808,"env":"test","module":"rbac-middleware","userId":"YVHTbA37DgR7NCxAq-Hnv","userRole":"viewer","permission":"workflow:create","path":"/projects/b5fb9d38-dee6-4c62-b753-988a56a1975f/workflows","msg":"Permission denied"}
{"level":50,"time":1764880271233,"env":"test","error":{},"workflowId":"67e74db1-8371-4dd0-843b-d1ef8734fc76","userId":"y2sAjlCQsk1qhHhbiBaWP","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880271574,"env":"test","module":"auth-middleware","path":"/api/workflows/a037707f-9e7d-40da-b820-2a1bff2befe8/move","msg":"No valid authentication found"}
{"level":30,"time":1764880272089,"env":"test","module":"user-credentials-repository","userId":"wDND55S6_QtPWKGXUD3zA","msg":"User credentials created"}
{"level":30,"time":1764880272089,"env":"test","module":"auth-routes","userId":"wDND55S6_QtPWKGXUD3zA","email":"test-workflows-D_TN2voHZZAEY0XmECI17@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880272145,"env":"test","error":{},"workflowId":"f084c6ce-5906-4cd9-b641-64da752ddef9","userId":"wDND55S6_QtPWKGXUD3zA","projectId":"10404597-166a-4573-b442-0a1f41634e42","msg":"Error moving workflow"}
{"level":50,"time":1764880272509,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"d4aaa5e3-c782-4bce-86de-35b1c2aa0686","userId":"y2sAjlCQsk1qhHhbiBaWP","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880272933,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9b808c5a-8413-42e6-bdf8-0d29c844838a","userId":"y2sAjlCQsk1qhHhbiBaWP","msg":"Error moving workflow"}
{"level":30,"time":1764880273494,"env":"test","module":"user-credentials-repository","userId":"nSxLCW2r2dI6bdjyya_hm","msg":"User credentials created"}
{"level":30,"time":1764880273494,"env":"test","module":"auth-routes","userId":"nSxLCW2r2dI6bdjyya_hm","email":"test-workflows-6VYbSNbSoW1Sk6h9LYQBh@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880273714,"env":"test","module":"auth-routes","userId":"nSxLCW2r2dI6bdjyya_hm","email":"test-workflows-6VYbSNbSoW1Sk6h9LYQBh@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880273890,"env":"test","error":{},"workflowId":"91c13bb6-db8e-4a71-a91d-694eb95457f7","userId":"y2sAjlCQsk1qhHhbiBaWP","projectId":"a7e345d3-2547-4e9a-9451-b606276bc819","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 311[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 769[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 655[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 808[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 425[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 959[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:52
[2m   Duration [22m 21.15s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880279905,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880283743,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880286438,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880286439,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880286454,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880286454,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880286455,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880286456,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880286909,"env":"test","module":"user-credentials-repository","userId":"mUZQyC_nAoTZH-oUr7XDO","msg":"User credentials created"}
{"level":30,"time":1764880286912,"env":"test","module":"auth-routes","userId":"mUZQyC_nAoTZH-oUr7XDO","email":"test-workflows-hK0RnzjACZHv_TaSv4YlM@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"bfe99086-c218-4677-a040-915f3c24fb36","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"mUZQyC_nAoTZH-oUr7XDO","tenantId":"eef60c24-2a49-49fd-a29d-e84b49b65002","createdBy":"mUZQyC_nAoTZH-oUr7XDO","ownerId":"mUZQyC_nAoTZH-oUr7XDO","status":"active","archived":false,"createdAt":"2025-12-04T20:31:28.635Z","updatedAt":"2025-12-04T20:31:28.635Z"}

{"level":30,"time":1764880287599,"env":"test","module":"user-credentials-repository","userId":"BqXbN_JvEoouahYf9YRB6","msg":"User credentials created"}
{"level":30,"time":1764880287599,"env":"test","module":"auth-routes","userId":"BqXbN_JvEoouahYf9YRB6","email":"viewer-baj3IPWNehL37XN1fueaZ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880287702,"env":"test","module":"rbac-middleware","userId":"BqXbN_JvEoouahYf9YRB6","userRole":"viewer","permission":"workflow:create","path":"/projects/bfe99086-c218-4677-a040-915f3c24fb36/workflows","msg":"Permission denied"}
{"level":50,"time":1764880294108,"env":"test","error":{},"workflowId":"e4e47a3c-46f3-4f0c-9b54-60f5a53ca00b","userId":"mUZQyC_nAoTZH-oUr7XDO","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880294454,"env":"test","module":"auth-middleware","path":"/api/workflows/d7fea9b9-584a-40d7-b81b-48a79b514b9f/move","msg":"No valid authentication found"}
{"level":30,"time":1764880294992,"env":"test","module":"user-credentials-repository","userId":"wFGtFRnbli5HGKAVXMBtA","msg":"User credentials created"}
{"level":30,"time":1764880294993,"env":"test","module":"auth-routes","userId":"wFGtFRnbli5HGKAVXMBtA","email":"test-workflows-eLNJ19NfzWkfpPQAM5wYq@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880295039,"env":"test","error":{},"workflowId":"7045443d-5b16-4ebc-b593-0ef9b20b0972","userId":"wFGtFRnbli5HGKAVXMBtA","projectId":"84a220d8-1fe1-415a-bdcb-e0930381b087","msg":"Error moving workflow"}
{"level":50,"time":1764880295412,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f9d344ab-b49e-4d40-a13f-98271581ed33","userId":"mUZQyC_nAoTZH-oUr7XDO","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880295790,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"6aaa69f9-8944-4469-b27e-a3624b009684","userId":"mUZQyC_nAoTZH-oUr7XDO","msg":"Error moving workflow"}
{"level":30,"time":1764880296317,"env":"test","module":"user-credentials-repository","userId":"sM68tcMbS3hU-j8pMv0u7","msg":"User credentials created"}
{"level":30,"time":1764880296317,"env":"test","module":"auth-routes","userId":"sM68tcMbS3hU-j8pMv0u7","email":"test-workflows-6-06c1h1B8EEbPu40h9Fn@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880296521,"env":"test","module":"auth-routes","userId":"sM68tcMbS3hU-j8pMv0u7","email":"test-workflows-6-06c1h1B8EEbPu40h9Fn@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880296719,"env":"test","error":{},"workflowId":"2f367eed-e26c-485c-a3e1-71e12a749b5b","userId":"mUZQyC_nAoTZH-oUr7XDO","projectId":"5c6ace7d-fac8-4d03-89f9-ccfcf202c5bd","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 810[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 764[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 345[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 930[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:14
[2m   Duration [22m 21.42s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx26 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880301893,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880304262,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880307000,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880307001,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880307011,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880307011,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880307012,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880307012,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880307492,"env":"test","module":"user-credentials-repository","userId":"1ByyggxFe-ualWensBCvv","msg":"User credentials created"}
{"level":30,"time":1764880307496,"env":"test","module":"auth-routes","userId":"1ByyggxFe-ualWensBCvv","email":"test-workflows-1eojkTSeFVpz_lH-QBKv0@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3f983e19-3082-4aee-842b-83ece1681181","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"1ByyggxFe-ualWensBCvv","tenantId":"3f47bb6d-3511-4a48-813a-2ee890485c03","createdBy":"1ByyggxFe-ualWensBCvv","ownerId":"1ByyggxFe-ualWensBCvv","status":"active","archived":false,"createdAt":"2025-12-04T20:31:49.228Z","updatedAt":"2025-12-04T20:31:49.228Z"}

{"level":30,"time":1764880308246,"env":"test","module":"user-credentials-repository","userId":"0iH9iIB9bm4ztPJy24fNP","msg":"User credentials created"}
{"level":30,"time":1764880308247,"env":"test","module":"auth-routes","userId":"0iH9iIB9bm4ztPJy24fNP","email":"viewer-SsCcPoS8gMwJmnPaeSIGY@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880308344,"env":"test","module":"rbac-middleware","userId":"0iH9iIB9bm4ztPJy24fNP","userRole":"viewer","permission":"workflow:create","path":"/projects/3f983e19-3082-4aee-842b-83ece1681181/workflows","msg":"Permission denied"}
{"level":50,"time":1764880314875,"env":"test","error":{},"workflowId":"10300992-6afc-4a1e-9add-7204322884da","userId":"1ByyggxFe-ualWensBCvv","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880315207,"env":"test","module":"auth-middleware","path":"/api/workflows/38942028-dd4e-472f-94fa-8107e8045bef/move","msg":"No valid authentication found"}
{"level":30,"time":1764880315827,"env":"test","module":"user-credentials-repository","userId":"71ZRgEU40MDUQXN2xUCIW","msg":"User credentials created"}
{"level":30,"time":1764880315828,"env":"test","module":"auth-routes","userId":"71ZRgEU40MDUQXN2xUCIW","email":"test-workflows-Y8leYyEjWdF0TucUag8Y9@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880315878,"env":"test","error":{},"workflowId":"4952813b-562f-488a-ab11-b62c8d572c68","userId":"71ZRgEU40MDUQXN2xUCIW","projectId":"e2731c45-fc5b-4d4c-86e7-f04df00ad5a0","msg":"Error moving workflow"}
{"level":50,"time":1764880316256,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8332497a-4ed1-4632-bb35-8f3b0400d8f2","userId":"1ByyggxFe-ualWensBCvv","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880316687,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"95eba527-4c6b-4221-8ace-7c2af3d01f1f","userId":"1ByyggxFe-ualWensBCvv","msg":"Error moving workflow"}
{"level":30,"time":1764880317239,"env":"test","module":"user-credentials-repository","userId":"mrVPnmitFWi2L4MF78iPN","msg":"User credentials created"}
{"level":30,"time":1764880317240,"env":"test","module":"auth-routes","userId":"mrVPnmitFWi2L4MF78iPN","email":"test-workflows-hSp_6Ciy7_4XSWjmI-5Zt@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880317463,"env":"test","module":"auth-routes","userId":"mrVPnmitFWi2L4MF78iPN","email":"test-workflows-hSp_6Ciy7_4XSWjmI-5Zt@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880317664,"env":"test","error":{},"workflowId":"4b5a742a-6817-4cfc-a11e-3450d543a419","userId":"1ByyggxFe-ualWensBCvv","projectId":"99113e3f-260c-43f0-8e35-fe5dd9fb8c6d","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10961[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 491[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 812[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 661[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 671[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 431[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 978[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:37
[2m   Duration [22m 19.67s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx27 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764880322747,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880325286,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880327743,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880327744,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880327756,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880327756,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880327756,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880327756,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880328237,"env":"test","module":"user-credentials-repository","userId":"3QCCX-bIvBj9jx_n25cFO","msg":"User credentials created"}
{"level":30,"time":1764880328241,"env":"test","module":"auth-routes","userId":"3QCCX-bIvBj9jx_n25cFO","email":"test-workflows-KhVVYGYF65hIk5uZYYB-L@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9534ea73-f59b-46d9-b622-513d8e92f8a5","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"3QCCX-bIvBj9jx_n25cFO","tenantId":"36a0e0f7-d011-47fe-b9ad-44a76ac1a089","createdBy":"3QCCX-bIvBj9jx_n25cFO","ownerId":"3QCCX-bIvBj9jx_n25cFO","status":"active","archived":false,"createdAt":"2025-12-04T20:32:09.974Z","updatedAt":"2025-12-04T20:32:09.974Z"}

{"level":30,"time":1764880328951,"env":"test","module":"user-credentials-repository","userId":"Twv7of46cddFya2yk9FM2","msg":"User credentials created"}
{"level":30,"time":1764880328952,"env":"test","module":"auth-routes","userId":"Twv7of46cddFya2yk9FM2","email":"viewer-axVATKtnf1iJWsrnBYagZ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880329052,"env":"test","module":"rbac-middleware","userId":"Twv7of46cddFya2yk9FM2","userRole":"viewer","permission":"workflow:create","path":"/projects/9534ea73-f59b-46d9-b622-513d8e92f8a5/workflows","msg":"Permission denied"}
{"level":50,"time":1764880335385,"env":"test","error":{},"workflowId":"24fe644b-c450-4be8-b32e-fc7bf2339dec","userId":"3QCCX-bIvBj9jx_n25cFO","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880335700,"env":"test","module":"auth-middleware","path":"/api/workflows/4199a563-76ed-4b28-9784-45c8ad95eba3/move","msg":"No valid authentication found"}
{"level":30,"time":1764880336220,"env":"test","module":"user-credentials-repository","userId":"jWAVILfQ7nH1hwG7MQYBC","msg":"User credentials created"}
{"level":30,"time":1764880336220,"env":"test","module":"auth-routes","userId":"jWAVILfQ7nH1hwG7MQYBC","email":"test-workflows-X9RWrZ9-BoLc4rN8IDgYW@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880336268,"env":"test","error":{},"workflowId":"d5126d1b-f48d-42d5-a379-a758d5d93c20","userId":"jWAVILfQ7nH1hwG7MQYBC","projectId":"fef1da80-b29b-4ca8-93ee-0123b8837919","msg":"Error moving workflow"}
{"level":50,"time":1764880336642,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"750aec16-7f85-4302-b4c7-fb84702c7633","userId":"3QCCX-bIvBj9jx_n25cFO","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880337026,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9f29e2e0-9387-46be-b1e7-6a3ae818ac0a","userId":"3QCCX-bIvBj9jx_n25cFO","msg":"Error moving workflow"}
{"level":50,"time":1764880337515,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CGQ77tMxxx4-WAuAE4yVX) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"CGQ77tMxxx4-WAuAE4yVX","msg":"Failed to create user credentials"}
{"level":50,"time":1764880337515,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(CGQ77tMxxx4-WAuAE4yVX) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10192[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 569[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 383[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 491[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:58
[2m   Duration [22m 18.42s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx28 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764880371071,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880374090,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880377583,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880377584,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880377595,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880377595,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880377596,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880377596,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880378243,"env":"test","module":"user-credentials-repository","userId":"ESt3EtnaXwaJGRMYKdbaI","msg":"User credentials created"}
{"level":30,"time":1764880378246,"env":"test","module":"auth-routes","userId":"ESt3EtnaXwaJGRMYKdbaI","email":"test-workflows-twSDMaIe9n2Vetx6cKZ-b@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a94547b4-d0b4-45e3-bebe-1875255bfd40","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ESt3EtnaXwaJGRMYKdbaI","tenantId":"ddb1271c-4718-4856-a5ae-da35bd084214","createdBy":"ESt3EtnaXwaJGRMYKdbaI","ownerId":"ESt3EtnaXwaJGRMYKdbaI","status":"active","archived":false,"createdAt":"2025-12-04T20:32:59.961Z","updatedAt":"2025-12-04T20:32:59.961Z"}

{"level":30,"time":1764880378943,"env":"test","module":"user-credentials-repository","userId":"YbkxHbBEZTtSwHCzpuI8e","msg":"User credentials created"}
{"level":30,"time":1764880378944,"env":"test","module":"auth-routes","userId":"YbkxHbBEZTtSwHCzpuI8e","email":"viewer-eEkAS-uUK_iliKAyM-oJD@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880379040,"env":"test","module":"rbac-middleware","userId":"YbkxHbBEZTtSwHCzpuI8e","userRole":"viewer","permission":"workflow:create","path":"/projects/a94547b4-d0b4-45e3-bebe-1875255bfd40/workflows","msg":"Permission denied"}
{"level":50,"time":1764880385256,"env":"test","error":{},"workflowId":"7fa87714-f99e-4075-8962-383477191793","userId":"ESt3EtnaXwaJGRMYKdbaI","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880385586,"env":"test","module":"auth-middleware","path":"/api/workflows/85455adc-b686-477d-b1aa-38ffdfcc16c6/move","msg":"No valid authentication found"}
{"level":30,"time":1764880386088,"env":"test","module":"user-credentials-repository","userId":"1nNb6AGPBQGLRWp5AV2Fk","msg":"User credentials created"}
{"level":30,"time":1764880386089,"env":"test","module":"auth-routes","userId":"1nNb6AGPBQGLRWp5AV2Fk","email":"test-workflows-yL2UspX7hqlY7vD-hWj4w@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880386137,"env":"test","error":{},"workflowId":"56980a93-84db-4a71-85f5-3ec8fab0391f","userId":"1nNb6AGPBQGLRWp5AV2Fk","projectId":"5b7816b1-ecb0-45ca-a74f-8dc9457fde5c","msg":"Error moving workflow"}
{"level":50,"time":1764880386521,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"a2d009ed-c5b3-43e9-baec-cfe9d880bddf","userId":"ESt3EtnaXwaJGRMYKdbaI","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880386925,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ea2d0168-0f76-4539-912c-273f11bbc22b","userId":"ESt3EtnaXwaJGRMYKdbaI","msg":"Error moving workflow"}
{"level":30,"time":1764880387420,"env":"test","module":"user-credentials-repository","userId":"V6xX_lsL27ZIIjCkgWUln","msg":"User credentials created"}
{"level":30,"time":1764880387421,"env":"test","module":"auth-routes","userId":"V6xX_lsL27ZIIjCkgWUln","email":"test-workflows-EQuHiyfeks053TP43eIwL@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880387612,"env":"test","module":"auth-routes","userId":"V6xX_lsL27ZIIjCkgWUln","email":"test-workflows-EQuHiyfeks053TP43eIwL@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880387800,"env":"test","error":{},"workflowId":"c4cd323c-6f70-47df-b9c8-59e94759c664","userId":"ESt3EtnaXwaJGRMYKdbaI","projectId":"5d00b7b4-2c30-434d-bd4c-bb4229f3f65d","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 784[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 599[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 552[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 874[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:32:47
[2m   Duration [22m 19.56s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx29 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764891573354,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764891576606,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764891580767,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764891580768,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764891580778,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764891580778,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764891580779,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764891580779,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764891581207,"env":"test","module":"user-credentials-repository","userId":"cKfnIk1bnFYd7L_5JFAZL","msg":"User credentials created"}
{"level":30,"time":1764891581211,"env":"test","module":"auth-routes","userId":"cKfnIk1bnFYd7L_5JFAZL","email":"test-workflows-EMgC1LHSQ1Jl6lKCKTIp0@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"987a1761-893c-4af0-8b35-e288f805af1b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"cKfnIk1bnFYd7L_5JFAZL","tenantId":"3e0773d7-220e-4827-861b-1e092c822dd6","createdBy":"cKfnIk1bnFYd7L_5JFAZL","ownerId":"cKfnIk1bnFYd7L_5JFAZL","status":"active","archived":false,"createdAt":"2025-12-04T23:39:43.126Z","updatedAt":"2025-12-04T23:39:43.126Z"}

{"level":30,"time":1764891581877,"env":"test","module":"user-credentials-repository","userId":"mbH3so32xmHqrmW48YRRR","msg":"User credentials created"}
{"level":30,"time":1764891581878,"env":"test","module":"auth-routes","userId":"mbH3so32xmHqrmW48YRRR","email":"viewer-SnEOkW8ajey5GQ84kNA0m@example.com","msg":"User registered successfully"}
{"level":40,"time":1764891581984,"env":"test","module":"rbac-middleware","userId":"mbH3so32xmHqrmW48YRRR","userRole":"viewer","permission":"workflow:create","path":"/projects/987a1761-893c-4af0-8b35-e288f805af1b/workflows","msg":"Permission denied"}
{"level":50,"time":1764891587984,"env":"test","error":{},"workflowId":"1e0cfa3d-8374-449f-8cfc-acefcf1b120c","userId":"cKfnIk1bnFYd7L_5JFAZL","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764891588278,"env":"test","module":"auth-middleware","path":"/api/workflows/053967fa-26f5-4105-83e9-47414ba11388/move","msg":"No valid authentication found"}
{"level":30,"time":1764891588787,"env":"test","module":"user-credentials-repository","userId":"uNXfpefHl1otmmWCVFY7D","msg":"User credentials created"}
{"level":30,"time":1764891588788,"env":"test","module":"auth-routes","userId":"uNXfpefHl1otmmWCVFY7D","email":"test-workflows-4kFvXzZm11y56Mgk_5O7R@example.com","msg":"User registered successfully"}
{"level":50,"time":1764891588833,"env":"test","error":{},"workflowId":"143c0d66-347e-4003-a6d2-c422b84b9329","userId":"uNXfpefHl1otmmWCVFY7D","projectId":"bee2305e-77a3-40a1-9e3d-238ad12c2dd7","msg":"Error moving workflow"}
{"level":50,"time":1764891589175,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"4e6d3c68-c74a-43d7-b2c1-21d822cde046","userId":"cKfnIk1bnFYd7L_5JFAZL","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764891589538,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"cb96f706-95f1-4273-b975-0b1cf0729f6a","userId":"cKfnIk1bnFYd7L_5JFAZL","msg":"Error moving workflow"}
{"level":30,"time":1764891590033,"env":"test","module":"user-credentials-repository","userId":"B1DVp0Hk-4fWRb1rt_U5m","msg":"User credentials created"}
{"level":30,"time":1764891590033,"env":"test","module":"auth-routes","userId":"B1DVp0Hk-4fWRb1rt_U5m","email":"test-workflows-UL_HCH1xkCivp149GCvWT@example.com","msg":"User registered successfully"}
{"level":30,"time":1764891590231,"env":"test","module":"auth-routes","userId":"B1DVp0Hk-4fWRb1rt_U5m","email":"test-workflows-UL_HCH1xkCivp149GCvWT@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764891590412,"env":"test","error":{},"workflowId":"25b6f6a1-4d69-4b69-ab23-cd704575bf8d","userId":"cKfnIk1bnFYd7L_5JFAZL","projectId":"87ecb66f-73d7-4443-9c9f-970938c379a4","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9972[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 430[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 443[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 555[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 363[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 875[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:39:28
[2m   Duration [22m 21.38s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/auth.ts [22m[34mx30 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764892166217,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892169706,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892174079,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892174079,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892174091,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892174092,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892174092,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892174092,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892174654,"env":"test","module":"user-credentials-repository","userId":"p2Ub8YB1UwIdWS19pehf2","msg":"User credentials created"}
{"level":30,"time":1764892174658,"env":"test","module":"auth-routes","userId":"p2Ub8YB1UwIdWS19pehf2","email":"test-workflows-hQJEKjxbXnW6dFE694-L4@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e361ed3f-f417-4fc2-af7b-be6454cc50ee","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"p2Ub8YB1UwIdWS19pehf2","tenantId":"9012cfae-9717-4bef-8b8e-fd4db3fc0abf","createdBy":"p2Ub8YB1UwIdWS19pehf2","ownerId":"p2Ub8YB1UwIdWS19pehf2","status":"active","archived":false,"createdAt":"2025-12-04T23:49:36.581Z","updatedAt":"2025-12-04T23:49:36.581Z"}

{"level":30,"time":1764892175365,"env":"test","module":"user-credentials-repository","userId":"69EJ84DGX2lF4SYV8WgH9","msg":"User credentials created"}
{"level":30,"time":1764892175366,"env":"test","module":"auth-routes","userId":"69EJ84DGX2lF4SYV8WgH9","email":"viewer-QQZWPuegrF9qjR-C6NmKP@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892175467,"env":"test","module":"rbac-middleware","userId":"69EJ84DGX2lF4SYV8WgH9","userRole":"viewer","permission":"workflow:create","path":"/projects/e361ed3f-f417-4fc2-af7b-be6454cc50ee/workflows","msg":"Permission denied"}
{"level":50,"time":1764892181889,"env":"test","error":{},"workflowId":"0f1a53e4-93f3-4e6c-a190-4e194b08f67e","userId":"p2Ub8YB1UwIdWS19pehf2","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892182217,"env":"test","module":"auth-middleware","path":"/api/workflows/2461f566-eb6a-4c77-a8a7-8abfaed42ad3/move","msg":"No valid authentication found"}
{"level":30,"time":1764892182743,"env":"test","module":"user-credentials-repository","userId":"PCluS5pC7TGSd7OB9Y9Ky","msg":"User credentials created"}
{"level":30,"time":1764892182743,"env":"test","module":"auth-routes","userId":"PCluS5pC7TGSd7OB9Y9Ky","email":"test-workflows-79quo8jrQ8879rkX64zLb@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892182793,"env":"test","error":{},"workflowId":"a27b1f19-e81b-46e2-89e9-8fb3732a5701","userId":"PCluS5pC7TGSd7OB9Y9Ky","projectId":"7815626c-e2f8-4537-8ad9-578cd3c5eaef","msg":"Error moving workflow"}
{"level":50,"time":1764892183179,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"be246b81-f98f-4a7b-9dc4-0425385400d3","userId":"p2Ub8YB1UwIdWS19pehf2","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892183557,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bdba05ed-f7e3-47da-a0f1-72e7fa6d1eed","userId":"p2Ub8YB1UwIdWS19pehf2","msg":"Error moving workflow"}
{"level":30,"time":1764892184080,"env":"test","module":"user-credentials-repository","userId":"bY5cnnEJeXGmkbJDE-Hod","msg":"User credentials created"}
{"level":30,"time":1764892184080,"env":"test","module":"auth-routes","userId":"bY5cnnEJeXGmkbJDE-Hod","email":"test-workflows-IBTzcRaeEnSxKoisCBeIV@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892184282,"env":"test","module":"auth-routes","userId":"bY5cnnEJeXGmkbJDE-Hod","email":"test-workflows-IBTzcRaeEnSxKoisCBeIV@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892184465,"env":"test","error":{},"workflowId":"e266793f-1755-48e8-8d36-88faee966550","userId":"p2Ub8YB1UwIdWS19pehf2","projectId":"d0397da4-9259-40c6-bdd2-2a05ee53cb1e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 495[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 386[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 910[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:49:20
[2m   Duration [22m 22.71s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx31 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764892481194,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892486475,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892488781,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892488782,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892488792,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892488792,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892488793,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892488793,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892489270,"env":"test","module":"user-credentials-repository","userId":"JUej-02pfXyXWel1QcMmD","msg":"User credentials created"}
{"level":30,"time":1764892489275,"env":"test","module":"auth-routes","userId":"JUej-02pfXyXWel1QcMmD","email":"test-workflows-HdVQXWDudpnCbrzxR4nvH@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"426d5815-5648-452a-ac64-8c5eabe3a3e0","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"JUej-02pfXyXWel1QcMmD","tenantId":"184981bd-9f91-4aa7-9421-461d9f3f870e","createdBy":"JUej-02pfXyXWel1QcMmD","ownerId":"JUej-02pfXyXWel1QcMmD","status":"active","archived":false,"createdAt":"2025-12-04T23:54:51.209Z","updatedAt":"2025-12-04T23:54:51.209Z"}

{"level":30,"time":1764892489977,"env":"test","module":"user-credentials-repository","userId":"TyQngadcjPGaQpqbLFb9O","msg":"User credentials created"}
{"level":30,"time":1764892489978,"env":"test","module":"auth-routes","userId":"TyQngadcjPGaQpqbLFb9O","email":"viewer-dIpTLY1Sujge0-R9XNYQG@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892490078,"env":"test","module":"rbac-middleware","userId":"TyQngadcjPGaQpqbLFb9O","userRole":"viewer","permission":"workflow:create","path":"/projects/426d5815-5648-452a-ac64-8c5eabe3a3e0/workflows","msg":"Permission denied"}
{"level":50,"time":1764892496651,"env":"test","error":{},"workflowId":"954641a7-6498-4b42-902f-faa0ff277cc5","userId":"JUej-02pfXyXWel1QcMmD","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892496990,"env":"test","module":"auth-middleware","path":"/api/workflows/1dea4a2c-099d-4f46-91ec-d1ac886d7333/move","msg":"No valid authentication found"}
{"level":30,"time":1764892497549,"env":"test","module":"user-credentials-repository","userId":"sya46Nd7-934dC9d5ypuh","msg":"User credentials created"}
{"level":30,"time":1764892497549,"env":"test","module":"auth-routes","userId":"sya46Nd7-934dC9d5ypuh","email":"test-workflows-3MXV8626Y1vNKWpicTURK@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892497643,"env":"test","error":{},"workflowId":"cecf8727-fb0d-4292-9cdc-596035f70385","userId":"sya46Nd7-934dC9d5ypuh","projectId":"b5cd2e02-0337-4221-a9f6-a78586570df8","msg":"Error moving workflow"}
{"level":50,"time":1764892498031,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6537dc4e-6055-4eb5-b258-dfdae1b6e0bb","userId":"JUej-02pfXyXWel1QcMmD","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892498212,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(JUej-02pfXyXWel1QcMmD) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"JUej-02pfXyXWel1QcMmD","msg":"Error creating workflow"}
{"level":50,"time":1764892498397,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(JUej-02pfXyXWel1QcMmD) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"JUej-02pfXyXWel1QcMmD","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 9951[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 801[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 669[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 814[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 530[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 338[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 387[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 180[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 185[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:36
[2m   Duration [22m 20.97s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx32 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764892503198,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892505537,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892507626,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892507626,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892507636,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892507636,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892507636,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892507636,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892508088,"env":"test","module":"user-credentials-repository","userId":"QAp_SyzNyJr3BLn67yJ1d","msg":"User credentials created"}
{"level":30,"time":1764892508091,"env":"test","module":"auth-routes","userId":"QAp_SyzNyJr3BLn67yJ1d","email":"test-workflows-CRuQpDDPv4RBFmIKwqxrY@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2fe056c4-b721-44aa-95a4-f333ed50c0b9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"QAp_SyzNyJr3BLn67yJ1d","tenantId":"a2349054-2153-4405-83b8-5111488a242a","createdBy":"QAp_SyzNyJr3BLn67yJ1d","ownerId":"QAp_SyzNyJr3BLn67yJ1d","status":"active","archived":false,"createdAt":"2025-12-04T23:55:10.020Z","updatedAt":"2025-12-04T23:55:10.020Z"}

{"level":30,"time":1764892508781,"env":"test","module":"user-credentials-repository","userId":"n5n5MgcmzX-J9lQ6aQtiF","msg":"User credentials created"}
{"level":30,"time":1764892508781,"env":"test","module":"auth-routes","userId":"n5n5MgcmzX-J9lQ6aQtiF","email":"viewer-mmMkcC2IWELGMeqPDysFS@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892508883,"env":"test","module":"rbac-middleware","userId":"n5n5MgcmzX-J9lQ6aQtiF","userRole":"viewer","permission":"workflow:create","path":"/projects/2fe056c4-b721-44aa-95a4-f333ed50c0b9/workflows","msg":"Permission denied"}
{"level":50,"time":1764892515330,"env":"test","error":{},"workflowId":"591bceac-bda7-47e3-8bbf-b671654bc5e5","userId":"QAp_SyzNyJr3BLn67yJ1d","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892515664,"env":"test","module":"auth-middleware","path":"/api/workflows/9fea2a32-51bf-4d75-92ab-e89c4f7ff2b7/move","msg":"No valid authentication found"}
{"level":30,"time":1764892516219,"env":"test","module":"user-credentials-repository","userId":"BgWlfvff0Uj6N0EGkg_VJ","msg":"User credentials created"}
{"level":30,"time":1764892516219,"env":"test","module":"auth-routes","userId":"BgWlfvff0Uj6N0EGkg_VJ","email":"test-workflows-ynMjG20njYZXcGkVOClwW@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892516273,"env":"test","error":{},"workflowId":"2c0f422e-e98d-4801-84b3-bd73f3ce8cb9","userId":"BgWlfvff0Uj6N0EGkg_VJ","projectId":"dc63e68c-5404-43e7-b1a7-4f0f0d256de0","msg":"Error moving workflow"}
{"level":50,"time":1764892516785,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f6fa185a-b771-40aa-b628-26ef8f85cb02","userId":"QAp_SyzNyJr3BLn67yJ1d","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892516973,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(QAp_SyzNyJr3BLn67yJ1d) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"QAp_SyzNyJr3BLn67yJ1d","msg":"Error creating workflow"}
{"level":50,"time":1764892517163,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(QAp_SyzNyJr3BLn67yJ1d) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"QAp_SyzNyJr3BLn67yJ1d","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9804[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 340[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 299[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 858[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 513[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 189[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 188[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:58
[2m   Duration [22m 17.56s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx33 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764895078106,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895080776,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895084498,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895084499,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895084509,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895084510,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895084510,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895084510,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895084975,"env":"test","module":"user-credentials-repository","userId":"dO4VrC0g8PWdJk3DZOAwq","msg":"User credentials created"}
{"level":30,"time":1764895084978,"env":"test","module":"auth-routes","userId":"dO4VrC0g8PWdJk3DZOAwq","email":"test-workflows--jGdyonVoAy-UflPYxGiO@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"375d0a62-60ba-491e-a227-fed06d06f9f4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"dO4VrC0g8PWdJk3DZOAwq","tenantId":"c3ef6b3d-1482-480e-b734-d47d448e5c9f","createdBy":"dO4VrC0g8PWdJk3DZOAwq","ownerId":"dO4VrC0g8PWdJk3DZOAwq","status":"active","archived":false,"createdAt":"2025-12-05T00:38:05.136Z","updatedAt":"2025-12-05T00:38:05.136Z"}

{"level":30,"time":1764895085603,"env":"test","module":"user-credentials-repository","userId":"sUPIfRBHpqZJcPyt3sJR5","msg":"User credentials created"}
{"level":30,"time":1764895085604,"env":"test","module":"auth-routes","userId":"sUPIfRBHpqZJcPyt3sJR5","email":"viewer-ry9sb3fACNVk6NG1NvBBh@example.com","msg":"User registered successfully"}
{"level":40,"time":1764895085702,"env":"test","module":"rbac-middleware","userId":"sUPIfRBHpqZJcPyt3sJR5","userRole":"viewer","permission":"workflow:create","path":"/projects/375d0a62-60ba-491e-a227-fed06d06f9f4/workflows","msg":"Permission denied"}
{"level":50,"time":1764895091432,"env":"test","error":{},"workflowId":"d6ebc347-5d78-47c6-89d6-3c4255bfa104","userId":"dO4VrC0g8PWdJk3DZOAwq","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764895091729,"env":"test","module":"auth-middleware","path":"/api/workflows/7c939565-fb2f-4266-8ea6-8451be5e4953/move","msg":"No valid authentication found"}
{"level":30,"time":1764895092232,"env":"test","module":"user-credentials-repository","userId":"0zKt74-CghNkXG9q65syM","msg":"User credentials created"}
{"level":30,"time":1764895092232,"env":"test","module":"auth-routes","userId":"0zKt74-CghNkXG9q65syM","email":"test-workflows-PcuNx7JBudQrIqw5B4pnu@example.com","msg":"User registered successfully"}
{"level":50,"time":1764895092276,"env":"test","error":{},"workflowId":"24ca6d58-71ea-4d36-9d9d-4c7e75cb4150","userId":"0zKt74-CghNkXG9q65syM","projectId":"d697a046-161e-4d10-89b0-ddb1f428f3ef","msg":"Error moving workflow"}
{"level":50,"time":1764895092616,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"fc13bf10-4f27-4b49-8efc-847ddeee3590","userId":"dO4VrC0g8PWdJk3DZOAwq","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764895092964,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ffd10db4-65b3-49b4-b360-d8dc8bcd1d6e","userId":"dO4VrC0g8PWdJk3DZOAwq","msg":"Error moving workflow"}
{"level":30,"time":1764895093427,"env":"test","module":"user-credentials-repository","userId":"N9gzWHHV7WSRUjRmY4MfM","msg":"User credentials created"}
{"level":30,"time":1764895093427,"env":"test","module":"auth-routes","userId":"N9gzWHHV7WSRUjRmY4MfM","email":"test-workflows-vdXv3XPGW5RnCBbDNJdik@example.com","msg":"User registered successfully"}
{"level":30,"time":1764895093609,"env":"test","module":"auth-routes","userId":"N9gzWHHV7WSRUjRmY4MfM","email":"test-workflows-vdXv3XPGW5RnCBbDNJdik@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764895093783,"env":"test","error":{},"workflowId":"e3e4c490-9023-4b86-9359-eb4f1faebf15","userId":"dO4VrC0g8PWdJk3DZOAwq","projectId":"8877f729-59c4-47c8-8809-b37d72f34ca4","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9619[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create a new draft workflow[32m 297[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 286[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 401[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 542[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 565[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 682[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 409[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 297[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 820[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 18:37:52
[2m   Duration [22m 20.06s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
