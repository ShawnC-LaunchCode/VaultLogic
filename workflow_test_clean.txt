npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764861906244,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764861907434,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764861908521,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764861908521,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764861908526,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764861908526,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764861908527,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764861908527,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764861908959,"env":"test","module":"user-credentials-repository","userId":"-scPsB1gh5zgV2hSc7P00","msg":"User credentials created"}
{"level":30,"time":1764861908961,"env":"test","module":"auth-routes","userId":"-scPsB1gh5zgV2hSc7P00","email":"test-workflows-qK3ie7Je2laYAXkJ8SvvK@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"65c8c2f0-dc4f-4197-9ac1-10098fae7e96","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"-scPsB1gh5zgV2hSc7P00","tenantId":"fb734533-f722-4e52-a0a3-6c4ff1176037","createdBy":"-scPsB1gh5zgV2hSc7P00","ownerId":"-scPsB1gh5zgV2hSc7P00","status":"active","archived":false,"createdAt":"2025-12-04T15:25:10.359Z","updatedAt":"2025-12-04T15:25:10.359Z"}

{"level":30,"time":1764861909628,"env":"test","module":"user-credentials-repository","userId":"ToeHC_MI2xT-G5IVI2hzX","msg":"User credentials created"}
{"level":30,"time":1764861909628,"env":"test","module":"auth-routes","userId":"ToeHC_MI2xT-G5IVI2hzX","email":"viewer--BeIHKqjaziYlpm55SngF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764861909723,"env":"test","module":"rbac-middleware","userId":"ToeHC_MI2xT-G5IVI2hzX","userRole":"viewer","permission":"workflow:create","path":"/projects/65c8c2f0-dc4f-4197-9ac1-10098fae7e96/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 6785[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 340[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 288[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 666[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 780[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[32m 96[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[32m 90[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[32m 96[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without authentication[39m[32m 96[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 95[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 90[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 95[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 93[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 8 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without authentication
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
ReferenceError: projectResponse is not defined
 Î“Â¥Â» tests/integration/api.workflows.test.ts:284:7
    282|           description: "Target project for move tests",
    283|         });
    284|       targetProjectId = projectResponse.body.id;
       |       ^
    285|     });
    286| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/8]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m9 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 09:25:04
[2m   Duration [22m 11.14s[2m (transform 1.75s, setup 545ms, collect 3.30s, tests 6.78s, environment 0ms, prepare 11ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764862028002,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764862029202,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764862030584,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764862030584,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764862030591,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764862030591,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764862030591,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764862030591,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764862031041,"env":"test","module":"user-credentials-repository","userId":"5bGkWkVICU_MnK-LP91Kn","msg":"User credentials created"}
{"level":30,"time":1764862031044,"env":"test","module":"auth-routes","userId":"5bGkWkVICU_MnK-LP91Kn","email":"test-workflows-yE7vT_IZ2Qht76REYYPjy@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a4131c7a-f5f5-4126-ad73-14785713834f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"5bGkWkVICU_MnK-LP91Kn","tenantId":"1867a623-8e25-414d-99c9-dfc977c8d828","createdBy":"5bGkWkVICU_MnK-LP91Kn","ownerId":"5bGkWkVICU_MnK-LP91Kn","status":"active","archived":false,"createdAt":"2025-12-04T15:27:12.470Z","updatedAt":"2025-12-04T15:27:12.470Z"}

{"level":30,"time":1764862031768,"env":"test","module":"user-credentials-repository","userId":"uLMzfln7gN2uZaLzCPrCy","msg":"User credentials created"}
{"level":30,"time":1764862031769,"env":"test","module":"auth-routes","userId":"uLMzfln7gN2uZaLzCPrCy","email":"viewer-hy30r8wRTO3PcrS4aUD2x@example.com","msg":"User registered successfully"}
{"level":40,"time":1764862031869,"env":"test","module":"rbac-middleware","userId":"uLMzfln7gN2uZaLzCPrCy","userRole":"viewer","permission":"workflow:create","path":"/projects/a4131c7a-f5f5-4126-ad73-14785713834f/workflows","msg":"Permission denied"}
{"level":50,"time":1764862038757,"env":"test","error":{},"workflowId":"bad3224f-d270-4418-a4b9-8517eafcb8fc","userId":"5bGkWkVICU_MnK-LP91Kn","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764862039116,"env":"test","module":"auth-middleware","path":"/api/workflows/4bb42d72-ac37-4832-b527-6adb8c61d098/move","msg":"No valid authentication found"}
{"level":30,"time":1764862039675,"env":"test","module":"user-credentials-repository","userId":"097XJLVQ1bieigUDcL7qx","msg":"User credentials created"}
{"level":30,"time":1764862039675,"env":"test","module":"auth-routes","userId":"097XJLVQ1bieigUDcL7qx","email":"test-workflows-nX1RzAMTwV09X7Vawl2_G@example.com","msg":"User registered successfully"}
{"level":50,"time":1764862039728,"env":"test","error":{},"workflowId":"9bd498a0-b646-4887-864b-1e5965a684e0","userId":"097XJLVQ1bieigUDcL7qx","projectId":"cd02900c-2f1b-49e3-8d07-290ad5f8ac25","msg":"Error moving workflow"}
{"level":50,"time":1764862040136,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"aa7ac299-3aae-47d9-94bf-ca8e95301f05","userId":"5bGkWkVICU_MnK-LP91Kn","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764862040566,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"6371a48b-7a86-4bbe-b7f1-3cc7ec5dcfec","userId":"5bGkWkVICU_MnK-LP91Kn","msg":"Error moving workflow"}
{"level":30,"time":1764862041131,"env":"test","module":"user-credentials-repository","userId":"BbUX7tNnSMJLqHG7oOo1d","msg":"User credentials created"}
{"level":30,"time":1764862041131,"env":"test","module":"auth-routes","userId":"BbUX7tNnSMJLqHG7oOo1d","email":"test-workflows-7dLTN3AJ9aFjqT0feGE5B@example.com","msg":"User registered successfully"}
{"level":30,"time":1764862041322,"env":"test","module":"auth-routes","userId":"BbUX7tNnSMJLqHG7oOo1d","email":"test-workflows-7dLTN3AJ9aFjqT0feGE5B@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764862041552,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"00bda7d4-55d6-47a8-bb76-b231a2c15fab","userId":"5bGkWkVICU_MnK-LP91Kn","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11255[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 503[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 877[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 815[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 685[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 817[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 693[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 838[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 526[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 407[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 431[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 986[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 09:27:06
[2m   Duration [22m 15.35s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764866788425,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764866789749,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764866791186,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764866791186,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764866791195,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764866791195,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764866791195,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764866791195,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764866791633,"env":"test","module":"user-credentials-repository","userId":"bfAeHoNn-AyUKG7e4KJ-X","msg":"User credentials created"}
{"level":30,"time":1764866791637,"env":"test","module":"auth-routes","userId":"bfAeHoNn-AyUKG7e4KJ-X","email":"test-workflows-qcP5RgeR6PfgOeZY3m3nL@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"181a1ca1-d0b5-472a-b929-52797967f949","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"bfAeHoNn-AyUKG7e4KJ-X","tenantId":"67f13e20-f587-48de-b43b-937c5e8cc991","createdBy":"bfAeHoNn-AyUKG7e4KJ-X","ownerId":"bfAeHoNn-AyUKG7e4KJ-X","status":"active","archived":false,"createdAt":"2025-12-04T16:46:33.123Z","updatedAt":"2025-12-04T16:46:33.123Z"}

{"level":30,"time":1764866792326,"env":"test","module":"user-credentials-repository","userId":"2R-_bQWS_GOQ1lTJTv_x4","msg":"User credentials created"}
{"level":30,"time":1764866792327,"env":"test","module":"auth-routes","userId":"2R-_bQWS_GOQ1lTJTv_x4","email":"viewer-Q6oe41FRRLMXP8xXHGthf@example.com","msg":"User registered successfully"}
{"level":40,"time":1764866792427,"env":"test","module":"rbac-middleware","userId":"2R-_bQWS_GOQ1lTJTv_x4","userRole":"viewer","permission":"workflow:create","path":"/projects/181a1ca1-d0b5-472a-b929-52797967f949/workflows","msg":"Permission denied"}
{"level":50,"time":1764866799445,"env":"test","error":{},"workflowId":"0e1384ce-dcf9-43ba-9cb6-eac7dbb2b711","userId":"bfAeHoNn-AyUKG7e4KJ-X","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764866799794,"env":"test","module":"auth-middleware","path":"/api/workflows/b4f62101-6e89-4256-bceb-4c6f69549db6/move","msg":"No valid authentication found"}
{"level":30,"time":1764866800361,"env":"test","module":"user-credentials-repository","userId":"pSJ9qOWmSPlC1GtXXHHw8","msg":"User credentials created"}
{"level":30,"time":1764866800362,"env":"test","module":"auth-routes","userId":"pSJ9qOWmSPlC1GtXXHHw8","email":"test-workflows-KuFS7gECEh0lMph3bzZLw@example.com","msg":"User registered successfully"}
{"level":50,"time":1764866800419,"env":"test","error":{},"workflowId":"50d570b0-27ee-4328-b134-264e9a6eb84c","userId":"pSJ9qOWmSPlC1GtXXHHw8","projectId":"047c7ef0-71e5-4291-9ccc-4e06d8981eae","msg":"Error moving workflow"}
{"level":50,"time":1764866800838,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"532ae348-2915-4214-a936-d0913be86af4","userId":"bfAeHoNn-AyUKG7e4KJ-X","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764866801243,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"193a37d6-c158-4577-b09a-1d260f71cd98","userId":"bfAeHoNn-AyUKG7e4KJ-X","msg":"Error moving workflow"}
{"level":30,"time":1764866801822,"env":"test","module":"user-credentials-repository","userId":"1prtEP7sEHj9FgnWxsfhk","msg":"User credentials created"}
{"level":30,"time":1764866801823,"env":"test","module":"auth-routes","userId":"1prtEP7sEHj9FgnWxsfhk","email":"test-workflows-TFvmFrpBCgrsebL_afxSF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764866801984,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764866802040,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"7f6bf0f1-b185-42af-96ac-a333c9ce755b","userId":"bfAeHoNn-AyUKG7e4KJ-X","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11144[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 353[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 518[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 507[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 888[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 671[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 815[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 680[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 882[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 686[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 861[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 508[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 418[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 405[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 797[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:46:26
[2m   Duration [22m 15.75s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764867267344,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867268861,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867270543,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867270543,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867270551,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867270551,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867270551,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867270551,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867270968,"env":"test","module":"user-credentials-repository","userId":"9PieD9gaGyFsqWCv_0uSc","msg":"User credentials created"}
{"level":30,"time":1764867270971,"env":"test","module":"auth-routes","userId":"9PieD9gaGyFsqWCv_0uSc","email":"test-workflows-cfnByzVJfEtGp614KwRID@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"86cf0d37-e372-451d-b55b-78daa972c55f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"9PieD9gaGyFsqWCv_0uSc","tenantId":"02036ce0-c685-46d3-8285-a2ce6b2e11f4","createdBy":"9PieD9gaGyFsqWCv_0uSc","ownerId":"9PieD9gaGyFsqWCv_0uSc","status":"active","archived":false,"createdAt":"2025-12-04T16:54:32.457Z","updatedAt":"2025-12-04T16:54:32.457Z"}

{"level":30,"time":1764867271645,"env":"test","module":"user-credentials-repository","userId":"nXUyHYH7kLNGRM66KvPzr","msg":"User credentials created"}
{"level":30,"time":1764867271646,"env":"test","module":"auth-routes","userId":"nXUyHYH7kLNGRM66KvPzr","email":"viewer-1cw935miKhNb7KfOBwBGY@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867271776,"env":"test","module":"rbac-middleware","userId":"nXUyHYH7kLNGRM66KvPzr","userRole":"viewer","permission":"workflow:create","path":"/projects/86cf0d37-e372-451d-b55b-78daa972c55f/workflows","msg":"Permission denied"}
{"level":50,"time":1764867278360,"env":"test","error":{},"workflowId":"12a04e3d-081b-46ff-8ae6-3ea12fc8a8d9","userId":"9PieD9gaGyFsqWCv_0uSc","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867278698,"env":"test","module":"auth-middleware","path":"/api/workflows/3fdf3315-23e5-42c3-bce5-0048261531a4/move","msg":"No valid authentication found"}
{"level":30,"time":1764867279271,"env":"test","module":"user-credentials-repository","userId":"5PqX0ktg9yXm7Hmyg4o7U","msg":"User credentials created"}
{"level":30,"time":1764867279271,"env":"test","module":"auth-routes","userId":"5PqX0ktg9yXm7Hmyg4o7U","email":"test-workflows-ukSTSun2mQb9WV56Ihl2f@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867279316,"env":"test","error":{},"workflowId":"1c445b08-ed46-4d91-88fa-26c2c7f74700","userId":"5PqX0ktg9yXm7Hmyg4o7U","projectId":"3f1ced69-ca04-40ee-97cf-4bb693d12444","msg":"Error moving workflow"}
{"level":50,"time":1764867279692,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8fe921d1-4f4e-4483-a357-9258b0ce07cb","userId":"9PieD9gaGyFsqWCv_0uSc","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867280070,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"48e70276-a0e6-49b8-a326-095793e10e53","userId":"9PieD9gaGyFsqWCv_0uSc","msg":"Error moving workflow"}
{"level":30,"time":1764867280616,"env":"test","module":"user-credentials-repository","userId":"54yowfc8Y-2E2LV1I1JiH","msg":"User credentials created"}
{"level":30,"time":1764867280616,"env":"test","module":"auth-routes","userId":"54yowfc8Y-2E2LV1I1JiH","email":"test-workflows--IJLnV58lK3OJHodwEDc_@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867280838,"env":"test","module":"auth-routes","userId":"54yowfc8Y-2E2LV1I1JiH","email":"test-workflows--IJLnV58lK3OJHodwEDc_@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867281051,"env":"test","error":{},"workflowId":"3db072f3-13b9-49b6-a19e-2ae591a560a0","userId":"9PieD9gaGyFsqWCv_0uSc","projectId":"16b8a553-6462-45a3-8366-177554ae0433","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 850[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 681[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 635[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 803[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 618[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 981[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:54:25
[2m   Duration [22m 15.88s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764867556304,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867558547,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867560734,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867560735,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867560743,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867560743,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867560744,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867560744,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867561193,"env":"test","module":"user-credentials-repository","userId":"TGU-pxWqXSJFDEvOV4oyM","msg":"User credentials created"}
{"level":30,"time":1764867561196,"env":"test","module":"auth-routes","userId":"TGU-pxWqXSJFDEvOV4oyM","email":"test-workflows-4CKM6YN5ZkVaKwBcAMzoR@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a95aa66e-864b-40cc-8368-4750ad2f2a45","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"TGU-pxWqXSJFDEvOV4oyM","tenantId":"9d706510-ec1a-4b87-9a53-6f5d1758ee46","createdBy":"TGU-pxWqXSJFDEvOV4oyM","ownerId":"TGU-pxWqXSJFDEvOV4oyM","status":"active","archived":false,"createdAt":"2025-12-04T16:59:22.699Z","updatedAt":"2025-12-04T16:59:22.699Z"}

{"level":30,"time":1764867561871,"env":"test","module":"user-credentials-repository","userId":"ECco26j6tyjD-yEjbmLgS","msg":"User credentials created"}
{"level":30,"time":1764867561872,"env":"test","module":"auth-routes","userId":"ECco26j6tyjD-yEjbmLgS","email":"viewer-M2wnkO5919MXcWcnKmxfI@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867561973,"env":"test","module":"rbac-middleware","userId":"ECco26j6tyjD-yEjbmLgS","userRole":"viewer","permission":"workflow:create","path":"/projects/a95aa66e-864b-40cc-8368-4750ad2f2a45/workflows","msg":"Permission denied"}
{"level":50,"time":1764867568153,"env":"test","error":{},"workflowId":"29898256-e1af-41e8-88bf-2e0e9bf1c7af","userId":"TGU-pxWqXSJFDEvOV4oyM","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867568482,"env":"test","module":"auth-middleware","path":"/api/workflows/82e76a76-6719-4a87-a4cd-dd940fcf7822/move","msg":"No valid authentication found"}
{"level":30,"time":1764867568980,"env":"test","module":"user-credentials-repository","userId":"wB_3WbgI3Sg4dGw9ABBZy","msg":"User credentials created"}
{"level":30,"time":1764867568980,"env":"test","module":"auth-routes","userId":"wB_3WbgI3Sg4dGw9ABBZy","email":"test-workflows-OKiNqBym32RFjWMgi2Gjd@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867569034,"env":"test","error":{},"workflowId":"c9c9b2ab-fc25-4e05-8da0-b95188af70a9","userId":"wB_3WbgI3Sg4dGw9ABBZy","projectId":"3704e423-fe3a-4799-b934-18c634a68e83","msg":"Error moving workflow"}
{"level":50,"time":1764867569391,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"90b16e81-ddbf-4d74-b461-a8ff52cedd6d","userId":"TGU-pxWqXSJFDEvOV4oyM","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867569759,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0cfced2a-4369-4c64-b993-56a8fcb015cf","userId":"TGU-pxWqXSJFDEvOV4oyM","msg":"Error moving workflow"}
{"level":30,"time":1764867570313,"env":"test","module":"user-credentials-repository","userId":"SGcJWe47c3H9Qfd8X8nPd","msg":"User credentials created"}
{"level":30,"time":1764867570314,"env":"test","module":"auth-routes","userId":"SGcJWe47c3H9Qfd8X8nPd","email":"test-workflows-ZtfGFTx6kFS3o36uYGSVY@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867570448,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764867570494,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8dcb7717-e6c4-4c77-b2c8-480da8672bdd","userId":"TGU-pxWqXSJFDEvOV4oyM","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10035[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 311[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 582[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 606[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 632[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 720[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 553[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 735[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to

Error: expected 403 "Forbidden", got 400 "Bad Request"
[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:59:13
[2m   Duration [22m 17.02s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764867688810,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867690599,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867692381,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867692382,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867692394,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867692394,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867692394,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867692394,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867692840,"env":"test","module":"user-credentials-repository","userId":"12RbUz1_V5_W7xeWPekss","msg":"User credentials created"}
{"level":30,"time":1764867692842,"env":"test","module":"auth-routes","userId":"12RbUz1_V5_W7xeWPekss","email":"test-workflows-Mp2ypQiQAH5y0hby_nRuK@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"71e61bf0-7970-4fee-835f-0c5a23aee622","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"12RbUz1_V5_W7xeWPekss","tenantId":"f2d976ff-d5e8-4ee1-a377-8212aef8e1a6","createdBy":"12RbUz1_V5_W7xeWPekss","ownerId":"12RbUz1_V5_W7xeWPekss","status":"active","archived":false,"createdAt":"2025-12-04T17:01:34.348Z","updatedAt":"2025-12-04T17:01:34.348Z"}

{"level":30,"time":1764867693506,"env":"test","module":"user-credentials-repository","userId":"bxIAgWw_WruPqGNzm0e9g","msg":"User credentials created"}
{"level":30,"time":1764867693508,"env":"test","module":"auth-routes","userId":"bxIAgWw_WruPqGNzm0e9g","email":"viewer-QrF7uSEpjIEnmg5rFfTUm@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867693597,"env":"test","module":"rbac-middleware","userId":"bxIAgWw_WruPqGNzm0e9g","userRole":"viewer","permission":"workflow:create","path":"/projects/71e61bf0-7970-4fee-835f-0c5a23aee622/workflows","msg":"Permission denied"}
{"level":50,"time":1764867699470,"env":"test","error":{},"workflowId":"866fe795-9fda-4f5c-8154-1665f8c5ebb3","userId":"12RbUz1_V5_W7xeWPekss","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867699776,"env":"test","module":"auth-middleware","path":"/api/workflows/cf40fb57-062c-4a40-8b54-ace7d9bd8454/move","msg":"No valid authentication found"}
{"level":30,"time":1764867700256,"env":"test","module":"user-credentials-repository","userId":"irk9HhHJuiFSIhTHo1ECl","msg":"User credentials created"}
{"level":30,"time":1764867700257,"env":"test","module":"auth-routes","userId":"irk9HhHJuiFSIhTHo1ECl","email":"test-workflows-CvXlc-sLrsTP82hcmPy85@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867700310,"env":"test","error":{},"workflowId":"ae032864-6bb0-4bb2-8253-47a10332e041","userId":"irk9HhHJuiFSIhTHo1ECl","projectId":"b1b1dddb-ec8d-41e5-82d3-884a55569fa5","msg":"Error moving workflow"}
{"level":50,"time":1764867700691,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"fc015f01-b083-468e-9ab4-6baaf724a63f","userId":"12RbUz1_V5_W7xeWPekss","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867701027,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2f95ffb2-a478-4a02-acbc-9014cca0fe11","userId":"12RbUz1_V5_W7xeWPekss","msg":"Error moving workflow"}
{"level":30,"time":1764867701515,"env":"test","module":"user-credentials-repository","userId":"VR-yPcmlrUUtyGkgkiiZi","msg":"User credentials created"}
{"level":30,"time":1764867701515,"env":"test","module":"auth-routes","userId":"VR-yPcmlrUUtyGkgkiiZi","email":"test-workflows-WASOdorazIxO72u2H238Z@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867701696,"env":"test","module":"auth-routes","userId":"VR-yPcmlrUUtyGkgkiiZi","email":"test-workflows-WASOdorazIxO72u2H238Z@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867701871,"env":"test","error":{},"workflowId":"c93518bf-7a6f-4381-bf29-a07b34ecfd49","userId":"12RbUz1_V5_W7xeWPekss","projectId":"190b1ae4-434a-450b-b54a-52b0d5dd8c12","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 324[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 286[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 563[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 534[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 844[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:01:26
[2m   Duration [22m 15.58s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764868031251,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868033418,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868035486,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868035487,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868035497,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868035497,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868035497,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868035497,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868037007,"env":"test","module":"user-credentials-repository","userId":"dsIGcLutvcNC8eQQOp-Gr","msg":"User credentials created"}
{"level":30,"time":1764868037011,"env":"test","module":"auth-routes","userId":"dsIGcLutvcNC8eQQOp-Gr","email":"test-workflows-e_adLTv5bvxFvgFgMnoKJ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"6d6e4a50-6117-4733-b330-b3dfa2d4fc75","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"dsIGcLutvcNC8eQQOp-Gr","tenantId":"913ab938-538c-492d-a982-32b19037fd82","createdBy":"dsIGcLutvcNC8eQQOp-Gr","ownerId":"dsIGcLutvcNC8eQQOp-Gr","status":"active","archived":false,"createdAt":"2025-12-04T17:07:18.530Z","updatedAt":"2025-12-04T17:07:18.530Z"}

{"level":30,"time":1764868037698,"env":"test","module":"user-credentials-repository","userId":"d1VpNWARoWy5qwaoVxoX9","msg":"User credentials created"}
{"level":30,"time":1764868037699,"env":"test","module":"auth-routes","userId":"d1VpNWARoWy5qwaoVxoX9","email":"viewer-q0Ywii8DSHtzNST2x0eaN@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868037795,"env":"test","module":"rbac-middleware","userId":"d1VpNWARoWy5qwaoVxoX9","userRole":"viewer","permission":"workflow:create","path":"/projects/6d6e4a50-6117-4733-b330-b3dfa2d4fc75/workflows","msg":"Permission denied"}
{"level":50,"time":1764868044436,"env":"test","error":{},"workflowId":"419a762a-efac-4483-8852-d6d82f1eb377","userId":"dsIGcLutvcNC8eQQOp-Gr","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868044784,"env":"test","module":"auth-middleware","path":"/api/workflows/003ba688-7cbc-41af-acfa-dc00fab63fb9/move","msg":"No valid authentication found"}
{"level":30,"time":1764868045369,"env":"test","module":"user-credentials-repository","userId":"JN4qSpjzVX6OpUvwthM47","msg":"User credentials created"}
{"level":30,"time":1764868045370,"env":"test","module":"auth-routes","userId":"JN4qSpjzVX6OpUvwthM47","email":"test-workflows-RoLzk9S7xLAHr4uiWyuS3@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868045421,"env":"test","error":{},"workflowId":"f874d532-8522-4fcf-947a-563839180414","userId":"JN4qSpjzVX6OpUvwthM47","projectId":"1c58f6c0-29fa-438c-9edf-72cc3f14b5f9","msg":"Error moving workflow"}
{"level":50,"time":1764868045805,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"fc43ef92-aeac-43cd-b67b-810591901017","userId":"dsIGcLutvcNC8eQQOp-Gr","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868046212,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"bb9502d8-54b2-45a0-b39d-a3c696008add","userId":"dsIGcLutvcNC8eQQOp-Gr","msg":"Error moving workflow"}
{"level":50,"time":1764868046795,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(MdubU9a4SzUeNNVHoNxSk) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"MdubU9a4SzUeNNVHoNxSk","msg":"Failed to create user credentials"}
{"level":50,"time":1764868046796,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(MdubU9a4SzUeNNVHoNxSk) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11685[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 301[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 682[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 644[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 827[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 408[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 584[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:07:08
[2m   Duration [22m 18.11s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764868270523,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868272152,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868274009,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868274010,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868274024,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868274024,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868274024,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868274025,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868274483,"env":"test","module":"user-credentials-repository","userId":"tGbJe37dKTIukTU4Aq-8Q","msg":"User credentials created"}
{"level":30,"time":1764868274485,"env":"test","module":"auth-routes","userId":"tGbJe37dKTIukTU4Aq-8Q","email":"test-workflows-14J-MfjkE7aM-1n6evrw4@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"81086fe2-933e-4b8e-9c3e-c675672f9a00","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"tGbJe37dKTIukTU4Aq-8Q","tenantId":"2783ceb5-29dd-414c-a30b-0008c0077d7b","createdBy":"tGbJe37dKTIukTU4Aq-8Q","ownerId":"tGbJe37dKTIukTU4Aq-8Q","status":"active","archived":false,"createdAt":"2025-12-04T17:11:16.001Z","updatedAt":"2025-12-04T17:11:16.001Z"}

{"level":30,"time":1764868275185,"env":"test","module":"user-credentials-repository","userId":"qRuiGIZ7rURkN_tGbVHxG","msg":"User credentials created"}
{"level":30,"time":1764868275186,"env":"test","module":"auth-routes","userId":"qRuiGIZ7rURkN_tGbVHxG","email":"viewer-WQBWXS36c1Rq-CoXxS2cB@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868275276,"env":"test","module":"rbac-middleware","userId":"qRuiGIZ7rURkN_tGbVHxG","userRole":"viewer","permission":"workflow:create","path":"/projects/81086fe2-933e-4b8e-9c3e-c675672f9a00/workflows","msg":"Permission denied"}
{"level":50,"time":1764868281458,"env":"test","error":{},"workflowId":"b7601272-e7cb-40f8-bbfc-c87c3e0cba08","userId":"tGbJe37dKTIukTU4Aq-8Q","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868281783,"env":"test","module":"auth-middleware","path":"/api/workflows/f7e90ca5-b8ff-4265-924b-e5fed36ba73e/move","msg":"No valid authentication found"}
{"level":30,"time":1764868282299,"env":"test","module":"user-credentials-repository","userId":"nl_OZT7vjVcX8rQGjtRuR","msg":"User credentials created"}
{"level":30,"time":1764868282300,"env":"test","module":"auth-routes","userId":"nl_OZT7vjVcX8rQGjtRuR","email":"test-workflows-VaF2o7O81EYJsIjXDpe5y@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868282351,"env":"test","error":{},"workflowId":"eb0677fc-5b63-48ec-95b9-48d88afc2115","userId":"nl_OZT7vjVcX8rQGjtRuR","projectId":"7e5a3d90-0521-4587-86f3-0b368a9a68c8","msg":"Error moving workflow"}
{"level":50,"time":1764868282737,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7109521f-1891-4271-96d0-f4d8c50fb8a0","userId":"tGbJe37dKTIukTU4Aq-8Q","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868283083,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"127eeb6c-e0c4-4322-ba11-9081c769b628","userId":"tGbJe37dKTIukTU4Aq-8Q","msg":"Error moving workflow"}
{"level":30,"time":1764868283587,"env":"test","module":"user-credentials-repository","userId":"dWf50bQFSnzmA_3WdviwF","msg":"User credentials created"}
{"level":30,"time":1764868283587,"env":"test","module":"auth-routes","userId":"dWf50bQFSnzmA_3WdviwF","email":"test-workflows-rZRgPhTHoMK6DpxvIP0Ez@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868283790,"env":"test","module":"auth-routes","userId":"dWf50bQFSnzmA_3WdviwF","email":"test-workflows-rZRgPhTHoMK6DpxvIP0Ez@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868283972,"env":"test","error":{},"workflowId":"e40a394f-a522-4589-b25f-7f6b3ae32e58","userId":"tGbJe37dKTIukTU4Aq-8Q","projectId":"301fef6c-b810-4952-a778-f14f6d770e9a","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10231[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 641[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 387[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 890[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:11:07
[2m   Duration [22m 15.97s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764868528698,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531012,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533399,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533399,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533412,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533412,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533412,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533412,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868533868,"env":"test","module":"user-credentials-repository","userId":"4oa4xe6ITGzMHG4S0y0Xt","msg":"User credentials created"}
{"level":30,"time":1764868533873,"env":"test","module":"auth-routes","userId":"4oa4xe6ITGzMHG4S0y0Xt","email":"test-workflows-qs3cSd7orC1027YZp0ruC@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7c8e498a-b14d-4c95-9449-1d4bb1dbca25","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"4oa4xe6ITGzMHG4S0y0Xt","tenantId":"d4a77e00-cc24-4377-b94b-96eab6729666","createdBy":"4oa4xe6ITGzMHG4S0y0Xt","ownerId":"4oa4xe6ITGzMHG4S0y0Xt","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.409Z","updatedAt":"2025-12-04T17:15:35.409Z"}

{"level":30,"time":1764868534584,"env":"test","module":"user-credentials-repository","userId":"hpY0iktDJcB5MNsMHMWwf","msg":"User credentials created"}
{"level":30,"time":1764868534585,"env":"test","module":"auth-routes","userId":"hpY0iktDJcB5MNsMHMWwf","email":"viewer-trh3LN7MibQWz8xedEWaJ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534679,"env":"test","module":"rbac-middleware","userId":"hpY0iktDJcB5MNsMHMWwf","userRole":"viewer","permission":"workflow:create","path":"/projects/7c8e498a-b14d-4c95-9449-1d4bb1dbca25/workflows","msg":"Permission denied"}
{"level":50,"time":1764868540783,"env":"test","error":{},"workflowId":"63e19cdf-6a8b-406c-89de-80356296aef1","userId":"4oa4xe6ITGzMHG4S0y0Xt","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541098,"env":"test","module":"auth-middleware","path":"/api/workflows/41eed6b4-b2e8-41ef-a56f-9aa0e9fdf88f/move","msg":"No valid authentication found"}
{"level":30,"time":1764868541591,"env":"test","module":"user-credentials-repository","userId":"zAqlTYlB2kC37RyqZ-BF7","msg":"User credentials created"}
{"level":30,"time":1764868541592,"env":"test","module":"auth-routes","userId":"zAqlTYlB2kC37RyqZ-BF7","email":"test-workflows-KhJj0pjOBs5pYayLuF5Yx@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868541640,"env":"test","error":{},"workflowId":"77a83fbc-41a4-4051-8926-47c333e998e9","userId":"zAqlTYlB2kC37RyqZ-BF7","projectId":"6578c4de-3ed3-4954-abf6-0886468ba474","msg":"Error moving workflow"}
{"level":50,"time":1764868541996,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ccf3b986-448b-44c8-8d3b-2520d53d95f7","userId":"4oa4xe6ITGzMHG4S0y0Xt","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868542445,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"7976353d-e99b-4804-8dd9-db1924fa7d70","userId":"4oa4xe6ITGzMHG4S0y0Xt","msg":"Error moving workflow"}
{"level":30,"time":1764868543163,"env":"test","module":"user-credentials-repository","userId":"3KoTsl8Jg8J36EbN_2xs4","msg":"User credentials created"}
{"level":30,"time":1764868543165,"env":"test","module":"auth-routes","userId":"3KoTsl8Jg8J36EbN_2xs4","email":"test-workflows-M0WuMRYDvffbshO0fMY6r@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868543367,"env":"test","module":"auth-routes","userId":"3KoTsl8Jg8J36EbN_2xs4","email":"test-workflows-M0WuMRYDvffbshO0fMY6r@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868543573,"env":"test","error":{},"workflowId":"94b74bc4-8022-4297-a785-fd87df63de39","userId":"4oa4xe6ITGzMHG4S0y0Xt","projectId":"bbaceee6-08cd-4463-92f3-4057f49f7a42","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10445[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 579[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 449[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1130[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 17.78s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764868816624,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818722,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820666,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820666,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820677,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820677,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820677,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820677,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821130,"env":"test","module":"user-credentials-repository","userId":"KNW1wQCQDqAs55BB-Trj1","msg":"User credentials created"}
{"level":30,"time":1764868821133,"env":"test","module":"auth-routes","userId":"KNW1wQCQDqAs55BB-Trj1","email":"test-workflows-oXvXUWV0A6wOTdQtlbgzJ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a2a05816-b5d9-4093-a66a-535cb97dd2bc","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"KNW1wQCQDqAs55BB-Trj1","tenantId":"82c2b1bb-7747-4032-9782-8bc2092630a3","createdBy":"KNW1wQCQDqAs55BB-Trj1","ownerId":"KNW1wQCQDqAs55BB-Trj1","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.666Z","updatedAt":"2025-12-04T17:20:22.666Z"}

{"level":30,"time":1764868821835,"env":"test","module":"user-credentials-repository","userId":"7SlAj47y5AVRbgplqRGlY","msg":"User credentials created"}
{"level":30,"time":1764868821837,"env":"test","module":"auth-routes","userId":"7SlAj47y5AVRbgplqRGlY","email":"viewer-Btyd6ppauiiOKCgEg4g0D@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821937,"env":"test","module":"rbac-middleware","userId":"7SlAj47y5AVRbgplqRGlY","userRole":"viewer","permission":"workflow:create","path":"/projects/a2a05816-b5d9-4093-a66a-535cb97dd2bc/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828348,"env":"test","error":{},"workflowId":"bf32bd25-b7e2-4768-aaf0-44b262fb224b","userId":"KNW1wQCQDqAs55BB-Trj1","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828681,"env":"test","module":"auth-middleware","path":"/api/workflows/c39f6e79-0741-447e-9fb4-62dd49e52f55/move","msg":"No valid authentication found"}
{"level":30,"time":1764868829201,"env":"test","module":"user-credentials-repository","userId":"OryzqG0JhBWUJRstqb30f","msg":"User credentials created"}
{"level":30,"time":1764868829202,"env":"test","module":"auth-routes","userId":"OryzqG0JhBWUJRstqb30f","email":"test-workflows-NS-_iy6pqGu6ToHNWLfKC@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868829252,"env":"test","error":{},"workflowId":"3fadb62b-27c1-46f7-b0b4-b76a4d34a6e1","userId":"OryzqG0JhBWUJRstqb30f","projectId":"d0fe9465-e58c-4e0a-9f0c-4f37a85b34f7","msg":"Error moving workflow"}
{"level":50,"time":1764868829623,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b19e3f58-7d60-4ffc-8ec8-1270bbc8a464","userId":"KNW1wQCQDqAs55BB-Trj1","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868830037,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"29a5a21e-8618-4e23-ad1a-12529c9fa5f6","userId":"KNW1wQCQDqAs55BB-Trj1","msg":"Error moving workflow"}
{"level":30,"time":1764868830552,"env":"test","module":"user-credentials-repository","userId":"9yukwY331PxqurWtx17P2","msg":"User credentials created"}
{"level":30,"time":1764868830553,"env":"test","module":"auth-routes","userId":"9yukwY331PxqurWtx17P2","email":"test-workflows-e1HgcfrFdY-wH2Dz-oLmg@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830764,"env":"test","module":"auth-routes","userId":"9yukwY331PxqurWtx17P2","email":"test-workflows-e1HgcfrFdY-wH2Dz-oLmg@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868830960,"env":"test","error":{},"workflowId":"e7887ce6-bbd5-4ba4-9d60-04ba2873db3d","userId":"KNW1wQCQDqAs55BB-Trj1","projectId":"23720353-f807-46c9-8657-f1e05e1f3bf3","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 795[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 415[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 924[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.50s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/repositories/UserRepository.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764871633179,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871637136,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871641505,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871641506,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871641521,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871641521,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871641521,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871641521,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871642069,"env":"test","module":"user-credentials-repository","userId":"WdrEz1LWHCixFuW1Dst2b","msg":"User credentials created"}
{"level":30,"time":1764871642072,"env":"test","module":"auth-routes","userId":"WdrEz1LWHCixFuW1Dst2b","email":"test-workflows-E54PGAJB58h5DdI2Ov6WP@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f33a5eac-1d7a-4789-ac7d-f8a81bf9f9e7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"WdrEz1LWHCixFuW1Dst2b","tenantId":"57c47e19-e093-4c2a-af3f-12fc9de2e2f4","createdBy":"WdrEz1LWHCixFuW1Dst2b","ownerId":"WdrEz1LWHCixFuW1Dst2b","status":"active","archived":false,"createdAt":"2025-12-04T18:07:23.649Z","updatedAt":"2025-12-04T18:07:23.649Z"}

{"level":30,"time":1764871642778,"env":"test","module":"user-credentials-repository","userId":"HWAeRaxNDfw5lXm7Xp37D","msg":"User credentials created"}
{"level":30,"time":1764871642779,"env":"test","module":"auth-routes","userId":"HWAeRaxNDfw5lXm7Xp37D","email":"viewer-qxK3DEwuz9d5Md-4spQUy@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871642881,"env":"test","module":"rbac-middleware","userId":"HWAeRaxNDfw5lXm7Xp37D","userRole":"viewer","permission":"workflow:create","path":"/projects/f33a5eac-1d7a-4789-ac7d-f8a81bf9f9e7/workflows","msg":"Permission denied"}
{"level":50,"time":1764871649276,"env":"test","error":{},"workflowId":"bbf5abd7-47c0-47a8-8b37-64d6855e2885","userId":"WdrEz1LWHCixFuW1Dst2b","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871649632,"env":"test","module":"auth-middleware","path":"/api/workflows/dca0af5c-e092-437e-bc21-25ff419e77d9/move","msg":"No valid authentication found"}
{"level":30,"time":1764871650149,"env":"test","module":"user-credentials-repository","userId":"Lu9Tuz7HBHxUk6oVhADc3","msg":"User credentials created"}
{"level":30,"time":1764871650150,"env":"test","module":"auth-routes","userId":"Lu9Tuz7HBHxUk6oVhADc3","email":"test-workflows-5PkOOw5i29o7Ms9hlmB5E@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871650201,"env":"test","error":{},"workflowId":"c3528ce7-3836-444f-b7e7-874c742c9501","userId":"Lu9Tuz7HBHxUk6oVhADc3","projectId":"e30bb30f-53f8-42e4-aa45-d4243c9df217","msg":"Error moving workflow"}
{"level":50,"time":1764871650585,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6cf992fa-1a6d-4b18-a727-81c56208ff25","userId":"WdrEz1LWHCixFuW1Dst2b","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871650967,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c2603c01-a88c-4598-89d3-9ed4d2cc9898","userId":"WdrEz1LWHCixFuW1Dst2b","msg":"Error moving workflow"}
{"level":50,"time":1764871651559,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(RL-eItl2roZtZq1Cu1oJk) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"RL-eItl2roZtZq1Cu1oJk","msg":"Failed to create user credentials"}
{"level":50,"time":1764871651559,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(RL-eItl2roZtZq1Cu1oJk) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 383[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 593[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:07:08
[2m   Duration [22m 22.26s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764871701414,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871704850,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871708727,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871708728,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871708739,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871708739,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871708739,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871708739,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871709307,"env":"test","module":"user-credentials-repository","userId":"BFOVwVk3zav9LXFhpuYPI","msg":"User credentials created"}
{"level":30,"time":1764871709311,"env":"test","module":"auth-routes","userId":"BFOVwVk3zav9LXFhpuYPI","email":"test-workflows-_Fnb5NTDiIRwjndsPlPvP@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a700559d-7a58-48c7-a1f6-c3dccf1be035","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"BFOVwVk3zav9LXFhpuYPI","tenantId":"f6dda8fd-85fe-4158-a1d6-7f04d085d05e","createdBy":"BFOVwVk3zav9LXFhpuYPI","ownerId":"BFOVwVk3zav9LXFhpuYPI","status":"active","archived":false,"createdAt":"2025-12-04T18:08:30.895Z","updatedAt":"2025-12-04T18:08:30.895Z"}

{"level":30,"time":1764871710001,"env":"test","module":"user-credentials-repository","userId":"ewNct4evW65nyT-mDXeOC","msg":"User credentials created"}
{"level":30,"time":1764871710001,"env":"test","module":"auth-routes","userId":"ewNct4evW65nyT-mDXeOC","email":"viewer-SQ4uIKwlJxJZirUNzgv0f@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871710090,"env":"test","module":"rbac-middleware","userId":"ewNct4evW65nyT-mDXeOC","userRole":"viewer","permission":"workflow:create","path":"/projects/a700559d-7a58-48c7-a1f6-c3dccf1be035/workflows","msg":"Permission denied"}
{"level":50,"time":1764871716263,"env":"test","error":{},"workflowId":"2e446866-78c0-454e-bc7f-f4516da6ea32","userId":"BFOVwVk3zav9LXFhpuYPI","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871716602,"env":"test","module":"auth-middleware","path":"/api/workflows/960c48c8-0f48-4dce-b238-7c1f1102a61f/move","msg":"No valid authentication found"}
{"level":30,"time":1764871717114,"env":"test","module":"user-credentials-repository","userId":"PgTq7FAakIPIoNjsDKliW","msg":"User credentials created"}
{"level":30,"time":1764871717115,"env":"test","module":"auth-routes","userId":"PgTq7FAakIPIoNjsDKliW","email":"test-workflows-Pp_5HfgfLFIu6x0HYqfoV@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871717164,"env":"test","error":{},"workflowId":"fd8ebcf3-2d7f-447a-bfbf-8df844468748","userId":"PgTq7FAakIPIoNjsDKliW","projectId":"1127d10d-f420-477a-9665-4af0d1bc60cc","msg":"Error moving workflow"}
{"level":50,"time":1764871717532,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"dd25e77c-e681-4214-a48d-1af5351f6407","userId":"BFOVwVk3zav9LXFhpuYPI","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871717904,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"44651e18-aa0f-4daf-ad88-1707716ff0ec","userId":"BFOVwVk3zav9LXFhpuYPI","msg":"Error moving workflow"}
{"level":30,"time":1764871718464,"env":"test","module":"user-credentials-repository","userId":"2rPOj5gk4JrnMWM30mrI9","msg":"User credentials created"}
{"level":30,"time":1764871718465,"env":"test","module":"auth-routes","userId":"2rPOj5gk4JrnMWM30mrI9","email":"test-workflows-JG8bigEz5kzWHZLrTDlEi@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871718663,"env":"test","module":"auth-routes","userId":"2rPOj5gk4JrnMWM30mrI9","email":"test-workflows-JG8bigEz5kzWHZLrTDlEi@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871718851,"env":"test","error":{},"workflowId":"40a9bd37-dfc8-47c2-9301-41badfb897d1","userId":"BFOVwVk3zav9LXFhpuYPI","projectId":"7d1a1cf3-f651-480e-aeb3-342ecae1e665","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 324[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 582[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 706[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 367[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 945[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:08:17
[2m   Duration [22m 20.70s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/tenant.routes.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764871752323,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764871757156,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764871760567,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764871760568,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764871760579,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764871760579,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764871760579,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764871760579,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764871761062,"env":"test","module":"user-credentials-repository","userId":"Y5Ndj2Br2W76vOLUhleKA","msg":"User credentials created"}
{"level":30,"time":1764871761065,"env":"test","module":"auth-routes","userId":"Y5Ndj2Br2W76vOLUhleKA","email":"test-workflows-IwNJcm0oGaiW_coZBBnNU@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b88676ae-dd14-42d9-97d4-5a17bac36027","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Y5Ndj2Br2W76vOLUhleKA","tenantId":"a1eca006-e828-412f-9ecf-bd6af02280e6","createdBy":"Y5Ndj2Br2W76vOLUhleKA","ownerId":"Y5Ndj2Br2W76vOLUhleKA","status":"active","archived":false,"createdAt":"2025-12-04T18:09:22.645Z","updatedAt":"2025-12-04T18:09:22.645Z"}

{"level":30,"time":1764871761806,"env":"test","module":"user-credentials-repository","userId":"8xH_f5CY-RLAOTD-LDJ_H","msg":"User credentials created"}
{"level":30,"time":1764871761807,"env":"test","module":"auth-routes","userId":"8xH_f5CY-RLAOTD-LDJ_H","email":"viewer-5f2Fk6C962Kluz8FzGnvO@example.com","msg":"User registered successfully"}
{"level":40,"time":1764871761904,"env":"test","module":"rbac-middleware","userId":"8xH_f5CY-RLAOTD-LDJ_H","userRole":"viewer","permission":"workflow:create","path":"/projects/b88676ae-dd14-42d9-97d4-5a17bac36027/workflows","msg":"Permission denied"}
{"level":50,"time":1764871768420,"env":"test","error":{},"workflowId":"39163e0f-31cf-49da-9865-87f636907a0c","userId":"Y5Ndj2Br2W76vOLUhleKA","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764871768774,"env":"test","module":"auth-middleware","path":"/api/workflows/e4ba0bac-d25d-4c51-803e-76ee16b61e6b/move","msg":"No valid authentication found"}
{"level":30,"time":1764871769315,"env":"test","module":"user-credentials-repository","userId":"oIdwa6MJaM7k_EeHwwXxK","msg":"User credentials created"}
{"level":30,"time":1764871769316,"env":"test","module":"auth-routes","userId":"oIdwa6MJaM7k_EeHwwXxK","email":"test-workflows-HVGYmdvjaqafwoUoTJ5cb@example.com","msg":"User registered successfully"}
{"level":50,"time":1764871769367,"env":"test","error":{},"workflowId":"c2f5322e-47b8-4348-92cb-ee08e83b6d4d","userId":"oIdwa6MJaM7k_EeHwwXxK","projectId":"b12ca1a7-3744-418a-a8b0-778a9ba2b1af","msg":"Error moving workflow"}
{"level":50,"time":1764871769745,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"decbd640-e92d-4e7f-bdf9-cd6e12d0026a","userId":"Y5Ndj2Br2W76vOLUhleKA","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764871770134,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8c8783ce-c351-454a-82f7-74f95b18ab32","userId":"Y5Ndj2Br2W76vOLUhleKA","msg":"Error moving workflow"}
{"level":30,"time":1764871770684,"env":"test","module":"user-credentials-repository","userId":"tmb_F7lwiUReP10GHXV8U","msg":"User credentials created"}
{"level":30,"time":1764871770685,"env":"test","module":"auth-routes","userId":"tmb_F7lwiUReP10GHXV8U","email":"test-workflows-Vb7sgdnVszXMSLiGWa1Wo@example.com","msg":"User registered successfully"}
{"level":30,"time":1764871770876,"env":"test","module":"auth-routes","userId":"tmb_F7lwiUReP10GHXV8U","email":"test-workflows-Vb7sgdnVszXMSLiGWa1Wo@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764871771122,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"46737794-03b5-4194-ad09-04eccd360161","userId":"Y5Ndj2Br2W76vOLUhleKA","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 519[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 819[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 354[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 389[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 989[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:09:08
[2m   Duration [22m 21.87s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764873689228,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764873692778,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764873696856,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764873696856,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764873696868,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764873696869,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764873696869,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764873696869,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764873697489,"env":"test","module":"user-credentials-repository","userId":"FZuNQGAG31YOyhtb0fpwc","msg":"User credentials created"}
{"level":30,"time":1764873697493,"env":"test","module":"auth-routes","userId":"FZuNQGAG31YOyhtb0fpwc","email":"test-workflows-RXTSLOrXunur5bBMNmGut@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c7ff4171-f5dc-412f-9263-fcff2d9a91ee","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"FZuNQGAG31YOyhtb0fpwc","tenantId":"20ff618e-e40b-4cbc-90c9-a6417c8dcb7c","createdBy":"FZuNQGAG31YOyhtb0fpwc","ownerId":"FZuNQGAG31YOyhtb0fpwc","status":"active","archived":false,"createdAt":"2025-12-04T18:41:39.102Z","updatedAt":"2025-12-04T18:41:39.102Z"}

{"level":30,"time":1764873698276,"env":"test","module":"user-credentials-repository","userId":"Dx49eS2sWJ27vDIBJSaiG","msg":"User credentials created"}
{"level":30,"time":1764873698277,"env":"test","module":"auth-routes","userId":"Dx49eS2sWJ27vDIBJSaiG","email":"viewer-nsrkcESIm8ioAIn8Pd4Eo@example.com","msg":"User registered successfully"}
{"level":40,"time":1764873698375,"env":"test","module":"rbac-middleware","userId":"Dx49eS2sWJ27vDIBJSaiG","userRole":"viewer","permission":"workflow:create","path":"/projects/c7ff4171-f5dc-412f-9263-fcff2d9a91ee/workflows","msg":"Permission denied"}
{"level":50,"time":1764873704859,"env":"test","error":{},"workflowId":"ad8d2b83-21bc-43aa-a452-24aa714ccc19","userId":"FZuNQGAG31YOyhtb0fpwc","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764873705187,"env":"test","module":"auth-middleware","path":"/api/workflows/e9cc7e4b-6d8e-417c-8b38-0021e94aa980/move","msg":"No valid authentication found"}
{"level":30,"time":1764873705703,"env":"test","module":"user-credentials-repository","userId":"XSjy6n5W5NJPx3xiZUzcb","msg":"User credentials created"}
{"level":30,"time":1764873705703,"env":"test","module":"auth-routes","userId":"XSjy6n5W5NJPx3xiZUzcb","email":"test-workflows-YXX3Mpv40NgqNhrD6WVBh@example.com","msg":"User registered successfully"}
{"level":50,"time":1764873705755,"env":"test","error":{},"workflowId":"309584c3-4d3a-4c46-9e46-f5eac9b53372","userId":"XSjy6n5W5NJPx3xiZUzcb","projectId":"dbe93da1-f180-419e-892d-d27398447b8f","msg":"Error moving workflow"}
{"level":50,"time":1764873706135,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"a283b942-08e0-4ab4-a2d7-dc6cd536b07f","userId":"FZuNQGAG31YOyhtb0fpwc","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764873706522,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"70a9075f-f3e6-4334-b4fb-4b15a532403a","userId":"FZuNQGAG31YOyhtb0fpwc","msg":"Error moving workflow"}
{"level":30,"time":1764873707039,"env":"test","module":"user-credentials-repository","userId":"TSSiHsHJdxLpgEFBmmfH3","msg":"User credentials created"}
{"level":30,"time":1764873707039,"env":"test","module":"auth-routes","userId":"TSSiHsHJdxLpgEFBmmfH3","email":"test-workflows-d5ChEux-gCh_EN3ETWnNj@example.com","msg":"User registered successfully"}
{"level":30,"time":1764873707247,"env":"test","module":"auth-routes","userId":"TSSiHsHJdxLpgEFBmmfH3","email":"test-workflows-d5ChEux-gCh_EN3ETWnNj@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764873707450,"env":"test","error":{},"workflowId":"c64e1ea4-2cb2-4ada-94ad-bc1041aec958","userId":"FZuNQGAG31YOyhtb0fpwc","projectId":"5f33413c-30f7-4e59-a0ae-c196f6440370","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 403[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 311[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 801[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 825[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 569[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 929[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:41:24
[2m   Duration [22m 22.20s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
ReferenceError: dbInitPromise is not defined
 Î“Â¥Â» server/db.ts:54:1
     52| const isInitialConfigured = !!initialDatabaseUrl && initialDatabaseUrlÎ“Ã‡Âª
     53| 
     54| dbInitPromise = isInitialConfigured
       | ^
     55|   ? initializeDatabase()
     56|   : Promise.resolve(); // Don't reject immediately to avoid unhandled Î“Ã‡Âª
 Î“Â¥Â» tests/setup.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
ReferenceError: dbInitialized is not defined
 Î“Â¥Â» initializeDatabase server/db.ts:10:3
      8| // Initialize database connection
      9| async function initializeDatabase() {
     10|   if (dbInitialized) return;
       |   ^
     11| 
     12|   const databaseUrl = process.env.DATABASE_URL;
 Î“Â¥Â» server/db.ts:55:5
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73
 Î“Â¥Â» tests/setup.ts:2:1
 Î“Â¥Â» VitestModuleEvaluator.runInlinedModule node_modules/vitest/dist/module-evaluator.js:136:4
 Î“Â¥Â» VitestModuleRunner.directRequest node_modules/vite/dist/node/module-runner.js:1113:59
 Î“Â¥Â» VitestModuleRunner.cachedRequest node_modules/vite/dist/node/module-runner.js:1031:73

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 12:55:40
[2m   Duration [22m 0ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/db.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764874579442,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874584296,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874590813,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874590814,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874590830,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874590830,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874590831,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874590831,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874591604,"env":"test","module":"user-credentials-repository","userId":"ZsiALRWUIrMFFhOxD507t","msg":"User credentials created"}
{"level":30,"time":1764874591608,"env":"test","module":"auth-routes","userId":"ZsiALRWUIrMFFhOxD507t","email":"test-workflows-GZXfWNk51_PjkNc-2bO9_@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"599907b9-f567-4d13-80b3-24ace28cf6e8","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ZsiALRWUIrMFFhOxD507t","tenantId":"3a8c2a45-b53c-44df-8667-558297360001","createdBy":"ZsiALRWUIrMFFhOxD507t","ownerId":"ZsiALRWUIrMFFhOxD507t","status":"active","archived":false,"createdAt":"2025-12-04T18:56:33.227Z","updatedAt":"2025-12-04T18:56:33.227Z"}

{"level":30,"time":1764874592383,"env":"test","module":"user-credentials-repository","userId":"P8HH7lJdYxWjk6T2nAquQ","msg":"User credentials created"}
{"level":30,"time":1764874592383,"env":"test","module":"auth-routes","userId":"P8HH7lJdYxWjk6T2nAquQ","email":"viewer-iyuD8P1Kk04cNCr-T6MGj@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874592480,"env":"test","module":"rbac-middleware","userId":"P8HH7lJdYxWjk6T2nAquQ","userRole":"viewer","permission":"workflow:create","path":"/projects/599907b9-f567-4d13-80b3-24ace28cf6e8/workflows","msg":"Permission denied"}
{"level":50,"time":1764874598762,"env":"test","error":{},"workflowId":"86ca8827-e27c-4139-beeb-773fb49e9827","userId":"ZsiALRWUIrMFFhOxD507t","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874599081,"env":"test","module":"auth-middleware","path":"/api/workflows/8cf0c8c5-cf8b-4dc6-a0ef-937513373c7c/move","msg":"No valid authentication found"}
{"level":30,"time":1764874599605,"env":"test","module":"user-credentials-repository","userId":"jSd7_f9O-37_qohwOW3sx","msg":"User credentials created"}
{"level":30,"time":1764874599606,"env":"test","module":"auth-routes","userId":"jSd7_f9O-37_qohwOW3sx","email":"test-workflows-OOU1K5TrPdfKSHawQGtPv@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874599655,"env":"test","error":{},"workflowId":"f88677a2-9afc-4c99-b7c8-311868e74e08","userId":"jSd7_f9O-37_qohwOW3sx","projectId":"0f8564f9-07bb-49a7-b593-90404230362d","msg":"Error moving workflow"}
{"level":50,"time":1764874600298,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"1e42780b-6508-4301-96ae-2d0d7b07986a","userId":"ZsiALRWUIrMFFhOxD507t","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874600659,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c0973709-339b-48cf-b1ab-b95a6db82a2c","userId":"ZsiALRWUIrMFFhOxD507t","msg":"Error moving workflow"}
{"level":30,"time":1764874601201,"env":"test","module":"user-credentials-repository","userId":"bEsGLDy3ZVSwYfJATq3C7","msg":"User credentials created"}
{"level":30,"time":1764874601202,"env":"test","module":"auth-routes","userId":"bEsGLDy3ZVSwYfJATq3C7","email":"test-workflows-nRjp9HohRy6b30tJ1PCR6@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874601403,"env":"test","module":"auth-routes","userId":"bEsGLDy3ZVSwYfJATq3C7","email":"test-workflows-nRjp9HohRy6b30tJ1PCR6@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874601588,"env":"test","error":{},"workflowId":"e9a2a818-df33-4702-b6a5-e023a895b34b","userId":"ZsiALRWUIrMFFhOxD507t","projectId":"c7e4ffd0-fbd1-4179-ab9d-fb69c660f94e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 11023[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 424[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 305[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 778[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 459[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 643[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 929[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:56:13
[2m   Duration [22m 27.09s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/setup.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764874685558,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764874690748,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764874697096,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764874697097,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764874697110,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764874697111,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764874697111,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764874697111,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764874697738,"env":"test","module":"user-credentials-repository","userId":"TbBLZSqwPkgATLceMPsXJ","msg":"User credentials created"}
{"level":30,"time":1764874697743,"env":"test","module":"auth-routes","userId":"TbBLZSqwPkgATLceMPsXJ","email":"test-workflows-RyFwbs5kY-7ShCCtEUJKc@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3c43e70a-fd72-476f-9fd0-76ff33533563","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"TbBLZSqwPkgATLceMPsXJ","tenantId":"8ee7405e-ee7c-4615-90f5-8b8805d2d5aa","createdBy":"TbBLZSqwPkgATLceMPsXJ","ownerId":"TbBLZSqwPkgATLceMPsXJ","status":"active","archived":false,"createdAt":"2025-12-04T18:58:19.381Z","updatedAt":"2025-12-04T18:58:19.381Z"}

{"level":30,"time":1764874698468,"env":"test","module":"user-credentials-repository","userId":"VBCm9EJxNIvlJKpSRQNNT","msg":"User credentials created"}
{"level":30,"time":1764874698469,"env":"test","module":"auth-routes","userId":"VBCm9EJxNIvlJKpSRQNNT","email":"viewer-BgpCmz1Ie-IOg_TnL6cby@example.com","msg":"User registered successfully"}
{"level":40,"time":1764874698564,"env":"test","module":"rbac-middleware","userId":"VBCm9EJxNIvlJKpSRQNNT","userRole":"viewer","permission":"workflow:create","path":"/projects/3c43e70a-fd72-476f-9fd0-76ff33533563/workflows","msg":"Permission denied"}
{"level":50,"time":1764874705073,"env":"test","error":{},"workflowId":"19429d06-a903-4308-9e39-698b60c16459","userId":"TbBLZSqwPkgATLceMPsXJ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764874705413,"env":"test","module":"auth-middleware","path":"/api/workflows/45f43f02-2abf-4c8c-b45c-28e432c6e2e1/move","msg":"No valid authentication found"}
{"level":30,"time":1764874705941,"env":"test","module":"user-credentials-repository","userId":"RHCJzN-p9N_nid5bhDYl-","msg":"User credentials created"}
{"level":30,"time":1764874705941,"env":"test","module":"auth-routes","userId":"RHCJzN-p9N_nid5bhDYl-","email":"test-workflows-M2pQc4tOIqigzbI9Kf940@example.com","msg":"User registered successfully"}
{"level":50,"time":1764874705995,"env":"test","error":{},"workflowId":"7084365a-a40f-4e1c-ae8a-2168a87ca0cd","userId":"RHCJzN-p9N_nid5bhDYl-","projectId":"e506b19f-6c28-4445-976d-40e2ed221e58","msg":"Error moving workflow"}
{"level":50,"time":1764874706400,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"aaa0b85b-4cfc-4c12-b735-9ab4c3e25471","userId":"TbBLZSqwPkgATLceMPsXJ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764874706864,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1f1d71a1-7aee-421e-9c58-bdd357d2cce7","userId":"TbBLZSqwPkgATLceMPsXJ","msg":"Error moving workflow"}
{"level":30,"time":1764874707402,"env":"test","module":"user-credentials-repository","userId":"xlVMLavZSAEaIb86wW13s","msg":"User credentials created"}
{"level":30,"time":1764874707402,"env":"test","module":"auth-routes","userId":"xlVMLavZSAEaIb86wW13s","email":"test-workflows-I3rp388lIZt8iBPd8DePb@example.com","msg":"User registered successfully"}
{"level":30,"time":1764874707602,"env":"test","module":"auth-routes","userId":"xlVMLavZSAEaIb86wW13s","email":"test-workflows-I3rp388lIZt8iBPd8DePb@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764874707793,"env":"test","error":{},"workflowId":"d9a1c4db-185f-41f7-8ce9-2866412f42e6","userId":"TbBLZSqwPkgATLceMPsXJ","projectId":"7aa6304e-951d-422e-a09f-a72f360fcfb9","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10977[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 821[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 769[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 465[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 929[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 12:57:58
[2m   Duration [22m 28.10s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764876565354,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876569058,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876573401,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876573401,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876573413,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876573413,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876573413,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876573413,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876573909,"env":"test","module":"user-credentials-repository","userId":"WB9aU-aFYGKtuNzhoetQl","msg":"User credentials created"}
{"level":30,"time":1764876573912,"env":"test","module":"auth-routes","userId":"WB9aU-aFYGKtuNzhoetQl","email":"test-workflows-Ykqy9V2wGFIOTosmml8Bc@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"32afb8e6-4041-4d31-802b-a4cf9b618b81","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"WB9aU-aFYGKtuNzhoetQl","tenantId":"1e838e3d-2cc8-4b30-9092-d4d7a6e7d5cb","createdBy":"WB9aU-aFYGKtuNzhoetQl","ownerId":"WB9aU-aFYGKtuNzhoetQl","status":"active","archived":false,"createdAt":"2025-12-04T19:29:35.567Z","updatedAt":"2025-12-04T19:29:35.567Z"}

{"level":30,"time":1764876574596,"env":"test","module":"user-credentials-repository","userId":"aYWRlveuNgKt80rC4EXUU","msg":"User credentials created"}
{"level":30,"time":1764876574598,"env":"test","module":"auth-routes","userId":"aYWRlveuNgKt80rC4EXUU","email":"viewer-z_dSgOYwSUs6q-ZI0v5tJ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876574698,"env":"test","module":"rbac-middleware","userId":"aYWRlveuNgKt80rC4EXUU","userRole":"viewer","permission":"workflow:create","path":"/projects/32afb8e6-4041-4d31-802b-a4cf9b618b81/workflows","msg":"Permission denied"}
{"level":50,"time":1764876581026,"env":"test","error":{},"workflowId":"cb4ef466-af40-4804-a528-537b4cab3114","userId":"WB9aU-aFYGKtuNzhoetQl","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876581355,"env":"test","module":"auth-middleware","path":"/api/workflows/486ba0c4-2fc6-4912-9855-f1e9f709601f/move","msg":"No valid authentication found"}
{"level":30,"time":1764876581876,"env":"test","module":"user-credentials-repository","userId":"dI3IqmhExgqJd1CrhcIlS","msg":"User credentials created"}
{"level":30,"time":1764876581877,"env":"test","module":"auth-routes","userId":"dI3IqmhExgqJd1CrhcIlS","email":"test-workflows-pDh3QQ3jAAzL9WFOC5jhk@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876581924,"env":"test","error":{},"workflowId":"0a9d65d1-d11e-4606-8d5c-67891d319a0a","userId":"dI3IqmhExgqJd1CrhcIlS","projectId":"f59f52d2-95c7-4c78-b02b-243ea746b8fc","msg":"Error moving workflow"}
{"level":50,"time":1764876582288,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b20da404-a051-466f-b36e-46262ff18182","userId":"WB9aU-aFYGKtuNzhoetQl","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876582649,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9e411b86-f85f-4d1e-b1fd-83d126c73b95","userId":"WB9aU-aFYGKtuNzhoetQl","msg":"Error moving workflow"}
{"level":30,"time":1764876583175,"env":"test","module":"user-credentials-repository","userId":"FF1vNej5zp7UdNPJJEBdM","msg":"User credentials created"}
{"level":30,"time":1764876583176,"env":"test","module":"auth-routes","userId":"FF1vNej5zp7UdNPJJEBdM","email":"test-workflows-O50_mHJZK4Uobnt6Yq-sr@example.com","msg":"User registered successfully"}
{"level":30,"time":1764876583363,"env":"test","module":"auth-routes","userId":"FF1vNej5zp7UdNPJJEBdM","email":"test-workflows-O50_mHJZK4Uobnt6Yq-sr@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764876583551,"env":"test","error":{},"workflowId":"3bb2e479-1551-458c-9a57-f103c889781c","userId":"WB9aU-aFYGKtuNzhoetQl","projectId":"c67d6659-5a45-4160-9950-5b93f4a12a00","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10533[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 643[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 902[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:29:20
[2m   Duration [22m 22.17s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764876646337,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764876649592,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764876654100,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764876654101,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764876654114,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764876654114,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764876654120,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764876654120,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764876654658,"env":"test","module":"user-credentials-repository","userId":"eHaAecs-Dr-9Jx_0gucQy","msg":"User credentials created"}
{"level":30,"time":1764876654663,"env":"test","module":"auth-routes","userId":"eHaAecs-Dr-9Jx_0gucQy","email":"test-workflows-EobYp1MFmZgPLp0crZlkB@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d763f522-6aaa-4000-837c-9709353b8e19","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"eHaAecs-Dr-9Jx_0gucQy","tenantId":"da5b9c77-175c-4173-9089-98787017a49a","createdBy":"eHaAecs-Dr-9Jx_0gucQy","ownerId":"eHaAecs-Dr-9Jx_0gucQy","status":"active","archived":false,"createdAt":"2025-12-04T19:30:56.328Z","updatedAt":"2025-12-04T19:30:56.328Z"}

{"level":30,"time":1764876655666,"env":"test","module":"user-credentials-repository","userId":"aNqA5BZkpXlpYNsZiJI1-","msg":"User credentials created"}
{"level":30,"time":1764876655667,"env":"test","module":"auth-routes","userId":"aNqA5BZkpXlpYNsZiJI1-","email":"viewer-WTkG1EiJy8N79ZXmMWm74@example.com","msg":"User registered successfully"}
{"level":40,"time":1764876655772,"env":"test","module":"rbac-middleware","userId":"aNqA5BZkpXlpYNsZiJI1-","userRole":"viewer","permission":"workflow:create","path":"/projects/d763f522-6aaa-4000-837c-9709353b8e19/workflows","msg":"Permission denied"}
{"level":50,"time":1764876662301,"env":"test","error":{},"workflowId":"606d0875-0a85-4896-8400-bd6b77d31fe8","userId":"eHaAecs-Dr-9Jx_0gucQy","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764876662633,"env":"test","module":"auth-middleware","path":"/api/workflows/b8a6fed9-ec03-4056-9571-2da86bcb1278/move","msg":"No valid authentication found"}
{"level":30,"time":1764876663163,"env":"test","module":"user-credentials-repository","userId":"t8oiEBZSDrbtNx9dit3xb","msg":"User credentials created"}
{"level":30,"time":1764876663164,"env":"test","module":"auth-routes","userId":"t8oiEBZSDrbtNx9dit3xb","email":"test-workflows-b6fSxp6pSZJZHgA8ty7s1@example.com","msg":"User registered successfully"}
{"level":50,"time":1764876663259,"env":"test","error":{},"workflowId":"b258f445-3386-412e-9986-cfa7354b9d09","userId":"t8oiEBZSDrbtNx9dit3xb","projectId":"22dbe825-a2b3-4c5e-8f75-e3dccdaeeb4f","msg":"Error moving workflow"}
{"level":50,"time":1764876664654,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b4306e5f-f884-44a7-9b4b-3a46d6cb7dba","userId":"eHaAecs-Dr-9Jx_0gucQy","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764876664841,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(eHaAecs-Dr-9Jx_0gucQy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"eHaAecs-Dr-9Jx_0gucQy","msg":"Error creating workflow"}
{"level":50,"time":1764876665032,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(eHaAecs-Dr-9Jx_0gucQy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"eHaAecs-Dr-9Jx_0gucQy","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 11207[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 500[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 803[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 667[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 814[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 631[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 1395[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 187[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 192[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:30:40
[2m   Duration [22m 23.48s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/rbac.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764877227188,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877230654,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877235218,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877235219,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877235231,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877235231,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877235231,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877235231,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877235869,"env":"test","module":"user-credentials-repository","userId":"99pKDFMZZqOXqpvqbGbSf","msg":"User credentials created"}
{"level":30,"time":1764877235873,"env":"test","module":"auth-routes","userId":"99pKDFMZZqOXqpvqbGbSf","email":"test-workflows-YDEntdRexpZDOuSorilKQ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"111e6e45-7421-47cf-8828-b3ab8adc61a7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"99pKDFMZZqOXqpvqbGbSf","tenantId":"61443f64-08ed-4760-8ef9-1618cb21f260","createdBy":"99pKDFMZZqOXqpvqbGbSf","ownerId":"99pKDFMZZqOXqpvqbGbSf","status":"active","archived":false,"createdAt":"2025-12-04T19:40:37.555Z","updatedAt":"2025-12-04T19:40:37.555Z"}

{"level":30,"time":1764877236660,"env":"test","module":"user-credentials-repository","userId":"W6vfE-ElGGZa56LE7j1Hg","msg":"User credentials created"}
{"level":30,"time":1764877236661,"env":"test","module":"auth-routes","userId":"W6vfE-ElGGZa56LE7j1Hg","email":"viewer-OPaH1orbpQ2AxcVx5_ioq@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877236763,"env":"test","module":"rbac-middleware","userId":"W6vfE-ElGGZa56LE7j1Hg","userRole":"viewer","permission":"workflow:create","path":"/projects/111e6e45-7421-47cf-8828-b3ab8adc61a7/workflows","msg":"Permission denied"}
{"level":50,"time":1764877243157,"env":"test","error":{},"workflowId":"e37e797d-871e-4427-b337-3644fdf99d1d","userId":"99pKDFMZZqOXqpvqbGbSf","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877243492,"env":"test","module":"auth-middleware","path":"/api/workflows/fe7a8bdf-6c78-4f44-8522-9222385d538e/move","msg":"No valid authentication found"}
{"level":30,"time":1764877244017,"env":"test","module":"user-credentials-repository","userId":"6VoBwUlX5wies1_b6fAhV","msg":"User credentials created"}
{"level":30,"time":1764877244018,"env":"test","module":"auth-routes","userId":"6VoBwUlX5wies1_b6fAhV","email":"test-workflows-MX0tJREzly8Js8q6uvG76@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877244066,"env":"test","error":{},"workflowId":"c9eccdde-0831-4431-948f-814f1a52fcae","userId":"6VoBwUlX5wies1_b6fAhV","projectId":"a5ca3843-bf3f-4a48-8c9a-fa7eecee2f9a","msg":"Error moving workflow"}
{"level":50,"time":1764877244434,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"47a1f9bd-fc3d-4d3b-bdb1-83cd11d633d9","userId":"99pKDFMZZqOXqpvqbGbSf","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877244815,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ca766f48-7ca8-4382-a52e-e9616effa183","userId":"99pKDFMZZqOXqpvqbGbSf","msg":"Error moving workflow"}
{"level":30,"time":1764877245317,"env":"test","module":"user-credentials-repository","userId":"OfwF0MFkN_6GZC6FWf5kS","msg":"User credentials created"}
{"level":30,"time":1764877245318,"env":"test","module":"auth-routes","userId":"OfwF0MFkN_6GZC6FWf5kS","email":"test-workflows-Ixr5P_3zs23EClScvvT6D@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877245507,"env":"test","module":"auth-routes","userId":"OfwF0MFkN_6GZC6FWf5kS","email":"test-workflows-Ixr5P_3zs23EClScvvT6D@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877245689,"env":"test","error":{},"workflowId":"6dee05e0-db5d-4208-9c80-eb6bc3243f74","userId":"99pKDFMZZqOXqpvqbGbSf","projectId":"46c21a5d-ec0d-4323-8d0e-86df3805bb70","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10811[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 672[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 381[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 877[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:40:22
[2m   Duration [22m 22.51s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/googleAuth.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764877490116,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877493599,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877498225,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877498226,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877498235,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877498235,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877498235,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877498236,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877498722,"env":"test","module":"user-credentials-repository","userId":"Efpoa18TCPE51CVNyTT8o","msg":"User credentials created"}
{"level":30,"time":1764877498727,"env":"test","module":"auth-routes","userId":"Efpoa18TCPE51CVNyTT8o","email":"test-workflows-ziZsTpBSJnw185kolzdDH@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"fa61235d-6e3b-441b-8227-b7ea9087f60d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Efpoa18TCPE51CVNyTT8o","tenantId":"e0f89f3b-3aca-4509-be1e-6ce9e8704919","createdBy":"Efpoa18TCPE51CVNyTT8o","ownerId":"Efpoa18TCPE51CVNyTT8o","status":"active","archived":false,"createdAt":"2025-12-04T19:45:00.476Z","updatedAt":"2025-12-04T19:45:00.476Z"}

{"level":30,"time":1764877499614,"env":"test","module":"user-credentials-repository","userId":"zWRJqMNQ0Qu7cFQlBW11U","msg":"User credentials created"}
{"level":30,"time":1764877499615,"env":"test","module":"auth-routes","userId":"zWRJqMNQ0Qu7cFQlBW11U","email":"viewer-J518y8cKyBFr1NLCdHcRM@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877499707,"env":"test","module":"rbac-middleware","userId":"zWRJqMNQ0Qu7cFQlBW11U","userRole":"viewer","permission":"workflow:create","path":"/projects/fa61235d-6e3b-441b-8227-b7ea9087f60d/workflows","msg":"Permission denied"}
{"level":50,"time":1764877505652,"env":"test","error":{},"workflowId":"80fe555e-519a-4830-885f-e671fa84687c","userId":"Efpoa18TCPE51CVNyTT8o","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877505970,"env":"test","module":"auth-middleware","path":"/api/workflows/72873252-c58f-4ace-a753-dae67156feaf/move","msg":"No valid authentication found"}
{"level":30,"time":1764877506454,"env":"test","module":"user-credentials-repository","userId":"zNqFN9xIeXUU7esbw0iZC","msg":"User credentials created"}
{"level":30,"time":1764877506455,"env":"test","module":"auth-routes","userId":"zNqFN9xIeXUU7esbw0iZC","email":"test-workflows-EvcHi-_NGV9e8tmNCy3vG@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877506499,"env":"test","error":{},"workflowId":"ceeeb672-b7e9-4e8b-9c54-1889aa39f8b6","userId":"zNqFN9xIeXUU7esbw0iZC","projectId":"94700b36-3ce4-4be6-91e4-15a42eb8299d","msg":"Error moving workflow"}
{"level":50,"time":1764877506852,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b5c07349-f1cb-4adb-aaf2-bb11f44ea675","userId":"Efpoa18TCPE51CVNyTT8o","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877507205,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"df9d85d2-b341-4cfc-8b45-a286340c6d80","userId":"Efpoa18TCPE51CVNyTT8o","msg":"Error moving workflow"}
{"level":50,"time":1764877507375,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(Efpoa18TCPE51CVNyTT8o) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"Efpoa18TCPE51CVNyTT8o","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 460[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 732[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 679[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 612[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 579[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 700[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 428[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 530[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 354[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 170[2mms[22m[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:44:44
[2m   Duration [22m 21.86s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764877821788,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877825379,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877829807,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877829808,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877829826,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877829826,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877829827,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877829827,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877830483,"env":"test","module":"user-credentials-repository","userId":"V6dfPUUxde3WmSQBTZaVz","msg":"User credentials created"}
{"level":30,"time":1764877830487,"env":"test","module":"auth-routes","userId":"V6dfPUUxde3WmSQBTZaVz","email":"test-workflows-1HGXDikBcpLRVR2ZczY7Y@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f05b33e7-2902-435e-b173-cfd6b894cd6b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"V6dfPUUxde3WmSQBTZaVz","tenantId":"46513a0f-d335-4299-a2e4-ccdeb7e66ec5","createdBy":"V6dfPUUxde3WmSQBTZaVz","ownerId":"V6dfPUUxde3WmSQBTZaVz","status":"active","archived":false,"createdAt":"2025-12-04T19:50:32.177Z","updatedAt":"2025-12-04T19:50:32.177Z"}

{"level":30,"time":1764877831186,"env":"test","module":"user-credentials-repository","userId":"bkRVbSf49bjpBRgPf-UrU","msg":"User credentials created"}
{"level":30,"time":1764877831188,"env":"test","module":"auth-routes","userId":"bkRVbSf49bjpBRgPf-UrU","email":"viewer-r5Pmw_Gw52hIFpNksQQvC@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877831289,"env":"test","module":"rbac-middleware","userId":"bkRVbSf49bjpBRgPf-UrU","userRole":"viewer","permission":"workflow:create","path":"/projects/f05b33e7-2902-435e-b173-cfd6b894cd6b/workflows","msg":"Permission denied"}
{"level":50,"time":1764877837537,"env":"test","error":{},"workflowId":"91e0a36d-8b2b-46bd-a5ef-afe3954f6de0","userId":"V6dfPUUxde3WmSQBTZaVz","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877837881,"env":"test","module":"auth-middleware","path":"/api/workflows/6e82feb2-1824-428c-af40-d7fbf1290ecb/move","msg":"No valid authentication found"}
{"level":30,"time":1764877838558,"env":"test","module":"user-credentials-repository","userId":"arclKlqwuAUjOPm1hv1UK","msg":"User credentials created"}
{"level":30,"time":1764877838559,"env":"test","module":"auth-routes","userId":"arclKlqwuAUjOPm1hv1UK","email":"test-workflows-ITqOnoOuFvtB6UJJrTi2v@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877838614,"env":"test","error":{},"workflowId":"990faceb-f9f9-40c3-9194-53062777da80","userId":"arclKlqwuAUjOPm1hv1UK","projectId":"1c887cf8-15c2-494a-9e01-f6732e7f0415","msg":"Error moving workflow"}
{"level":50,"time":1764877839029,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b4ef359d-f5d3-473a-aa86-a7a822484cbf","userId":"V6dfPUUxde3WmSQBTZaVz","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877839492,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"5c389528-a6c8-4092-88b4-384e88e4422b","userId":"V6dfPUUxde3WmSQBTZaVz","msg":"Error moving workflow"}
{"level":50,"time":1764877840043,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(pfoxeE859ahjpQynrDOxF) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"pfoxeE859ahjpQynrDOxF","msg":"Failed to create user credentials"}
{"level":50,"time":1764877840044,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(pfoxeE859ahjpQynrDOxF) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10667[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 311[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 588[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 729[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 762[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 415[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 464[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 551[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:18
[2m   Duration [22m 21.65s


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764877846506,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877849132,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877851177,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877851178,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877851190,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877851190,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877851191,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877851191,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877851685,"env":"test","module":"user-credentials-repository","userId":"AhRHNd6lCepIUSX0BHACC","msg":"User credentials created"}
{"level":30,"time":1764877851689,"env":"test","module":"auth-routes","userId":"AhRHNd6lCepIUSX0BHACC","email":"test-workflows-7a7umzySoNJ4V-L2nIXbs@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"34edab32-079d-40c6-9f0e-8bb0796a0495","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"AhRHNd6lCepIUSX0BHACC","tenantId":"708695d5-28e1-4b08-b72f-5a7690cbad5b","createdBy":"AhRHNd6lCepIUSX0BHACC","ownerId":"AhRHNd6lCepIUSX0BHACC","status":"active","archived":false,"createdAt":"2025-12-04T19:50:53.369Z","updatedAt":"2025-12-04T19:50:53.369Z"}

{"level":30,"time":1764877852365,"env":"test","module":"user-credentials-repository","userId":"GuCi0c0SYJ_OL7cIATJbF","msg":"User credentials created"}
{"level":30,"time":1764877852366,"env":"test","module":"auth-routes","userId":"GuCi0c0SYJ_OL7cIATJbF","email":"viewer-9899wCEalikdCLKXExr0y@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877852460,"env":"test","module":"rbac-middleware","userId":"GuCi0c0SYJ_OL7cIATJbF","userRole":"viewer","permission":"workflow:create","path":"/projects/34edab32-079d-40c6-9f0e-8bb0796a0495/workflows","msg":"Permission denied"}
{"level":50,"time":1764877858586,"env":"test","error":{},"workflowId":"6dd30f44-9128-4714-82be-7cee58fadcfd","userId":"AhRHNd6lCepIUSX0BHACC","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877858971,"env":"test","module":"auth-middleware","path":"/api/workflows/9d456601-ad9c-410d-834b-65b3a04d9baf/move","msg":"No valid authentication found"}
{"level":30,"time":1764877859623,"env":"test","module":"user-credentials-repository","userId":"nrp77LanAkvhYKrJ1Z3kz","msg":"User credentials created"}
{"level":30,"time":1764877859623,"env":"test","module":"auth-routes","userId":"nrp77LanAkvhYKrJ1Z3kz","email":"test-workflows-Tvx4dwveL3bgaJEP_2KC9@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877859714,"env":"test","error":{},"workflowId":"6f14355b-726b-4963-b682-1a4b07d1dee3","userId":"nrp77LanAkvhYKrJ1Z3kz","projectId":"e70fd862-1109-4e27-b8fd-ce046856b08a","msg":"Error moving workflow"}
{"level":50,"time":1764877860067,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"55f33620-19bc-40cd-a5a0-942e96858c30","userId":"AhRHNd6lCepIUSX0BHACC","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877860421,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"32f0cdcc-b9fa-4428-bedc-119018dced72","userId":"AhRHNd6lCepIUSX0BHACC","msg":"Error moving workflow"}
{"level":30,"time":1764877860913,"env":"test","module":"user-credentials-repository","userId":"2ZyPRBztDfMMw9MneI8pj","msg":"User credentials created"}
{"level":30,"time":1764877860915,"env":"test","module":"auth-routes","userId":"2ZyPRBztDfMMw9MneI8pj","email":"test-workflows-KnMelxZ9iVUOiPse9dFSV@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877861107,"env":"test","module":"auth-routes","userId":"2ZyPRBztDfMMw9MneI8pj","email":"test-workflows-KnMelxZ9iVUOiPse9dFSV@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877861310,"env":"test","error":{},"workflowId":"fe841279-b2d8-4276-a715-69f7301ca1c7","userId":"AhRHNd6lCepIUSX0BHACC","projectId":"e84b96d3-c112-47b6-840a-70f5ffc1aae7","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 299[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 586[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 767[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 385[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 353[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 891[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:50:40
[2m   Duration [22m 19.12s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/dashboard.routes.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764877865709,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764877868680,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764877872351,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764877872352,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764877872363,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764877872363,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764877872364,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764877872364,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764877872960,"env":"test","module":"user-credentials-repository","userId":"bQA2crBdG5_fUq2XP9I2g","msg":"User credentials created"}
{"level":30,"time":1764877872963,"env":"test","module":"auth-routes","userId":"bQA2crBdG5_fUq2XP9I2g","email":"test-workflows-dgcTqUszsRFEa9nxyf4i5@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c4590dd0-f73f-4d23-9dfe-a3efa7b02ede","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"bQA2crBdG5_fUq2XP9I2g","tenantId":"ae225444-3b78-409a-b033-390df1e2be91","createdBy":"bQA2crBdG5_fUq2XP9I2g","ownerId":"bQA2crBdG5_fUq2XP9I2g","status":"active","archived":false,"createdAt":"2025-12-04T19:51:14.646Z","updatedAt":"2025-12-04T19:51:14.646Z"}

{"level":30,"time":1764877873629,"env":"test","module":"user-credentials-repository","userId":"avHXdhf7ZRayOO7K8zs2R","msg":"User credentials created"}
{"level":30,"time":1764877873630,"env":"test","module":"auth-routes","userId":"avHXdhf7ZRayOO7K8zs2R","email":"viewer-amUfMAWtTRl3uqdcqbRyC@example.com","msg":"User registered successfully"}
{"level":40,"time":1764877873726,"env":"test","module":"rbac-middleware","userId":"avHXdhf7ZRayOO7K8zs2R","userRole":"viewer","permission":"workflow:create","path":"/projects/c4590dd0-f73f-4d23-9dfe-a3efa7b02ede/workflows","msg":"Permission denied"}
{"level":50,"time":1764877879640,"env":"test","error":{},"workflowId":"59425287-4fca-48e8-84f9-21082e15c20f","userId":"bQA2crBdG5_fUq2XP9I2g","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764877879955,"env":"test","module":"auth-middleware","path":"/api/workflows/8dec6de7-63ba-4f34-890b-9aa0eb6d7eaf/move","msg":"No valid authentication found"}
{"level":30,"time":1764877880446,"env":"test","module":"user-credentials-repository","userId":"YhjDGI7Eyub-900WTjhW1","msg":"User credentials created"}
{"level":30,"time":1764877880446,"env":"test","module":"auth-routes","userId":"YhjDGI7Eyub-900WTjhW1","email":"test-workflows-6Ktt_jGCj3KYQKOAi97iT@example.com","msg":"User registered successfully"}
{"level":50,"time":1764877880489,"env":"test","error":{},"workflowId":"261192b2-9dcd-48f1-9776-40c977801cdd","userId":"YhjDGI7Eyub-900WTjhW1","projectId":"e46c52fe-f174-4b7d-a32e-f5cd3041f221","msg":"Error moving workflow"}
{"level":50,"time":1764877880846,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2971cd4d-7ba2-4fab-a559-29ce70ff2af5","userId":"bQA2crBdG5_fUq2XP9I2g","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764877881194,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e09252f0-2a68-4d6c-8edb-840526066ac7","userId":"bQA2crBdG5_fUq2XP9I2g","msg":"Error moving workflow"}
{"level":30,"time":1764877881687,"env":"test","module":"user-credentials-repository","userId":"TXQOrmMbcktSaoCPw6-JN","msg":"User credentials created"}
{"level":30,"time":1764877881688,"env":"test","module":"auth-routes","userId":"TXQOrmMbcktSaoCPw6-JN","email":"test-workflows-kTTraFqTdfFd9bPjpyVIC@example.com","msg":"User registered successfully"}
{"level":30,"time":1764877881868,"env":"test","module":"auth-routes","userId":"TXQOrmMbcktSaoCPw6-JN","email":"test-workflows-kTTraFqTdfFd9bPjpyVIC@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764877882039,"env":"test","error":{},"workflowId":"b2d17f57-09e1-49ee-bdbf-4d5d92556e3c","userId":"bQA2crBdG5_fUq2XP9I2g","projectId":"8c2ce358-0153-49b2-873c-2f7afc4c3a03","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9993[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 313[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 299[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 429[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 582[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 554[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 683[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 534[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 348[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 846[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 13:51:01
[2m   Duration [22m 19.72s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764879995194,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764879998178,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880001410,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880001411,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880001422,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880001422,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880001422,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880001423,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880001948,"env":"test","module":"user-credentials-repository","userId":"Xc36GmIn9FK7QAiEmnuSb","msg":"User credentials created"}
{"level":30,"time":1764880001951,"env":"test","module":"auth-routes","userId":"Xc36GmIn9FK7QAiEmnuSb","email":"test-workflows-_Ty390Kqi69wH-toQP4Mo@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2da525ad-8e6e-4ae7-af63-49f1abbbd283","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Xc36GmIn9FK7QAiEmnuSb","tenantId":"1c448bbc-12cf-4bdb-adf7-84118569b962","createdBy":"Xc36GmIn9FK7QAiEmnuSb","ownerId":"Xc36GmIn9FK7QAiEmnuSb","status":"active","archived":false,"createdAt":"2025-12-04T20:26:43.675Z","updatedAt":"2025-12-04T20:26:43.675Z"}

{"level":30,"time":1764880002647,"env":"test","module":"user-credentials-repository","userId":"1n6qDmT7t0Lbkw5zOC_B5","msg":"User credentials created"}
{"level":30,"time":1764880002648,"env":"test","module":"auth-routes","userId":"1n6qDmT7t0Lbkw5zOC_B5","email":"viewer-UO6h6FVin1oPJQYLCF0xN@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880002739,"env":"test","module":"rbac-middleware","userId":"1n6qDmT7t0Lbkw5zOC_B5","userRole":"viewer","permission":"workflow:create","path":"/projects/2da525ad-8e6e-4ae7-af63-49f1abbbd283/workflows","msg":"Permission denied"}
{"level":50,"time":1764880009205,"env":"test","error":{},"workflowId":"0ec6754b-896e-4dec-92f9-779dde70bb7e","userId":"Xc36GmIn9FK7QAiEmnuSb","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880009546,"env":"test","module":"auth-middleware","path":"/api/workflows/0fd12c10-ecac-4d9e-8c42-bb747cea1251/move","msg":"No valid authentication found"}
{"level":30,"time":1764880010057,"env":"test","module":"user-credentials-repository","userId":"TqmYwoiA-IYiV-pEJBAXC","msg":"User credentials created"}
{"level":30,"time":1764880010058,"env":"test","module":"auth-routes","userId":"TqmYwoiA-IYiV-pEJBAXC","email":"test-workflows-eoRNFug3Vl1y8dIYMILWL@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880010102,"env":"test","error":{},"workflowId":"4ee8668d-4688-4390-948d-d287814f1735","userId":"TqmYwoiA-IYiV-pEJBAXC","projectId":"d48e829a-944a-4b04-b115-8ad9608542d4","msg":"Error moving workflow"}
{"level":50,"time":1764880010465,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"44a4485c-968a-40ec-8c11-16efe822bcd3","userId":"Xc36GmIn9FK7QAiEmnuSb","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880010832,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"847e5481-aeaa-4e19-a989-4a04994c8932","userId":"Xc36GmIn9FK7QAiEmnuSb","msg":"Error moving workflow"}
{"level":30,"time":1764880011403,"env":"test","module":"user-credentials-repository","userId":"hPcGcQx1MuVAH6pMQWLBp","msg":"User credentials created"}
{"level":30,"time":1764880011404,"env":"test","module":"auth-routes","userId":"hPcGcQx1MuVAH6pMQWLBp","email":"test-workflows-IvbUqK7bGHJcaOE9ZiAfT@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880011546,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764880011592,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"42abfb14-1f1c-46ff-b8b2-6201eb98dae2","userId":"Xc36GmIn9FK7QAiEmnuSb","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10441[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 812[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 714[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 539[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 363[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 762[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:29
[2m   Duration [22m 21.26s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/account.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764880016401,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880019967,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880023615,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880023616,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880023630,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880023631,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880023631,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880023631,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880024156,"env":"test","module":"user-credentials-repository","userId":"kI8v6zM94BmWLZM2qS2qA","msg":"User credentials created"}
{"level":30,"time":1764880024160,"env":"test","module":"auth-routes","userId":"kI8v6zM94BmWLZM2qS2qA","email":"test-workflows-0QjvvXsK7ESv7yLZ41Iia@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"99b096e8-7e4e-4010-a246-4be6e9874a1b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"kI8v6zM94BmWLZM2qS2qA","tenantId":"3aff8743-9973-4e18-8b33-57580c24fc49","createdBy":"kI8v6zM94BmWLZM2qS2qA","ownerId":"kI8v6zM94BmWLZM2qS2qA","status":"active","archived":false,"createdAt":"2025-12-04T20:27:05.891Z","updatedAt":"2025-12-04T20:27:05.891Z"}

{"level":30,"time":1764880024898,"env":"test","module":"user-credentials-repository","userId":"NTFJJU_iq3-UKyfE7yX-w","msg":"User credentials created"}
{"level":30,"time":1764880024899,"env":"test","module":"auth-routes","userId":"NTFJJU_iq3-UKyfE7yX-w","email":"viewer-uhAywpPr1ylDEyfq08PrT@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880025002,"env":"test","module":"rbac-middleware","userId":"NTFJJU_iq3-UKyfE7yX-w","userRole":"viewer","permission":"workflow:create","path":"/projects/99b096e8-7e4e-4010-a246-4be6e9874a1b/workflows","msg":"Permission denied"}
{"level":50,"time":1764880031296,"env":"test","error":{},"workflowId":"7d888a72-4d77-4936-b2a6-81192b074522","userId":"kI8v6zM94BmWLZM2qS2qA","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880031630,"env":"test","module":"auth-middleware","path":"/api/workflows/5a7ee984-5290-4e45-af14-df4e4c5a8cee/move","msg":"No valid authentication found"}
{"level":30,"time":1764880032152,"env":"test","module":"user-credentials-repository","userId":"I-QDBdpwoN4RxNc1DGEVy","msg":"User credentials created"}
{"level":30,"time":1764880032153,"env":"test","module":"auth-routes","userId":"I-QDBdpwoN4RxNc1DGEVy","email":"test-workflows-I_XJBs0P5SQo4bPFT-P_W@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880032248,"env":"test","error":{},"workflowId":"d027e36c-76bb-4522-bbbc-6a15c4c78780","userId":"I-QDBdpwoN4RxNc1DGEVy","projectId":"584962ee-85ed-4254-83b3-710bdb191158","msg":"Error moving workflow"}
{"level":50,"time":1764880032660,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9c7a3977-c79e-4cbc-aa82-95f659c611de","userId":"kI8v6zM94BmWLZM2qS2qA","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880033024,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e5262092-58a8-41fa-a672-9abfd27918b3","userId":"kI8v6zM94BmWLZM2qS2qA","msg":"Error moving workflow"}
{"level":30,"time":1764880033542,"env":"test","module":"user-credentials-repository","userId":"wdjO-k1a5fNDD0NXiYw31","msg":"User credentials created"}
{"level":30,"time":1764880033543,"env":"test","module":"auth-routes","userId":"wdjO-k1a5fNDD0NXiYw31","email":"test-workflows-BPuoBoir0HMYiwFAt9R7z@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880033744,"env":"test","module":"auth-routes","userId":"wdjO-k1a5fNDD0NXiYw31","email":"test-workflows-BPuoBoir0HMYiwFAt9R7z@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880033920,"env":"test","error":{},"workflowId":"357284cc-9729-4666-91c8-371a6318b279","userId":"kI8v6zM94BmWLZM2qS2qA","projectId":"dbd67660-a7ef-4af6-8bbc-b3cd55f8ff92","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 334[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 409[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 363[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 897[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:26:51
[2m   Duration [22m 21.30s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx26 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880066669,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880071010,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880075142,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880075143,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880075153,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880075153,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880075153,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880075153,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880075656,"env":"test","module":"user-credentials-repository","userId":"U17O7VGtTtjbiG4Vpd8aQ","msg":"User credentials created"}
{"level":30,"time":1764880075659,"env":"test","module":"auth-routes","userId":"U17O7VGtTtjbiG4Vpd8aQ","email":"test-workflows-4xa8sicvg1X5rsnvhi7Uw@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f9b8eeb0-7de1-484e-a986-81378d61b3b6","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"U17O7VGtTtjbiG4Vpd8aQ","tenantId":"fba07964-c75e-4162-a8d2-77754da4540f","createdBy":"U17O7VGtTtjbiG4Vpd8aQ","ownerId":"U17O7VGtTtjbiG4Vpd8aQ","status":"active","archived":false,"createdAt":"2025-12-04T20:27:57.372Z","updatedAt":"2025-12-04T20:27:57.372Z"}

{"level":30,"time":1764880076328,"env":"test","module":"user-credentials-repository","userId":"R_GACYv04JE37HykQjXGu","msg":"User credentials created"}
{"level":30,"time":1764880076329,"env":"test","module":"auth-routes","userId":"R_GACYv04JE37HykQjXGu","email":"viewer-EoiY8sAcO0Huhzm5frrYj@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880076416,"env":"test","module":"rbac-middleware","userId":"R_GACYv04JE37HykQjXGu","userRole":"viewer","permission":"workflow:create","path":"/projects/f9b8eeb0-7de1-484e-a986-81378d61b3b6/workflows","msg":"Permission denied"}
{"level":50,"time":1764880082619,"env":"test","error":{},"workflowId":"3208a845-a850-4d31-87da-d420e6d05952","userId":"U17O7VGtTtjbiG4Vpd8aQ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880082932,"env":"test","module":"auth-middleware","path":"/api/workflows/72bef1b5-b4ac-474e-a166-c61db2a4dffd/move","msg":"No valid authentication found"}
{"level":30,"time":1764880083434,"env":"test","module":"user-credentials-repository","userId":"J64n-fS4H_7nhjdtJ8Kb1","msg":"User credentials created"}
{"level":30,"time":1764880083434,"env":"test","module":"auth-routes","userId":"J64n-fS4H_7nhjdtJ8Kb1","email":"test-workflows-3Eu6W1a7oP9Yojzup_SxC@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880083483,"env":"test","error":{},"workflowId":"0575301b-002a-45be-8722-b7e659fa6197","userId":"J64n-fS4H_7nhjdtJ8Kb1","projectId":"3e30c7aa-6460-470d-a6a1-c75554080a5e","msg":"Error moving workflow"}
{"level":50,"time":1764880083852,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ac572040-43d1-48ba-b0e6-59a76464e3f4","userId":"U17O7VGtTtjbiG4Vpd8aQ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880084218,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"3efd343d-787c-44e7-88f7-89d2e7272f94","userId":"U17O7VGtTtjbiG4Vpd8aQ","msg":"Error moving workflow"}
{"level":30,"time":1764880084737,"env":"test","module":"user-credentials-repository","userId":"YBvYD04HjssqCJu3HlUwH","msg":"User credentials created"}
{"level":30,"time":1764880084738,"env":"test","module":"auth-routes","userId":"YBvYD04HjssqCJu3HlUwH","email":"test-workflows-4cpgldHIVPkMPTKBB_GGd@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880084935,"env":"test","module":"auth-routes","userId":"YBvYD04HjssqCJu3HlUwH","email":"test-workflows-4cpgldHIVPkMPTKBB_GGd@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880085148,"env":"test","error":{},"workflowId":"eab068e4-c5e0-4cd9-a57b-f5eff6df368e","userId":"U17O7VGtTtjbiG4Vpd8aQ","projectId":"7d0eda16-877e-4a42-9445-f579408d0be0","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10272[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 331[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 282[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 724[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 444[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 366[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 932[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:27:42
[2m   Duration [22m 21.92s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx27 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880090539,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880093608,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880096455,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880096455,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880096464,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880096464,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880096464,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880096464,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880096971,"env":"test","module":"user-credentials-repository","userId":"_Zwr47jVQqcFVUkNrFP_J","msg":"User credentials created"}
{"level":30,"time":1764880096975,"env":"test","module":"auth-routes","userId":"_Zwr47jVQqcFVUkNrFP_J","email":"test-workflows-1sJgbEWErJjGt4gs2mIGI@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"1dc4487d-4d97-45a4-8ddd-c9d72bccd7f6","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"_Zwr47jVQqcFVUkNrFP_J","tenantId":"99821c15-ca7e-4ab6-8b1a-79b85307ef2a","createdBy":"_Zwr47jVQqcFVUkNrFP_J","ownerId":"_Zwr47jVQqcFVUkNrFP_J","status":"active","archived":false,"createdAt":"2025-12-04T20:28:18.706Z","updatedAt":"2025-12-04T20:28:18.706Z"}

{"level":30,"time":1764880097752,"env":"test","module":"user-credentials-repository","userId":"JqGbcYL_-GU_bG7p1veMe","msg":"User credentials created"}
{"level":30,"time":1764880097753,"env":"test","module":"auth-routes","userId":"JqGbcYL_-GU_bG7p1veMe","email":"viewer--6E5PvUn_Wqo2CJwIE9YX@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880097855,"env":"test","module":"rbac-middleware","userId":"JqGbcYL_-GU_bG7p1veMe","userRole":"viewer","permission":"workflow:create","path":"/projects/1dc4487d-4d97-45a4-8ddd-c9d72bccd7f6/workflows","msg":"Permission denied"}
{"level":50,"time":1764880104689,"env":"test","error":{},"workflowId":"081af104-4236-465d-aec8-b8eb28241b20","userId":"_Zwr47jVQqcFVUkNrFP_J","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880105035,"env":"test","module":"auth-middleware","path":"/api/workflows/e686d8dc-27d8-4e49-b632-225b975ac06c/move","msg":"No valid authentication found"}
{"level":30,"time":1764880105623,"env":"test","module":"user-credentials-repository","userId":"odd0Z7u_Qo5JGeU186UtR","msg":"User credentials created"}
{"level":30,"time":1764880105623,"env":"test","module":"auth-routes","userId":"odd0Z7u_Qo5JGeU186UtR","email":"test-workflows-8e3-aE4RpFOnTCN1uXxxZ@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880105722,"env":"test","error":{},"workflowId":"ebae83ca-f5d5-45cc-94f4-b3d12aa3991a","userId":"odd0Z7u_Qo5JGeU186UtR","projectId":"e5dc1117-0ce7-493c-bd0c-56dd6bc97c45","msg":"Error moving workflow"}
{"level":50,"time":1764880106100,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3a8b2750-2726-408e-89e7-e8dc0a2ee953","userId":"_Zwr47jVQqcFVUkNrFP_J","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880106296,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_Zwr47jVQqcFVUkNrFP_J) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_Zwr47jVQqcFVUkNrFP_J","msg":"Error creating workflow"}
{"level":50,"time":1764880106490,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_Zwr47jVQqcFVUkNrFP_J) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_Zwr47jVQqcFVUkNrFP_J","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 10327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 363[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 514[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 491[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 893[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 805[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 680[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 834[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 666[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 793[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 515[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 197[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 194[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:05
[2m   Duration [22m 20.23s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/collections.routes.ts [22m[34mx28 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880110203,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880112210,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880114254,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880114255,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880114263,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880114263,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880114263,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880114263,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880114704,"env":"test","module":"user-credentials-repository","userId":"YF0HNp3oQDBLEkG7bUbUu","msg":"User credentials created"}
{"level":30,"time":1764880114706,"env":"test","module":"auth-routes","userId":"YF0HNp3oQDBLEkG7bUbUu","email":"test-workflows-ww7mkxFIeYgAMKFOVh1Uu@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"235ec9e7-1c3c-487b-8b53-cbc76192a825","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"YF0HNp3oQDBLEkG7bUbUu","tenantId":"2b6d21e4-f18f-4a5f-9bb9-8da5300cf814","createdBy":"YF0HNp3oQDBLEkG7bUbUu","ownerId":"YF0HNp3oQDBLEkG7bUbUu","status":"active","archived":false,"createdAt":"2025-12-04T20:28:36.428Z","updatedAt":"2025-12-04T20:28:36.428Z"}

{"level":30,"time":1764880115397,"env":"test","module":"user-credentials-repository","userId":"WMNykj0jommlKgz29isF7","msg":"User credentials created"}
{"level":30,"time":1764880115397,"env":"test","module":"auth-routes","userId":"WMNykj0jommlKgz29isF7","email":"viewer-CZVXDreT1i_8xSVKp2N-w@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880115484,"env":"test","module":"rbac-middleware","userId":"WMNykj0jommlKgz29isF7","userRole":"viewer","permission":"workflow:create","path":"/projects/235ec9e7-1c3c-487b-8b53-cbc76192a825/workflows","msg":"Permission denied"}
{"level":50,"time":1764880121751,"env":"test","error":{},"workflowId":"c3de6f30-ce91-41aa-9d18-5164257de667","userId":"YF0HNp3oQDBLEkG7bUbUu","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880122079,"env":"test","module":"auth-middleware","path":"/api/workflows/53b75813-bf76-41a6-ba5b-db37a2f7b2ab/move","msg":"No valid authentication found"}
{"level":30,"time":1764880122593,"env":"test","module":"user-credentials-repository","userId":"_s3m_iwO1Zg7VvlVcOTBj","msg":"User credentials created"}
{"level":30,"time":1764880122593,"env":"test","module":"auth-routes","userId":"_s3m_iwO1Zg7VvlVcOTBj","email":"test-workflows-wgZRlbIIrU9oWYF-uTqS0@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880122639,"env":"test","error":{},"workflowId":"2b094299-871a-429a-88c2-5c96953c5ce5","userId":"_s3m_iwO1Zg7VvlVcOTBj","projectId":"23656aeb-5841-44a2-b95c-4083e237907a","msg":"Error moving workflow"}
{"level":50,"time":1764880122998,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"d59a20ac-d158-49ca-9cf1-abd071717d10","userId":"YF0HNp3oQDBLEkG7bUbUu","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880123367,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"434d3ad9-8f91-47ff-86a9-11968ea7df40","userId":"YF0HNp3oQDBLEkG7bUbUu","msg":"Error moving workflow"}
{"level":30,"time":1764880123932,"env":"test","module":"user-credentials-repository","userId":"ItmKWSNZnBgiEHWaeoTx9","msg":"User credentials created"}
{"level":30,"time":1764880123933,"env":"test","module":"auth-routes","userId":"ItmKWSNZnBgiEHWaeoTx9","email":"test-workflows-lgpL19bEreKUq_sH-JS0V@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880124034,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764880124080,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"85fde369-74ef-4194-868d-575acd37fc36","userId":"YF0HNp3oQDBLEkG7bUbUu","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10085[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 340[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 284[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 658[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 717[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:26
[2m   Duration [22m 16.80s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/sections.routes.ts [22m[34mx29 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764880140349,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880143856,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880148177,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880148178,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880148189,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880148189,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880148189,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880148189,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880148705,"env":"test","module":"user-credentials-repository","userId":"L5_e7XpAEbpXut3nKi1Ym","msg":"User credentials created"}
{"level":30,"time":1764880148708,"env":"test","module":"auth-routes","userId":"L5_e7XpAEbpXut3nKi1Ym","email":"test-workflows-ceMpIElLIOIxhLZPQLsHz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2c774de8-14aa-494f-b4af-9066817a32cf","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"L5_e7XpAEbpXut3nKi1Ym","tenantId":"ba24b302-1669-4787-a7c7-0f04179bef0a","createdBy":"L5_e7XpAEbpXut3nKi1Ym","ownerId":"L5_e7XpAEbpXut3nKi1Ym","status":"active","archived":false,"createdAt":"2025-12-04T20:29:10.429Z","updatedAt":"2025-12-04T20:29:10.429Z"}

{"level":30,"time":1764880149423,"env":"test","module":"user-credentials-repository","userId":"mN_lXyVuHKLvF1Q9z1Vs6","msg":"User credentials created"}
{"level":30,"time":1764880149424,"env":"test","module":"auth-routes","userId":"mN_lXyVuHKLvF1Q9z1Vs6","email":"viewer-RQBcrbAiKEC4i_h-hRc9g@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880149519,"env":"test","module":"rbac-middleware","userId":"mN_lXyVuHKLvF1Q9z1Vs6","userRole":"viewer","permission":"workflow:create","path":"/projects/2c774de8-14aa-494f-b4af-9066817a32cf/workflows","msg":"Permission denied"}
{"level":50,"time":1764880155841,"env":"test","error":{},"workflowId":"330b244c-e4c3-4874-b6d0-801b8a06d6f9","userId":"L5_e7XpAEbpXut3nKi1Ym","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880156170,"env":"test","module":"auth-middleware","path":"/api/workflows/7b60d674-4074-4d3b-b9b0-1c902bd7cee2/move","msg":"No valid authentication found"}
{"level":30,"time":1764880156667,"env":"test","module":"user-credentials-repository","userId":"ddcCOzLeLiaHl-xx4iHP6","msg":"User credentials created"}
{"level":30,"time":1764880156667,"env":"test","module":"auth-routes","userId":"ddcCOzLeLiaHl-xx4iHP6","email":"test-workflows-IsCTu-VzkP3FDL3F58MLF@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880156720,"env":"test","error":{},"workflowId":"22ccb9d1-3ffa-4174-95a7-dec0a366a23c","userId":"ddcCOzLeLiaHl-xx4iHP6","projectId":"7e4f16aa-9575-4e0b-baa4-bd5b420de5a0","msg":"Error moving workflow"}
{"level":50,"time":1764880157097,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"cc129ad3-1415-4115-96ae-0a582ca7a542","userId":"L5_e7XpAEbpXut3nKi1Ym","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880157488,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"980b989d-e696-4d6e-ada1-00c7f06587f5","userId":"L5_e7XpAEbpXut3nKi1Ym","msg":"Error moving workflow"}
{"level":30,"time":1764880157991,"env":"test","module":"user-credentials-repository","userId":"qATrtiVfJq2igefzsPT0B","msg":"User credentials created"}
{"level":30,"time":1764880157992,"env":"test","module":"auth-routes","userId":"qATrtiVfJq2igefzsPT0B","email":"test-workflows-NP6L_KxrESZCTRfnbrzdY@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880158181,"env":"test","module":"auth-routes","userId":"qATrtiVfJq2igefzsPT0B","email":"test-workflows-NP6L_KxrESZCTRfnbrzdY@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880158360,"env":"test","error":{},"workflowId":"7575c354-92d9-46f3-9832-fef7c19554fa","userId":"L5_e7XpAEbpXut3nKi1Ym","projectId":"2f4f4285-2376-4630-ad8c-9751f1428dc9","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10498[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 795[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 377[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 391[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 873[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:28:56
[2m   Duration [22m 21.84s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx30 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764880169900,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880173595,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880177113,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880177114,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880177126,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880177126,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880177127,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880177127,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880177675,"env":"test","module":"user-credentials-repository","userId":"5O7BnuzL_8HN7FWY0-27P","msg":"User credentials created"}
{"level":30,"time":1764880177678,"env":"test","module":"auth-routes","userId":"5O7BnuzL_8HN7FWY0-27P","email":"test-workflows-NyuZs-bNnhZH-6AyB1F-r@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"ad67d0c1-0ba1-46b1-b13d-2b131339b16e","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"5O7BnuzL_8HN7FWY0-27P","tenantId":"d15f394d-7cf2-4cbc-9636-a3d2a1935b7c","createdBy":"5O7BnuzL_8HN7FWY0-27P","ownerId":"5O7BnuzL_8HN7FWY0-27P","status":"active","archived":false,"createdAt":"2025-12-04T20:29:39.407Z","updatedAt":"2025-12-04T20:29:39.407Z"}

{"level":30,"time":1764880178415,"env":"test","module":"user-credentials-repository","userId":"h-CR4cqDMbploTFppGxlM","msg":"User credentials created"}
{"level":30,"time":1764880178416,"env":"test","module":"auth-routes","userId":"h-CR4cqDMbploTFppGxlM","email":"viewer-glkhBL01WWJA8g5nrFPkb@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880178511,"env":"test","module":"rbac-middleware","userId":"h-CR4cqDMbploTFppGxlM","userRole":"viewer","permission":"workflow:create","path":"/projects/ad67d0c1-0ba1-46b1-b13d-2b131339b16e/workflows","msg":"Permission denied"}
{"level":50,"time":1764880185091,"env":"test","error":{},"workflowId":"749292bc-9bdc-4354-8a07-bbb049812e9d","userId":"5O7BnuzL_8HN7FWY0-27P","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880185437,"env":"test","module":"auth-middleware","path":"/api/workflows/57cb36f2-e811-47b2-9418-b59c52e61fa6/move","msg":"No valid authentication found"}
{"level":30,"time":1764880185979,"env":"test","module":"user-credentials-repository","userId":"WR2mWiXyJ6FptsMjbqyR6","msg":"User credentials created"}
{"level":30,"time":1764880185980,"env":"test","module":"auth-routes","userId":"WR2mWiXyJ6FptsMjbqyR6","email":"test-workflows-ht4fvHPLocnIueIH_IsjE@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880186029,"env":"test","error":{},"workflowId":"6ded7237-d94d-47cc-80ce-c8440113c644","userId":"WR2mWiXyJ6FptsMjbqyR6","projectId":"d900f515-bddf-4f1b-ae8e-bb578c1f6dce","msg":"Error moving workflow"}
{"level":50,"time":1764880186420,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"fa09db97-a76a-4dcc-9643-8651e770d4b6","userId":"5O7BnuzL_8HN7FWY0-27P","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880186792,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b3f3c9db-e782-4956-9904-72b9eca8e598","userId":"5O7BnuzL_8HN7FWY0-27P","msg":"Error moving workflow"}
{"level":30,"time":1764880187364,"env":"test","module":"user-credentials-repository","userId":"jDQIVAxvo3ffd8tRSRS-4","msg":"User credentials created"}
{"level":30,"time":1764880187364,"env":"test","module":"auth-routes","userId":"jDQIVAxvo3ffd8tRSRS-4","email":"test-workflows-evyleLJJcF5ESywiR_mOq@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880187572,"env":"test","module":"auth-routes","userId":"jDQIVAxvo3ffd8tRSRS-4","email":"test-workflows-evyleLJJcF5ESywiR_mOq@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880187771,"env":"test","error":{},"workflowId":"9b513da0-0109-4957-b1b8-e5c1446cfced","userId":"5O7BnuzL_8HN7FWY0-27P","projectId":"260c64ef-ca0c-45cc-b3ec-3a6a2907cfb5","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10998[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 849[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 649[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 392[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 371[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 980[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:25
[2m   Duration [22m 21.85s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/secrets.routes.ts [22m[34mx31 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764880190703,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880192959,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880195418,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880195419,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880195430,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880195430,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880195430,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880195430,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880195934,"env":"test","module":"user-credentials-repository","userId":"7rNVbPonU0PUqTQZF2KXW","msg":"User credentials created"}
{"level":30,"time":1764880195938,"env":"test","module":"auth-routes","userId":"7rNVbPonU0PUqTQZF2KXW","email":"test-workflows-uEaZ6wmObVu-1WFY98wID@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7be3fde2-951a-42b2-abf7-cef671f2cfe8","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"7rNVbPonU0PUqTQZF2KXW","tenantId":"b64ec451-1db0-42f9-bfea-795d2e9742d1","createdBy":"7rNVbPonU0PUqTQZF2KXW","ownerId":"7rNVbPonU0PUqTQZF2KXW","status":"active","archived":false,"createdAt":"2025-12-04T20:29:57.672Z","updatedAt":"2025-12-04T20:29:57.672Z"}

{"level":30,"time":1764880196662,"env":"test","module":"user-credentials-repository","userId":"FcUue-vVvcqQdDzRHR7Sa","msg":"User credentials created"}
{"level":30,"time":1764880196663,"env":"test","module":"auth-routes","userId":"FcUue-vVvcqQdDzRHR7Sa","email":"viewer-rgSOLXsKaggxdziQu6J1C@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880196760,"env":"test","module":"rbac-middleware","userId":"FcUue-vVvcqQdDzRHR7Sa","userRole":"viewer","permission":"workflow:create","path":"/projects/7be3fde2-951a-42b2-abf7-cef671f2cfe8/workflows","msg":"Permission denied"}
{"level":50,"time":1764880203403,"env":"test","error":{},"workflowId":"577325de-a01f-476d-8940-22bfd5953720","userId":"7rNVbPonU0PUqTQZF2KXW","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880203740,"env":"test","module":"auth-middleware","path":"/api/workflows/b81e6db2-1834-4548-85b4-a9eb9fb381e4/move","msg":"No valid authentication found"}
{"level":30,"time":1764880204292,"env":"test","module":"user-credentials-repository","userId":"vRod18M3RWQyiCPjgPn5v","msg":"User credentials created"}
{"level":30,"time":1764880204293,"env":"test","module":"auth-routes","userId":"vRod18M3RWQyiCPjgPn5v","email":"test-workflows-xEewkK--mEdoCJEg3VZ6h@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880204343,"env":"test","error":{},"workflowId":"a4c2ffd1-f4ab-484f-b168-7054d55736b3","userId":"vRod18M3RWQyiCPjgPn5v","projectId":"e49395da-aa66-4a84-9f19-73ee8173289e","msg":"Error moving workflow"}
{"level":50,"time":1764880204809,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"a3ebefcd-fb13-495e-b7e6-ebde9da17949","userId":"7rNVbPonU0PUqTQZF2KXW","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880205211,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8d00cfe1-7f4b-41cb-8353-bd141ed6d247","userId":"7rNVbPonU0PUqTQZF2KXW","msg":"Error moving workflow"}
{"level":30,"time":1764880205780,"env":"test","module":"user-credentials-repository","userId":"pSi8xZR1kNbVqCgZrES2d","msg":"User credentials created"}
{"level":30,"time":1764880205781,"env":"test","module":"auth-routes","userId":"pSi8xZR1kNbVqCgZrES2d","email":"test-workflows-m1r8Rh6SWDjdwGiJZLMDy@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880205928,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764880205976,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"6bfb6be9-0a7e-43b8-94ef-09e7ab016cd4","userId":"7rNVbPonU0PUqTQZF2KXW","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10850[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 491[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 836[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 692[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 824[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 515[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 400[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 768[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:29:48
[2m   Duration [22m 17.66s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/steps.routes.ts [22m[34mx32 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764880218862,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880221951,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880226373,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880226374,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880226385,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880226386,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880226386,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880226386,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880226962,"env":"test","module":"user-credentials-repository","userId":"3j78MptJMPWdxiOlAcru6","msg":"User credentials created"}
{"level":30,"time":1764880226965,"env":"test","module":"auth-routes","userId":"3j78MptJMPWdxiOlAcru6","email":"test-workflows-G9zojACsni1wkdbFmy2XF@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"6950bedf-ca0a-4f62-8e1f-157aece6a6b8","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"3j78MptJMPWdxiOlAcru6","tenantId":"611e93fd-93ea-4700-b5af-71b450c87257","createdBy":"3j78MptJMPWdxiOlAcru6","ownerId":"3j78MptJMPWdxiOlAcru6","status":"active","archived":false,"createdAt":"2025-12-04T20:30:28.684Z","updatedAt":"2025-12-04T20:30:28.684Z"}

{"level":30,"time":1764880227625,"env":"test","module":"user-credentials-repository","userId":"s8_tqjvzHataKAfNhY-26","msg":"User credentials created"}
{"level":30,"time":1764880227625,"env":"test","module":"auth-routes","userId":"s8_tqjvzHataKAfNhY-26","email":"viewer-HJKsg4bScT-HWk1E8Ed9A@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880227720,"env":"test","module":"rbac-middleware","userId":"s8_tqjvzHataKAfNhY-26","userRole":"viewer","permission":"workflow:create","path":"/projects/6950bedf-ca0a-4f62-8e1f-157aece6a6b8/workflows","msg":"Permission denied"}
{"level":50,"time":1764880233574,"env":"test","error":{},"workflowId":"f1123e2c-8abe-466c-9dec-d5bc88f77dd8","userId":"3j78MptJMPWdxiOlAcru6","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880233876,"env":"test","module":"auth-middleware","path":"/api/workflows/392e6ee0-d325-41bc-b929-5cb7bf7c3210/move","msg":"No valid authentication found"}
{"level":30,"time":1764880234350,"env":"test","module":"user-credentials-repository","userId":"e4tVx5AJmLhS_F28aUnwd","msg":"User credentials created"}
{"level":30,"time":1764880234351,"env":"test","module":"auth-routes","userId":"e4tVx5AJmLhS_F28aUnwd","email":"test-workflows-oAsGXxgIaHR5AkZfKL2pq@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880234395,"env":"test","error":{},"workflowId":"6f9caa45-bc49-4671-a08e-6daec42af842","userId":"e4tVx5AJmLhS_F28aUnwd","projectId":"feccac52-c82d-4b70-81f5-e0275b356cd0","msg":"Error moving workflow"}
{"level":50,"time":1764880234737,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f08713d5-4b6d-405f-a615-60a6cc5003df","userId":"3j78MptJMPWdxiOlAcru6","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880235072,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0564f35d-6ed6-4cd4-99e2-203c93806b85","userId":"3j78MptJMPWdxiOlAcru6","msg":"Error moving workflow"}
{"level":30,"time":1764880235560,"env":"test","module":"user-credentials-repository","userId":"X-V1nxwQm8ShpM11Q_B_o","msg":"User credentials created"}
{"level":30,"time":1764880235561,"env":"test","module":"auth-routes","userId":"X-V1nxwQm8ShpM11Q_B_o","email":"test-workflows-jO50koJBuMIRvGHoJNIvN@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880235746,"env":"test","module":"auth-routes","userId":"X-V1nxwQm8ShpM11Q_B_o","email":"test-workflows-jO50koJBuMIRvGHoJNIvN@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880235939,"env":"test","error":{},"workflowId":"59223d8a-eb70-47b9-b1c2-846418b0500a","userId":"3j78MptJMPWdxiOlAcru6","projectId":"e785c551-3bd3-4b12-b7f2-d00896ba12bf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9822[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 318[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 289[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 552[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 704[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 301[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 520[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 335[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 868[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:14
[2m   Duration [22m 20.89s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx33 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764880256560,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880259545,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880263292,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880263293,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880263304,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880263304,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880263305,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880263305,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880263810,"env":"test","module":"user-credentials-repository","userId":"FEu17zYoAr58WwCRb0Xa1","msg":"User credentials created"}
{"level":30,"time":1764880263813,"env":"test","module":"auth-routes","userId":"FEu17zYoAr58WwCRb0Xa1","email":"test-workflows-6RPZxFshGitj4oKOHeYny@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c2435726-151e-49de-b54b-1a3a9871468e","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"FEu17zYoAr58WwCRb0Xa1","tenantId":"716ffdca-e1ec-40e9-a297-93e2aa843a4a","createdBy":"FEu17zYoAr58WwCRb0Xa1","ownerId":"FEu17zYoAr58WwCRb0Xa1","status":"active","archived":false,"createdAt":"2025-12-04T20:31:05.530Z","updatedAt":"2025-12-04T20:31:05.530Z"}

{"level":30,"time":1764880264496,"env":"test","module":"user-credentials-repository","userId":"CawqL7O6ldmsPyE0kwdHX","msg":"User credentials created"}
{"level":30,"time":1764880264496,"env":"test","module":"auth-routes","userId":"CawqL7O6ldmsPyE0kwdHX","email":"viewer-Aye7X_DuNOTPLAi84KZs1@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880264599,"env":"test","module":"rbac-middleware","userId":"CawqL7O6ldmsPyE0kwdHX","userRole":"viewer","permission":"workflow:create","path":"/projects/c2435726-151e-49de-b54b-1a3a9871468e/workflows","msg":"Permission denied"}
{"level":50,"time":1764880270640,"env":"test","error":{},"workflowId":"49883412-73ef-415d-9617-5c9a0dc08fb1","userId":"FEu17zYoAr58WwCRb0Xa1","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880270970,"env":"test","module":"auth-middleware","path":"/api/workflows/ad1c6c9b-ceaf-4e63-a860-3763dd2ad670/move","msg":"No valid authentication found"}
{"level":30,"time":1764880271466,"env":"test","module":"user-credentials-repository","userId":"Y3EDsvdtHGIpEhDPheMiG","msg":"User credentials created"}
{"level":30,"time":1764880271467,"env":"test","module":"auth-routes","userId":"Y3EDsvdtHGIpEhDPheMiG","email":"test-workflows-xeDLK0YFIiQ7kWNZB8Yr9@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880271512,"env":"test","error":{},"workflowId":"df52f6a6-eff3-452e-90f9-04f6b12f7a5a","userId":"Y3EDsvdtHGIpEhDPheMiG","projectId":"8c814817-bd90-4d5b-959f-105a8c1efaa2","msg":"Error moving workflow"}
{"level":50,"time":1764880271879,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"27703fe5-49eb-4784-a6e9-bcf6686b5c9c","userId":"FEu17zYoAr58WwCRb0Xa1","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880272234,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"557c8ee3-72c2-4cef-8c1d-d76a267d9b30","userId":"FEu17zYoAr58WwCRb0Xa1","msg":"Error moving workflow"}
{"level":30,"time":1764880272738,"env":"test","module":"user-credentials-repository","userId":"zuKlcwzCfcKIidDiPhVFT","msg":"User credentials created"}
{"level":30,"time":1764880272738,"env":"test","module":"auth-routes","userId":"zuKlcwzCfcKIidDiPhVFT","email":"test-workflows-aaBVB3mYD1vm1E8iII-qF@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880272940,"env":"test","module":"auth-routes","userId":"zuKlcwzCfcKIidDiPhVFT","email":"test-workflows-aaBVB3mYD1vm1E8iII-qF@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880273110,"env":"test","error":{},"workflowId":"b25b78a0-7077-4518-98dd-90428a894385","userId":"FEu17zYoAr58WwCRb0Xa1","projectId":"1330b494-da79-4bf6-826a-fc1862987d3f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10082[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 565[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 606[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 428[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 367[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 356[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 876[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:30:52
[2m   Duration [22m 20.40s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx34 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764880277325,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880281816,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880286220,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880286220,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880286229,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880286229,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880286230,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880286230,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880286694,"env":"test","module":"user-credentials-repository","userId":"gnyiwegUcr7Kn-rYxtkV4","msg":"User credentials created"}
{"level":30,"time":1764880286697,"env":"test","module":"auth-routes","userId":"gnyiwegUcr7Kn-rYxtkV4","email":"test-workflows-ozXAlEthotE9Q887tY3BC@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"661ef089-9aca-4b8a-b723-bc1bd5d81871","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"gnyiwegUcr7Kn-rYxtkV4","tenantId":"980a4919-7511-4c32-9bab-52e35fce656e","createdBy":"gnyiwegUcr7Kn-rYxtkV4","ownerId":"gnyiwegUcr7Kn-rYxtkV4","status":"active","archived":false,"createdAt":"2025-12-04T20:31:28.414Z","updatedAt":"2025-12-04T20:31:28.414Z"}

{"level":30,"time":1764880287347,"env":"test","module":"user-credentials-repository","userId":"-W-ICCsCZpF3ZPLJGnGLT","msg":"User credentials created"}
{"level":30,"time":1764880287348,"env":"test","module":"auth-routes","userId":"-W-ICCsCZpF3ZPLJGnGLT","email":"viewer-RSvUV43tGXqPqszW5dNRC@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880287435,"env":"test","module":"rbac-middleware","userId":"-W-ICCsCZpF3ZPLJGnGLT","userRole":"viewer","permission":"workflow:create","path":"/projects/661ef089-9aca-4b8a-b723-bc1bd5d81871/workflows","msg":"Permission denied"}
{"level":50,"time":1764880293296,"env":"test","error":{},"workflowId":"9b5343b7-4d11-4406-8472-7f5866cbce6e","userId":"gnyiwegUcr7Kn-rYxtkV4","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880293596,"env":"test","module":"auth-middleware","path":"/api/workflows/0602c5bd-3a22-4910-912f-5dfeed64f39d/move","msg":"No valid authentication found"}
{"level":30,"time":1764880294097,"env":"test","module":"user-credentials-repository","userId":"8kzFH_zqojUqQnlfYfxiV","msg":"User credentials created"}
{"level":30,"time":1764880294098,"env":"test","module":"auth-routes","userId":"8kzFH_zqojUqQnlfYfxiV","email":"test-workflows-tycCHqpTcAMOKR5om8a-j@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880294189,"env":"test","error":{},"workflowId":"e1a8ffd9-2588-4598-818c-ffab7bf8c80a","userId":"8kzFH_zqojUqQnlfYfxiV","projectId":"d45d3594-2906-44bc-9df4-6096024f4779","msg":"Error moving workflow"}
{"level":50,"time":1764880294536,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"37fca332-8ad2-4404-84ac-aba0cd073587","userId":"gnyiwegUcr7Kn-rYxtkV4","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880294878,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0f42d198-ce4b-4870-9188-7f9ecf8ed024","userId":"gnyiwegUcr7Kn-rYxtkV4","msg":"Error moving workflow"}
{"level":30,"time":1764880295381,"env":"test","module":"user-credentials-repository","userId":"0urFuAgg7Kp2yFBjJrWKv","msg":"User credentials created"}
{"level":30,"time":1764880295382,"env":"test","module":"auth-routes","userId":"0urFuAgg7Kp2yFBjJrWKv","email":"test-workflows-aqJj3XPkfphUOc97L_-bB@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880295565,"env":"test","module":"auth-routes","userId":"0urFuAgg7Kp2yFBjJrWKv","email":"test-workflows-aqJj3XPkfphUOc97L_-bB@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880295735,"env":"test","error":{},"workflowId":"3bb9ad9e-fa19-485f-8d44-7751bdcf9bec","userId":"gnyiwegUcr7Kn-rYxtkV4","projectId":"c8163b8f-aaa1-44f9-b59a-d6b85a3677ca","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 322[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 270[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 455[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 719[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 692[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 414[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 298[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 342[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 857[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:13
[2m   Duration [22m 21.72s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/userPreferences.routes.ts [22m[34mx35 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764880300790,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880304697,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880307592,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880307593,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880307608,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880307608,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880307608,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880307608,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880308097,"env":"test","module":"user-credentials-repository","userId":"g8B-pQwziHkWTgDlvG9qH","msg":"User credentials created"}
{"level":30,"time":1764880308100,"env":"test","module":"auth-routes","userId":"g8B-pQwziHkWTgDlvG9qH","email":"test-workflows-lqirp2NRIZBajjbFPYXpz@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"8fe4bf7d-feb4-4740-a56b-8fd942ac559c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"g8B-pQwziHkWTgDlvG9qH","tenantId":"0dff5800-84df-4889-a22f-e78570a67d45","createdBy":"g8B-pQwziHkWTgDlvG9qH","ownerId":"g8B-pQwziHkWTgDlvG9qH","status":"active","archived":false,"createdAt":"2025-12-04T20:31:49.824Z","updatedAt":"2025-12-04T20:31:49.824Z"}

{"level":30,"time":1764880308809,"env":"test","module":"user-credentials-repository","userId":"Rcb32LrQ4hOgGC8IMjNBF","msg":"User credentials created"}
{"level":30,"time":1764880308810,"env":"test","module":"auth-routes","userId":"Rcb32LrQ4hOgGC8IMjNBF","email":"viewer-SutZJZM8MXYXMsy33FkVe@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880308903,"env":"test","module":"rbac-middleware","userId":"Rcb32LrQ4hOgGC8IMjNBF","userRole":"viewer","permission":"workflow:create","path":"/projects/8fe4bf7d-feb4-4740-a56b-8fd942ac559c/workflows","msg":"Permission denied"}
{"level":50,"time":1764880314725,"env":"test","error":{},"workflowId":"935a5911-7843-4d80-8c5e-15257174782d","userId":"g8B-pQwziHkWTgDlvG9qH","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764880315201,"env":"test","error":{},"workflowId":"f4d7f410-e586-4841-b7ec-7779ac197a2a","userId":"g8B-pQwziHkWTgDlvG9qH","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880315537,"env":"test","module":"auth-middleware","path":"/api/workflows/60d2bd6e-7629-4140-a51d-6f167355c58d/move","msg":"No valid authentication found"}
{"level":30,"time":1764880316120,"env":"test","module":"user-credentials-repository","userId":"2WxvwW6H3QLO3bZZXit5_","msg":"User credentials created"}
{"level":30,"time":1764880316120,"env":"test","module":"auth-routes","userId":"2WxvwW6H3QLO3bZZXit5_","email":"test-workflows-gsr9lmrjdid-rRlN5faUj@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880316215,"env":"test","error":{},"workflowId":"972bc66c-be4b-4cae-87a0-dfbffe30fe71","userId":"2WxvwW6H3QLO3bZZXit5_","projectId":"15432cc2-8144-4a39-8351-033fa45f9d91","msg":"Error moving workflow"}
{"level":50,"time":1764880316588,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"09b62c9e-39de-4cf1-abc5-b93f4d0bf991","userId":"g8B-pQwziHkWTgDlvG9qH","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880316950,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"5bbd19d8-8f70-4103-b35a-77645c1a9fd4","userId":"g8B-pQwziHkWTgDlvG9qH","msg":"Error moving workflow"}
{"level":30,"time":1764880317467,"env":"test","module":"user-credentials-repository","userId":"lqa7cZ6esjiv5fEArJBsG","msg":"User credentials created"}
{"level":30,"time":1764880317468,"env":"test","module":"auth-routes","userId":"lqa7cZ6esjiv5fEArJBsG","email":"test-workflows-KhWptcJZUhrf917ENAmMF@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880317688,"env":"test","module":"auth-routes","userId":"lqa7cZ6esjiv5fEArJBsG","email":"test-workflows-KhWptcJZUhrf917ENAmMF@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880317877,"env":"test","error":{},"workflowId":"4916f104-37f1-4973-b92c-49b3acbf4a42","userId":"g8B-pQwziHkWTgDlvG9qH","projectId":"0506d6cd-416f-4a0a-a1f1-f456769b6ffc","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 10561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 582[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 618[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 671[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 335[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 679[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 372[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 362[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 927[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:332:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:36
[2m   Duration [22m 20.84s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/versions.routes.ts [22m[34mx36 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764880322318,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880324469,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880328777,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880328778,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880328788,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880328788,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880328789,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880328789,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880329223,"env":"test","module":"user-credentials-repository","userId":"0zRAkpwg7QzzExKIiugIV","msg":"User credentials created"}
{"level":30,"time":1764880329226,"env":"test","module":"auth-routes","userId":"0zRAkpwg7QzzExKIiugIV","email":"test-workflows-a4pdtD-xypk4JqxNXHk4j@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"48360971-9094-4952-a997-efcc1af16dc9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"0zRAkpwg7QzzExKIiugIV","tenantId":"48ce2f1d-3e72-4caa-9c01-919f53aae4d5","createdBy":"0zRAkpwg7QzzExKIiugIV","ownerId":"0zRAkpwg7QzzExKIiugIV","status":"active","archived":false,"createdAt":"2025-12-04T20:32:10.946Z","updatedAt":"2025-12-04T20:32:10.946Z"}

{"level":30,"time":1764880329885,"env":"test","module":"user-credentials-repository","userId":"Q-u4zkbD6yh708MBxdFiO","msg":"User credentials created"}
{"level":30,"time":1764880329886,"env":"test","module":"auth-routes","userId":"Q-u4zkbD6yh708MBxdFiO","email":"viewer--2JJap1YkUd8RbZCXXVyi@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880329977,"env":"test","module":"rbac-middleware","userId":"Q-u4zkbD6yh708MBxdFiO","userRole":"viewer","permission":"workflow:create","path":"/projects/48360971-9094-4952-a997-efcc1af16dc9/workflows","msg":"Permission denied"}
{"level":50,"time":1764880335323,"env":"test","error":{},"workflowId":"ae9f1b79-abd2-4c70-a590-3355fe346550","userId":"0zRAkpwg7QzzExKIiugIV","projectId":"6f17322c-0322-410e-acd3-2bd4843713ab","msg":"Error moving workflow"}
{"level":50,"time":1764880335446,"env":"test","error":{},"workflowId":"ae9f1b79-abd2-4c70-a590-3355fe346550","userId":"0zRAkpwg7QzzExKIiugIV","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764880335885,"env":"test","error":{},"workflowId":"355fc14e-0b7f-4f94-ac0a-6ad70d260ee7","userId":"0zRAkpwg7QzzExKIiugIV","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880336193,"env":"test","module":"auth-middleware","path":"/api/workflows/fdf0a843-9587-4d12-8c2e-f3f618cc76a5/move","msg":"No valid authentication found"}
{"level":30,"time":1764880336685,"env":"test","module":"user-credentials-repository","userId":"zjlubIX_Pk_2nN-CNsSga","msg":"User credentials created"}
{"level":30,"time":1764880336685,"env":"test","module":"auth-routes","userId":"zjlubIX_Pk_2nN-CNsSga","email":"test-workflows-OLz1T44gfEqkJ2bEtmBTH@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880336780,"env":"test","error":{},"workflowId":"6636f27b-9bc0-4e00-ac59-7398909ef878","userId":"zjlubIX_Pk_2nN-CNsSga","projectId":"e97d74e8-ee60-4e33-9ff8-c7bc67fc3fb7","msg":"Error moving workflow"}
{"level":50,"time":1764880337132,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"2536ea19-cea7-4cee-9c44-c488b69d662f","userId":"0zRAkpwg7QzzExKIiugIV","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880337473,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"051e6f2c-d5fe-41f7-8505-818d1fa3fcda","userId":"0zRAkpwg7QzzExKIiugIV","msg":"Error moving workflow"}
{"level":50,"time":1764880337646,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(0zRAkpwg7QzzExKIiugIV) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"0zRAkpwg7QzzExKIiugIV","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 9136[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 313[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 606[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 439[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 307[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 341[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 174[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:332:10
    330|         .set("Authorization", `Bearer ${authToken}`)
    331|         .send({ projectId: null })
    332|         .expect(200);
       |          ^
    333| 
    334|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
    385|         .set("Authorization", `Bearer ${authToken2}`)
    386|         .send({ projectId: targetProjectId })
    387|         .expect(403);
       |          ^
    388| 
    389|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:31:58
[2m   Duration [22m 18.77s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/runs.routes.ts [22m[34mx37 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764880371842,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764880375006,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764880378820,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764880378821,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764880378833,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764880378834,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764880378834,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764880378834,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764880379350,"env":"test","module":"user-credentials-repository","userId":"uQo_fe2Tzg1IvcdG90s-P","msg":"User credentials created"}
{"level":30,"time":1764880379353,"env":"test","module":"auth-routes","userId":"uQo_fe2Tzg1IvcdG90s-P","email":"test-workflows-oZhJST1Gd_uj4SRfBV_4o@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"85dba79d-0528-456f-b0e1-e863b12d242f","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"uQo_fe2Tzg1IvcdG90s-P","tenantId":"0a998e8f-94d6-4892-9bbd-ecfd1d36199b","createdBy":"uQo_fe2Tzg1IvcdG90s-P","ownerId":"uQo_fe2Tzg1IvcdG90s-P","status":"active","archived":false,"createdAt":"2025-12-04T20:33:01.095Z","updatedAt":"2025-12-04T20:33:01.095Z"}

{"level":30,"time":1764880380085,"env":"test","module":"user-credentials-repository","userId":"0qnjaaTBepTKjbT5fxXTM","msg":"User credentials created"}
{"level":30,"time":1764880380085,"env":"test","module":"auth-routes","userId":"0qnjaaTBepTKjbT5fxXTM","email":"viewer-2eoJZ2o6MGjP1CjgtSDYE@example.com","msg":"User registered successfully"}
{"level":40,"time":1764880380181,"env":"test","module":"rbac-middleware","userId":"0qnjaaTBepTKjbT5fxXTM","userRole":"viewer","permission":"workflow:create","path":"/projects/85dba79d-0528-456f-b0e1-e863b12d242f/workflows","msg":"Permission denied"}
{"level":50,"time":1764880386634,"env":"test","error":{},"workflowId":"dacdaae1-7a74-48ba-8eca-16973a299af6","userId":"uQo_fe2Tzg1IvcdG90s-P","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764880386985,"env":"test","module":"auth-middleware","path":"/api/workflows/0f2d4fb5-b2a5-462b-b77e-fec527e5984d/move","msg":"No valid authentication found"}
{"level":30,"time":1764880387519,"env":"test","module":"user-credentials-repository","userId":"2uDfNat1hplMkxf-n9dM4","msg":"User credentials created"}
{"level":30,"time":1764880387520,"env":"test","module":"auth-routes","userId":"2uDfNat1hplMkxf-n9dM4","email":"test-workflows-S1KP7im4aFzyf8YBE_0Qs@example.com","msg":"User registered successfully"}
{"level":50,"time":1764880387572,"env":"test","error":{},"workflowId":"51c3bb0e-fba0-4a19-b47d-68ea2313e617","userId":"2uDfNat1hplMkxf-n9dM4","projectId":"4929e61a-51c1-4595-b4c7-22f5c0d29bc4","msg":"Error moving workflow"}
{"level":50,"time":1764880387948,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"bb1ac68a-885f-4117-ba00-6613c5c5fd89","userId":"uQo_fe2Tzg1IvcdG90s-P","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764880388333,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9730a05a-8b07-43b2-b2e4-a3c177f0e2c6","userId":"uQo_fe2Tzg1IvcdG90s-P","msg":"Error moving workflow"}
{"level":30,"time":1764880388847,"env":"test","module":"user-credentials-repository","userId":"UtLHYFyy-doybMvo3AVy4","msg":"User credentials created"}
{"level":30,"time":1764880388848,"env":"test","module":"auth-routes","userId":"UtLHYFyy-doybMvo3AVy4","email":"test-workflows-onbWLM6Ytkki9JFHqsfjR@example.com","msg":"User registered successfully"}
{"level":30,"time":1764880389049,"env":"test","module":"auth-routes","userId":"UtLHYFyy-doybMvo3AVy4","email":"test-workflows-onbWLM6Ytkki9JFHqsfjR@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764880389232,"env":"test","error":{},"workflowId":"52c26217-a267-4d35-8e12-d64cb3e678ac","userId":"uQo_fe2Tzg1IvcdG90s-P","projectId":"193707d8-e9cc-42a1-8963-ec0f934ef9e8","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10691[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 306[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 819[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 598[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 514[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 385[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 900[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 14:32:47
[2m   Duration [22m 20.95s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx38 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764891574717,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764891577303,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764891580772,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764891580773,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764891580787,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764891580787,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764891580788,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764891580788,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764891581341,"env":"test","module":"user-credentials-repository","userId":"rhEwfyQTgKubEB6Ot2x5u","msg":"User credentials created"}
{"level":30,"time":1764891581345,"env":"test","module":"auth-routes","userId":"rhEwfyQTgKubEB6Ot2x5u","email":"test-workflows-QqXwIxINuhCCPXewySoo7@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"233c8a29-3f77-426e-863f-ac10a45bf1a1","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"rhEwfyQTgKubEB6Ot2x5u","tenantId":"ff384987-ae68-4cda-bee8-ec6f1c164421","createdBy":"rhEwfyQTgKubEB6Ot2x5u","ownerId":"rhEwfyQTgKubEB6Ot2x5u","status":"active","archived":false,"createdAt":"2025-12-04T23:39:43.257Z","updatedAt":"2025-12-04T23:39:43.257Z"}

{"level":30,"time":1764891582094,"env":"test","module":"user-credentials-repository","userId":"v-4anW0vJsJruijaLo_Rh","msg":"User credentials created"}
{"level":30,"time":1764891582095,"env":"test","module":"auth-routes","userId":"v-4anW0vJsJruijaLo_Rh","email":"viewer-QfBBJ7W9AVYVPWIgQuzbY@example.com","msg":"User registered successfully"}
{"level":40,"time":1764891582196,"env":"test","module":"rbac-middleware","userId":"v-4anW0vJsJruijaLo_Rh","userRole":"viewer","permission":"workflow:create","path":"/projects/233c8a29-3f77-426e-863f-ac10a45bf1a1/workflows","msg":"Permission denied"}
{"level":50,"time":1764891588689,"env":"test","error":{},"workflowId":"c14de3aa-4490-4acf-a6b0-3b07ef11b7bf","userId":"rhEwfyQTgKubEB6Ot2x5u","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764891589031,"env":"test","module":"auth-middleware","path":"/api/workflows/c4dc779e-f976-4bb2-8bdb-aa8632b4151e/move","msg":"No valid authentication found"}
{"level":30,"time":1764891589554,"env":"test","module":"user-credentials-repository","userId":"Go9q-oYHiXiBKRN_87lnR","msg":"User credentials created"}
{"level":30,"time":1764891589555,"env":"test","module":"auth-routes","userId":"Go9q-oYHiXiBKRN_87lnR","email":"test-workflows-U4KgdiZNQkK1-HWqE3mn_@example.com","msg":"User registered successfully"}
{"level":50,"time":1764891589605,"env":"test","error":{},"workflowId":"f1a6c8bf-df0b-40ab-beee-d27ced7b1ef3","userId":"Go9q-oYHiXiBKRN_87lnR","projectId":"d5fa0e5d-6ceb-4149-8956-cec650ba5f68","msg":"Error moving workflow"}
{"level":50,"time":1764891589989,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"40e7c488-5ee9-4325-91d9-dd9c176369d0","userId":"rhEwfyQTgKubEB6Ot2x5u","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764891590371,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"de86a49a-b691-431d-aa6c-ebce97c512a6","userId":"rhEwfyQTgKubEB6Ot2x5u","msg":"Error moving workflow"}
{"level":30,"time":1764891590931,"env":"test","module":"user-credentials-repository","userId":"yye702yVDaNI_t96E9trT","msg":"User credentials created"}
{"level":30,"time":1764891590931,"env":"test","module":"auth-routes","userId":"yye702yVDaNI_t96E9trT","email":"test-workflows-5ZojqDyD21kJuZGZqsRwK@example.com","msg":"User registered successfully"}
{"level":30,"time":1764891591125,"env":"test","module":"auth-routes","userId":"yye702yVDaNI_t96E9trT","email":"test-workflows-5ZojqDyD21kJuZGZqsRwK@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764891591320,"env":"test","error":{},"workflowId":"1b97b90d-bd4e-470c-88f7-48bb82b4c2aa","userId":"rhEwfyQTgKubEB6Ot2x5u","projectId":"7611e34d-8826-447d-bd77-4bd5d43d8032","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 498[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 483[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 804[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 621[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 778[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 676[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 780[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 385[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 382[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 950[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:39:28
[2m   Duration [22m 21.65s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/middleware/auth.ts [22m[34mx39 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764892167310,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892169994,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892173575,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892173575,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892173588,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892173588,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892173588,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892173588,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892174100,"env":"test","module":"user-credentials-repository","userId":"3KykIoFDLK4X1B23PaYtD","msg":"User credentials created"}
{"level":30,"time":1764892174103,"env":"test","module":"auth-routes","userId":"3KykIoFDLK4X1B23PaYtD","email":"test-workflows-WfjTdzF96uAOg7OL4bLEh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"eee8677d-cec8-4fc6-bc1f-93ddd8404ddd","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"3KykIoFDLK4X1B23PaYtD","tenantId":"0414cd4a-0552-4686-97b7-e65674014eb9","createdBy":"3KykIoFDLK4X1B23PaYtD","ownerId":"3KykIoFDLK4X1B23PaYtD","status":"active","archived":false,"createdAt":"2025-12-04T23:49:36.027Z","updatedAt":"2025-12-04T23:49:36.027Z"}

{"level":30,"time":1764892174786,"env":"test","module":"user-credentials-repository","userId":"xMYSCDMtnRgwPJsHH3hWi","msg":"User credentials created"}
{"level":30,"time":1764892174787,"env":"test","module":"auth-routes","userId":"xMYSCDMtnRgwPJsHH3hWi","email":"viewer-p6EOj6b4gbnZVMxM5Xr-c@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892174875,"env":"test","module":"rbac-middleware","userId":"xMYSCDMtnRgwPJsHH3hWi","userRole":"viewer","permission":"workflow:create","path":"/projects/eee8677d-cec8-4fc6-bc1f-93ddd8404ddd/workflows","msg":"Permission denied"}
{"level":50,"time":1764892180926,"env":"test","error":{},"workflowId":"e4fb790b-6c7c-473a-82b1-9d275fce1637","userId":"3KykIoFDLK4X1B23PaYtD","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892181229,"env":"test","module":"auth-middleware","path":"/api/workflows/517a0908-a0da-4cee-88e7-6e44292cc07a/move","msg":"No valid authentication found"}
{"level":30,"time":1764892181728,"env":"test","module":"user-credentials-repository","userId":"S9JHpJXNDPllKYEBd5B95","msg":"User credentials created"}
{"level":30,"time":1764892181729,"env":"test","module":"auth-routes","userId":"S9JHpJXNDPllKYEBd5B95","email":"test-workflows-G_tbiXDd6wNS77wQxxVtH@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892181773,"env":"test","error":{},"workflowId":"6d7e6f14-9377-4acb-9a0a-ea886cbb978f","userId":"S9JHpJXNDPllKYEBd5B95","projectId":"65a52f18-d34d-4142-86bd-3b9e193f1767","msg":"Error moving workflow"}
{"level":50,"time":1764892182132,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3f3d8453-7a82-4f90-a7fc-e2ebf0ada141","userId":"3KykIoFDLK4X1B23PaYtD","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892182497,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"085a8051-8cc4-4cfa-ace0-d57b3971d4cc","userId":"3KykIoFDLK4X1B23PaYtD","msg":"Error moving workflow"}
{"level":30,"time":1764892182980,"env":"test","module":"user-credentials-repository","userId":"44eDStZLq1El3oJtF-LuN","msg":"User credentials created"}
{"level":30,"time":1764892182981,"env":"test","module":"auth-routes","userId":"44eDStZLq1El3oJtF-LuN","email":"test-workflows-9lS4o6w8CReX3-wRKt0fu@example.com","msg":"User registered successfully"}
{"level":30,"time":1764892183175,"env":"test","module":"auth-routes","userId":"44eDStZLq1El3oJtF-LuN","email":"test-workflows-9lS4o6w8CReX3-wRKt0fu@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764892183355,"env":"test","error":{},"workflowId":"558410d7-d23b-4e10-ba09-0a47e5e39067","userId":"3KykIoFDLK4X1B23PaYtD","projectId":"af7cd968-7c7b-4ddd-bddc-3d01a0d3249d","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10122[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 331[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 289[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 569[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 302[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 360[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 858[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:49:20
[2m   Duration [22m 22.09s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx40 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764892481588,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892485467,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892488289,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892488290,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892488300,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892488300,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892488300,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892488300,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892488781,"env":"test","module":"user-credentials-repository","userId":"MWPKJekhgzUtNqtKu-ypl","msg":"User credentials created"}
{"level":30,"time":1764892488784,"env":"test","module":"auth-routes","userId":"MWPKJekhgzUtNqtKu-ypl","email":"test-workflows-O_XLqfuzixUXibEHF0g5p@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b3e4b371-226a-495d-8bc8-45f6a0a52b78","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"MWPKJekhgzUtNqtKu-ypl","tenantId":"c56ef39c-e30f-4d55-9fa8-0af7b1fe96ee","createdBy":"MWPKJekhgzUtNqtKu-ypl","ownerId":"MWPKJekhgzUtNqtKu-ypl","status":"active","archived":false,"createdAt":"2025-12-04T23:54:50.717Z","updatedAt":"2025-12-04T23:54:50.717Z"}

{"level":30,"time":1764892489483,"env":"test","module":"user-credentials-repository","userId":"TCmDDwcFLecM9jfUQfTDT","msg":"User credentials created"}
{"level":30,"time":1764892489484,"env":"test","module":"auth-routes","userId":"TCmDDwcFLecM9jfUQfTDT","email":"viewer-JAZCmtFcqR7stb4QWPfCF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892489581,"env":"test","module":"rbac-middleware","userId":"TCmDDwcFLecM9jfUQfTDT","userRole":"viewer","permission":"workflow:create","path":"/projects/b3e4b371-226a-495d-8bc8-45f6a0a52b78/workflows","msg":"Permission denied"}
{"level":50,"time":1764892496170,"env":"test","error":{},"workflowId":"cc0bab65-0d95-4fd0-8a07-2318c3faceb1","userId":"MWPKJekhgzUtNqtKu-ypl","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892496527,"env":"test","module":"auth-middleware","path":"/api/workflows/918d443e-e17e-494a-884e-99b4e9af24d9/move","msg":"No valid authentication found"}
{"level":30,"time":1764892497108,"env":"test","module":"user-credentials-repository","userId":"YgBJk_ZeIeUornMs9TaWL","msg":"User credentials created"}
{"level":30,"time":1764892497108,"env":"test","module":"auth-routes","userId":"YgBJk_ZeIeUornMs9TaWL","email":"test-workflows-WF2od0tlgoDWBCM_tIt5F@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892497207,"env":"test","error":{},"workflowId":"a417a1dd-14a4-434f-894f-672e2b1e2ad9","userId":"YgBJk_ZeIeUornMs9TaWL","projectId":"dfbf4ec1-3760-4890-b9fb-03ef3a0f1f2e","msg":"Error moving workflow"}
{"level":50,"time":1764892497592,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f6064c80-1a3a-4983-9d4d-17330f226e6f","userId":"MWPKJekhgzUtNqtKu-ypl","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892497988,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4b54b199-ee52-4f84-9be4-17c8db6378b8","userId":"MWPKJekhgzUtNqtKu-ypl","msg":"Error moving workflow"}
{"level":50,"time":1764892498183,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(MWPKJekhgzUtNqtKu-ypl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"MWPKJekhgzUtNqtKu-ypl","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10168[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 491[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 496[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 670[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 704[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 357[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 683[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 382[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 395[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 196[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:36
[2m   Duration [22m 20.72s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/auth.routes.ts [22m[34mx41 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764892502679,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764892504782,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764892507101,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764892507102,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764892507113,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764892507113,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764892507113,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764892507113,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764892507575,"env":"test","module":"user-credentials-repository","userId":"woaG8CPmKZ8FY3RPkIskQ","msg":"User credentials created"}
{"level":30,"time":1764892507579,"env":"test","module":"auth-routes","userId":"woaG8CPmKZ8FY3RPkIskQ","email":"test-workflows-3LqWJf_7rqGkrxaWtD3w8@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"66c2784b-119d-45ca-8264-ad8ddb0f4c9a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"woaG8CPmKZ8FY3RPkIskQ","tenantId":"a0987457-39be-4ff1-b18b-2bf4fbb0aab7","createdBy":"woaG8CPmKZ8FY3RPkIskQ","ownerId":"woaG8CPmKZ8FY3RPkIskQ","status":"active","archived":false,"createdAt":"2025-12-04T23:55:09.507Z","updatedAt":"2025-12-04T23:55:09.507Z"}

{"level":30,"time":1764892508254,"env":"test","module":"user-credentials-repository","userId":"UY4KrGgLCl7LAne0q5D5Q","msg":"User credentials created"}
{"level":30,"time":1764892508255,"env":"test","module":"auth-routes","userId":"UY4KrGgLCl7LAne0q5D5Q","email":"viewer-sivkxM_m-y5aXqvIxdDZF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764892508351,"env":"test","module":"rbac-middleware","userId":"UY4KrGgLCl7LAne0q5D5Q","userRole":"viewer","permission":"workflow:create","path":"/projects/66c2784b-119d-45ca-8264-ad8ddb0f4c9a/workflows","msg":"Permission denied"}
{"level":50,"time":1764892514809,"env":"test","error":{},"workflowId":"70633d88-875f-4510-8bb2-92c17db3855f","userId":"woaG8CPmKZ8FY3RPkIskQ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764892515127,"env":"test","module":"auth-middleware","path":"/api/workflows/309255b0-8995-40d4-b779-05b9af87d6b2/move","msg":"No valid authentication found"}
{"level":30,"time":1764892515675,"env":"test","module":"user-credentials-repository","userId":"9sj2qTTgvKe9hYTRwUGW2","msg":"User credentials created"}
{"level":30,"time":1764892515676,"env":"test","module":"auth-routes","userId":"9sj2qTTgvKe9hYTRwUGW2","email":"test-workflows-3cdCfyu3BUQOGPAHolvPU@example.com","msg":"User registered successfully"}
{"level":50,"time":1764892515728,"env":"test","error":{},"workflowId":"25a8971d-873d-48cc-b730-f1c16139db95","userId":"9sj2qTTgvKe9hYTRwUGW2","projectId":"4ce90ca8-a99b-4386-8f0b-58f7da832b7d","msg":"Error moving workflow"}
{"level":50,"time":1764892516123,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8f8991d2-553c-4483-8c06-2e8fe1906b06","userId":"woaG8CPmKZ8FY3RPkIskQ","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764892516488,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"dbaf0a96-ade8-4349-a189-371e8b4d32f9","userId":"woaG8CPmKZ8FY3RPkIskQ","msg":"Error moving workflow"}
{"level":50,"time":1764892516668,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(woaG8CPmKZ8FY3RPkIskQ) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"woaG8CPmKZ8FY3RPkIskQ","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9843[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 330[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 812[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 651[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 861[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 395[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 178[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:286:15
    284| 
    285|       if (workflowResponse.status !== 201) {
    286|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    287|       }
    288|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 17:54:58
[2m   Duration [22m 17.49s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx42 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764895077411,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895080833,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895084966,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895084966,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895084976,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895084976,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895084977,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895084977,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895085506,"env":"test","module":"user-credentials-repository","userId":"yh3iCquUfn0GQbSdDjM9w","msg":"User credentials created"}
{"level":30,"time":1764895085511,"env":"test","module":"auth-routes","userId":"yh3iCquUfn0GQbSdDjM9w","email":"test-workflows-ilEQ3qwWf9Ct9dC1aI9_W@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e5f55dcb-d3e0-4488-b9fe-cd93a5ba0396","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"yh3iCquUfn0GQbSdDjM9w","tenantId":"61717173-6dd9-41f8-8ba8-87b1d9a3b51a","createdBy":"yh3iCquUfn0GQbSdDjM9w","ownerId":"yh3iCquUfn0GQbSdDjM9w","status":"active","archived":false,"createdAt":"2025-12-05T00:38:05.677Z","updatedAt":"2025-12-05T00:38:05.677Z"}

{"level":30,"time":1764895086245,"env":"test","module":"user-credentials-repository","userId":"QvhQrNVw0ABKkKXGR3BAn","msg":"User credentials created"}
{"level":30,"time":1764895086246,"env":"test","module":"auth-routes","userId":"QvhQrNVw0ABKkKXGR3BAn","email":"viewer-0Iwe5bo31ybAnZ14kOti1@example.com","msg":"User registered successfully"}
{"level":40,"time":1764895086342,"env":"test","module":"rbac-middleware","userId":"QvhQrNVw0ABKkKXGR3BAn","userRole":"viewer","permission":"workflow:create","path":"/projects/e5f55dcb-d3e0-4488-b9fe-cd93a5ba0396/workflows","msg":"Permission denied"}
{"level":50,"time":1764895092703,"env":"test","error":{},"workflowId":"d1af80c1-dd17-4be6-a478-41f393402a96","userId":"yh3iCquUfn0GQbSdDjM9w","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764895093040,"env":"test","module":"auth-middleware","path":"/api/workflows/206ff10f-7597-4d9f-9007-691aae936218/move","msg":"No valid authentication found"}
{"level":30,"time":1764895093584,"env":"test","module":"user-credentials-repository","userId":"RqbnhKrJjbSPudBwyIWqb","msg":"User credentials created"}
{"level":30,"time":1764895093585,"env":"test","module":"auth-routes","userId":"RqbnhKrJjbSPudBwyIWqb","email":"test-workflows-RIHds2-spk0eXkWnA-x3B@example.com","msg":"User registered successfully"}
{"level":50,"time":1764895093629,"env":"test","error":{},"workflowId":"aeee8852-4fa4-4886-8f88-99a0eb732a6c","userId":"RqbnhKrJjbSPudBwyIWqb","projectId":"4ac7aa4e-d8d0-429f-af60-ce3ee9aede37","msg":"Error moving workflow"}
{"level":50,"time":1764895093988,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"98e5bb4e-914a-4553-9eab-5ab15f47e250","userId":"yh3iCquUfn0GQbSdDjM9w","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764895094359,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"82f1746f-814f-4c0c-a813-b1cb2bcf5838","userId":"yh3iCquUfn0GQbSdDjM9w","msg":"Error moving workflow"}
{"level":50,"time":1764895094874,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(1P93eMJ59n2xC6sUcCe1K) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"1P93eMJ59n2xC6sUcCe1K","msg":"Failed to create user credentials"}
{"level":50,"time":1764895094874,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(1P93eMJ59n2xC6sUcCe1K) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 345[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 810[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 618[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 335[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 589[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 371[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 516[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 18:37:52
[2m   Duration [22m 21.53s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes.ts [22m[34mx43 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (13) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764895096855,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764895097888,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests

{"level":30,"time":1764895099140,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764895099141,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764895099151,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764895099151,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764895099152,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764895099152,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764895099573,"env":"test","module":"user-credentials-repository","userId":"jRepV8yA-W2ElObD4IJyT","msg":"User credentials created"}
{"level":30,"time":1764895099575,"env":"test","module":"auth-routes","userId":"jRepV8yA-W2ElObD4IJyT","email":"test-workflows-Zn9yogUpyOT4D-vbIrPA6@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"4c85142d-b3ec-4597-bf37-f98395a62b11","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"jRepV8yA-W2ElObD4IJyT","tenantId":"23eae2ed-01d8-4de8-ab4f-3595e6a977cd","createdBy":"jRepV8yA-W2ElObD4IJyT","ownerId":"jRepV8yA-W2ElObD4IJyT","status":"active","archived":false,"createdAt":"2025-12-05T00:38:19.724Z","updatedAt":"2025-12-05T00:38:19.724Z"}

{"level":30,"time":1764895100199,"env":"test","module":"user-credentials-repository","userId":"7wa0JjyDOEnG_lj2hC8Lf","msg":"User credentials created"}
{"level":30,"time":1764895100199,"env":"test","module":"auth-routes","userId":"7wa0JjyDOEnG_lj2hC8Lf","email":"viewer-Ent3V2SYuCrd0SRpfNtkP@example.com","msg":"User registered successfully"}
{"level":40,"time":1764895100285,"env":"test","module":"rbac-middleware","userId":"7wa0JjyDOEnG_lj2hC8Lf","userRole":"viewer","permission":"workflow:create","path":"/projects/4c85142d-b3ec-4597-bf37-f98395a62b11/workflows","msg":"Permission denied"}
{"level":50,"time":1764895106298,"env":"test","error":{},"workflowId":"07215888-f1e2-4fe1-b977-fe31fc8acd33","userId":"jRepV8yA-W2ElObD4IJyT","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764895106606,"env":"test","module":"auth-middleware","path":"/api/workflows/448de22f-7120-45fe-952c-c1949232c55d/move","msg":"No valid authentication found"}
{"level":30,"time":1764895107104,"env":"test","module":"user-credentials-repository","userId":"ZmNOISN9TLs2GP5F6KJiX","msg":"User credentials created"}
{"level":30,"time":1764895107104,"env":"test","module":"auth-routes","userId":"ZmNOISN9TLs2GP5F6KJiX","email":"test-workflows-VHgq2fRYIEG6zpd8R4-Es@example.com","msg":"User registered successfully"}
{"level":50,"time":1764895107148,"env":"test","error":{},"workflowId":"a29d8334-10bb-4c03-842a-ff9a9c0aa58e","userId":"ZmNOISN9TLs2GP5F6KJiX","projectId":"9c8b2047-0e5b-45d9-bf54-6c3e4d38d013","msg":"Error moving workflow"}
{"level":50,"time":1764895107498,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"57896d99-e1ab-4047-8fdc-6b935c2691b1","userId":"jRepV8yA-W2ElObD4IJyT","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764895107846,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e2d45960-500f-428c-ae25-6e46978b55a3","userId":"jRepV8yA-W2ElObD4IJyT","msg":"Error moving workflow"}
{"level":30,"time":1764895108335,"env":"test","module":"user-credentials-repository","userId":"inl3bZjgs1o5wPtLjvqM0","msg":"User credentials created"}
{"level":30,"time":1764895108336,"env":"test","module":"auth-routes","userId":"inl3bZjgs1o5wPtLjvqM0","email":"test-workflows-6ZTBlAtnjla2GzJJwGfg4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764895108522,"env":"test","module":"auth-routes","userId":"inl3bZjgs1o5wPtLjvqM0","email":"test-workflows-6ZTBlAtnjla2GzJJwGfg4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764895108700,"env":"test","error":{},"workflowId":"89eb0714-3de9-4e95-bf18-cbb5f7e53f8c","userId":"jRepV8yA-W2ElObD4IJyT","projectId":"725af8c4-84a2-433b-b56d-dedd2564e3e8","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9824[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 309[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 426[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 552[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 671[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 307[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 542[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 351[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 855[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 18:38:15
[2m   Duration [22m 13.33s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
